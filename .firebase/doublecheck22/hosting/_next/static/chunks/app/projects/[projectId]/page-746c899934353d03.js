(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{5401:(e,t,r)=>{Promise.resolve().then(r.bind(r,7749))},7749:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>tj});var a=r(2221),s=r(1801),n=r(7386),l=r(4542),o=r(7127),i=r(2441),d=r(8637),c=r.n(d),m=r(7933);let u={planning:{gradient:"from-blue-500 to-cyan-500",icon:"\uD83D\uDCDD"},"pre-production":{gradient:"from-amber-500 to-yellow-500",icon:"⚙️"},production:{gradient:"from-green-500 to-emerald-500",icon:"\uD83C\uDFAC"},"post-production":{gradient:"from-purple-500 to-pink-500",icon:"✂️"},completed:{gradient:"from-gray-500 to-slate-500",icon:"✓"},archived:{gradient:"from-gray-700 to-gray-800",icon:"\uD83D\uDCE6"}};function x(e){let{project:t,projectId:r,onNavigate:s}=e;(0,l.useRouter)();let n=u[t.status]||u.planning;return(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsxs)("div",{className:"card-elevated mb-8 overflow-hidden relative",children:[t.coverImageUrl&&(0,a.jsx)("div",{className:"relative w-full h-64 overflow-hidden bg-background-secondary",children:(0,a.jsx)(m.default,{src:t.coverImageUrl,alt:t.title,fill:!0,className:"object-cover",sizes:"100vw"})}),(0,a.jsx)("div",{className:"p-8",children:(0,a.jsxs)("div",{className:"flex items-start gap-6 relative",children:[!t.coverImageUrl&&(0,a.jsx)("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br ".concat(n.gradient," flex items-center justify-center text-4xl shadow-xl flex-shrink-0"),children:n.icon}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-2 text-text-primary",children:t.title}),(0,a.jsxs)("p",{className:"text-text-secondary text-lg mb-4",children:["Client: ",(0,a.jsx)("span",{className:"text-text-primary font-medium",children:t.client})]}),t.description&&(0,a.jsx)("p",{className:"text-text-secondary leading-relaxed",children:t.description})]}),(0,a.jsxs)("div",{className:"px-6 py-3 rounded-xl font-semibold flex items-center gap-2 bg-gradient-to-br ".concat(n.gradient," text-white shadow-lg"),children:[(0,a.jsx)("span",{children:n.icon}),(0,a.jsx)("span",{className:"capitalize",children:t.status.replace("-"," ")})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"card-elevated p-6",children:[(0,a.jsx)("div",{className:"text-text-tertiary text-sm font-medium mb-2",children:"Timeline"}),(0,a.jsxs)("div",{className:"text-2xl font-bold mb-1",children:[Math.ceil((new Date(t.endDate).getTime()-new Date(t.startDate).getTime())/864e5)," days"]}),(0,a.jsxs)("div",{className:"text-text-secondary text-sm",children:[new Date(t.startDate).toLocaleDateString()," - ",new Date(t.endDate).toLocaleDateString()]})]}),t.budget&&(0,a.jsxs)("div",{className:"card-elevated p-6",children:[(0,a.jsx)("div",{className:"text-text-tertiary text-sm font-medium mb-2",children:"Budget"}),(0,a.jsxs)("div",{className:"text-2xl font-bold mb-1",children:["$",t.budget.toLocaleString()]}),(0,a.jsx)("div",{className:"text-text-secondary text-sm",children:"Total allocated"})]}),(0,a.jsxs)("div",{className:"card-elevated p-6",children:[(0,a.jsx)("div",{className:"text-text-tertiary text-sm font-medium mb-2",children:"Last Updated"}),(0,a.jsx)("div",{className:"text-2xl font-bold mb-1",children:new Date(t.updatedAt).toLocaleDateString()}),(0,a.jsx)("div",{className:"text-text-secondary text-sm",children:new Date(t.updatedAt).toLocaleTimeString()})]})]}),(0,a.jsxs)("div",{className:"card-elevated p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("button",{onClick:()=>{s&&(s("admin"),sessionStorage.setItem("adminTab_".concat(r),"settings"))},className:"btn-secondary justify-center hover:bg-accent-primary/10 transition-colors",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDCDD"}),"Edit Details"]}),(0,a.jsxs)("button",{onClick:()=>{let e=new Blob([JSON.stringify({project:{title:t.title,client:t.client,description:t.description,status:t.status,budget:t.budget,startDate:t.startDate,endDate:t.endDate},exportedAt:new Date().toISOString()},null,2)],{type:"application/json"}),r=URL.createObjectURL(e),a=document.createElement("a");a.href=r,a.download="".concat(t.title.replace(/[^a-z0-9]/gi,"_"),"_export_").concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},className:"btn-secondary justify-center hover:bg-accent-primary/10 transition-colors",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDCE4"}),"Export Data"]}),(0,a.jsxs)("button",{onClick:()=>{s&&(s("admin"),sessionStorage.setItem("adminTab_".concat(r),"team"))},className:"btn-secondary justify-center hover:bg-accent-primary/10 transition-colors",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDC65"}),"Invite Team"]}),(0,a.jsxs)("button",{onClick:()=>{s&&s("analytics")},className:"btn-secondary justify-center hover:bg-accent-primary/10 transition-colors",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDCCA"}),"View Reports"]})]})]})]})}var p=r(7043),h=r(7767);function b(e){let{projectId:t,onClose:r}=e,{data:s=[],isLoading:n}=o.i.castTemplates.getAll.useQuery(),l=o.i.useUtils(),[d,c]=(0,i.useState)(null),[m,u]=(0,i.useState)(!0),[x,p]=(0,i.useState)(!1),h=o.i.castTemplates.applyTemplate.useMutation({onSuccess:e=>{l.cast.listByProject.invalidate({projectId:t}),alert("Template applied successfully! Created ".concat(e.rolesCreated," cast roles.").concat(e.rolesSkipped>0?" Skipped ".concat(e.rolesSkipped," existing roles."):"")),r()},onError:e=>{alert("Failed to apply template: ".concat(e.message))}}),b=async()=>{d&&await h.mutateAsync({projectId:t,templateId:d,skipExisting:m,overwriteExisting:x})},g=s.find(e=>e.id===d);return n?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary mx-auto"})})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Apply Cast Template"}),(0,a.jsx)("button",{onClick:r,className:"text-text-secondary hover:text-text-primary transition-colors",children:"✕"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:s.map(e=>(0,a.jsxs)("div",{onClick:()=>c(e.id),className:"p-4 border rounded-lg cursor-pointer transition-all ".concat(d===e.id?"border-accent-primary bg-accent-primary/10":"border-border-default hover:border-accent-primary/50"),children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-text-tertiary",children:[(0,a.jsx)("span",{className:"px-2 py-1 bg-background-secondary rounded",children:e.type}),(0,a.jsxs)("span",{children:[e.roles.length," roles"]})]})]},e.id))}),g&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary mb-3",children:"Template Preview"}),(0,a.jsx)("div",{className:"bg-background-secondary border border-border-default rounded-lg p-4 max-h-64 overflow-y-auto",children:(0,a.jsx)("div",{className:"space-y-2",children:g.roles.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-background-primary rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-text-primary",children:e.characterName}),(0,a.jsxs)("span",{className:"text-sm text-text-secondary ml-2",children:["(",e.castType,")"]}),e.quantity>1&&(0,a.jsxs)("span",{className:"text-text-tertiary ml-1",children:["(\xd7",e.quantity,")"]})]}),e.required&&(0,a.jsx)("span",{className:"text-accent-primary text-xs",children:"Required"})]},t))})})]}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"skipExisting",checked:m,onChange:e=>{u(e.target.checked),e.target.checked&&p(!1)},className:"w-4 h-4"}),(0,a.jsx)("label",{htmlFor:"skipExisting",className:"text-sm text-text-primary",children:"Skip existing roles (don't create duplicates)"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"overwriteExisting",checked:x,onChange:e=>{p(e.target.checked),e.target.checked&&u(!1)},className:"w-4 h-4"}),(0,a.jsx)("label",{htmlFor:"overwriteExisting",className:"text-sm text-text-primary",children:"Overwrite existing roles (update existing cast members)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 border border-border-default rounded-lg hover:bg-background-secondary transition-colors text-text-primary",children:"Cancel"}),(0,a.jsx)("button",{onClick:b,disabled:!d||h.isPending,className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"rgb(var(--colored-button-text))"},children:h.isPending?"Applying...":"Apply Template"})]})]})})}let g=[{value:"lead",label:"Lead Role"},{value:"supporting",label:"Supporting Role"},{value:"featured",label:"Featured"},{value:"extra",label:"Extra/Background"},{value:"stunt",label:"Stunt Performer"},{value:"voice",label:"Voice Only"}];function y(e){let{projectId:t}=e,{firebaseUser:r,user:s}=(0,p.A)(),n=o.i.useUtils(),[l,d]=(0,i.useState)(!1),[c,m]=(0,i.useState)(!1),[u,x]=(0,i.useState)(!1),[y,j]=(0,i.useState)(!1),[f,N]=(0,i.useState)(new Set),[k,w]=(0,i.useState)("grid"),[C,S]=(0,i.useState)(""),[D,I]=(0,i.useState)(null),[L,A]=(0,i.useState)(!1),[M,P]=(0,i.useState)(!1),[q,B]=(0,i.useState)(null),[Y,R]=(0,i.useState)(""),[E,T]=(0,i.useState)(new Set(g.map(e=>e.value))),[U,z]=(0,i.useState)({actorName:"",characterName:"",castType:"",photoUrl:"",email:"",phone:"",agent:"",rate:""}),{data:F,refetch:O}=o.i.projects.getById.useQuery({id:t}),{data:W=[],isLoading:V,error:H,refetch:_}=o.i.cast.listByProject.useQuery({projectId:t}),Q=o.i.cast.create.useMutation({onSuccess:()=>{_()}}),$=o.i.cast.update.useMutation({onSuccess:()=>{_()}}),G=o.i.cast.delete.useMutation({onSuccess:()=>{_()}}),K=o.i.projects.addCustomCastType.useMutation({onSuccess:()=>{O()}}),X=o.i.projects.removeCustomCastType.useMutation({onSuccess:()=>{O()}}),J=o.i.budget.createFromCast.useMutation({onSuccess:()=>{n.budget.getBudget.invalidate({projectId:t}),alert("Budget items created successfully!")}}),Z=o.i.cast.delete.useMutation({onSuccess:()=>{_(),N(new Set)}}),ee=e=>{let t=new Set(f);t.has(e)?t.delete(e):t.add(e),N(t)},et=(null==F?void 0:F.customCastTypes)||[],er=[...g,...et.map(e=>({value:e,label:e}))];(0,i.useEffect)(()=>{F&&et.length>0&&T(e=>{let t=new Set(e);return et.forEach(e=>t.add(e)),t})},[null==F?void 0:F.id,et.length]);let ea=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),es=e=>{let t=["from-purple-500 to-pink-500","from-blue-500 to-cyan-500","from-green-500 to-emerald-500","from-orange-500 to-red-500","from-pink-500 to-rose-500","from-indigo-500 to-purple-500","from-cyan-500 to-blue-500","from-amber-500 to-orange-500"],r=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0)%t.length;return t[r]},en=e=>{if(e&&e.type.startsWith("image/")){B(e);let t=URL.createObjectURL(e);z({...U,photoUrl:t})}},el=e=>{e.preventDefault(),A(!0)},eo=e=>{e.preventDefault(),A(!1)},ei=e=>{e.preventDefault(),A(!1);let t=e.dataTransfer.files[0];t&&en(t)},ed=e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&en(r)},ec=async e=>{if(e.preventDefault(),!r)return void alert("You must be logged in to add cast members");try{let e="";if(q){P(!0);let r=(0,h.generateUniqueFilename)(q.name),a="cast/".concat(t,"/").concat(r);e=await (0,h.uploadImage)(q,a),P(!1)}await Q.mutateAsync({projectId:t,actorName:U.actorName,characterName:U.characterName,castType:U.castType,photoUrl:e,email:U.email,phone:U.phone,agent:U.agent,rate:U.rate?Number(U.rate):void 0,createdBy:r.uid}),d(!1),B(null),z({actorName:"",characterName:"",castType:"",photoUrl:"",email:"",phone:"",agent:"",rate:""})}catch(e){console.error("Error adding cast member:",e),alert("Failed to add cast member. Please try again."),P(!1)}},em=e=>{I(e),B(null),z({actorName:e.actorName,characterName:e.characterName,castType:e.castType,photoUrl:e.photoUrl,email:e.email||"",phone:e.phone||"",agent:e.agent||"",rate:e.rate||""}),m(!0)},eu=async e=>{if(e.preventDefault(),D)try{let e=U.photoUrl,r=D.photoUrl;if(q){P(!0);let a=(0,h.generateUniqueFilename)(q.name),s="cast/".concat(t,"/").concat(a);e=await (0,h.uploadImage)(q,s),P(!1),r&&!(0,h.isBlobUrl)(r)&&await (0,h.deleteImage)(r)}await $.mutateAsync({id:D.id,data:{actorName:U.actorName,characterName:U.characterName,castType:U.castType,photoUrl:e,email:U.email,phone:U.phone,agent:U.agent,rate:U.rate?Number(U.rate):void 0}}),m(!1),I(null),B(null),z({actorName:"",characterName:"",castType:"",photoUrl:"",email:"",phone:"",agent:"",rate:""})}catch(e){console.error("Error updating cast member:",e),alert("Failed to update cast member. Please try again."),P(!1)}},ex=async e=>{if(confirm("Remove this cast member?"))try{let t=W.find(t=>t.id===e);await G.mutateAsync({id:e}),(null==t?void 0:t.photoUrl)&&!(0,h.isBlobUrl)(t.photoUrl)&&await (0,h.deleteImage)(t.photoUrl)}catch(e){console.error("Error deleting cast member:",e),alert("Failed to delete cast member. Please try again.")}},ep=()=>{T(new Set(er.map(e=>e.value)))},eh=async e=>{if(e.preventDefault(),!C.trim())return void alert("Please enter a cast type name");try{await K.mutateAsync({projectId:t,castType:C.trim()});let e=new Set(E);e.add(C.trim()),T(e),x(!1),S("")}catch(e){alert(e.message||"Failed to add custom cast type")}},eb=async e=>{if(confirm('Remove "'.concat(e,"\" cast type? Cast members with this type will keep it, but you won't be able to assign it to new members.")))try{await X.mutateAsync({projectId:t,castType:e});let r=new Set(E);r.delete(e),T(r)}catch(e){alert(e.message||"Failed to remove custom cast type")}},eg=W.filter(e=>{if(!E.has(e.castType))return!1;if(Y){let t=Y.toLowerCase(),r=e.actorName.toLowerCase().includes(t),a=e.characterName.toLowerCase().includes(t);return r||a}return!0}),ey=eg.reduce((e,t)=>{let r=t.castType;return e[r]||(e[r]=[]),e[r].push(t),e},{});return V?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-primary mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Loading cast members..."})]})}):H?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"⚠️"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"Error Loading Cast"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:H.message}),(0,a.jsx)("button",{onClick:()=>_(),className:"btn-primary",children:"Try Again"})]})}):(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2 text-text-primary",children:"Cast Management"}),(0,a.jsxs)("p",{className:"text-text-secondary",children:[eg.length," of ",W.length," cast members",Y&&(0,a.jsxs)("span",{className:"text-accent-primary",children:[' • Searching "',Y,'"']})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>d(!l),className:"btn-primary",children:"+ Add Cast Member"}),(0,a.jsx)("button",{className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-text-primary font-medium",onClick:()=>j(!0),children:"\uD83D\uDCCB Apply Template"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 border border-border-default rounded-lg p-1 bg-background-secondary",children:[(0,a.jsx)("button",{onClick:()=>w("grid"),className:"px-3 py-1 rounded transition-colors ".concat("grid"===k?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"grid"===k?{color:"rgb(var(--colored-button-text))"}:void 0,title:"Grid View",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),(0,a.jsx)("button",{onClick:()=>w("list"),className:"px-3 py-1 rounded transition-colors ".concat("list"===k?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"list"===k?{color:"rgb(var(--colored-button-text))"}:void 0,title:"List View",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]})]}),f.size>0&&(0,a.jsxs)("div",{className:"bg-accent-primary/10 border border-accent-primary/30 rounded-lg p-4 mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"font-semibold text-text-primary",children:[f.size," cast member",1!==f.size?"s":""," selected"]}),(0,a.jsx)("button",{onClick:()=>{f.size===eg.length?N(new Set):N(new Set(eg.map(e=>e.id)))},className:"text-sm text-accent-primary hover:underline",children:f.size===eg.length?"Deselect All":"Select All"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>{if(0===f.size)return;let e=Array.from(f);J.mutate({projectId:t,castMemberIds:e}),N(new Set)},className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-primary/90 transition-colors text-sm font-medium",style:{color:"rgb(var(--colored-button-text))"},disabled:J.isPending,children:J.isPending?"Creating...":"\uD83D\uDCB0 Create Budget Items"}),(0,a.jsx)("button",{onClick:()=>{0!==f.size&&confirm("Are you sure you want to delete ".concat(f.size," cast member(s)?"))&&Promise.all(Array.from(f).map(e=>Z.mutateAsync({id:e}))).then(()=>{N(new Set)})},className:"px-4 py-2 bg-error text-white rounded-lg hover:bg-error/90 transition-colors text-sm font-medium",disabled:Z.isPending,children:Z.isPending?"Deleting...":"\uD83D\uDDD1️ Delete Selected"}),(0,a.jsx)("button",{onClick:()=>N(new Set),className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-text-primary text-sm font-medium",children:"Cancel"})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search by actor or character name...",value:Y,onChange:e=>R(e.target.value),className:"input-field pl-10 w-full"}),(0,a.jsx)("svg",{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),Y&&(0,a.jsx)("button",{onClick:()=>R(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-tertiary hover:text-text-primary",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),l&&(0,a.jsxs)("div",{className:"card-elevated p-6 mb-8 animate-in fade-in slide-in-from-top-4 duration-300",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-4 text-text-primary",children:"Add New Cast Member"}),(0,a.jsxs)("form",{onSubmit:ec,className:"space-y-4",children:[(0,a.jsx)("div",{onDragOver:el,onDragLeave:eo,onDrop:ei,className:"border-2 border-dashed rounded-xl p-6 transition-all ".concat(L?"border-accent-primary bg-accent-primary/5":"border-border-default bg-background-tertiary hover:border-accent-primary/50"),children:(0,a.jsx)("div",{className:"flex flex-col items-center gap-4",children:U.photoUrl?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:U.photoUrl,alt:"Preview",className:"w-32 h-32 rounded-xl object-cover shadow-md"}),(0,a.jsx)("button",{type:"button",onClick:()=>z({...U,photoUrl:""}),className:"absolute -top-2 -right-2 w-6 h-6 bg-error text-white rounded-full flex items-center justify-center hover:bg-error/80 transition-colors",children:"\xd7"})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-primary flex items-center justify-center text-3xl",children:"\uD83D\uDCF7"}),(0,a.jsx)("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Drag & drop photo here"}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mb-3",children:"or"}),(0,a.jsxs)("label",{className:"btn-secondary cursor-pointer inline-block",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:ed,className:"hidden"}),"Choose File"]})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Actor Name ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Jane Smith",required:!0,className:"input-field",value:U.actorName,onChange:e=>z({...U,actorName:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Character Name ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Sarah Connor",required:!0,className:"input-field",value:U.characterName,onChange:e=>z({...U,characterName:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Cast Type ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsxs)("select",{required:!0,className:"input-field",value:U.castType,onChange:e=>z({...U,castType:e.target.value}),children:[(0,a.jsx)("option",{value:"",children:"Select cast type"}),er.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email"}),(0,a.jsx)("input",{type:"email",placeholder:"actor@example.com",className:"input-field",value:U.email,onChange:e=>z({...U,email:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Phone"}),(0,a.jsx)("input",{type:"tel",placeholder:"(555) 123-4567",className:"input-field",value:U.phone,onChange:e=>z({...U,phone:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Agent/Agency"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., CAA, WME",className:"input-field",value:U.agent,onChange:e=>z({...U,agent:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Day Rate"}),(0,a.jsx)("input",{type:"number",placeholder:"1000",className:"input-field",value:U.rate,onChange:e=>z({...U,rate:parseFloat(e.target.value)})})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>d(!1),className:"btn-secondary",disabled:M,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:M,children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Uploading..."]}):"Add Cast Member"})]})]})]}),0===W.length&&!l&&(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFAD"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"No cast members yet"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Add your first cast member to get started"})]}),W.length>0&&0===eg.length&&!l&&(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"No matching cast members"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:Y?'No results for "'.concat(Y,'"'):"Try selecting different cast types in the filter"}),(0,a.jsx)("button",{onClick:()=>{R(""),ep()},className:"btn-secondary",children:"Clear Filters"})]}),Object.keys(ey).length>0&&(0,a.jsx)("div",{className:"space-y-8",children:Object.entries(ey).map(e=>{let[r,s]=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:(e=>{let t=g.find(t=>t.value===e);return(null==t?void 0:t.label)||e})(r)}),(0,a.jsx)("span",{className:"badge-primary",children:s.length})]}),"grid"===k?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(e=>(0,a.jsxs)("div",{id:"element-".concat(e.id),className:"card p-5 hover:border-accent-primary/50 transition-all relative ".concat(f.has(e.id)?"ring-2 ring-accent-primary border-accent-primary":""),children:[(0,a.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 pt-1",children:(0,a.jsx)("input",{type:"checkbox",checked:f.has(e.id),onChange:()=>ee(e.id),className:"w-5 h-5 rounded border-2 border-accent-primary text-accent-primary focus:ring-2 focus:ring-accent-primary cursor-pointer bg-transparent checked:bg-accent-primary",style:{accentColor:"rgb(var(--accent-primary))"}})}),(0,a.jsxs)("div",{className:"flex gap-4 flex-1",children:[(0,a.jsxs)("div",{className:"flex-shrink-0",children:[e.photoUrl?(0,a.jsx)("img",{src:e.photoUrl,alt:e.actorName,className:"w-20 h-20 rounded-xl object-cover shadow-md",onError:e=>{var t;e.currentTarget.style.display="none",null==(t=e.currentTarget.nextElementSibling)||t.classList.remove("hidden")}}):null,(0,a.jsx)("div",{className:"w-20 h-20 rounded-xl bg-gradient-to-br ".concat(es(e.actorName)," flex items-center justify-center text-white text-xl font-bold shadow-md ").concat(e.photoUrl?"hidden":""),children:ea(e.actorName)})]}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"font-semibold text-text-primary truncate",children:e.actorName}),(0,a.jsxs)("p",{className:"text-sm text-accent-secondary font-medium",children:["as ",e.characterName]})]}),(0,a.jsxs)("div",{className:"flex gap-1 ml-2",children:[(0,a.jsx)("button",{onClick:()=>em(e),className:"flex-shrink-0 text-text-tertiary hover:text-accent-primary transition-colors p-1",title:"Edit cast member",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:()=>ex(e.id),className:"flex-shrink-0 text-text-tertiary hover:text-error transition-colors p-1",title:"Delete cast member",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})})]})]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-text-secondary mb-3",children:[e.agent&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83C\uDFE2"}),(0,a.jsx)("span",{className:"truncate",children:e.agent})]}),e.email&&(0,a.jsxs)("div",{className:"truncate",children:["\uD83D\uDCE7 ",e.email]}),e.phone&&(0,a.jsxs)("div",{children:["\uD83D\uDCDE ",e.phone]}),e.rate>0&&(0,a.jsxs)("div",{className:"text-text-primary font-semibold",children:["\uD83D\uDCB0 $",e.rate.toLocaleString(),"/day"]})]}),(0,a.jsx)(v,{projectId:t,castMemberId:e.id,canEdit:!0,onCreateBudgetItem:()=>{J.mutate({projectId:t,castMemberIds:[e.id]})},onViewBudget:()=>{window.location.href="/projects/".concat(t,"#budget")}})]},e.id))}):(0,a.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,a.jsxs)("div",{id:"element-".concat(e.id),className:"card p-4 hover:border-accent-primary/50 transition-all flex items-center gap-4 ".concat(f.has(e.id)?"ring-2 ring-accent-primary border-accent-primary bg-accent-primary/5":""),children:[(0,a.jsx)("input",{type:"checkbox",checked:f.has(e.id),onChange:()=>ee(e.id),className:"w-5 h-5 rounded border-2 border-accent-primary text-accent-primary focus:ring-2 focus:ring-accent-primary flex-shrink-0 cursor-pointer bg-transparent checked:bg-accent-primary",style:{accentColor:"rgb(var(--accent-primary))"}}),(0,a.jsxs)("div",{className:"flex-shrink-0",children:[e.photoUrl?(0,a.jsx)("img",{src:e.photoUrl,alt:e.actorName,className:"w-12 h-12 rounded-lg object-cover",onError:e=>{var t;e.currentTarget.style.display="none",null==(t=e.currentTarget.nextElementSibling)||t.classList.remove("hidden")}}):null,(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br ".concat(es(e.actorName)," flex items-center justify-center text-white text-sm font-bold ").concat(e.photoUrl?"hidden":""),children:ea(e.actorName)})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"font-semibold text-text-primary truncate",children:e.actorName}),(0,a.jsxs)("p",{className:"text-sm text-accent-secondary font-medium",children:["as ",e.characterName]})]}),(0,a.jsxs)("div",{className:"flex gap-1 ml-2",children:[(0,a.jsx)("button",{onClick:()=>em(e),className:"flex-shrink-0 text-text-tertiary hover:text-accent-primary transition-colors p-1",title:"Edit cast member",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:()=>ex(e.id),className:"flex-shrink-0 text-text-tertiary hover:text-error transition-colors p-1",title:"Delete cast member",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-text-secondary mt-2",children:[e.agent&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83C\uDFE2"}),(0,a.jsx)("span",{className:"truncate",children:e.agent})]}),e.email&&(0,a.jsxs)("div",{className:"truncate",children:["\uD83D\uDCE7 ",e.email]}),e.phone&&(0,a.jsxs)("div",{children:["\uD83D\uDCDE ",e.phone]}),e.rate>0&&(0,a.jsxs)("div",{className:"text-text-primary font-semibold",children:["\uD83D\uDCB0 $",e.rate.toLocaleString(),"/day"]})]})]})]},e.id))})]},r)})})]}),(0,a.jsxs)("aside",{className:"w-80 bg-background-secondary border-l border-border-subtle overflow-y-auto p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-4 text-text-primary",children:"Cast Overview"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-text-secondary",children:"Filter by Type"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:ep,className:"text-xs text-accent-primary hover:text-accent-hover",children:"Select All"}),(0,a.jsx)("span",{className:"text-text-tertiary",children:"•"}),(0,a.jsx)("button",{onClick:()=>{T(new Set)},className:"text-xs text-accent-primary hover:text-accent-hover",children:"Clear"})]})]}),(0,a.jsx)("div",{className:"space-y-2",children:er.map(e=>{let t,r=(t=e.value,W.filter(e=>e.castType===t).length),s=E.has(e.value),n=et.includes(e.value);return(0,a.jsxs)("label",{className:"flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors ".concat(s?"bg-background-tertiary hover:bg-background-elevated":"bg-background-primary hover:bg-background-tertiary opacity-60"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,a.jsx)("input",{type:"checkbox",checked:s,onChange:()=>(e=>{let t=new Set(E);t.has(e)?t.delete(e):t.add(e),T(t)})(e.value),className:"w-4 h-4 rounded border-border-default text-accent-primary focus:ring-accent-primary focus:ring-2"}),(0,a.jsx)("span",{className:"text-sm font-medium text-text-primary",children:e.label})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"badge-primary ".concat(!s&&"opacity-40"),children:r}),n&&(0,a.jsx)("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),eb(e.value)},className:"text-text-tertiary hover:text-error transition-colors p-1",title:"Remove custom type",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]},e.value)})}),(0,a.jsx)("button",{onClick:()=>x(!0),className:"w-full mt-3 py-2 px-3 rounded-lg border-2 border-dashed border-border-default hover:border-accent-primary text-text-secondary hover:text-accent-primary transition-colors text-sm font-medium",children:"+ Add Custom Type"})]}),(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-accent-primary/10 border border-accent-primary/30",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold mb-2 text-accent-primary",children:"\uD83D\uDCA1 Cast Management Tips"}),(0,a.jsxs)("ul",{className:"text-xs text-text-secondary space-y-1",children:[(0,a.jsx)("li",{children:"• Keep contact info updated"}),(0,a.jsx)("li",{children:"• Track availability dates"}),(0,a.jsx)("li",{children:"• Maintain agent relationships"}),(0,a.jsx)("li",{children:"• Document day rates clearly"})]})]})]}),u&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"card-elevated max-w-md w-full",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Add Custom Cast Type"}),(0,a.jsx)("button",{onClick:()=>{x(!1),S("")},className:"text-text-tertiary hover:text-text-primary transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("form",{onSubmit:eh,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Cast Type Name"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Stand-In, Body Double, etc.",required:!0,className:"input-field w-full",value:C,onChange:e=>S(e.target.value),autoFocus:!0}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-2",children:"This custom type will be available for all team members working on this project."})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{x(!1),S("")},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:K.isPending,children:K.isPending?"Adding...":"Add Type"})]})]})]})})}),c&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"card-elevated max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Edit Cast Member"}),(0,a.jsx)("button",{onClick:()=>{m(!1),I(null)},className:"text-text-tertiary hover:text-text-primary transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("form",{onSubmit:eu,className:"space-y-4",children:[(0,a.jsx)("div",{onDragOver:el,onDragLeave:eo,onDrop:ei,className:"border-2 border-dashed rounded-xl p-6 transition-all ".concat(L?"border-accent-primary bg-accent-primary/5":"border-border-default bg-background-tertiary hover:border-accent-primary/50"),children:(0,a.jsx)("div",{className:"flex flex-col items-center gap-4",children:U.photoUrl?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:U.photoUrl,alt:"Preview",className:"w-32 h-32 rounded-xl object-cover shadow-md"}),(0,a.jsx)("button",{type:"button",onClick:()=>z({...U,photoUrl:""}),className:"absolute -top-2 -right-2 w-6 h-6 bg-error text-white rounded-full flex items-center justify-center hover:bg-error/80 transition-colors",children:"\xd7"})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-primary flex items-center justify-center text-3xl",children:"\uD83D\uDCF7"}),(0,a.jsx)("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Drag & drop photo here"}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mb-3",children:"or"}),(0,a.jsxs)("label",{className:"btn-secondary cursor-pointer inline-block",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:ed,className:"hidden"}),"Choose File"]})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Actor Name ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Jane Smith",required:!0,className:"input-field",value:U.actorName,onChange:e=>z({...U,actorName:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Character Name ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Sarah Connor",required:!0,className:"input-field",value:U.characterName,onChange:e=>z({...U,characterName:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Cast Type ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsxs)("select",{required:!0,className:"input-field",value:U.castType,onChange:e=>z({...U,castType:e.target.value}),children:[(0,a.jsx)("option",{value:"",children:"Select cast type"}),er.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email"}),(0,a.jsx)("input",{type:"email",placeholder:"actor@example.com",className:"input-field",value:U.email,onChange:e=>z({...U,email:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Phone"}),(0,a.jsx)("input",{type:"tel",placeholder:"(555) 123-4567",className:"input-field",value:U.phone,onChange:e=>z({...U,phone:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Agent/Agency"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., CAA, WME",className:"input-field",value:U.agent,onChange:e=>z({...U,agent:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Day Rate"}),(0,a.jsx)("input",{type:"number",placeholder:"1000",className:"input-field",value:U.rate,onChange:e=>z({...U,rate:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{m(!1),I(null)},className:"btn-secondary",disabled:M,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:M,children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Uploading..."]}):"Update Cast Member"})]})]})]})})}),y&&(0,a.jsx)(b,{projectId:t,onClose:()=>j(!1)})]})}function v(e){let{projectId:t,castMemberId:r,canEdit:s,onCreateBudgetItem:n,onViewBudget:l}=e,{data:i=[],isLoading:d}=o.i.budget.getItemsByCastMember.useQuery({projectId:t,castMemberId:r});if(d)return(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:"Loading budget..."});if(0===i.length)return(0,a.jsx)("div",{className:"pt-2 border-t border-border-default",children:s&&(0,a.jsx)("button",{onClick:n,className:"w-full text-xs px-2 py-1 bg-background-tertiary hover:bg-accent-primary/10 text-accent-primary rounded border border-border-default transition-colors",children:"\uD83D\uDCB0 Create Budget Item"})});let c=i.reduce((e,t)=>e+(t.estimatedAmount||0),0);return(0,a.jsxs)("div",{className:"pt-2 border-t border-border-default",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("span",{className:"text-xs font-medium text-text-primary",children:["\uD83D\uDCB0 ",i.length," Budget Item",1!==i.length?"s":""]}),(0,a.jsx)("button",{onClick:l,className:"text-xs text-accent-primary hover:text-accent-hover",children:"View →"})]}),(0,a.jsxs)("div",{className:"text-xs text-text-secondary",children:["Total: $",c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),s&&(0,a.jsx)("button",{onClick:n,className:"mt-1 w-full text-xs px-2 py-1 bg-background-tertiary hover:bg-accent-primary/10 text-accent-primary rounded border border-border-default transition-colors",children:"+ Add Another"})]})}let j={camera:["Director of Photography","Camera Operator","1st AC (Focus Puller)","1st AC","2nd AC (Clapper Loader)","DIT (Digital Imaging Technician)","DIT","Steadicam Operator","Drone Operator","Camera PA","B-Camera Operator","B-Camera 1st AC"],lighting_grip:["Gaffer","Best Boy Electric","Electrician","Board Operator","Key Grip","Best Boy Grip","Dolly Grip","Grip","Swing"],sound:["Production Sound Mixer","Boom Operator","Sound Utility","Playback Operator"],art:["Production Designer","Art Director","Assistant Art Director","Set Decorator","Lead Person","Set Dresser","Prop Master","Assistant Prop Master","Prop Builder","Scenic Artist","Construction Coordinator","Carpenter","Painter"],wardrobe:["Costume Designer","Assistant Costume Designer","Costume Supervisor","Key Costumer","Set Costumer","Costume PA","Stylist","Assistant Stylist","Wardrobe Assistant"],makeup_hair:["Key Makeup Artist","Makeup Artist","SFX Makeup Artist","Key Hairstylist","Hairstylist"],production:["Director","Producer","Executive Producer","Co-Producer","Co-Executive Producer","Supervising Producer","Showrunner","Line Producer","Production Manager","Production Supervisor","Production Coordinator","Assistant Production Coordinator","1st AD","2nd AD","2nd 2nd AD","Production Assistant","Set PA","Office PA","Script Supervisor","Location Manager","Assistant Location Manager","Location Scout","Location PA","Creative Director","Art Director","Copywriter","Account Executive","Agency PA","Field Producer","Associate Producer","Photographer","Assistant Photographer","Digital Tech","Photo Assistant"],post_production:["Editor","Assistant Editor","Post Production Supervisor","Post Production Coordinator","Colorist","VFX Supervisor","VFX Producer","VFX Coordinator","Sound Designer","Sound Editor","Dialogue Editor","Foley Artist","Re-recording Mixer","Composer","Music Supervisor"],transportation:["Transportation Coordinator","Transportation Captain","Driver","Picture Car Coordinator"],catering:["Caterer","Craft Service"],stunts:["Stunt Coordinator","Stunt Performer","Stunt Rigger","Safety Officer"],vfx:["VFX Supervisor","VFX Producer","VFX Coordinator","On-Set VFX Supervisor","VFX PA"],other:["Unit Publicist","Still Photographer","BTS Videographer","Medic","Security","Animal Wrangler","Fixer","Translator","Choreographer","Dance Captain","Retoucher"]};function f(e){let{projectId:t,onClose:r}=e,{data:s=[],isLoading:n}=o.i.crewTemplates.getAll.useQuery(),l=o.i.useUtils(),[d,c]=(0,i.useState)(null),[m,u]=(0,i.useState)(!0),[x,p]=(0,i.useState)(!1),h=o.i.crewTemplates.applyTemplate.useMutation({onSuccess:e=>{l.crew.listByProject.invalidate({projectId:t}),alert("Template applied successfully! Created ".concat(e.positionsCreated," crew positions.").concat(e.positionsSkipped>0?" Skipped ".concat(e.positionsSkipped," existing positions."):"")),r()},onError:e=>{alert("Failed to apply template: ".concat(e.message))}}),b=async()=>{d&&await h.mutateAsync({projectId:t,templateId:d,skipExisting:m,overwriteExisting:x})},g=s.find(e=>e.id===d);return n?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary mx-auto"})})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Apply Crew Template"}),(0,a.jsx)("button",{onClick:r,className:"text-text-secondary hover:text-text-primary transition-colors",children:"✕"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:s.map(e=>(0,a.jsxs)("div",{onClick:()=>c(e.id),className:"p-4 border rounded-lg cursor-pointer transition-all ".concat(d===e.id?"border-accent-primary bg-accent-primary/10":"border-border-default hover:border-accent-primary/50"),children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-text-tertiary",children:[(0,a.jsx)("span",{className:"px-2 py-1 bg-background-secondary rounded",children:e.type}),(0,a.jsxs)("span",{children:[e.positions.length," positions"]})]})]},e.id))}),g&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary mb-3",children:"Template Preview"}),(0,a.jsx)("div",{className:"bg-background-secondary border border-border-default rounded-lg p-4 max-h-64 overflow-y-auto",children:(0,a.jsx)("div",{className:"space-y-2",children:Object.entries(g.positions.reduce((e,t)=>{let r=t.department;return e[r]||(e[r]=[]),e[r].push(t),e},{})).map(e=>{let[t,r]=e;return(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("h4",{className:"font-medium text-text-primary mb-1 capitalize",children:t.replace("_"," ")}),(0,a.jsx)("ul",{className:"text-sm text-text-secondary space-y-1 ml-4",children:r.map((e,t)=>(0,a.jsxs)("li",{children:[e.role,e.quantity>1&&(0,a.jsxs)("span",{className:"text-text-tertiary ml-1",children:["(\xd7",e.quantity,")"]}),e.required&&(0,a.jsx)("span",{className:"text-accent-primary ml-1 text-xs",children:"Required"})]},t))})]},t)})})})]}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"skipExisting",checked:m,onChange:e=>{u(e.target.checked),e.target.checked&&p(!1)},className:"w-4 h-4"}),(0,a.jsx)("label",{htmlFor:"skipExisting",className:"text-sm text-text-primary",children:"Skip existing positions (don't create duplicates)"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"overwriteExisting",checked:x,onChange:e=>{p(e.target.checked),e.target.checked&&u(!1)},className:"w-4 h-4"}),(0,a.jsx)("label",{htmlFor:"overwriteExisting",className:"text-sm text-text-primary",children:"Overwrite existing positions (update existing crew members)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 border border-border-default rounded-lg hover:bg-background-secondary transition-colors text-text-primary",children:"Cancel"}),(0,a.jsx)("button",{onClick:b,disabled:!d||h.isPending,className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"rgb(var(--colored-button-text))"},children:h.isPending?"Applying...":"Apply Template"})]})]})})}let N=[{value:"camera",label:"Camera"},{value:"lighting_grip",label:"Lighting & Grip"},{value:"sound",label:"Sound"},{value:"art",label:"Art Department"},{value:"wardrobe",label:"Wardrobe"},{value:"makeup_hair",label:"Makeup & Hair"},{value:"production",label:"Production"},{value:"post_production",label:"Post-Production"},{value:"transportation",label:"Transportation"},{value:"catering",label:"Catering"},{value:"stunts",label:"Stunts"},{value:"vfx",label:"VFX"},{value:"other",label:"Other"}];function k(e){var t,r;let{projectId:s}=e,{firebaseUser:n,user:d}=(0,p.A)(),c=o.i.useUtils();(0,l.useRouter)();let[m,u]=(0,i.useState)(!1),[x,b]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!1),[v,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1),[D,I]=(0,i.useState)(!1),[L,A]=(0,i.useState)(!1),[M,P]=(0,i.useState)(!1),[q,B]=(0,i.useState)(new Set),[Y,R]=(0,i.useState)("grid"),[E,T]=(0,i.useState)(""),[U,z]=(0,i.useState)(""),[F,O]=(0,i.useState)(""),[W,V]=(0,i.useState)(""),[H,_]=(0,i.useState)(null),[Q,$]=(0,i.useState)({requestedDepartment:"",requestedRole:"",reason:""}),[G,K]=(0,i.useState)(!1),[X,J]=(0,i.useState)(!1),[Z,ee]=(0,i.useState)(null),[et,er]=(0,i.useState)(""),[ea,es]=(0,i.useState)(new Set(N.map(e=>e.value))),[en,el]=(0,i.useState)({}),[eo,ei]=(0,i.useState)(new Set),[ed,ec]=(0,i.useState)({name:"",department:"",role:"",photoUrl:"",email:"",phone:"",rate:"",rateType:"daily"}),{data:em,refetch:eu}=o.i.projects.getById.useQuery({id:s}),{data:ex=[],isLoading:ep,error:eh,refetch:eb}=o.i.crew.listByProject.useQuery({projectId:s}),{data:eg}=o.i.projectMembers.getMyRole.useQuery({projectId:s}),{data:ey=[]}=o.i.departmentHeads.listByProject.useQuery({projectId:s}),ev="owner"===eg||"admin"===eg,ej=o.i.budget.createFromCrew.useMutation({onSuccess:()=>{c.budget.getBudget.invalidate({projectId:s}),alert("Budget items created successfully!")}}),ef=o.i.crew.delete.useMutation({onSuccess:()=>{eb(),B(new Set)}}),eN=e=>{let t=new Set(q);t.has(e)?t.delete(e):t.add(e),B(t)},ek=e=>!!n&&("owner"===eg||"admin"===eg||("dept_head"===eg?ey.filter(e=>e.userId===n.uid).map(e=>e.department).includes(e.department):e.userId===n.uid)),ew=o.i.crew.create.useMutation({onSuccess:()=>{eb()}}),eC=o.i.crew.update.useMutation({onSuccess:()=>{eb()}}),eS=o.i.crew.delete.useMutation({onSuccess:()=>{eb()}}),eD=o.i.projects.addCustomCrewDepartment.useMutation({onSuccess:()=>{eu()}}),eI=o.i.projects.removeCustomCrewDepartment.useMutation({onSuccess:()=>{eu()}}),eL=o.i.projects.addCustomRole.useMutation({onSuccess:()=>{eu()}}),eA=o.i.projects.removeCustomRole.useMutation({onSuccess:()=>{eu()}}),{data:eM}=o.i.crew.getMyCrewCard.useQuery({projectId:s}),{data:eP=[]}=o.i.roleRequests.listByProject.useQuery({projectId:s}),eq=o.i.roleRequests.create.useMutation({onSuccess:()=>{c.roleRequests.listByProject.invalidate({projectId:s}),A(!1),$({requestedDepartment:"",requestedRole:"",reason:""}),alert("Role change request submitted! You will be notified when it is reviewed.")},onError:e=>{alert(e.message)}}),eB=o.i.roleRequests.cancel.useMutation({onSuccess:()=>{c.roleRequests.listByProject.invalidate({projectId:s})}}),eY=(null==em?void 0:em.customCrewDepartments)||[],eR=[...N,...eY.map(e=>({value:e,label:e}))],eE={production:{Director:1,"Executive Producer":2,Producer:3,Showrunner:4,"Supervising Producer":5,"Co-Executive Producer":6,"Co-Producer":7,"Line Producer":8,"Production Manager":9,"Production Supervisor":10,"1st AD":11,"2nd AD":12,"2nd 2nd AD":13,"Production Coordinator":14,"Assistant Production Coordinator":15,"Script Supervisor":16,"Location Manager":17,"Assistant Location Manager":18,"Location Scout":19,"Creative Director":20,"Art Director":21,Copywriter:22,"Account Executive":23,"Field Producer":24,"Associate Producer":25,Photographer:26,"Assistant Photographer":27,"Digital Tech":28,"Production Assistant":29,"Set PA":30,"Office PA":31,"Location PA":32,"Agency PA":33,"Photo Assistant":34},camera:{"Director of Photography":1,"Camera Operator":2,"B-Camera Operator":3,"1st AC (Focus Puller)":4,"1st AC":5,"B-Camera 1st AC":6,"2nd AC (Clapper Loader)":7,"DIT (Digital Imaging Technician)":8,DIT:9,"Steadicam Operator":10,"Drone Operator":11,"Camera PA":12},lighting_grip:{Gaffer:1,"Key Grip":2,"Best Boy Electric":3,"Best Boy Grip":4,Electrician:5,Grip:6,"Dolly Grip":7,"Board Operator":8,Swing:9},sound:{"Production Sound Mixer":1,"Boom Operator":2,"Sound Utility":3,"Playback Operator":4},art:{"Production Designer":1,"Art Director":2,"Assistant Art Director":3,"Set Decorator":4,"Prop Master":5,"Construction Coordinator":6,"Lead Person":7,"Assistant Prop Master":8,"Set Dresser":9,"Prop Builder":10,"Scenic Artist":11,Carpenter:12,Painter:13},wardrobe:{"Costume Designer":1,Stylist:2,"Costume Supervisor":3,"Assistant Costume Designer":4,"Assistant Stylist":5,"Key Costumer":6,"Set Costumer":7,"Costume PA":8,"Wardrobe Assistant":9},makeup_hair:{"Key Makeup Artist":1,"Key Hairstylist":2,"Makeup Artist":3,"SFX Makeup Artist":4,Hairstylist:5},post_production:{Editor:1,"Post Production Supervisor":2,"VFX Supervisor":3,Colorist:4,"Sound Designer":5,Composer:6,"VFX Producer":7,"Re-recording Mixer":8,"Assistant Editor":9,"Post Production Coordinator":10,"VFX Coordinator":11,"Sound Editor":12,"Dialogue Editor":13,"Foley Artist":14,"Music Supervisor":15},transportation:{"Transportation Coordinator":1,"Transportation Captain":2,"Picture Car Coordinator":3,Driver:4},catering:{Caterer:1,"Craft Service":2},stunts:{"Stunt Coordinator":1,"Safety Officer":2,"Stunt Performer":3,"Stunt Rigger":4},vfx:{"VFX Supervisor":1,"On-Set VFX Supervisor":2,"VFX Producer":3,"VFX Coordinator":4,"VFX PA":5},other:{"Unit Publicist":1,"Still Photographer":2,"BTS Videographer":3,Choreographer:4,"Dance Captain":5,Medic:6,Security:7,"Animal Wrangler":8,Fixer:9,Translator:10,Retoucher:11}},eT=(e,t)=>{let r=eE[e];return r&&void 0!==r[t]?r[t]:9999},eU=e=>{var t;return[...j[e]||[],...(null==em||null==(t=em.customRolesByDepartment)?void 0:t[e])||[]].sort((t,r)=>{let a=eT(e,t),s=eT(e,r);return a!==s?a-s:t.localeCompare(r)})};(0,i.useEffect)(()=>{if(em&&eY.length>0){es(e=>{let t=new Set(e);return eY.forEach(e=>t.add(e)),t});let e={};eY.forEach(t=>{let r=eU(t);r.length>0&&(e[t]=new Set(r))}),Object.keys(e).length>0&&el(t=>({...t,...e}))}},[null==em?void 0:em.id,eY.length]);let ez=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),eF=e=>{let t=["from-purple-500 to-pink-500","from-blue-500 to-cyan-500","from-green-500 to-emerald-500","from-orange-500 to-red-500","from-pink-500 to-rose-500","from-indigo-500 to-purple-500","from-cyan-500 to-blue-500","from-amber-500 to-orange-500"],r=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0)%t.length;return t[r]},eO=e=>{if(e&&e.type.startsWith("image/")){ee(e);let t=URL.createObjectURL(e);ec({...ed,photoUrl:t})}},eW=e=>{e.preventDefault(),K(!0)},eV=e=>{e.preventDefault(),K(!1)},eH=e=>{e.preventDefault(),K(!1);let t=e.dataTransfer.files[0];t&&eO(t)},e_=e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&eO(r)},eQ=async e=>{if(e.preventDefault(),!user)return void alert("You must be logged in to add crew members");try{let e="";if(Z){J(!0);let t=(0,h.generateUniqueFilename)(Z.name),r="crew/".concat(s,"/").concat(t);e=await (0,h.uploadImage)(Z,r),J(!1)}await ew.mutateAsync({projectId:s,name:ed.name,department:ed.department,role:ed.role,photoUrl:e,email:ed.email,phone:ed.phone,rate:ed.rate?Number(ed.rate):void 0,rateType:ed.rateType,createdBy:n.uid}),u(!1),ee(null),S(!1),T(""),ec({name:"",department:"",role:"",photoUrl:"",email:"",phone:"",rate:"",rateType:"daily"})}catch(e){console.error("Error adding crew member:",e),alert("Failed to add crew member. Please try again."),J(!1)}},e$=e=>{_(e),ee(null),I(!1),T(""),ec({name:e.name,department:e.department,role:e.role,photoUrl:e.photoUrl||"",email:e.email||"",phone:e.phone||"",rate:e.rate||"",rateType:e.rateType||"daily"}),b(!0)},eG=async e=>{if(e.preventDefault(),H)try{let e=ed.photoUrl,t=H.photoUrl;if(Z){J(!0);let r=(0,h.generateUniqueFilename)(Z.name),a="crew/".concat(s,"/").concat(r);e=await (0,h.uploadImage)(Z,a),J(!1),t&&!(0,h.isBlobUrl)(t)&&await (0,h.deleteImage)(t)}await eC.mutateAsync({id:H.id,data:{name:ed.name,department:ed.department,role:ed.role,photoUrl:e,email:ed.email,phone:ed.phone,rate:ed.rate?Number(ed.rate):void 0,rateType:ed.rateType}}),b(!1),_(null),ee(null),I(!1),T(""),ec({name:"",department:"",role:"",photoUrl:"",email:"",phone:"",rate:"",rateType:"daily"})}catch(e){console.error("Error updating crew member:",e),alert("Failed to update crew member. Please try again."),J(!1)}},eK=async e=>{if(confirm("Remove this crew member?"))try{let t=ex.find(t=>t.id===e);await eS.mutateAsync({id:e}),(null==t?void 0:t.photoUrl)&&!(0,h.isBlobUrl)(t.photoUrl)&&await (0,h.deleteImage)(t.photoUrl)}catch(e){console.error("Error deleting crew member:",e),alert("Failed to delete crew member. Please try again.")}},eX=()=>{es(new Set(eR.map(e=>e.value)));let e={};eR.forEach(t=>{e[t.value]=new Set(eU(t.value))}),el(e)},eJ=async e=>{if(e.preventDefault(),!U.trim())return void alert("Please enter a department name");try{await eD.mutateAsync({projectId:s,department:U.trim()});let e=new Set(ea);e.add(U.trim()),es(e),y(!1),z("")}catch(e){alert(e.message||"Failed to add custom department")}},eZ=async e=>{if(confirm('Remove "'.concat(e,"\" department? Crew members with this department will keep it, but you won't be able to assign it to new members.")))try{await eI.mutateAsync({projectId:s,department:e});let t=new Set(ea);t.delete(e),es(t)}catch(e){alert(e.message||"Failed to remove custom department")}},e0=async e=>{if(e.preventDefault(),F.trim()&&W)try{await eL.mutateAsync({projectId:s,department:W,role:F.trim()});let e=en[W]||new Set(eU(W)),t=new Set(e);t.add(F.trim()),el({...en,[W]:t}),O(""),V(""),k(!1)}catch(e){console.error("Error adding custom role:",e),alert(e.message||"Failed to add custom role. Please try again.")}},e2=async(e,t)=>{if(confirm('Remove custom role "'.concat(t,'"? This will not delete crew members with this role.')))try{await eA.mutateAsync({projectId:s,department:e,role:t})}catch(e){console.error("Error removing custom role:",e),alert("Failed to remove custom role. Please try again.")}},e1=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(E.trim()&&ed.department)try{await eL.mutateAsync({projectId:s,department:ed.department,role:E.trim()}),ec({...ed,role:E.trim()});let t=en[ed.department]||new Set(eU(ed.department)),r=new Set(t);r.add(E.trim()),el({...en,[ed.department]:r}),T(""),e?I(!1):S(!1)}catch(e){console.error("Error adding custom role:",e),alert(e.message||"Failed to add custom role. Please try again.")}},e4=ex.filter(e=>{if(!ea.has(e.department))return!1;let t=en[e.department];if(t&&t.size>0){let r=eU(e.department);if(r.length>0&&t.size<r.length&&!t.has(e.role))return!1}if(et){let t=et.toLowerCase(),r=e.name.toLowerCase().includes(t),a=e.role.toLowerCase().includes(t);return r||a}return!0}),e3={production:1,camera:2,lighting_grip:3,sound:4,art:5,wardrobe:6,makeup_hair:7,post_production:8,vfx:9,stunts:10,transportation:11,catering:12,other:999},e5=Object.entries(e4.reduce((e,t)=>{let r=t.department;return e[r]||(e[r]=[]),e[r].push(t),e},{})).sort((e,t)=>{var r,a;let[s]=e,[n]=t,l=null!=(r=e3[s])?r:500,o=null!=(a=e3[n])?a:500;return l!==o?l-o:s.localeCompare(n)}),e6=e=>{let t=eR.find(t=>t.value===e);return(null==t?void 0:t.label)||e};return ep?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-primary mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Loading crew members..."})]})}):eh?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"⚠️"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"Error Loading Crew"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:eh.message}),(0,a.jsx)("button",{onClick:()=>eb(),className:"btn-primary",children:"Try Again"})]})}):(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2 text-text-primary",children:"Crew Management"}),(0,a.jsxs)("p",{className:"text-text-secondary",children:[e4.length," of ",ex.length," crew members",et&&(0,a.jsxs)("span",{className:"text-accent-primary",children:[' • Searching "',et,'"']})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[eM&&(0,a.jsxs)("button",{onClick:()=>{$({requestedDepartment:eM.department,requestedRole:eM.role,reason:""}),A(!0)},className:"px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors font-medium",children:["\uD83D\uDCDD Request Role Change",eP.filter(e=>"pending"===e.status).length>0&&(0,a.jsx)("span",{className:"ml-2 px-2 py-0.5 rounded-full bg-yellow-500/20 text-yellow-400 text-xs",children:eP.filter(e=>"pending"===e.status).length})]}),(0,a.jsx)("button",{onClick:()=>u(!m),className:"btn-primary",children:"+ Add Crew Member"}),ev&&(0,a.jsx)("button",{className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-text-primary font-medium",onClick:()=>P(!0),children:"\uD83D\uDCCB Apply Template"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 border border-border-default rounded-lg p-1 bg-background-secondary",children:[(0,a.jsx)("button",{onClick:()=>R("grid"),className:"px-3 py-1 rounded transition-colors ".concat("grid"===Y?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"grid"===Y?{color:"rgb(var(--colored-button-text))"}:void 0,title:"Grid View",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),(0,a.jsx)("button",{onClick:()=>R("list"),className:"px-3 py-1 rounded transition-colors ".concat("list"===Y?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"list"===Y?{color:"rgb(var(--colored-button-text))"}:void 0,title:"List View",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search by name or role...",value:et,onChange:e=>er(e.target.value),className:"input-field pl-10 w-full"}),(0,a.jsx)("svg",{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),et&&(0,a.jsx)("button",{onClick:()=>er(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-tertiary hover:text-text-primary",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),q.size>0&&(0,a.jsxs)("div",{className:"bg-accent-primary/10 border border-accent-primary/30 rounded-lg p-4 mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"font-semibold text-text-primary",children:[q.size," crew member",1!==q.size?"s":""," selected"]}),(0,a.jsx)("button",{onClick:()=>{q.size===e4.length?B(new Set):B(new Set(e4.map(e=>e.id)))},className:"text-sm text-accent-primary hover:underline",children:q.size===e4.length?"Deselect All":"Select All"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[ev&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{if(0===q.size)return;let e=Array.from(q);ej.mutate({projectId:s,crewMemberIds:e}),B(new Set)},className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-primary/90 transition-colors text-sm font-medium",style:{color:"rgb(var(--colored-button-text))"},disabled:ej.isPending,children:ej.isPending?"Creating...":"\uD83D\uDCB0 Create Budget Items"}),(0,a.jsx)("button",{onClick:()=>{0!==q.size&&confirm("Are you sure you want to delete ".concat(q.size," crew member(s)?"))&&Promise.all(Array.from(q).map(e=>ef.mutateAsync({id:e}))).then(()=>{B(new Set)})},className:"px-4 py-2 bg-error text-white rounded-lg hover:bg-error/90 transition-colors text-sm font-medium",disabled:ef.isPending,children:ef.isPending?"Deleting...":"\uD83D\uDDD1️ Delete Selected"})]}),(0,a.jsx)("button",{onClick:()=>B(new Set),className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-text-primary text-sm font-medium",children:"Cancel"})]})]}),m&&(0,a.jsxs)("div",{className:"card-elevated p-6 mb-8 animate-in fade-in slide-in-from-top-4 duration-300",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-4 text-text-primary",children:"Add New Crew Member"}),(0,a.jsxs)("form",{onSubmit:eQ,className:"space-y-4",children:[(0,a.jsx)("div",{onDragOver:eW,onDragLeave:eV,onDrop:eH,className:"border-2 border-dashed rounded-xl p-6 transition-all ".concat(G?"border-accent-primary bg-accent-primary/5":"border-border-default bg-background-tertiary hover:border-accent-primary/50"),children:(0,a.jsx)("div",{className:"flex flex-col items-center gap-4",children:ed.photoUrl?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:ed.photoUrl,alt:"Preview",className:"w-32 h-32 rounded-xl object-cover shadow-md"}),(0,a.jsx)("button",{type:"button",onClick:()=>ec({...ed,photoUrl:""}),className:"absolute -top-2 -right-2 w-6 h-6 bg-error text-white rounded-full flex items-center justify-center hover:bg-error/80 transition-colors",children:"\xd7"})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-primary flex items-center justify-center text-3xl",children:"\uD83D\uDCF7"}),(0,a.jsx)("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Drag & drop photo here"}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mb-3",children:"or"}),(0,a.jsxs)("label",{className:"btn-secondary cursor-pointer inline-block",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e_,className:"hidden"}),"Choose File"]})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Name ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., John Doe",required:!0,className:"input-field",value:ed.name,onChange:e=>ec({...ed,name:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Department ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsxs)("select",{required:!0,className:"input-field",value:ed.department,onChange:e=>ec({...ed,department:e.target.value,role:""}),children:[(0,a.jsx)("option",{value:"",children:"Select department"}),eR.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),ed.department?(0,a.jsxs)("div",{className:"col-span-2 space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Role ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsxs)("select",{required:!C,className:"input-field w-full",value:ed.role,onChange:e=>ec({...ed,role:e.target.value}),disabled:C,children:[(0,a.jsx)("option",{value:"",children:"Select role"}),eU(ed.department).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),C?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Enter custom role name",className:"input-field flex-1 text-sm",value:E,onChange:e=>T(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),e1(!1)):"Escape"===e.key&&(S(!1),T(""))},autoFocus:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>e1(!1),disabled:!E.trim()||eL.isPending,className:"btn-primary text-sm px-3 py-1",children:eL.isPending?"...":"Add"}),(0,a.jsx)("button",{type:"button",onClick:()=>{S(!1),T("")},className:"btn-secondary text-sm px-3 py-1",children:"Cancel"})]}):(0,a.jsxs)("button",{type:"button",onClick:()=>S(!0),className:"text-xs text-accent-primary hover:text-accent-hover font-medium flex items-center gap-1",children:[(0,a.jsx)("span",{children:"+"})," Add custom role to ",null==(t=N.find(e=>e.value===ed.department))?void 0:t.label]})]}):(0,a.jsx)("input",{type:"text",placeholder:"Select department first",disabled:!0,className:"input-field col-span-2 opacity-50",value:""}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email"}),(0,a.jsx)("input",{type:"email",placeholder:"john@example.com",className:"input-field",value:ed.email,onChange:e=>ec({...ed,email:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Phone"}),(0,a.jsx)("input",{type:"tel",placeholder:"(555) 123-4567",className:"input-field",value:ed.phone,onChange:e=>ec({...ed,phone:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Rate"}),(0,a.jsx)("input",{type:"number",placeholder:"500",className:"input-field",value:ed.rate,onChange:e=>ec({...ed,rate:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Rate Type"}),(0,a.jsxs)("select",{className:"input-field",value:ed.rateType,onChange:e=>ec({...ed,rateType:e.target.value}),children:[(0,a.jsx)("option",{value:"hourly",children:"Hourly"}),(0,a.jsx)("option",{value:"daily",children:"Daily"}),(0,a.jsx)("option",{value:"weekly",children:"Weekly"}),(0,a.jsx)("option",{value:"flat",children:"Flat Rate"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",disabled:X,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:X,children:X?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Uploading..."]}):"Add Crew Member"})]})]})]}),0===ex.length&&!m&&(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC65"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"No crew members yet"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Add your first crew member to get started"})]}),ex.length>0&&0===e4.length&&!m&&(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"No matching crew members"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:et?'No results for "'.concat(et,'"'):"Try selecting different departments in the filter"}),(0,a.jsx)("button",{onClick:()=>{er(""),eX()},className:"btn-secondary",children:"Clear Filters"})]}),e5.length>0&&(0,a.jsx)("div",{className:"space-y-8",children:e5.map(e=>{let[t,r]=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:e6(t)}),(0,a.jsx)("span",{className:"badge-primary",children:r.length})]}),"grid"===Y?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(e=>(0,a.jsxs)("div",{id:"element-".concat(e.id),className:"card p-5 hover:border-accent-primary/50 transition-all relative ".concat(q.has(e.id)?"ring-2 ring-accent-primary border-accent-primary":""),children:[(0,a.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[ev&&(0,a.jsx)("div",{className:"flex-shrink-0 pt-1",children:(0,a.jsx)("input",{type:"checkbox",checked:q.has(e.id),onChange:()=>eN(e.id),className:"w-5 h-5 rounded border-2 border-accent-primary text-accent-primary focus:ring-2 focus:ring-accent-primary cursor-pointer bg-transparent checked:bg-accent-primary",style:{accentColor:"rgb(var(--accent-primary))"}})}),(0,a.jsxs)("div",{className:"flex gap-4 flex-1",children:[(0,a.jsxs)("div",{className:"flex-shrink-0",children:[e.photoUrl?(0,a.jsx)("img",{src:e.photoUrl,alt:e.name,className:"w-20 h-20 rounded-xl object-cover shadow-md",onError:e=>{var t;e.currentTarget.style.display="none",null==(t=e.currentTarget.nextElementSibling)||t.classList.remove("hidden")}}):null,(0,a.jsx)("div",{className:"w-20 h-20 rounded-xl bg-gradient-to-br ".concat(eF(e.name)," flex items-center justify-center text-white text-xl font-bold shadow-md ").concat(e.photoUrl?"hidden":""),children:ez(e.name)})]}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"font-semibold text-text-primary truncate",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-accent-secondary font-medium",children:e.role})]}),(0,a.jsxs)("div",{className:"flex gap-1 ml-2",children:[ek(e)&&(0,a.jsx)("button",{onClick:()=>e$(e),className:"flex-shrink-0 text-text-tertiary hover:text-accent-primary transition-colors p-1",title:"Edit crew member",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),ek(e)&&(0,a.jsx)("button",{onClick:()=>eK(e.id),className:"flex-shrink-0 text-text-tertiary hover:text-error transition-colors p-1",title:"Delete crew member",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})})]})]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-text-secondary mb-3",children:[e.email&&(0,a.jsxs)("div",{className:"truncate",children:["\uD83D\uDCE7 ",e.email]}),e.phone&&(0,a.jsxs)("div",{children:["\uD83D\uDCDE ",e.phone]}),e.rate&&(0,a.jsxs)("div",{className:"text-text-primary font-semibold",children:["\uD83D\uDCB0 $",e.rate.toLocaleString(),"/",e.rateType||"day"]})]}),(0,a.jsx)(w,{projectId:s,crewMemberId:e.id,canEdit:ev,onCreateBudgetItem:()=>{ej.mutate({projectId:s,crewMemberIds:[e.id]})},onViewBudget:()=>{window.location.href="/projects/".concat(s,"#budget")}})]},e.id))}):(0,a.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,a.jsxs)("div",{id:"element-".concat(e.id),className:"card p-4 hover:border-accent-primary/50 transition-all flex items-center gap-4 ".concat(q.has(e.id)?"ring-2 ring-accent-primary border-accent-primary bg-accent-primary/5":""),children:[ev&&(0,a.jsx)("input",{type:"checkbox",checked:q.has(e.id),onChange:()=>eN(e.id),className:"w-5 h-5 rounded border-2 border-accent-primary text-accent-primary focus:ring-2 focus:ring-accent-primary flex-shrink-0 cursor-pointer bg-transparent checked:bg-accent-primary",style:{accentColor:"rgb(var(--accent-primary))"}}),(0,a.jsxs)("div",{className:"flex-shrink-0",children:[e.photoUrl?(0,a.jsx)("img",{src:e.photoUrl,alt:e.name,className:"w-12 h-12 rounded-lg object-cover",onError:e=>{var t;e.currentTarget.style.display="none",null==(t=e.currentTarget.nextElementSibling)||t.classList.remove("hidden")}}):null,(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br ".concat(eF(e.name)," flex items-center justify-center text-white text-sm font-bold ").concat(e.photoUrl?"hidden":""),children:ez(e.name)})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 grid grid-cols-12 gap-4 items-center",children:[(0,a.jsxs)("div",{className:"col-span-3",children:[(0,a.jsx)("h4",{className:"font-semibold text-text-primary truncate",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-accent-secondary font-medium truncate",children:e.role})]}),(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)("span",{className:"text-xs text-text-tertiary capitalize",children:e6(e.department)})}),(0,a.jsxs)("div",{className:"col-span-3 text-sm text-text-secondary",children:[e.email&&(0,a.jsxs)("div",{className:"truncate",children:["\uD83D\uDCE7 ",e.email]}),e.phone&&(0,a.jsxs)("div",{children:["\uD83D\uDCDE ",e.phone]})]}),(0,a.jsx)("div",{className:"col-span-2 text-sm text-text-primary font-semibold",children:e.rate&&"\uD83D\uDCB0 $".concat(e.rate.toLocaleString(),"/").concat(e.rateType||"day")}),(0,a.jsxs)("div",{className:"col-span-2 flex items-center justify-end gap-2",children:[ek(e)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>e$(e),className:"text-text-tertiary hover:text-accent-primary transition-colors p-1",title:"Edit crew member",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:()=>eK(e.id),className:"text-text-tertiary hover:text-error transition-colors p-1",title:"Delete crew member",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(0,a.jsx)(w,{projectId:s,crewMemberId:e.id,canEdit:ev,onCreateBudgetItem:()=>{ej.mutate({projectId:s,crewMemberIds:[e.id]})},onViewBudget:()=>{window.location.href="/projects/".concat(s,"#budget")},compact:!0})]})]})]},e.id))})]},t)})})]}),(0,a.jsxs)("aside",{className:"w-80 bg-background-secondary border-l border-border-subtle overflow-y-auto p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-4 text-text-primary",children:"Crew Overview"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-text-secondary",children:"Filter by Department & Role"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:eX,className:"text-xs text-accent-primary hover:text-accent-hover",children:"Select All"}),(0,a.jsx)("span",{className:"text-text-tertiary",children:"•"}),(0,a.jsx)("button",{onClick:()=>{es(new Set),el({})},className:"text-xs text-accent-primary hover:text-accent-hover",children:"Clear"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,a.jsx)("button",{onClick:()=>{ei(new Set(eR.map(e=>e.value)))},className:"text-xs text-text-tertiary hover:text-accent-primary transition-colors",children:"Expand All"}),(0,a.jsx)("span",{className:"text-text-tertiary",children:"•"}),(0,a.jsx)("button",{onClick:()=>{ei(new Set)},className:"text-xs text-text-tertiary hover:text-accent-primary transition-colors",children:"Collapse All"})]}),(0,a.jsx)("div",{className:"space-y-2 max-h-[500px] overflow-y-auto pr-2",children:eR.sort((e,t)=>{var r,a;let s=null!=(r=e3[e.value])?r:500,n=null!=(a=e3[t.value])?a:500;return s!==n?s-n:e.value.localeCompare(t.value)}).map(e=>{var t;let r,s=(r=e.value,ex.filter(e=>e.department===r).length),n=ea.has(e.value),l=eo.has(e.value),o=eY.includes(e.value),i=eU(e.value),d=en[e.value]||new Set(i),c=(null==em||null==(t=em.customRolesByDepartment)?void 0:t[e.value])||[];return(0,a.jsxs)("div",{className:"rounded-lg border transition-all ".concat(n?"border-accent-primary/30 bg-background-tertiary":"border-border-default bg-background-primary opacity-60"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3",children:[(0,a.jsx)("button",{onClick:()=>(e=>{let t=new Set(eo);t.has(e)?t.delete(e):t.add(e),ei(t)})(e.value),className:"text-text-tertiary hover:text-text-primary transition-colors",disabled:0===i.length,children:i.length>0?(0,a.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(l?"rotate-90":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}):(0,a.jsx)("div",{className:"w-4 h-4"})}),(0,a.jsx)("input",{type:"checkbox",checked:n,onChange:()=>(e=>{let t=new Set(ea);t.has(e)?t.delete(e):t.add(e),es(t)})(e.value),className:"w-4 h-4 rounded border-border-default text-accent-primary focus:ring-accent-primary focus:ring-2"}),(0,a.jsx)("span",{className:"text-sm font-medium text-text-primary flex-1",children:e.label}),(0,a.jsx)("span",{className:"badge-primary ".concat(!n&&"opacity-40"),children:s}),o&&(0,a.jsx)("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),eZ(e.value)},className:"text-text-tertiary hover:text-error transition-colors p-1",title:"Remove custom department",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),l&&i.length>0&&(0,a.jsxs)("div",{className:"border-t border-border-subtle px-3 pb-3 pt-2 space-y-1.5",children:[i.map(t=>{let r=c.includes(t),s=d.has(t);return(0,a.jsxs)("div",{className:"flex items-center gap-2 pl-6 group",children:[(0,a.jsx)("input",{type:"checkbox",checked:s,onChange:()=>((e,t)=>{let r=new Set(en[e]||new Set(eU(e)));r.has(t)?r.delete(t):r.add(t),el({...en,[e]:r})})(e.value,t),disabled:!n,className:"w-3.5 h-3.5 rounded border-border-default text-accent-secondary focus:ring-accent-secondary focus:ring-1"}),(0,a.jsx)("span",{className:"text-xs flex-1 ".concat(n&&s?"text-text-secondary":"text-text-tertiary"),children:t}),r&&(0,a.jsx)("button",{onClick:()=>e2(e.value,t),className:"opacity-0 group-hover:opacity-100 text-text-tertiary hover:text-error transition-all p-0.5",title:"Remove custom role",children:(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t)}),(0,a.jsx)("button",{onClick:()=>{V(e.value),k(!0)},className:"w-full mt-2 ml-6 py-1.5 px-2 rounded border border-dashed border-border-default hover:border-accent-secondary text-text-tertiary hover:text-accent-secondary transition-colors text-xs font-medium text-left",children:"+ Add Custom Role"})]})]},e.value)})}),(0,a.jsx)("button",{onClick:()=>y(!0),className:"w-full mt-3 py-2 px-3 rounded-lg border-2 border-dashed border-border-default hover:border-accent-primary text-text-secondary hover:text-accent-primary transition-colors text-sm font-medium",children:"+ Add Custom Department"})]}),(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-accent-primary/10 border border-accent-primary/30",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold mb-2 text-accent-primary",children:"\uD83D\uDCA1 Crew Management Tips"}),(0,a.jsxs)("ul",{className:"text-xs text-text-secondary space-y-1",children:[(0,a.jsx)("li",{children:"• Keep contact info updated"}),(0,a.jsx)("li",{children:"• Track start and end dates"}),(0,a.jsx)("li",{children:"• Maintain rate agreements"}),(0,a.jsx)("li",{children:"• Document availability clearly"})]})]})]}),g&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"card-elevated max-w-md w-full",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Add Custom Department"}),(0,a.jsx)("button",{onClick:()=>{y(!1),z("")},className:"text-text-tertiary hover:text-text-primary transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("form",{onSubmit:eJ,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Department Name"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Special Effects, Props, etc.",required:!0,className:"input-field w-full",value:U,onChange:e=>z(e.target.value),autoFocus:!0}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-2",children:"This custom department will be available for all team members working on this project."})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{y(!1),z("")},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:eD.isPending,children:eD.isPending?"Adding...":"Add Department"})]})]})]})})}),v&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"card-elevated max-w-md w-full",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Add Custom Role"}),(0,a.jsx)("button",{onClick:()=>{k(!1),O(""),V("")},className:"text-text-tertiary hover:text-text-primary transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("form",{onSubmit:e0,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Department"}),(0,a.jsxs)("select",{required:!0,className:"input-field w-full",value:W,onChange:e=>V(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Select department"}),eR.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Role Name"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Lead Colorist, VFX Artist, etc.",required:!0,className:"input-field w-full",value:F,onChange:e=>O(e.target.value),autoFocus:!0}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-2",children:"This custom role will be available for all team members working on this project."})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{k(!1),O(""),V("")},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:eL.isPending,children:eL.isPending?"Adding...":"Add Role"})]})]})]})})}),x&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"card-elevated max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Edit Crew Member"}),(0,a.jsx)("button",{onClick:()=>{b(!1),_(null)},className:"text-text-tertiary hover:text-text-primary transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("form",{onSubmit:eG,className:"space-y-4",children:[(0,a.jsx)("div",{onDragOver:eW,onDragLeave:eV,onDrop:eH,className:"border-2 border-dashed rounded-xl p-6 transition-all ".concat(G?"border-accent-primary bg-accent-primary/5":"border-border-default bg-background-tertiary hover:border-accent-primary/50"),children:(0,a.jsx)("div",{className:"flex flex-col items-center gap-4",children:ed.photoUrl?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:ed.photoUrl,alt:"Preview",className:"w-32 h-32 rounded-xl object-cover shadow-md"}),(0,a.jsx)("button",{type:"button",onClick:()=>ec({...ed,photoUrl:""}),className:"absolute -top-2 -right-2 w-6 h-6 bg-error text-white rounded-full flex items-center justify-center hover:bg-error/80 transition-colors",children:"\xd7"})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-primary flex items-center justify-center text-3xl",children:"\uD83D\uDCF7"}),(0,a.jsx)("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Drag & drop photo here"}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mb-3",children:"or"}),(0,a.jsxs)("label",{className:"btn-secondary cursor-pointer inline-block",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e_,className:"hidden"}),"Choose File"]})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Name ",(0,a.jsx)("span",{className:"text-error",children:"*"})]}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., John Doe",required:!0,className:"input-field",value:ed.name,onChange:e=>ec({...ed,name:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Department ",(0,a.jsx)("span",{className:"text-error",children:"*"}),H&&H.userId===(null==n?void 0:n.uid)&&"owner"!==eg&&"admin"!==eg&&(0,a.jsx)("span",{className:"ml-2 text-xs text-yellow-400",children:"(Submit role request to change)"})]}),(0,a.jsxs)("select",{required:!0,className:"input-field",value:ed.department,onChange:e=>ec({...ed,department:e.target.value,role:""}),disabled:H&&H.userId===(null==n?void 0:n.uid)&&"owner"!==eg&&"admin"!==eg,children:[(0,a.jsx)("option",{value:"",children:"Select department"}),eR.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),ed.department?(0,a.jsxs)("div",{className:"col-span-2 space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Role ",(0,a.jsx)("span",{className:"text-error",children:"*"}),H&&H.userId===(null==n?void 0:n.uid)&&"owner"!==eg&&"admin"!==eg&&(0,a.jsx)("span",{className:"ml-2 text-xs text-yellow-400",children:"(Submit role request to change)"})]}),(0,a.jsxs)("select",{required:!D,className:"input-field w-full",value:ed.role,onChange:e=>ec({...ed,role:e.target.value}),disabled:D||H&&H.userId===(null==n?void 0:n.uid)&&"owner"!==eg&&"admin"!==eg,children:[(0,a.jsx)("option",{value:"",children:"Select role"}),eU(ed.department).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),D||H&&H.userId===(null==n?void 0:n.uid)&&"owner"!==eg&&"admin"!==eg?D?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Enter custom role name",className:"input-field flex-1 text-sm",value:E,onChange:e=>T(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),e1(!0)):"Escape"===e.key&&(I(!1),T(""))},autoFocus:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>e1(!0),disabled:!E.trim()||eL.isPending,className:"btn-primary text-sm px-3 py-1",children:eL.isPending?"...":"Add"}),(0,a.jsx)("button",{type:"button",onClick:()=>{I(!1),T("")},className:"btn-secondary text-sm px-3 py-1",children:"Cancel"})]}):null:(0,a.jsxs)("button",{type:"button",onClick:()=>I(!0),className:"text-xs text-accent-primary hover:text-accent-hover font-medium flex items-center gap-1",children:[(0,a.jsx)("span",{children:"+"})," Add custom role to ",null==(r=N.find(e=>e.value===ed.department))?void 0:r.label]})]}):(0,a.jsx)("input",{type:"text",placeholder:"Select department first",disabled:!0,className:"input-field col-span-2 opacity-50",value:""}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email"}),(0,a.jsx)("input",{type:"email",placeholder:"john@example.com",className:"input-field",value:ed.email,onChange:e=>ec({...ed,email:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Phone"}),(0,a.jsx)("input",{type:"tel",placeholder:"(555) 123-4567",className:"input-field",value:ed.phone,onChange:e=>ec({...ed,phone:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Rate"}),(0,a.jsx)("input",{type:"number",placeholder:"500",className:"input-field",value:ed.rate,onChange:e=>ec({...ed,rate:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Rate Type"}),(0,a.jsxs)("select",{className:"input-field",value:ed.rateType,onChange:e=>ec({...ed,rateType:e.target.value}),children:[(0,a.jsx)("option",{value:"hourly",children:"Hourly"}),(0,a.jsx)("option",{value:"daily",children:"Daily"}),(0,a.jsx)("option",{value:"weekly",children:"Weekly"}),(0,a.jsx)("option",{value:"flat",children:"Flat Rate"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{b(!1),_(null)},className:"btn-secondary",disabled:X,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:X,children:X?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Uploading..."]}):"Update Crew Member"})]})]})]})})}),M&&(0,a.jsx)(f,{projectId:s,onClose:()=>P(!1)}),L&&eM&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"card-elevated max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Request Role Change"}),(0,a.jsx)("button",{onClick:()=>A(!1),className:"text-text-tertiary hover:text-text-primary transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"mb-6 p-4 rounded-lg bg-background-secondary border border-border-default",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-text-tertiary mb-2",children:"Current Role"}),(0,a.jsxs)("div",{className:"text-text-primary",children:[(0,a.jsx)("span",{className:"font-medium",children:eM.role})," ","in"," ",(0,a.jsx)("span",{className:"font-medium capitalize",children:eM.department.replace("_"," ")})]})]}),eP.filter(e=>"pending"===e.status).length>0&&(0,a.jsxs)("div",{className:"mb-6 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-yellow-400 mb-2",children:"⏳ Pending Requests"}),eP.filter(e=>"pending"===e.status).map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:["Requested: ",(0,a.jsx)("span",{className:"text-text-primary font-medium",children:e.requestedRole})," in"," ",(0,a.jsx)("span",{className:"text-text-primary font-medium capitalize",children:e.requestedDepartment.replace("_"," ")})]}),(0,a.jsx)("button",{onClick:()=>{confirm("Cancel this request?")&&eB.mutate({requestId:e.id})},className:"text-xs px-2 py-1 bg-red-500/20 text-red-400 rounded hover:bg-red-500/30 transition-colors",children:"Cancel"})]},e.id))]}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!Q.requestedDepartment||!Q.requestedRole)return void alert("Please select both department and role");eq.mutate({projectId:s,crewMemberId:eM.id,requestedDepartment:Q.requestedDepartment,requestedRole:Q.requestedRole,reason:Q.reason})},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Requested Department *"}),(0,a.jsxs)("select",{value:Q.requestedDepartment,onChange:e=>$({...Q,requestedDepartment:e.target.value,requestedRole:""}),className:"input-field",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select department..."}),eR.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Requested Role *"}),(0,a.jsxs)("select",{value:Q.requestedRole,onChange:e=>$({...Q,requestedRole:e.target.value}),className:"input-field",required:!0,disabled:!Q.requestedDepartment,children:[(0,a.jsx)("option",{value:"",children:"Select role..."}),Q.requestedDepartment&&eU(Q.requestedDepartment).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Reason (Optional)"}),(0,a.jsx)("textarea",{value:Q.reason,onChange:e=>$({...Q,reason:e.target.value}),placeholder:"Why are you requesting this change?",className:"input-field min-h-[100px]"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>A(!1),className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:eq.isPending,children:eq.isPending?"Submitting...":"Submit Request"})]})]})]})})})]})}function w(e){let{projectId:t,crewMemberId:r,canEdit:s,onCreateBudgetItem:n,onViewBudget:l,compact:i=!1}=e,{data:d=[],isLoading:c}=o.i.budget.getItemsByCrewMember.useQuery({projectId:t,crewMemberId:r});if(c)return(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:"Loading budget..."});let m=d.reduce((e,t)=>e+(t.estimatedAmount||0),0);return i?0===d.length?s?(0,a.jsx)("button",{onClick:n,className:"text-xs px-2 py-1 bg-background-tertiary hover:bg-accent-primary/10 text-accent-primary rounded border border-border-default transition-colors",title:"Create Budget Item",children:"\uD83D\uDCB0"}):null:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-xs text-text-secondary",title:"".concat(d.length," budget items"),children:["\uD83D\uDCB0 ",d.length]}),(0,a.jsx)("button",{onClick:l,className:"text-xs text-accent-primary hover:text-accent-hover",title:"View Budget",children:"→"})]}):0===d.length?(0,a.jsx)("div",{className:"pt-2 border-t border-border-default",children:s&&(0,a.jsx)("button",{onClick:n,className:"w-full text-xs px-2 py-1 bg-background-tertiary hover:bg-accent-primary/10 text-accent-primary rounded border border-border-default transition-colors",children:"\uD83D\uDCB0 Create Budget Item"})}):(0,a.jsxs)("div",{className:"pt-2 border-t border-border-default",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("span",{className:"text-xs font-medium text-text-primary",children:["\uD83D\uDCB0 ",d.length," Budget Item",1!==d.length?"s":""]}),(0,a.jsx)("button",{onClick:l,className:"text-xs text-accent-primary hover:text-accent-hover",children:"View →"})]}),(0,a.jsxs)("div",{className:"text-xs text-text-secondary",children:["Total: $",m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),s&&(0,a.jsx)("button",{onClick:n,className:"mt-1 w-full text-xs px-2 py-1 bg-background-tertiary hover:bg-accent-primary/10 text-accent-primary rounded border border-border-default transition-colors",children:"+ Add Another"})]})}var C=r(1391);let S=C.k5(["admin","producer","coordinator","dept_head","crew"]);C.Ik({id:C.Yj(),email:C.Yj().email(),displayName:C.Yj().min(1),orgId:C.Yj(),role:S,photoURL:C.Yj().url().optional(),bio:C.Yj().optional(),website:C.Yj().url().optional(),socials:C.Ik({twitter:C.Yj().optional(),instagram:C.Yj().optional(),linkedin:C.Yj().optional(),imdb:C.Yj().optional()}).optional(),createdAt:C.p6(),updatedAt:C.p6()}).omit({id:!0,createdAt:!0,updatedAt:!0});let D=C.k5(["planning","pre-production","production","post-production","completed","archived"]),I=C.k5(["film","commercial","documentary","episodic","music_video","photoshoot","corporate","custom"]),L=C.Ik({id:C.Yj(),orgId:C.Yj(),title:C.Yj().min(1,"Title is required"),client:C.Yj().min(1,"Client is required"),description:C.Yj().optional(),startDate:C.au.date(),endDate:C.au.date(),status:D,budget:C.ai().positive().optional(),coverImageUrl:C.Yj().url().optional(),projectType:I.optional(),customCastTypes:C.YO(C.Yj()).optional().default([]),customCrewDepartments:C.YO(C.Yj()).optional().default([]),customRolesByDepartment:C.g1(C.YO(C.Yj())).optional().default({}),customEquipmentCategories:C.YO(C.Yj()).optional().default([]),isTemplate:C.zM().optional().default(!1),isPublic:C.zM().optional().default(!1),createdBy:C.Yj(),createdAt:C.au.date(),updatedAt:C.au.date()});L.omit({id:!0,orgId:!0,createdBy:!0,createdAt:!0,updatedAt:!0}),L.omit({id:!0,orgId:!0,createdBy:!0,createdAt:!0,updatedAt:!0}).partial();let A=C.k5(["owner","admin","dept_head","crew"]);C.Ik({id:C.Yj(),projectId:C.Yj(),userId:C.Yj(),userEmail:C.Yj().email(),userName:C.Yj(),role:A,invitedBy:C.Yj(),invitedAt:C.p6(),acceptedAt:C.p6().optional(),status:C.k5(["pending","active","declined"])}),C.Ik({projectId:C.Yj(),userEmail:C.Yj().email(),role:A.default("crew")}),C.Ik({id:C.Yj(),role:A}),C.k5(["camera","lighting_grip","sound","art","wardrobe","makeup_hair","production","post_production","transportation","catering","stunts","vfx","other"]);let M=C.Ik({id:C.Yj(),projectId:C.Yj(),userId:C.Yj().optional(),name:C.Yj().min(1,"Name is required"),department:C.Yj().min(1,"Department is required"),role:C.Yj().min(1,"Role is required"),photoUrl:C.Yj().optional(),email:C.Yj().email().optional(),phone:C.Yj().optional(),rate:C.ai().positive().optional(),rateType:C.k5(["hourly","daily","weekly","flat"]).optional(),startDate:C.p6().optional(),endDate:C.p6().optional(),notes:C.Yj().optional(),createdBy:C.Yj(),createdAt:C.p6(),updatedAt:C.p6()});M.omit({id:!0,createdAt:!0,updatedAt:!0}),M.omit({id:!0,projectId:!0,createdBy:!0,createdAt:!0,updatedAt:!0}).partial();let P=C.k5(["film","commercial","documentary","episodic","music_video","photoshoot","corporate","custom"]),q=C.Ik({department:C.Yj().min(1),role:C.Yj().min(1),required:C.zM().default(!0),quantity:C.ai().int().positive().default(1),defaultRate:C.ai().positive().optional(),notes:C.Yj().optional()});C.Ik({id:C.Yj(),name:C.Yj().min(1,"Template name is required"),type:P,description:C.Yj().optional(),positions:C.YO(q).default([]),isPublic:C.zM().default(!1),createdBy:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6()}).omit({id:!0,createdAt:!0,updatedAt:!0}),C.Ik({projectId:C.Yj(),templateId:C.Yj(),overwriteExisting:C.zM().default(!1),skipExisting:C.zM().default(!0)});let B=C.k5(["film","commercial","documentary","episodic","music_video","photoshoot","corporate","custom"]),Y=C.Ik({characterName:C.Yj().min(1),castType:C.Yj().min(1),required:C.zM().default(!0),quantity:C.ai().int().positive().default(1),notes:C.Yj().optional()});C.Ik({id:C.Yj(),name:C.Yj().min(1,"Template name is required"),type:B,description:C.Yj().optional(),roles:C.YO(Y).default([]),isPublic:C.zM().default(!1),createdBy:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6()}).omit({id:!0,createdAt:!0,updatedAt:!0}),C.Ik({projectId:C.Yj(),templateId:C.Yj(),overwriteExisting:C.zM().default(!1),skipExisting:C.zM().default(!0)});let R=C.k5(["film","commercial","documentary","episodic","music_video","photoshoot","corporate","custom"]),E=C.Ik({name:C.Yj().min(1),category:C.Yj().min(1),quantity:C.ai().int().positive().default(1),required:C.zM().default(!0),source:C.k5(["owned","rental","crew_provided"]).default("rental"),notes:C.Yj().optional()});C.Ik({id:C.Yj(),name:C.Yj().min(1,"Template name is required"),type:R,description:C.Yj().optional(),items:C.YO(E).default([]),isPublic:C.zM().default(!1),createdBy:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6()}).omit({id:!0,createdAt:!0,updatedAt:!0}),C.Ik({projectId:C.Yj(),templateId:C.Yj(),overwriteExisting:C.zM().default(!1),skipExisting:C.zM().default(!0)});let T=C.k5(["interior","exterior","studio","outdoor","indoor","other"]),U=C.k5(["scouted","confirmed","pending","rejected","backup"]);C.Ik({id:C.Yj(),projectId:C.Yj(),name:C.Yj(),address:C.Yj(),city:C.Yj().optional(),state:C.Yj().optional(),zipCode:C.Yj().optional(),country:C.Yj().optional(),latitude:C.ai().optional(),longitude:C.ai().optional(),type:T,status:U,contactName:C.Yj().optional(),contactPhone:C.Yj().optional(),contactEmail:C.Yj().optional(),notes:C.Yj().optional(),photoUrl:C.Yj().optional(),parkingInfo:C.Yj().optional(),accessInfo:C.Yj().optional(),restrictions:C.Yj().optional(),permitRequired:C.zM().optional(),permitInfo:C.Yj().optional(),rentalCost:C.ai().optional(),createdBy:C.Yj(),createdAt:C.p6(),updatedAt:C.p6()}).omit({id:!0,createdAt:!0,updatedAt:!0}).partial().extend({id:C.Yj()});let z=C.k5(["film","commercial","documentary","episodic","music_video","photoshoot","corporate","custom"]),F=C.Ik({name:C.Yj().min(1),type:T,required:C.zM().default(!0),quantity:C.ai().int().positive().default(1),notes:C.Yj().optional()});C.Ik({id:C.Yj(),name:C.Yj().min(1,"Template name is required"),type:z,description:C.Yj().optional(),locations:C.YO(F).default([]),isPublic:C.zM().default(!1),createdBy:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6()}).omit({id:!0,createdAt:!0,updatedAt:!0}),C.Ik({projectId:C.Yj(),templateId:C.Yj(),overwriteExisting:C.zM().default(!1),skipExisting:C.zM().default(!0)}),C.k5(["lead","supporting","featured","extra","stunt","voice"]);let O=C.Ik({id:C.Yj(),projectId:C.Yj(),actorName:C.Yj().min(1,"Actor name is required"),characterName:C.Yj().min(1,"Character name is required"),castType:C.Yj().min(1,"Cast type is required"),photoUrl:C.Yj().optional(),email:C.Yj().email().optional().or(C.eu("")),phone:C.Yj().optional(),agent:C.Yj().optional(),rate:C.ai().optional(),createdBy:C.Yj(),createdAt:C.p6(),updatedAt:C.p6()});O.omit({id:!0,createdAt:!0,updatedAt:!0}),O.omit({id:!0,projectId:!0,createdBy:!0,createdAt:!0,updatedAt:!0}).partial();let W=["camera","lenses","lighting","audio","grip","power","monitors","wireless_video","specialty","vehicles","other"];C.k5(["camera","lenses","lighting","audio","grip","power","monitors","wireless_video","specialty","vehicles","other"]);let V=C.k5(["available","checked_out","reserved","maintenance","not_available","lost"]),H=C.k5(["owned","rental","crew_provided"]),_=C.Ik({id:C.Yj(),projectId:C.Yj(),name:C.Yj().min(1,"Equipment name is required"),category:C.Yj().min(1,"Category is required"),quantity:C.ai().int().positive("Quantity must be at least 1").default(1),quantityAvailable:C.ai().int().min(0).default(1),status:V.default("available"),source:H.default("owned"),assignedTo:C.YO(C.Yj()).default([]),responsibleParty:C.Yj().optional(),rentalVendor:C.Yj().optional(),dailyRate:C.ai().positive().optional(),weeklyRate:C.ai().positive().optional(),serialNumber:C.Yj().optional(),manufacturer:C.Yj().optional(),model:C.Yj().optional(),photoUrl:C.Yj().optional(),packageId:C.Yj().optional(),notes:C.Yj().optional(),createdBy:C.Yj(),createdAt:C.p6(),updatedAt:C.p6()});_.omit({id:!0,createdAt:!0,updatedAt:!0,quantityAvailable:!0}),_.omit({id:!0,projectId:!0,createdBy:!0,createdAt:!0,updatedAt:!0}).partial(),C.Ik({id:C.Yj(),projectId:C.Yj(),equipmentId:C.Yj(),equipmentName:C.Yj(),userId:C.Yj(),userName:C.Yj(),quantity:C.ai().int().positive().default(1),checkoutDate:C.au.date(),dueDate:C.au.date().optional(),returnDate:C.au.date().optional(),status:C.k5(["checked_out","returned","overdue"]).default("checked_out"),notes:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6()}).omit({id:!0,createdAt:!0,updatedAt:!0,status:!0,returnDate:!0}),C.Ik({checkoutId:C.Yj(),returnDate:C.au.date().optional(),notes:C.Yj().optional()});let Q=C.Ik({id:C.Yj(),projectId:C.Yj(),name:C.Yj().min(1,"Package name is required"),description:C.Yj().optional(),equipmentIds:C.YO(C.Yj()).default([]),photoUrl:C.Yj().optional(),createdBy:C.Yj(),createdAt:C.p6(),updatedAt:C.p6()});Q.omit({id:!0,createdAt:!0,updatedAt:!0}),Q.omit({id:!0,projectId:!0,createdBy:!0,createdAt:!0,updatedAt:!0}).partial(),C.Ik({id:C.Yj(),projectId:C.Yj(),department:C.Yj(),userId:C.Yj(),userName:C.Yj(),assignedBy:C.Yj(),assignedAt:C.p6(),createdAt:C.p6(),updatedAt:C.p6()}),C.Ik({projectId:C.Yj(),department:C.Yj(),userId:C.Yj(),userName:C.Yj()}),C.Ik({id:C.Yj()});let $=C.k5(["pending","approved","denied","cancelled"]);C.Ik({id:C.Yj(),projectId:C.Yj(),crewMemberId:C.Yj(),requestedBy:C.Yj(),requesterName:C.Yj(),currentDepartment:C.Yj(),currentRole:C.Yj(),requestedDepartment:C.Yj(),requestedRole:C.Yj(),reason:C.Yj().optional(),status:$,reviewedBy:C.Yj().optional(),reviewerName:C.Yj().optional(),reviewedAt:C.p6().optional(),reviewNote:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6()}),C.Ik({projectId:C.Yj(),crewMemberId:C.Yj(),requestedDepartment:C.Yj().min(1,"Department is required"),requestedRole:C.Yj().min(1,"Role is required"),reason:C.Yj().optional()}),C.Ik({requestId:C.Yj(),action:C.k5(["approve","deny"]),reviewNote:C.Yj().optional()});let G=C.k5(["estimated","pending","paid","approved","rejected"]),K=C.k5(["pre-production","production","post-production","wrap","other"]),X=C.Ik({id:C.Yj(),projectId:C.Yj(),name:C.Yj().min(1,"Name is required"),order:C.ai().int(),department:C.Yj().optional(),phase:K.optional(),isSubtotal:C.zM().default(!1),parentCategoryId:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6()}),J=C.Ik({id:C.Yj(),categoryId:C.Yj(),projectId:C.Yj(),description:C.Yj().min(1,"Description is required"),estimatedAmount:C.ai().min(0),actualAmount:C.ai().min(0).optional().default(0),status:G.default("estimated"),notes:C.Yj().optional(),linkedCrewMemberId:C.Yj().optional(),linkedEquipmentId:C.Yj().optional(),linkedLocationId:C.Yj().optional(),linkedCastMemberId:C.Yj().optional(),linkedScheduleEventId:C.Yj().optional(),linkedSceneId:C.Yj().optional(),unit:C.Yj().optional(),quantity:C.ai().min(0).optional().default(1),unitRate:C.ai().min(0).optional(),vendor:C.Yj().optional(),accountCode:C.Yj().optional(),phase:K.optional(),createdAt:C.p6(),updatedAt:C.p6()});X.omit({id:!0,createdAt:!0,updatedAt:!0,order:!0}),X.omit({id:!0,projectId:!0,createdAt:!0,updatedAt:!0}).partial(),J.omit({id:!0,createdAt:!0,updatedAt:!0}),J.omit({id:!0,projectId:!0,categoryId:!0,createdAt:!0,updatedAt:!0}).partial().extend({categoryId:C.Yj().optional()});let Z=C.Ik({id:C.Yj(),projectId:C.Yj(),budgetItemId:C.Yj().optional(),budgetCategoryId:C.Yj().optional(),userId:C.Yj(),userName:C.Yj().optional(),userEmail:C.Yj().optional(),content:C.Yj().min(1,"Comment is required"),mentions:C.YO(C.Yj()).default([]),resolved:C.zM().default(!1),createdAt:C.p6(),updatedAt:C.p6()});Z.omit({id:!0,createdAt:!0,updatedAt:!0}),Z.omit({id:!0,projectId:!0,userId:!0,createdAt:!0,updatedAt:!0}).partial(),C.Ik({id:C.Yj(),projectId:C.Yj(),name:C.Yj().min(1,"Version name is required"),description:C.Yj().optional(),isCurrent:C.zM().default(!1),createdAt:C.p6(),updatedAt:C.p6(),createdBy:C.Yj()}).omit({id:!0,createdAt:!0,updatedAt:!0});let ee=C.k5(["pending","approved","rejected","paid","reimbursed"]),et=C.k5(["labor","equipment","location","transportation","catering","post_production","insurance","permits","other"]),er=C.Ik({id:C.Yj(),projectId:C.Yj(),budgetItemId:C.Yj().optional(),description:C.Yj().min(1,"Description is required"),amount:C.ai().min(0),category:et,status:ee.default("pending"),transactionDate:C.p6(),vendor:C.Yj().optional(),vendorId:C.Yj().optional(),receiptUrl:C.Yj().optional(),receiptFileName:C.Yj().optional(),paymentMethod:C.Yj().optional(),paymentDate:C.p6().optional(),checkNumber:C.Yj().optional(),approvedBy:C.Yj().optional(),approvedAt:C.p6().optional(),rejectedReason:C.Yj().optional(),notes:C.Yj().optional(),tags:C.YO(C.Yj()).default([]),createdBy:C.Yj(),createdAt:C.p6(),updatedAt:C.p6()});er.omit({id:!0,createdAt:!0,updatedAt:!0}),er.omit({id:!0,projectId:!0,createdBy:!0,createdAt:!0,updatedAt:!0}).partial(),C.Ik({date:C.Yj(),description:C.Yj(),amount:C.ai(),vendor:C.Yj().optional(),category:C.Yj().optional(),budgetItem:C.Yj().optional()});let ea=C.k5(["film","commercial","documentary","episodic","music_video","corporate","custom"]),es=C.Ik({name:C.Yj().min(1,"Name is required"),order:C.ai().int(),department:C.Yj().optional(),phase:K.optional(),isSubtotal:C.zM().default(!1).optional(),parentCategoryId:C.Yj().optional()}),en=C.Ik({description:C.Yj().min(1,"Description is required"),estimatedAmount:C.ai().min(0),actualAmount:C.ai().min(0).default(0),status:C.k5(["pending","approved","estimated","paid","rejected"]).default("estimated"),notes:C.Yj().optional(),linkedCrewMemberId:C.Yj().optional(),linkedEquipmentId:C.Yj().optional(),linkedLocationId:C.Yj().optional(),linkedCastMemberId:C.Yj().optional(),linkedScheduleEventId:C.Yj().optional(),linkedSceneId:C.Yj().optional(),unit:C.Yj().optional(),quantity:C.ai().min(0).default(1),unitRate:C.ai().min(0).optional(),vendor:C.Yj().optional(),accountCode:C.Yj().optional(),phase:K.optional()}).partial({actualAmount:!0,status:!0,quantity:!0}).extend({description:C.Yj().min(1,"Description is required"),estimatedAmount:C.ai().min(0)});C.Ik({id:C.Yj(),name:C.Yj().min(1,"Template name is required"),type:ea,description:C.Yj().optional(),categories:C.YO(C.Ik({category:es,items:C.YO(en).default([])})),isPublic:C.zM().default(!1),createdBy:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6()}).omit({id:!0,createdAt:!0,updatedAt:!0}),C.Ik({projectId:C.Yj(),templateId:C.Yj(),phase:K.optional(),includeItems:C.zM().default(!0),overwriteExisting:C.zM().default(!1)});let el=C.k5(["state_tax","federal_tax","union_dues","pension","health_welfare","workers_comp","unemployment","general_liability","other"]),eo=C.Ik({id:C.Yj(),projectId:C.Yj(),name:C.Yj().min(1,"Fringe name is required"),type:el,rate:C.ai().min(0).max(100),appliesToDepartments:C.YO(C.Yj()).default([]),appliesToRoles:C.YO(C.Yj()).default([]),isPercentage:C.zM().default(!0),flatAmount:C.ai().min(0).optional(),state:C.Yj().optional(),createdAt:C.au.date(),updatedAt:C.au.date()});eo.omit({id:!0,createdAt:!0,updatedAt:!0}),eo.omit({id:!0,projectId:!0,createdAt:!0,updatedAt:!0}).partial(),C.Ik({baseAmount:C.ai().min(0),fringes:C.YO(C.Ik({fringeId:C.Yj(),fringeName:C.Yj(),amount:C.ai().min(0),rate:C.ai()})),totalFringes:C.ai().min(0),totalWithFringes:C.ai().min(0)});let ei=C.k5(["scene","break","move","prep","wrap","other"]),ed=C.Ik({id:C.Yj(),projectId:C.Yj(),date:C.au.date(),dayNumber:C.ai().int().positive().optional(),totalDays:C.ai().int().positive().optional(),callTime:C.Yj().optional(),shootCall:C.Yj().optional(),breakfast:C.Yj().optional(),lunch:C.Yj().optional(),location:C.Yj().optional(),locationId:C.Yj().optional(),basecampLocationId:C.Yj().optional(),crewParkLocationId:C.Yj().optional(),techTrucksLocationId:C.Yj().optional(),bgHoldingLocationId:C.Yj().optional(),bgParkingLocationId:C.Yj().optional(),nearestHospital:C.Yj().optional(),directorCrewId:C.Yj().optional(),executiveProducerCrewId:C.Yj().optional(),productionCoordinatorCrewId:C.Yj().optional(),notes:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6()}),ec=C.Ik({id:C.Yj(),shootingDayId:C.Yj(),projectId:C.Yj(),type:ei,time:C.Yj().optional(),duration:C.ai().min(0).optional(),description:C.Yj().min(1,"Description is required"),sceneNumber:C.Yj().optional(),sceneId:C.Yj().optional(),shotId:C.Yj().optional(),pageCount:C.Yj().optional(),location:C.Yj().optional(),locationId:C.Yj().optional(),castIds:C.YO(C.Yj()).optional(),crewIds:C.YO(C.Yj()).optional(),equipmentIds:C.YO(C.Yj()).optional(),storyboardIds:C.YO(C.Yj()).optional(),notes:C.Yj().optional(),order:C.ai().int(),createdAt:C.p6(),updatedAt:C.p6()});ed.omit({id:!0,createdAt:!0,updatedAt:!0}),ed.omit({id:!0,projectId:!0,createdAt:!0,updatedAt:!0}).partial(),ec.omit({id:!0,createdAt:!0,updatedAt:!0,order:!0}),ec.omit({id:!0,projectId:!0,shootingDayId:!0,createdAt:!0,updatedAt:!0}).partial().extend({shootingDayId:C.Yj().optional()});let em=C.k5(["not-shot","in-progress","completed","omitted"]),eu=C.Ik({id:C.Yj(),projectId:C.Yj(),sceneNumber:C.Yj().min(1,"Scene number is required"),title:C.Yj().optional(),description:C.Yj().optional(),pageCount:C.Yj().optional(),locationId:C.Yj().optional(),locationName:C.Yj().optional(),locationIds:C.YO(C.Yj()).optional().default([]),locationNames:C.YO(C.Yj()).optional().default([]),imageUrl:C.Yj().optional(),scriptText:C.Yj().optional(),scriptPageStart:C.ai().optional(),scriptPageEnd:C.ai().optional(),status:em.default("not-shot"),shootingDayId:C.Yj().optional(),shootingDayIds:C.YO(C.Yj()).optional().default([]),scheduledDate:C.au.date().optional(),scheduledDates:C.YO(C.au.date()).optional().default([]),estimatedDuration:C.ai().min(0).optional(),timeOfDay:C.Yj().optional(),weather:C.Yj().optional(),mood:C.Yj().optional(),visualNotes:C.Yj().optional(),storyboardIds:C.YO(C.Yj()).optional().default([]),sceneReferences:C.YO(C.Ik({id:C.Yj(),url:C.Yj(),category:C.k5(["wardrobe","camera","location","character","other"])})).optional().default([]),castIds:C.YO(C.Yj()).optional().default([]),crewIds:C.YO(C.Yj()).optional().default([]),equipmentIds:C.YO(C.Yj()).optional().default([]),continuityNotes:C.Yj().optional(),specialRequirements:C.Yj().optional(),vfxNotes:C.Yj().optional(),stuntsRequired:C.zM().optional().default(!1),createdBy:C.Yj(),createdAt:C.p6(),updatedAt:C.p6()});eu.omit({id:!0,createdAt:!0,updatedAt:!0}),eu.omit({id:!0,projectId:!0,createdBy:!0,createdAt:!0,updatedAt:!0}).partial();let ex=C.k5(["master","medium","close","extreme-close","wide","insert","pov","over-shoulder","two-shot","establishing","cutaway","other"]),ep=C.k5(["not-shot","in-progress","completed","omitted"]),eh=C.Ik({id:C.Yj(),sceneId:C.Yj(),projectId:C.Yj(),shotNumber:C.Yj().min(1,"Shot number is required"),title:C.Yj().optional(),description:C.Yj().optional(),shotType:ex.default("master"),cameraAngle:C.Yj().optional(),cameraMovement:C.Yj().optional(),lens:C.Yj().optional(),focalLength:C.ai().optional(),frameRate:C.ai().optional(),resolution:C.Yj().optional(),cameraId:C.Yj().optional(),lensId:C.Yj().optional(),equipmentIds:C.YO(C.Yj()).optional().default([]),lightingSetup:C.Yj().optional(),status:ep.default("not-shot"),takeNumbers:C.YO(C.ai()).optional().default([]),bestTake:C.ai().optional(),duration:C.ai().min(0).optional(),slateInfo:C.Yj().optional(),composition:C.Yj().optional(),blocking:C.Yj().optional(),actionDescription:C.Yj().optional(),locationIds:C.YO(C.Yj()).optional().default([]),locationNames:C.YO(C.Yj()).optional().default([]),shootingDayIds:C.YO(C.Yj()).optional().default([]),imageUrl:C.Yj().optional(),shotReferences:C.YO(C.Ik({id:C.Yj(),url:C.Yj(),category:C.k5(["wardrobe","camera","location","character","other"])})).optional().default([]),castIds:C.YO(C.Yj()).optional().default([]),crewIds:C.YO(C.Yj()).optional().default([]),storyboardId:C.Yj().optional(),sortOrder:C.ai().optional(),createdBy:C.Yj(),createdAt:C.p6(),updatedAt:C.p6()});eh.omit({id:!0,createdAt:!0,updatedAt:!0}),eh.omit({id:!0,projectId:!0,createdBy:!0,createdAt:!0,updatedAt:!0}).partial();let eb=C.k5(["movie_magic_budgeting","plaid","quickbooks","showbiz_budgeting","slack","wrapbook"]),eg=C.k5(["disconnected","connecting","connected","error"]),ey=C.Ik({accessToken:C.Yj().optional(),refreshToken:C.Yj().optional(),tokenExpiresAt:C.p6().optional(),plaidItemId:C.Yj().optional(),plaidInstitutionId:C.Yj().optional(),quickbooksRealmId:C.Yj().optional(),quickbooksCompanyName:C.Yj().optional(),slackTeamId:C.Yj().optional(),slackTeamName:C.Yj().optional(),slackChannelId:C.Yj().optional(),slackChannelName:C.Yj().optional(),wrapbookProjectId:C.Yj().optional(),lastImportDate:C.p6().optional(),importSettings:C.Ik({autoSync:C.zM().optional().default(!1),syncFrequency:C.k5(["daily","weekly","monthly","manual"]).optional().default("manual")}).optional(),enabled:C.zM().optional().default(!0),syncDirection:C.k5(["import","export","both"]).optional().default("import")});C.Ik({id:C.Yj(),projectId:C.Yj(),type:eb,status:eg,config:ey,name:C.Yj(),description:C.Yj().optional(),lastSyncAt:C.p6().optional(),lastSyncStatus:C.k5(["success","error","pending"]).optional(),lastSyncError:C.Yj().optional(),createdAt:C.p6(),updatedAt:C.p6(),createdBy:C.Yj()});let ev={movie_magic_budgeting:{name:"Movie Magic Budgeting",description:"Import Movie Magic Budgeting files to manage and actualize in DoubleCheck.",icon:"\uD83C\uDFAC",category:"budgeting",requiresOAuth:!1,supportsImport:!0,supportsExport:!1},plaid:{name:"Plaid",description:"Connect to your bank and credit card accounts to make actualizing quicker.",icon:"\uD83C\uDFE6",category:"finance",requiresOAuth:!0,supportsImport:!0,supportsExport:!1},quickbooks:{name:"Quickbooks",description:"Import all your project transactions to Quickbooks for accounting.",icon:"\uD83D\uDCCA",category:"accounting",requiresOAuth:!0,supportsImport:!1,supportsExport:!0},showbiz_budgeting:{name:"Showbiz Budgeting",description:"Import Showbiz budgets right into DoubleCheck.",icon:"\uD83C\uDFAD",category:"budgeting",requiresOAuth:!1,supportsImport:!0,supportsExport:!1},slack:{name:"Slack",description:"Get in app notifications to your Slack channels to stay in the loop.",icon:"\uD83D\uDCAC",category:"communication",requiresOAuth:!0,supportsImport:!1,supportsExport:!1},wrapbook:{name:"Wrapbook",description:"Import Wrapbook payroll into DoubleCheck to actualize faster.",icon:"\uD83D\uDCB0",category:"payroll",requiresOAuth:!0,supportsImport:!0,supportsExport:!1}};C.Ik({id:C.Yj(),projectId:C.Yj(),url:C.Yj(),name:C.Yj(),category:C.k5(["wardrobe","camera","location","character","other"]).optional(),tags:C.YO(C.Yj()).default([]),createdAt:C.p6(),updatedAt:C.p6()}).omit({id:!0,createdAt:!0,updatedAt:!0});let ej={camera:"Camera",lenses:"Lenses",lighting:"Lighting",audio:"Audio",grip:"Grip",power:"Power & Distribution",monitors:"Monitors & Playback",wireless_video:"Wireless Video",specialty:"Specialty Equipment",vehicles:"Vehicles",other:"Other"};function ef(e){return ej[e]||e}var eN=r(8175);function ek(e){let{projectId:t,onClose:r}=e,{data:s=[],isLoading:n}=o.i.equipmentTemplates.getAll.useQuery(),l=o.i.useUtils(),[d,c]=(0,i.useState)(null),[m,u]=(0,i.useState)(!0),[x,p]=(0,i.useState)(!1),h=o.i.equipmentTemplates.applyTemplate.useMutation({onSuccess:e=>{l.equipment.listByProject.invalidate({projectId:t}),alert("Template applied successfully! Created ".concat(e.itemsCreated," equipment items.").concat(e.itemsSkipped>0?" Skipped ".concat(e.itemsSkipped," existing items."):"")),r()},onError:e=>{alert("Failed to apply template: ".concat(e.message))}}),b=async()=>{d&&await h.mutateAsync({projectId:t,templateId:d,skipExisting:m,overwriteExisting:x})},g=s.find(e=>e.id===d);return n?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary mx-auto"})})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Apply Equipment Template"}),(0,a.jsx)("button",{onClick:r,className:"text-text-secondary hover:text-text-primary transition-colors",children:"✕"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:s.map(e=>(0,a.jsxs)("div",{onClick:()=>c(e.id),className:"p-4 border rounded-lg cursor-pointer transition-all ".concat(d===e.id?"border-accent-primary bg-accent-primary/10":"border-border-default hover:border-accent-primary/50"),children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-text-tertiary",children:[(0,a.jsx)("span",{className:"px-2 py-1 bg-background-secondary rounded",children:e.type}),(0,a.jsxs)("span",{children:[e.items.length," items"]})]})]},e.id))}),g&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary mb-3",children:"Template Preview"}),(0,a.jsx)("div",{className:"bg-background-secondary border border-border-default rounded-lg p-4 max-h-64 overflow-y-auto",children:(0,a.jsx)("div",{className:"space-y-2",children:Object.entries(g.items.reduce((e,t)=>{let r=t.category;return e[r]||(e[r]=[]),e[r].push(t),e},{})).map(e=>{let[t,r]=e;return(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("h4",{className:"font-medium text-text-primary mb-1 capitalize",children:t.replace("_"," ")}),(0,a.jsx)("ul",{className:"text-sm text-text-secondary space-y-1 ml-4",children:r.map((e,t)=>(0,a.jsxs)("li",{children:[e.name,e.quantity>1&&(0,a.jsxs)("span",{className:"text-text-tertiary ml-1",children:["(\xd7",e.quantity,")"]}),e.required&&(0,a.jsx)("span",{className:"text-accent-primary ml-1 text-xs",children:"Required"})]},t))})]},t)})})})]}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"skipExisting",checked:m,onChange:e=>{u(e.target.checked),e.target.checked&&p(!1)},className:"w-4 h-4"}),(0,a.jsx)("label",{htmlFor:"skipExisting",className:"text-sm text-text-primary",children:"Skip existing items (don't create duplicates)"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"overwriteExisting",checked:x,onChange:e=>{p(e.target.checked),e.target.checked&&u(!1)},className:"w-4 h-4"}),(0,a.jsx)("label",{htmlFor:"overwriteExisting",className:"text-sm text-text-primary",children:"Overwrite existing items (update existing equipment)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 border border-border-default rounded-lg hover:bg-background-secondary transition-colors text-text-primary",children:"Cancel"}),(0,a.jsx)("button",{onClick:b,disabled:!d||h.isPending,className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"rgb(var(--colored-button-text))"},children:h.isPending?"Applying...":"Apply Template"})]})]})})}function ew(e){let{projectId:t}=e,{firebaseUser:r,user:s,loading:n}=(0,p.A)(),l=o.i.useUtils(),{data:d}=o.i.projects.getById.useQuery({id:t}),{data:c=[],isLoading:m}=o.i.equipment.listByProject.useQuery({projectId:t}),{data:u=[]}=o.i.equipment.getActiveCheckouts.useQuery({projectId:t}),{data:x=[]}=o.i.crew.listByProject.useQuery({projectId:t}),{data:b=[]}=o.i.equipment.listPackages.useQuery({projectId:t}),{data:g}=(0,eN.aN)(t),y="owner"===g||"admin"===g||"dept_head"===g||"crew"===g,v=o.i.budget.createFromEquipment.useMutation({onSuccess:()=>{l.budget.getBudget.invalidate({projectId:t}),alert("Budget items created successfully!")}}),j=o.i.equipment.create.useMutation({onSuccess:()=>{l.equipment.listByProject.invalidate({projectId:t}),z(!1),e$()}}),f=o.i.equipment.update.useMutation({onSuccess:()=>{l.equipment.listByProject.invalidate({projectId:t}),O(!1),eo(null),e$()}}),N=o.i.equipment.delete.useMutation({onSuccess:()=>{l.equipment.listByProject.invalidate({projectId:t})}}),k=o.i.equipment.delete.useMutation({onSuccess:()=>{l.equipment.listByProject.invalidate({projectId:t}),R(new Set)}}),w=e=>{let t=new Set(Y);t.has(e)?t.delete(e):t.add(e),R(t)},C=o.i.equipment.checkout.useMutation({onSuccess:()=>{l.equipment.listByProject.invalidate({projectId:t}),l.equipment.getActiveCheckouts.invalidate({projectId:t}),H(!1),eG()}}),S=o.i.equipment.returnEquipment.useMutation({onSuccess:()=>{l.equipment.listByProject.invalidate({projectId:t}),l.equipment.getActiveCheckouts.invalidate({projectId:t})}}),D=o.i.projects.addCustomEquipmentCategory.useMutation({onSuccess:()=>{l.projects.getById.invalidate({id:t})}}),I=o.i.projects.removeCustomEquipmentCategory.useMutation({onSuccess:()=>{l.projects.getById.invalidate({id:t})}}),L=o.i.equipment.createPackage.useMutation({onSuccess:()=>{l.equipment.listPackages.invalidate({projectId:t}),G(!1),et({name:"",description:"",equipmentIds:[]}),ea(""),en("")}}),A=o.i.equipment.deletePackage.useMutation({onSuccess:()=>{l.equipment.listPackages.invalidate({projectId:t})}}),[M,P]=(0,i.useState)("equipment"),[q,B]=(0,i.useState)("grid"),[Y,R]=(0,i.useState)(new Set),[E,T]=(0,i.useState)(!1),[U,z]=(0,i.useState)(!1),[F,O]=(0,i.useState)(!1),[V,H]=(0,i.useState)(!1),[_,Q]=(0,i.useState)(null),[$,G]=(0,i.useState)(!1),[K,X]=(0,i.useState)(!1),[J,Z]=(0,i.useState)(null),[ee,et]=(0,i.useState)({name:"",description:"",equipmentIds:[]}),[er,ea]=(0,i.useState)(""),[es,en]=(0,i.useState)(""),[el,eo]=(0,i.useState)(null),[ei,ed]=(0,i.useState)(!1),[ec,em]=(0,i.useState)(null),[eu,ex]=(0,i.useState)(null),[ep,eh]=(0,i.useState)({name:"",category:"",quantity:1,status:"available",source:"owned",rentalVendor:"",dailyRate:"",weeklyRate:"",serialNumber:"",manufacturer:"",model:"",responsibleParty:"",notes:"",photoUrl:""}),[eb,eg]=(0,i.useState)({userId:"",userName:"",quantity:1,dueDate:"",notes:""}),[ey,ev]=(0,i.useState)(""),[ew,eS]=(0,i.useState)(new Set(Object.keys(ej))),[eD,eI]=(0,i.useState)(new Set(["available","checked_out","reserved","maintenance","not_available"])),[eL,eA]=(0,i.useState)(new Set(["owned","rental","crew_provided"])),[eM,eP]=(0,i.useState)(!1),[eq,eB]=(0,i.useState)(""),[eY,eR]=(0,i.useState)(!1),[eE,eT]=(0,i.useState)(""),eU=(null==d?void 0:d.customEquipmentCategories)||[],ez=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...W,...e]}(eU);(0,i.useEffect)(()=>{eU.length>0&&eS(e=>{let t=new Set(e);return eU.forEach(e=>t.add(e)),t})},[eU.length]);let eF=(0,i.useMemo)(()=>c.filter(e=>{var t,r;if(ee.equipmentIds.includes(e.id))return!1;let a=er.toLowerCase(),s=!a||e.name.toLowerCase().includes(a)||(null==(t=e.manufacturer)?void 0:t.toLowerCase().includes(a))||(null==(r=e.model)?void 0:r.toLowerCase().includes(a)),n=!es||e.category===es;return s&&n}),[c,ee.equipmentIds,er,es]),eO=(0,i.useMemo)(()=>c.filter(e=>ee.equipmentIds.includes(e.id)),[c,ee.equipmentIds]),eW=(0,i.useMemo)(()=>c.filter(e=>{var t,r,a;if(!(""===ey||e.name.toLowerCase().includes(ey.toLowerCase())||(null==(t=e.manufacturer)?void 0:t.toLowerCase().includes(ey.toLowerCase()))||(null==(r=e.model)?void 0:r.toLowerCase().includes(ey.toLowerCase()))||(null==(a=e.serialNumber)?void 0:a.toLowerCase().includes(ey.toLowerCase()))))return!1;let s=0===ew.size||ew.has(e.category),n=0===eD.size||eD.has(e.status),l=0===eL.size||eL.has(e.source);return s&&n&&l}),[c,ey,ew,eD,eL]),eV={camera:1,lenses:2,lighting:3,audio:4,grip:5,power:6,monitors:7,wireless_video:8,specialty:9,vehicles:10,other:999},eH=(0,i.useMemo)(()=>eW.reduce((e,t)=>{let r=t.category;return e[r]||(e[r]=[]),e[r].push(t),e},{}),[eW]),e_=(0,i.useMemo)(()=>Object.entries(eH).sort((e,t)=>{var r,a;let[s]=e,[n]=t,l=null!=(r=eV[s])?r:500,o=null!=(a=eV[n])?a:500;return l!==o?l-o:s.localeCompare(n)}),[eH]),eQ=(0,i.useMemo)(()=>{let e=c.length,t=c.filter(e=>"available"===e.status).length;return{total:e,available:t,checkedOut:c.filter(e=>"checked_out"===e.status).length,totalValue:c.reduce((e,t)=>e+(t.dailyRate||0),0)}},[c]),e$=()=>{eh({name:"",category:"",quantity:1,status:"available",source:"owned",rentalVendor:"",dailyRate:"",weeklyRate:"",serialNumber:"",manufacturer:"",model:"",responsibleParty:"",notes:"",photoUrl:""}),em(null),ex(null)},eG=()=>{eg({userId:"",userName:"",quantity:1,dueDate:"",notes:""})},eK=e=>{var t,r;eo(e),eh({name:e.name,category:e.category,quantity:e.quantity,status:e.status,source:e.source,rentalVendor:e.rentalVendor||"",dailyRate:(null==(t=e.dailyRate)?void 0:t.toString())||"",weeklyRate:(null==(r=e.weeklyRate)?void 0:r.toString())||"",serialNumber:e.serialNumber||"",manufacturer:e.manufacturer||"",model:e.model||"",responsibleParty:e.responsibleParty||"",notes:e.notes||"",photoUrl:e.photoUrl||""}),em(e.photoUrl||null),ex(null),O(!0)},eX=e=>{Q(e),eg({userId:(null==r?void 0:r.uid)||"",userName:(null==r?void 0:r.displayName)||(null==r?void 0:r.email)||"",quantity:1,dueDate:"",notes:""}),H(!0)},eJ=async e=>{confirm("Return ".concat(e.equipmentName,"?"))&&await S.mutateAsync({checkoutId:e.id})},eZ=async e=>{confirm("Are you sure you want to delete this equipment?")&&await N.mutateAsync({id:e})},e0=async e=>{if(e.preventDefault(),!r||!r.uid)return void alert("Please wait for authentication to complete");let a=ep.photoUrl;if(ec&&(0,h.isBlobUrl)(ec)&&eu){ed(!0);try{let e=(0,h.generateUniqueFilename)(eu.name),r="equipment/".concat(t,"/").concat(e);a=await (0,h.uploadImage)(eu,r)}catch(e){console.error("Error uploading image:",e),alert("Failed to upload image"),ed(!1);return}ed(!1)}let s={projectId:t,name:ep.name,category:ep.category,quantity:ep.quantity,status:ep.status,source:ep.source,rentalVendor:ep.rentalVendor||void 0,dailyRate:ep.dailyRate?parseFloat(ep.dailyRate):void 0,weeklyRate:ep.weeklyRate?parseFloat(ep.weeklyRate):void 0,serialNumber:ep.serialNumber||void 0,manufacturer:ep.manufacturer||void 0,model:ep.model||void 0,responsibleParty:ep.responsibleParty||void 0,notes:ep.notes||void 0,photoUrl:a||void 0,assignedTo:[],createdBy:r.uid};if(el){if(el.photoUrl&&(0,h.G)(el.photoUrl)&&el.photoUrl!==a)try{await (0,h.deleteImage)(el.photoUrl)}catch(e){console.error("Error deleting old image:",e)}await f.mutateAsync({id:el.id,data:s})}else await j.mutateAsync(s)},e2=async e=>{e.preventDefault(),_&&await C.mutateAsync({projectId:t,equipmentId:_.id,equipmentName:_.name,userId:eb.userId,userName:eb.userName,quantity:eb.quantity,checkoutDate:new Date,dueDate:eb.dueDate?new Date(eb.dueDate):void 0,notes:eb.notes||void 0})},e1=async e=>{if(!e.type.startsWith("image/"))return void alert("Please upload an image file");let t=URL.createObjectURL(e);em(t),ex(e),eh({...ep,photoUrl:t})},e4=async()=>{if(ec){if((0,h.isBlobUrl)(ec))URL.revokeObjectURL(ec);else if((0,h.G)(ec))try{await (0,h.deleteImage)(ec)}catch(e){console.error("Error deleting image:",e)}}em(null),ex(null),ex(null),eh({...ep,photoUrl:""})},e3=e=>{e.preventDefault(),e.stopPropagation()},e5=e=>{e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.files[0];t&&e1(t)},e6=async()=>{if(eq.trim())try{let e=await D.mutateAsync({projectId:t,category:eq.trim()});eS(t=>new Set(t).add(e.category)),eB(""),eP(!1)}catch(e){alert(e.message||"Failed to add category")}},e8=async()=>{if(eE.trim())try{let e=await D.mutateAsync({projectId:t,category:eE.trim()});eh({...ep,category:e.category}),eS(t=>new Set(t).add(e.category)),eT(""),eR(!1)}catch(e){alert(e.message||"Failed to add category")}},e7=async e=>{confirm('Remove custom category "'.concat(e,'"?'))&&await I.mutateAsync({projectId:t,category:e})},e9=e=>{eS(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})};return(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-6 border-b border-[rgb(var(--border-default))]",children:[(0,a.jsx)("button",{onClick:()=>P("equipment"),className:"px-6 py-3 font-medium transition-all border-b-2 ".concat("equipment"===M?"border-[rgb(var(--accent-primary))] text-[rgb(var(--accent-primary))]":"border-transparent text-text-secondary hover:text-text-primary"),children:"\uD83D\uDCE6 Equipment"}),(0,a.jsx)("button",{onClick:()=>P("packages"),className:"px-6 py-3 font-medium transition-all border-b-2 ".concat("packages"===M?"border-[rgb(var(--accent-primary))] text-[rgb(var(--accent-primary))]":"border-transparent text-text-secondary hover:text-text-primary"),children:"\uD83C\uDF81 Packages & Kits"})]}),"equipment"===M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary mb-2",children:"Equipment"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Manage cameras, lights, audio gear, and equipment accountability"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>z(!U),className:"px-4 py-2 bg-[rgb(var(--accent-primary))] rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors",style:{color:"rgb(var(--colored-button-text))"},children:U?"Cancel":"+ Add Equipment"}),y&&(0,a.jsx)("button",{className:"px-4 py-2 bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg hover:bg-[rgb(var(--background-tertiary))] transition-colors text-text-primary font-medium",onClick:()=>T(!0),children:"\uD83D\uDCCB Apply Template"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 border border-[rgb(var(--border-default))] rounded-lg p-1 bg-[rgb(var(--background-secondary))]",children:[(0,a.jsx)("button",{onClick:()=>B("grid"),className:"px-3 py-1 rounded transition-colors ".concat("grid"===q?"bg-[rgb(var(--accent-primary))]":"text-text-secondary hover:text-text-primary"),style:"grid"===q?{color:"rgb(var(--colored-button-text))"}:void 0,title:"Grid View",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),(0,a.jsx)("button",{onClick:()=>B("list"),className:"px-3 py-1 rounded transition-colors ".concat("list"===q?"bg-[rgb(var(--accent-primary))]":"text-text-secondary hover:text-text-primary"),style:"list"===q?{color:"rgb(var(--colored-button-text))"}:void 0,title:"List View",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]})]}),Y.size>0&&(0,a.jsxs)("div",{className:"bg-accent-primary/10 border border-accent-primary/30 rounded-lg p-4 mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"font-semibold text-text-primary",children:[Y.size," equipment item",1!==Y.size?"s":""," selected"]}),(0,a.jsx)("button",{onClick:()=>{Y.size===eW.length?R(new Set):R(new Set(eW.map(e=>e.id)))},className:"text-sm text-accent-primary hover:underline",children:Y.size===eW.length?"Deselect All":"Select All"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[y&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{if(0===Y.size)return;let e=Array.from(Y);v.mutate({projectId:t,equipmentIds:e}),R(new Set)},className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-primary/90 transition-colors text-sm font-medium",style:{color:"rgb(var(--colored-button-text))"},disabled:v.isPending,children:v.isPending?"Creating...":"\uD83D\uDCB0 Create Budget Items"}),(0,a.jsx)("button",{onClick:()=>{0!==Y.size&&confirm("Are you sure you want to delete ".concat(Y.size," equipment item(s)?"))&&Promise.all(Array.from(Y).map(e=>k.mutateAsync({id:e}))).then(()=>{R(new Set)})},className:"px-4 py-2 bg-error text-white rounded-lg hover:bg-error/90 transition-colors text-sm font-medium",disabled:k.isPending,children:k.isPending?"Deleting...":"\uD83D\uDDD1️ Delete Selected"})]}),(0,a.jsx)("button",{onClick:()=>R(new Set),className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-text-primary text-sm font-medium",children:"Cancel"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-8",children:[(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-text-tertiary text-sm mb-1",children:"Total Items"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-text-primary",children:eQ.total})]}),(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-text-tertiary text-sm mb-1",children:"Available"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-400",children:eQ.available})]}),(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-text-tertiary text-sm mb-1",children:"Checked Out"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-400",children:eQ.checkedOut})]}),(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-text-tertiary text-sm mb-1",children:"Daily Rental Value"}),(0,a.jsxs)("div",{className:"text-2xl font-bold text-text-primary",children:["$",eQ.totalValue]})]})]}),U&&(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Add New Equipment"}),(0,a.jsxs)("form",{onSubmit:e0,children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Equipment Photo"}),ec?(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("img",{src:ec,alt:"Equipment preview",className:"w-32 h-32 object-cover rounded-lg"}),(0,a.jsx)("button",{type:"button",onClick:e4,className:"absolute -top-2 -right-2 bg-red-500 rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600",style:{color:"rgb(var(--colored-button-text))"},children:"\xd7"})]}):(0,a.jsxs)("div",{onDragOver:e3,onDrop:e5,className:"border-2 border-dashed border-[rgb(var(--border-default))] rounded-lg p-8 text-center cursor-pointer hover:border-[rgb(var(--accent-primary))] transition-colors",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return(null==(t=e.target.files)?void 0:t[0])&&e1(e.target.files[0])},className:"hidden",id:"equipment-photo-upload"}),(0,a.jsxs)("label",{htmlFor:"equipment-photo-upload",className:"cursor-pointer",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCF7"}),(0,a.jsx)("div",{className:"text-text-secondary",children:"Drag & drop or click to upload equipment photo"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Equipment Name *"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., ARRI Alexa Mini LF",value:ep.name,onChange:e=>eh({...ep,name:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Category *"}),eY?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"New category name",value:eE,onChange:e=>eT(e.target.value),className:"flex-1 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),e8())}}),(0,a.jsx)("button",{type:"button",onClick:e8,className:"px-3 py-2 bg-[rgb(var(--accent-primary))] text-white rounded-lg hover:bg-[rgb(var(--accent-hover))]",children:"Add"}),(0,a.jsx)("button",{type:"button",onClick:()=>{eR(!1),eT("")},className:"px-3 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--border-emphasis))] transition-colors text-text-secondary",children:"Cancel"})]}):(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("select",{value:ep.category,onChange:e=>eh({...ep,category:e.target.value}),className:"flex-1 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select category..."}),Object.keys(ej).map(e=>(0,a.jsx)("option",{value:e,children:ej[e]},e)),eU.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsx)("button",{type:"button",onClick:()=>eR(!0),className:"px-3 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--accent-primary))] transition-colors text-text-secondary text-sm",children:"+ Custom"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Manufacturer"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., ARRI, RED, Sony",value:ep.manufacturer,onChange:e=>eh({...ep,manufacturer:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Model"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Alexa Mini LF",value:ep.model,onChange:e=>eh({...ep,model:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Quantity *"}),(0,a.jsx)("input",{type:"number",min:"1",value:ep.quantity,onChange:e=>eh({...ep,quantity:parseInt(e.target.value)||1}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Source *"}),(0,a.jsxs)("select",{value:ep.source,onChange:e=>eh({...ep,source:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0,children:[(0,a.jsx)("option",{value:"owned",children:"Owned"}),(0,a.jsx)("option",{value:"rental",children:"Rental"}),(0,a.jsx)("option",{value:"crew_provided",children:"Crew Provided"})]})]}),"rental"===ep.source&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Rental Vendor"}),(0,a.jsx)("input",{type:"text",placeholder:"Vendor name",value:ep.rentalVendor,onChange:e=>eh({...ep,rentalVendor:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),"rental"===ep.source&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Daily Rate ($)"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ep.dailyRate,onChange:e=>eh({...ep,dailyRate:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),"rental"===ep.source&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Weekly Rate ($)"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ep.weeklyRate,onChange:e=>eh({...ep,weeklyRate:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Serial Number"}),(0,a.jsx)("input",{type:"text",placeholder:"Serial or asset number",value:ep.serialNumber,onChange:e=>eh({...ep,serialNumber:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Responsible Party"}),(0,a.jsxs)("select",{value:ep.responsibleParty,onChange:e=>eh({...ep,responsibleParty:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",children:[(0,a.jsx)("option",{value:"",children:"Select crew member..."}),x.map(e=>(0,a.jsxs)("option",{value:e.name,children:[e.name," - ",e.role]},e.id))]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Notes"}),(0,a.jsx)("textarea",{value:ep.notes,onChange:e=>eh({...ep,notes:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",rows:3,placeholder:"Condition, accessories, special notes..."})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{type:"submit",disabled:j.isPending||ei||n||!(null==r?void 0:r.uid),className:"px-4 py-2 bg-[rgb(var(--accent-primary))] text-white rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors disabled:opacity-50",children:n?"Loading...":ei?"Uploading...":j.isPending?"Adding...":"Add Equipment"}),(0,a.jsx)("button",{type:"button",onClick:()=>{z(!1),e$()},className:"px-4 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--border-emphasis))] transition-colors text-text-secondary",children:"Cancel"})]})]})]}),m?(0,a.jsx)("div",{className:"text-center py-12 text-text-secondary",children:"Loading equipment..."}):0===eW.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCE6"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-text-primary mb-2",children:"No equipment found"}),(0,a.jsx)("p",{className:"text-text-secondary",children:0===c.length?"Add your first piece of equipment to get started":"Try adjusting your filters"})]}):(0,a.jsx)(a.Fragment,{children:e_.length>0?(0,a.jsx)("div",{className:"space-y-8",children:e_.map(e=>{let[r,s]=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:ef(r)}),(0,a.jsx)("span",{className:"badge-primary",children:s.length})]}),"grid"===q?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(e=>(0,a.jsxs)("div",{id:"element-".concat(e.id),className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-4 hover:border-[rgb(var(--accent-primary))] transition-all relative ".concat(Y.has(e.id)?"ring-2 ring-accent-primary border-accent-primary":""),children:[y&&(0,a.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,a.jsx)("input",{type:"checkbox",checked:Y.has(e.id),onChange:()=>w(e.id),className:"w-5 h-5 rounded border-2 border-accent-primary text-accent-primary focus:ring-2 focus:ring-accent-primary cursor-pointer bg-transparent checked:bg-accent-primary",style:{accentColor:"rgb(var(--accent-primary))"}})}),e.photoUrl&&(0,a.jsx)("img",{src:e.photoUrl,alt:e.name,className:"w-full h-40 object-cover rounded-lg mb-4"}),(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:e.name}),(e.manufacturer||e.model)&&(0,a.jsx)("p",{className:"text-sm text-text-tertiary mb-2",children:[e.manufacturer,e.model].filter(Boolean).join(" ")})]}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("available"===e.status?"bg-green-500/20 text-green-400":"checked_out"===e.status?"bg-yellow-500/20 text-yellow-400":"reserved"===e.status?"bg-blue-500/20 text-blue-400":"not_available"===e.status?"bg-gray-500/20 text-gray-400":"maintenance"===e.status?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"),children:e.status.replace("_"," ")})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-text-tertiary",children:"Category:"}),(0,a.jsx)("span",{className:"text-text-secondary",children:ef(e.category)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-text-tertiary",children:"Quantity:"}),(0,a.jsxs)("span",{className:"text-text-secondary",children:[e.quantityAvailable," / ",e.quantity," available"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-text-tertiary",children:"Source:"}),(0,a.jsx)("span",{className:"text-text-secondary",children:"owned"===e.source?"Owned":"rental"===e.source?"Rental":"Crew Provided"})]}),e.serialNumber&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-text-tertiary",children:"Serial:"}),(0,a.jsx)("span",{className:"text-text-secondary font-mono",children:e.serialNumber})]}),e.dailyRate&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-text-tertiary",children:"Daily Rate:"}),(0,a.jsxs)("span",{className:"text-text-secondary",children:["$",e.dailyRate]})]})]}),(0,a.jsx)(eC,{projectId:t,equipmentId:e.id,canEdit:y,onCreateBudgetItem:()=>{v.mutate({projectId:t,equipmentIds:[e.id]})},onViewBudget:()=>{window.location.href="/projects/".concat(t,"#budget")}}),(0,a.jsxs)("div",{className:"flex gap-2",children:[e.quantityAvailable>0&&(0,a.jsx)("button",{onClick:()=>eX(e),className:"flex-1 px-3 py-2 bg-[rgb(var(--accent-primary))] text-white rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors text-sm",children:"Checkout"}),(0,a.jsx)("button",{onClick:()=>eK(e),className:"flex-1 px-3 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--accent-primary))] transition-colors text-text-secondary text-sm",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>eZ(e.id),className:"px-3 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors text-sm",children:"Delete"})]})]},e.id))}):(0,a.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,a.jsxs)("div",{id:"element-".concat(e.id),className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-4 hover:border-[rgb(var(--accent-primary))] transition-all flex items-center gap-4 ".concat(Y.has(e.id)?"ring-2 ring-accent-primary border-accent-primary bg-accent-primary/5":""),children:[y&&(0,a.jsx)("input",{type:"checkbox",checked:Y.has(e.id),onChange:()=>w(e.id),className:"w-5 h-5 rounded border-2 border-accent-primary text-accent-primary focus:ring-2 focus:ring-accent-primary flex-shrink-0 cursor-pointer bg-transparent checked:bg-accent-primary",style:{accentColor:"rgb(var(--accent-primary))"}}),(0,a.jsx)("div",{className:"flex-shrink-0",children:e.photoUrl?(0,a.jsx)("img",{src:e.photoUrl,alt:e.name,className:"w-16 h-16 object-cover rounded-lg"}):(0,a.jsx)("div",{className:"w-16 h-16 bg-[rgb(var(--background-tertiary))] rounded-lg flex items-center justify-center text-2xl",children:"\uD83D\uDCE6"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary truncate",children:e.name}),(e.manufacturer||e.model)&&(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:[e.manufacturer,e.model].filter(Boolean).join(" ")})]}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ml-2 ".concat("available"===e.status?"bg-green-500/20 text-green-400":"checked_out"===e.status?"bg-yellow-500/20 text-yellow-400":"reserved"===e.status?"bg-blue-500/20 text-blue-400":"not_available"===e.status?"bg-gray-500/20 text-gray-400":"maintenance"===e.status?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"),children:e.status.replace("_"," ")})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[(0,a.jsxs)("span",{children:["Category: ",ef(e.category)]}),(0,a.jsxs)("span",{children:["Qty: ",e.quantityAvailable," / ",e.quantity]}),e.dailyRate&&(0,a.jsxs)("span",{children:["$",e.dailyRate,"/day"]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-shrink-0",children:[e.quantityAvailable>0&&(0,a.jsx)("button",{onClick:()=>eX(e),className:"px-3 py-2 bg-[rgb(var(--accent-primary))] text-white rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors text-sm",children:"Checkout"}),(0,a.jsx)("button",{onClick:()=>eK(e),className:"px-3 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--accent-primary))] transition-colors text-text-secondary text-sm",children:"Edit"}),y&&(0,a.jsx)("button",{onClick:()=>eZ(e.id),className:"px-3 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors text-sm",children:"Delete"})]})]},e.id))})]},r)})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCE6"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-text-primary mb-2",children:"No equipment found"}),(0,a.jsx)("p",{className:"text-text-secondary",children:0===c.length?"Add your first piece of equipment to get started":"Try adjusting your filters"})]})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary mb-2",children:"Packages & Kits"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Group equipment into packages for easy checkout and management"})]}),(0,a.jsx)("button",{onClick:()=>G(!$),className:"px-4 py-2 bg-[rgb(var(--accent-primary))] rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors",style:{color:"rgb(var(--colored-button-text))"},children:$?"Cancel":"+ Create Package"})]}),$&&(0,a.jsx)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-6 mb-6",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r&&r.uid&&L.mutate({projectId:t,name:ee.name,description:ee.description,equipmentIds:ee.equipmentIds,createdBy:r.uid})},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Package Name *"}),(0,a.jsx)("input",{type:"text",value:ee.name,onChange:e=>et({...ee,name:e.target.value}),placeholder:"e.g., Camera Package A, Lighting Kit 1",className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:ee.description,onChange:e=>et({...ee,description:e.target.value}),placeholder:"Describe what's in this package...",className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary min-h-[100px]"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-3",children:"Add Equipment to Package"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"border border-border-default rounded-lg bg-background-primary",children:[(0,a.jsxs)("div",{className:"p-3 border-b border-border-default bg-background-tertiary",children:[(0,a.jsxs)("div",{className:"text-xs font-semibold text-text-tertiary mb-2",children:["AVAILABLE (",eF.length,")"]}),(0,a.jsx)("input",{type:"text",value:er,onChange:e=>ea(e.target.value),placeholder:"Search equipment...",className:"w-full px-2 py-1 text-sm bg-background-primary border border-border-default rounded"}),(0,a.jsxs)("select",{value:es,onChange:e=>en(e.target.value),className:"w-full px-2 py-1 text-sm bg-background-primary border border-border-default rounded mt-2",children:[(0,a.jsx)("option",{value:"",children:"All Categories"}),Object.entries(ej).map(e=>{let[t,r]=e;return(0,a.jsx)("option",{value:t,children:r},t)}),eU.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto p-2",children:0===eF.length?(0,a.jsx)("p",{className:"text-sm text-text-tertiary text-center py-8",children:0===c.length?"No equipment available":"No matching equipment"}):(0,a.jsx)("div",{className:"space-y-1",children:eF.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{et({...ee,equipmentIds:[...ee.equipmentIds,e.id]})},className:"w-full text-left px-3 py-2 rounded hover:bg-background-tertiary transition-colors group",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm text-text-primary truncate",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:ef(e.category)})]}),(0,a.jsx)("div",{className:"ml-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-accent-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})},e.id))})})]}),(0,a.jsxs)("div",{className:"border border-border-default rounded-lg bg-background-primary",children:[(0,a.jsx)("div",{className:"p-3 border-b border-border-default bg-accent-primary/10",children:(0,a.jsxs)("div",{className:"text-xs font-semibold text-accent-primary",children:["SELECTED (",eO.length,")"]})}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto p-2",children:0===eO.length?(0,a.jsx)("p",{className:"text-sm text-text-tertiary text-center py-8",children:"Click items to add them to the package"}):(0,a.jsx)("div",{className:"space-y-1",children:eO.map(e=>(0,a.jsx)("div",{className:"px-3 py-2 rounded bg-accent-primary/5 group hover:bg-accent-primary/10 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm text-text-primary truncate",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:ef(e.category)})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{et({...ee,equipmentIds:ee.equipmentIds.filter(t=>t!==e.id)})},className:"ml-2 opacity-50 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-error",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},e.id))})})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{G(!1),et({name:"",description:"",equipmentIds:[]}),ea(""),en("")},className:"px-4 py-2 bg-background-tertiary text-text-primary rounded-lg hover:bg-background-secondary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:!ee.name||0===ee.equipmentIds.length||L.isPending,className:"px-4 py-2 bg-[rgb(var(--accent-primary))] rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"rgb(var(--colored-button-text))"},children:L.isPending?"Creating...":"Create Package"})]})]})}),0===b.length?(0,a.jsxs)("div",{className:"text-center py-16 bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCE6"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-text-primary mb-2",children:"No Packages Yet"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Create your first equipment package to group related items together"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:b.map(e=>{let t=c.filter(t=>{var r;return null==(r=e.equipmentIds)?void 0:r.includes(t.id)}),r=t.every(e=>"available"===e.status);return(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:e.description})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 ml-4",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(r?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"),children:r?"All Available":"Partially Available"})})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"text-xs font-medium text-text-tertiary mb-2",children:["Equipment (",t.length," items):"]}),0===t.length?(0,a.jsx)("p",{className:"text-sm text-text-tertiary italic",children:"No equipment in this package"}):(0,a.jsx)("div",{className:"space-y-1",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-text-secondary",children:e.name}),(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-xs ".concat("available"===e.status?"bg-green-500/20 text-green-400":"checked_out"===e.status?"bg-blue-500/20 text-blue-400":"bg-gray-500/20 text-gray-400"),children:e.status.replace("_"," ")})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-4 border-t border-border-default",children:[(0,a.jsx)("button",{onClick:()=>{Z(e),X(!0)},disabled:0===t.length,className:"flex-1 px-3 py-2 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"\uD83D\uDCE4 Checkout Kit"}),(0,a.jsx)("button",{onClick:()=>{confirm('Delete package "'.concat(e.name,'"?'))&&A.mutate({id:e.id})},className:"px-3 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors text-sm",children:"Delete"})]})]},e.id)})})]})]})}),(0,a.jsx)("div",{className:"w-80 border-l border-[rgb(var(--border-default))] bg-[rgb(var(--background-secondary))] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-6",children:"Filters & Status"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Search"}),(0,a.jsx)("input",{type:"text",placeholder:"Search equipment...",value:ey,onChange:e=>ev(e.target.value),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary text-sm"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-text-secondary",children:"Categories"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{eS(new Set(ez))},className:"text-xs text-[rgb(var(--accent-primary))] hover:text-[rgb(var(--accent-hover))]",children:"Select All"}),(0,a.jsx)("button",{onClick:()=>{eS(new Set)},className:"text-xs text-text-tertiary hover:text-text-secondary",children:"Clear"})]})]}),(0,a.jsxs)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[Object.keys(ej).sort((e,t)=>{var r,a;let s=null!=(r=eV[e])?r:500,n=null!=(a=eV[t])?a:500;return s!==n?s-n:e.localeCompare(t)}).map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer group",children:[(0,a.jsx)("input",{type:"checkbox",checked:ew.has(e),onChange:()=>e9(e),className:"rounded border-[rgb(var(--border-default))] bg-[rgb(var(--background-tertiary))] text-[rgb(var(--accent-primary))] focus:ring-[rgb(var(--accent-primary))]"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary group-hover:text-text-primary",children:ej[e]})]},e)),eU.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer group flex-1",children:[(0,a.jsx)("input",{type:"checkbox",checked:ew.has(e),onChange:()=>e9(e),className:"rounded border-[rgb(var(--border-default))] bg-[rgb(var(--background-tertiary))] text-[rgb(var(--accent-primary))] focus:ring-[rgb(var(--accent-primary))]"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary group-hover:text-text-primary",children:e})]}),(0,a.jsx)("button",{onClick:()=>e7(e),className:"text-xs text-red-400 hover:text-red-300",title:"Remove custom category",children:"\xd7"})]},e))]}),eM?(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Category name",value:eq,onChange:e=>eB(e.target.value),className:"flex-1 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded px-2 py-1 text-sm text-text-primary",onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),e6())}}),(0,a.jsx)("button",{onClick:e6,className:"px-2 py-1 bg-[rgb(var(--accent-primary))] text-white rounded text-xs hover:bg-[rgb(var(--accent-hover))]",children:"Add"}),(0,a.jsx)("button",{onClick:()=>{eP(!1),eB("")},className:"px-2 py-1 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded text-xs text-text-secondary hover:border-[rgb(var(--border-emphasis))]",children:"Cancel"})]}):(0,a.jsx)("button",{onClick:()=>eP(!0),className:"mt-3 text-sm text-[rgb(var(--accent-primary))] hover:text-[rgb(var(--accent-hover))]",children:"+ Add Custom Category"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-3",children:"Status"}),(0,a.jsx)("div",{className:"space-y-2",children:["available","checked_out","reserved","maintenance","not_available"].map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer group",children:[(0,a.jsx)("input",{type:"checkbox",checked:eD.has(e),onChange:()=>{eI(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},className:"rounded border-[rgb(var(--border-default))] bg-[rgb(var(--background-tertiary))] text-[rgb(var(--accent-primary))] focus:ring-[rgb(var(--accent-primary))]"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary group-hover:text-text-primary capitalize",children:e.replace("_"," ")})]},e))})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-3",children:"Source"}),(0,a.jsx)("div",{className:"space-y-2",children:["owned","rental","crew_provided"].map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer group",children:[(0,a.jsx)("input",{type:"checkbox",checked:eL.has(e),onChange:()=>{eA(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},className:"rounded border-[rgb(var(--border-default))] bg-[rgb(var(--background-tertiary))] text-[rgb(var(--accent-primary))] focus:ring-[rgb(var(--accent-primary))]"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary group-hover:text-text-primary",children:"owned"===e?"Owned":"rental"===e?"Rental":"Crew Provided"})]},e))})]}),(0,a.jsxs)("div",{className:"border-t border-[rgb(var(--border-default))] pt-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-text-secondary mb-4",children:"Currently Checked Out"}),0===u.length?(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"No equipment currently checked out"}):(0,a.jsx)("div",{className:"space-y-3",children:u.map(e=>(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg p-3",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-text-primary mb-1",children:e.equipmentName}),(0,a.jsxs)("div",{className:"text-xs text-text-secondary mb-1",children:["Checked out by: ",e.userName]}),(0,a.jsxs)("div",{className:"text-xs text-text-tertiary mb-2",children:["Qty: ",e.quantity," • ",new Date(e.checkoutDate).toLocaleDateString()]}),e.dueDate&&(0,a.jsxs)("div",{className:"text-xs text-yellow-400 mb-2",children:["Due: ",new Date(e.dueDate).toLocaleDateString()]}),(0,a.jsx)("button",{onClick:()=>eJ(e),className:"w-full px-2 py-1 bg-green-500/20 text-green-400 rounded text-xs hover:bg-green-500/30 transition-colors",children:"Mark as Returned"})]},e.id))})]})]})}),F&&el&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Edit Equipment"}),(0,a.jsx)("button",{onClick:()=>{O(!1),eo(null),e$()},className:"text-text-tertiary hover:text-text-primary text-2xl",children:"\xd7"})]}),(0,a.jsxs)("form",{onSubmit:e0,children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Equipment Photo"}),ec?(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("img",{src:ec,alt:"Equipment preview",className:"w-32 h-32 object-cover rounded-lg"}),(0,a.jsx)("button",{type:"button",onClick:e4,className:"absolute -top-2 -right-2 bg-red-500 rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600",style:{color:"rgb(var(--colored-button-text))"},children:"\xd7"})]}):(0,a.jsxs)("div",{onDragOver:e3,onDrop:e5,className:"border-2 border-dashed border-[rgb(var(--border-default))] rounded-lg p-8 text-center cursor-pointer hover:border-[rgb(var(--accent-primary))] transition-colors",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return(null==(t=e.target.files)?void 0:t[0])&&e1(e.target.files[0])},className:"hidden",id:"equipment-photo-upload-edit"}),(0,a.jsxs)("label",{htmlFor:"equipment-photo-upload-edit",className:"cursor-pointer",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCF7"}),(0,a.jsx)("div",{className:"text-text-secondary",children:"Drag & drop or click to upload equipment photo"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Equipment Name *"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., ARRI Alexa Mini LF",value:ep.name,onChange:e=>eh({...ep,name:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Category *"}),eY?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"New category name",value:eE,onChange:e=>eT(e.target.value),className:"flex-1 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),e8())}}),(0,a.jsx)("button",{type:"button",onClick:e8,className:"px-3 py-2 bg-[rgb(var(--accent-primary))] text-white rounded-lg hover:bg-[rgb(var(--accent-hover))]",children:"Add"}),(0,a.jsx)("button",{type:"button",onClick:()=>{eR(!1),eT("")},className:"px-3 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--border-emphasis))] transition-colors text-text-secondary",children:"Cancel"})]}):(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("select",{value:ep.category,onChange:e=>eh({...ep,category:e.target.value}),className:"flex-1 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select category..."}),Object.keys(ej).map(e=>(0,a.jsx)("option",{value:e,children:ej[e]},e)),eU.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsx)("button",{type:"button",onClick:()=>eR(!0),className:"px-3 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--accent-primary))] transition-colors text-text-secondary text-sm",children:"+ Custom"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Manufacturer"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., ARRI, RED, Sony",value:ep.manufacturer,onChange:e=>eh({...ep,manufacturer:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Model"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Alexa Mini LF",value:ep.model,onChange:e=>eh({...ep,model:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Quantity *"}),(0,a.jsx)("input",{type:"number",min:"1",value:ep.quantity,onChange:e=>eh({...ep,quantity:parseInt(e.target.value)||1}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Status *"}),(0,a.jsxs)("select",{value:ep.status,onChange:e=>eh({...ep,status:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0,children:[(0,a.jsx)("option",{value:"available",children:"Available"}),(0,a.jsx)("option",{value:"checked_out",children:"Checked Out"}),(0,a.jsx)("option",{value:"reserved",children:"Reserved"}),(0,a.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,a.jsx)("option",{value:"not_available",children:"Not Available"}),(0,a.jsx)("option",{value:"lost",children:"Lost"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Source *"}),(0,a.jsxs)("select",{value:ep.source,onChange:e=>eh({...ep,source:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0,children:[(0,a.jsx)("option",{value:"owned",children:"Owned"}),(0,a.jsx)("option",{value:"rental",children:"Rental"}),(0,a.jsx)("option",{value:"crew_provided",children:"Crew Provided"})]})]}),"rental"===ep.source&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Rental Vendor"}),(0,a.jsx)("input",{type:"text",placeholder:"Vendor name",value:ep.rentalVendor,onChange:e=>eh({...ep,rentalVendor:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),"rental"===ep.source&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Daily Rate ($)"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ep.dailyRate,onChange:e=>eh({...ep,dailyRate:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),"rental"===ep.source&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Weekly Rate ($)"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ep.weeklyRate,onChange:e=>eh({...ep,weeklyRate:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Serial Number"}),(0,a.jsx)("input",{type:"text",placeholder:"Serial or asset number",value:ep.serialNumber,onChange:e=>eh({...ep,serialNumber:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Responsible Party"}),(0,a.jsxs)("select",{value:ep.responsibleParty,onChange:e=>eh({...ep,responsibleParty:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",children:[(0,a.jsx)("option",{value:"",children:"Select crew member..."}),x.map(e=>(0,a.jsxs)("option",{value:e.name,children:[e.name," - ",e.role]},e.id))]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Notes"}),(0,a.jsx)("textarea",{value:ep.notes,onChange:e=>eh({...ep,notes:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",rows:3,placeholder:"Condition, accessories, special notes..."})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{type:"submit",disabled:f.isPending||ei||n||!(null==r?void 0:r.uid),className:"px-4 py-2 bg-[rgb(var(--accent-primary))] text-white rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors disabled:opacity-50",children:n?"Loading...":ei?"Uploading...":f.isPending?"Saving...":"Save Changes"}),(0,a.jsx)("button",{type:"button",onClick:()=>{O(!1),eo(null),e$()},className:"px-4 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--border-emphasis))] transition-colors text-text-secondary",children:"Cancel"})]})]})]})})}),V&&_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg max-w-md w-full",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Checkout Equipment"}),(0,a.jsx)("button",{onClick:()=>{H(!1),Q(null),eG()},className:"text-text-tertiary hover:text-text-primary text-2xl",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"mb-6 p-4 bg-[rgb(var(--background-tertiary))] rounded-lg",children:[(0,a.jsx)("div",{className:"font-semibold text-text-primary mb-1",children:_.name}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:["Available: ",_.quantityAvailable," / ",_.quantity]})]}),(0,a.jsxs)("form",{onSubmit:e2,children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("input",{type:"hidden",value:eb.userId}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Checked Out By *"}),(0,a.jsx)("input",{type:"text",placeholder:"Person's name",value:eb.userName,onChange:e=>eg({...eb,userName:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Quantity *"}),(0,a.jsx)("input",{type:"number",min:"1",max:_.quantityAvailable,value:eb.quantity,onChange:e=>eg({...eb,quantity:parseInt(e.target.value)||1}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Due Date (Optional)"}),(0,a.jsx)("input",{type:"date",value:eb.dueDate,onChange:e=>eg({...eb,dueDate:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Notes"}),(0,a.jsx)("textarea",{value:eb.notes,onChange:e=>eg({...eb,notes:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",rows:3,placeholder:"Special instructions or notes..."})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{type:"submit",disabled:C.isPending,className:"flex-1 px-4 py-2 bg-[rgb(var(--accent-primary))] text-white rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors disabled:opacity-50",children:C.isPending?"Checking Out...":"Checkout"}),(0,a.jsx)("button",{type:"button",onClick:()=>{H(!1),Q(null),eG()},className:"px-4 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--border-emphasis))] transition-colors text-text-secondary",children:"Cancel"})]})]})]})})}),K&&J&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Checkout Package"}),(0,a.jsx)("button",{onClick:()=>{X(!1),Z(null),eG()},className:"text-text-tertiary hover:text-text-primary text-2xl",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"mb-6 p-4 bg-[rgb(var(--background-tertiary))] rounded-lg",children:[(0,a.jsx)("div",{className:"font-semibold text-text-primary mb-2",children:J.name}),J.description&&(0,a.jsx)("div",{className:"text-sm text-text-secondary mb-3",children:J.description}),(0,a.jsx)("div",{className:"text-xs font-medium text-text-tertiary mb-2",children:"Equipment in this package:"}),(0,a.jsx)("div",{className:"space-y-1",children:c.filter(e=>{var t;return null==(t=J.equipmentIds)?void 0:t.includes(e.id)}).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-text-primary",children:e.name}),(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-xs ".concat("available"===e.status?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"),children:"available"===e.status?"Available":"Not Available"})]},e.id))})]}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let r=c.filter(e=>{var t;return(null==(t=J.equipmentIds)?void 0:t.includes(e.id))&&"available"===e.status});if(0===r.length)return void alert("No equipment available to checkout in this package");Promise.all(r.map(e=>C.mutateAsync({projectId:t,equipmentId:e.id,equipmentName:e.name,userId:eb.userId,userName:eb.userName,quantity:1,checkoutDate:new Date,dueDate:eb.dueDate?new Date(eb.dueDate):void 0,notes:eb.notes||void 0}))).then(()=>{X(!1),Z(null),eG(),alert("Successfully checked out ".concat(r.length,' items from package "').concat(J.name,'"'))}).catch(e=>{alert("Error checking out package: ".concat(e.message))})},children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Checked Out By *"}),(0,a.jsx)("input",{type:"text",placeholder:"Person's name",value:eb.userName,onChange:e=>eg({...eb,userName:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Due Date (Optional)"}),(0,a.jsx)("input",{type:"date",value:eb.dueDate,onChange:e=>eg({...eb,dueDate:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Notes"}),(0,a.jsx)("textarea",{value:eb.notes,onChange:e=>eg({...eb,notes:e.target.value}),className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",rows:3,placeholder:"Special instructions or notes..."})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{type:"submit",disabled:C.isPending,className:"flex-1 px-4 py-2 bg-[rgb(var(--accent-primary))] text-white rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors disabled:opacity-50",children:C.isPending?"Checking Out...":"Checkout Entire Kit"}),(0,a.jsx)("button",{type:"button",onClick:()=>{X(!1),Z(null),eG()},className:"px-4 py-2 bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg hover:border-[rgb(var(--border-emphasis))] transition-colors text-text-secondary",children:"Cancel"})]})]})]})})}),E&&(0,a.jsx)(ek,{projectId:t,onClose:()=>T(!1)})]})}function eC(e){let{projectId:t,equipmentId:r,canEdit:s,onCreateBudgetItem:n,onViewBudget:l}=e,{data:i=[],isLoading:d}=o.i.budget.getItemsByEquipment.useQuery({projectId:t,equipmentId:r});if(d)return(0,a.jsx)("div",{className:"text-xs text-text-tertiary mb-2",children:"Loading budget..."});if(0===i.length)return(0,a.jsx)("div",{className:"pt-2 pb-2 border-t border-border-default mb-2",children:s&&(0,a.jsx)("button",{onClick:n,className:"w-full text-xs px-2 py-1 bg-background-tertiary hover:bg-accent-primary/10 text-accent-primary rounded border border-border-default transition-colors",children:"\uD83D\uDCB0 Create Budget Item"})});let c=i.reduce((e,t)=>e+(t.estimatedAmount||0),0);return(0,a.jsxs)("div",{className:"pt-2 pb-2 border-t border-border-default mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("span",{className:"text-xs font-medium text-text-primary",children:["\uD83D\uDCB0 ",i.length," Budget Item",1!==i.length?"s":""]}),(0,a.jsx)("button",{onClick:l,className:"text-xs text-accent-primary hover:text-accent-hover",children:"View →"})]}),(0,a.jsxs)("div",{className:"text-xs text-text-secondary",children:["Total: $",c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),s&&(0,a.jsx)("button",{onClick:n,className:"mt-1 w-full text-xs px-2 py-1 bg-background-tertiary hover:bg-accent-primary/10 text-accent-primary rounded border border-border-default transition-colors",children:"+ Add Another"})]})}var eS=r(5612);function eD(e){let t=o.i.useUtils(),{data:r,isLoading:a,error:s}=o.i.schedule.getSchedule.useQuery({projectId:e}),n=(0,i.useMemo)(()=>r?{...r,days:r.days.map(e=>({...e,date:e.date instanceof Date?e.date:new Date(e.date),createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)})),events:r.events.map(e=>({...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}))}:r,[r]),l=o.i.schedule.createDay.useMutation({onSuccess:()=>{t.schedule.getSchedule.invalidate({projectId:e})}}),d=o.i.schedule.updateDay.useMutation({onSuccess:()=>{t.schedule.getSchedule.invalidate({projectId:e})}}),c=o.i.schedule.deleteDay.useMutation({onSuccess:()=>{t.schedule.getSchedule.invalidate({projectId:e})}}),m=o.i.schedule.createEvent.useMutation({onSuccess:()=>{t.schedule.getSchedule.invalidate({projectId:e})}});return{schedule:n,isLoading:a,error:s,createDay:l,updateDay:d,deleteDay:c,createEvent:m,updateEvent:o.i.schedule.updateEvent.useMutation({onSuccess:()=>{t.schedule.getSchedule.invalidate({projectId:e})}}),deleteEvent:o.i.schedule.deleteEvent.useMutation({onSuccess:()=>{t.schedule.getSchedule.invalidate({projectId:e})}})}}function eI(e){var t,r,s,n,l,d;let{projectId:c,shootingDayId:m,isOpen:u,onClose:x,onCreate:p,initialData:h}=e,{data:b=[]}=o.i.crew.listByProject.useQuery({projectId:c}),{data:g=[]}=o.i.cast.listByProject.useQuery({projectId:c}),{data:y=[]}=o.i.equipment.listByProject.useQuery({projectId:c}),{data:v=[]}=o.i.equipment.listPackages.useQuery({projectId:c}),{data:j=[]}=o.i.locations.listByProject.useQuery({projectId:c}),{data:f=[],isLoading:N}=o.i.scenes.listByProject.useQuery({projectId:c}),{data:k}=o.i.schedule.getSchedule.useQuery({projectId:c}),{data:w=[]}=o.i.referenceImages.list.useQuery({projectId:c}),[C,S]=(0,i.useState)(""),{data:D=[]}=o.i.scenes.getShotsByScene.useQuery({sceneId:C},{enabled:!!C}),[I,L]=(0,i.useState)({time:(null==h?void 0:h.time)||"",sceneNumber:(null==h?void 0:h.sceneNumber)||"",description:(null==h?void 0:h.description)||"",location:(null==h?void 0:h.location)||"",locationId:"",pageCount:(null==h?void 0:h.pageCount)||"",type:(null==h?void 0:h.type)||"scene",duration:"",notes:"",sceneId:"",shotId:""}),[A,M]=(0,i.useState)(new Set),[P,q]=(0,i.useState)(new Set),[B,Y]=(0,i.useState)(new Set),[R,E]=(0,i.useState)(new Set),[T,U]=(0,i.useState)(!1),[z,F]=(0,i.useState)(!1),[O,W]=(0,i.useState)(!1),[V,H]=(0,i.useState)(!1),[_,Q]=(0,i.useState)(!1),[$,G]=(0,i.useState)(!1),[K,X]=(0,i.useState)(""),[J,Z]=(0,i.useState)(""),[ee,et]=(0,i.useState)(""),[er,ea]=(0,i.useState)(""),[es,en]=(0,i.useState)(""),[el,eo]=(0,i.useState)("");(0,i.useEffect)(()=>{if(u)if(h){var e;L({time:h.time||"",sceneNumber:h.sceneNumber||"",description:h.description||"",location:h.location||"",locationId:h.locationId||"",pageCount:h.pageCount||"",type:h.type||"scene",duration:(null==(e=h.duration)?void 0:e.toString())||"",notes:h.notes||"",sceneId:h.sceneId||"",shotId:h.shotId||""}),M(new Set(h.castIds||[])),q(new Set(h.crewIds||[])),Y(new Set(h.equipmentIds||[])),E(new Set(h.storyboardIds||[])),S(h.sceneId||"")}else L({time:"",sceneNumber:"",description:"",location:"",locationId:"",pageCount:"",type:"scene",duration:"",notes:"",sceneId:"",shotId:""}),M(new Set),q(new Set),Y(new Set),E(new Set),S(""),X(""),Z(""),et(""),ea(""),en(""),U(!1),F(!1),W(!1),H(!1),Q(!1),G(!1),eo("")},[u,h]);let ei=e=>{if(S(e),L(e=>({...e,shotId:""})),U(!1),X(""),e){let t=f.find(t=>t.id===e);if(t){let r=t.locationIds||(t.locationId?[t.locationId]:[]),a=t.locationNames||(t.locationName?[t.locationName]:[]),s=j.find(e=>r.includes(e.id));L(n=>{var l;return{...n,sceneId:e,sceneNumber:t.sceneNumber,description:t.title||"Scene ".concat(t.sceneNumber),location:a[0]||(null==s?void 0:s.name)||t.locationName||"",locationId:r[0]||t.locationId||"",pageCount:t.pageCount||"",duration:(null==(l=t.estimatedDuration)?void 0:l.toString())||"",notes:t.continuityNotes||t.specialRequirements||""}}),M(new Set(t.castIds||[])),q(new Set(t.crewIds||[])),Y(new Set(t.equipmentIds||[]))}}else L(e=>({...e,sceneId:"",sceneNumber:"",pageCount:"",duration:"",notes:""}))},ed=e=>{if(F(!1),Z(""),e){let t=D.find(t=>t.id===e);if(t){let r=t.locationIds||[],a=t.locationNames||[],s=j.find(e=>r.includes(e.id));L(n=>{var l;return{...n,shotId:e,description:t.title||"Shot ".concat(t.shotNumber),location:a[0]||(null==s?void 0:s.name)||"",locationId:r[0]||"",duration:(null==(l=t.duration)?void 0:l.toString())||"",notes:t.actionDescription||t.composition||""}});let n=f.find(e=>e.id===C);M(new Set([...t.castIds||[],...(null==n?void 0:n.castIds)||[]])),q(new Set([...t.crewIds||[],...(null==n?void 0:n.crewIds)||[]])),Y(new Set([...t.equipmentIds||[],...(null==n?void 0:n.equipmentIds)||[]])),t.shotReferences&&t.shotReferences.length>0?E(new Set(t.shotReferences.map(e=>e.id).filter(Boolean))):E(new Set)}}else L(e=>({...e,shotId:""})),E(new Set)},ec=f.filter(e=>{var t,r;return(null==(t=e.sceneNumber)?void 0:t.toLowerCase().includes(K.toLowerCase()))||(null==(r=e.title)?void 0:r.toLowerCase().includes(K.toLowerCase()))}),em=D.filter(e=>{var t,r;return(null==(t=e.shotNumber)?void 0:t.toLowerCase().includes(J.toLowerCase()))||(null==(r=e.title)?void 0:r.toLowerCase().includes(J.toLowerCase()))}),eu=g.filter(e=>{var t,r;return(null==(t=e.characterName)?void 0:t.toLowerCase().includes(ee.toLowerCase()))||(null==(r=e.actorName)?void 0:r.toLowerCase().includes(ee.toLowerCase()))}),ex=b.filter(e=>{var t,r,a;return(null==(t=e.name)?void 0:t.toLowerCase().includes(er.toLowerCase()))||(null==(r=e.role)?void 0:r.toLowerCase().includes(er.toLowerCase()))||(null==(a=e.department)?void 0:a.toLowerCase().includes(er.toLowerCase()))}),ep=y.filter(e=>{var t,r;return(null==(t=e.name)?void 0:t.toLowerCase().includes(es.toLowerCase()))||(null==(r=e.category)?void 0:r.toLowerCase().includes(es.toLowerCase()))}),eh=v.filter(e=>{var t,r;return(null==(t=e.name)?void 0:t.toLowerCase().includes(es.toLowerCase()))||(null==(r=e.description)?void 0:r.toLowerCase().includes(es.toLowerCase()))}),eb=w.filter(e=>{var t,r,a;return(null==(t=e.name)?void 0:t.toLowerCase().includes(el.toLowerCase()))||(null==(r=e.category)?void 0:r.toLowerCase().includes(el.toLowerCase()))||(null==(a=e.tags)?void 0:a.some(e=>e.toLowerCase().includes(el.toLowerCase())))}),eg=b.reduce((e,t)=>{let r=t.department||"other";return e[r]||(e[r]=[]),e[r].push(t),e},{}),ey=y.reduce((e,t)=>{let r=t.category||"other";return e[r]||(e[r]=[]),e[r].push(t),e},{}),ev=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=e=>{ev.current&&!ev.current.contains(e.target)&&(U(!1),F(!1),W(!1),H(!1),Q(!1),G(!1))};if(u)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[u]);let ej=e=>{var t,r,a,s;if(e.preventDefault(),!I.description.trim())return void alert("Description is required");let n={projectId:c,shootingDayId:m,type:I.type,description:I.description.trim()};if(I.time&&(n.time=I.time),(null==(t=I.sceneNumber)?void 0:t.trim())&&(n.sceneNumber=I.sceneNumber.trim()),(null==(r=I.pageCount)?void 0:r.trim())&&(n.pageCount=I.pageCount.trim()),(null==(a=I.location)?void 0:a.trim())&&(n.location=I.location.trim()),I.locationId&&(n.locationId=I.locationId),I.duration&&I.duration.trim()){let e=parseInt(I.duration);!isNaN(e)&&e>0&&(n.duration=e)}(null==(s=I.notes)?void 0:s.trim())&&(n.notes=I.notes.trim()),I.sceneId&&(n.sceneId=I.sceneId),I.shotId&&(n.shotId=I.shotId);let l=Array.from(A);l.length>0&&(n.castIds=l);let o=Array.from(P);o.length>0&&(n.crewIds=o);let i=Array.from(B);i.length>0&&(n.equipmentIds=i);let d=Array.from(R);d.length>0&&(n.storyboardIds=d),console.log("Creating event with data:",n),p(n)},ef=e=>{let t=new Set(A);t.has(e)?t.delete(e):t.add(e),M(t)},eN=e=>{let t=new Set(P);t.has(e)?t.delete(e):t.add(e),q(t)},ek=e=>{let t=new Set(B);t.has(e)?t.delete(e):t.add(e),Y(t)};return u?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{ref:ev,className:"bg-background-secondary border border-border-default rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:h?"Edit Schedule Event":"Create Schedule Event"}),(0,a.jsx)("button",{onClick:x,className:"text-text-secondary hover:text-text-primary transition-colors text-2xl font-bold w-8 h-8 flex items-center justify-center",children:"\xd7"})]}),(0,a.jsx)("form",{onSubmit:ej,className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary border-b border-border-default pb-2",children:"Basic Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Event Type *"}),(0,a.jsxs)("select",{value:I.type,onChange:e=>L({...I,type:e.target.value}),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0,children:[(0,a.jsx)("option",{value:"scene",children:"Scene"}),(0,a.jsx)("option",{value:"break",children:"Break"}),(0,a.jsx)("option",{value:"move",children:"Move"}),(0,a.jsx)("option",{value:"prep",children:"Prep"}),(0,a.jsx)("option",{value:"wrap",children:"Wrap"}),(0,a.jsx)("option",{value:"other",children:"Other"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Time"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"time",value:I.time,onChange:e=>L({...I,time:e.target.value}),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary [&::-webkit-calendar-picker-indicator]:invert [&::-webkit-calendar-picker-indicator]:cursor-pointer [&::-webkit-calendar-picker-indicator]:opacity-100"})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Select Scene (Optional)"}),(0,a.jsxs)("button",{type:"button",onClick:()=>{U(!T),F(!1)},className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary text-left flex items-center justify-between",children:[(0,a.jsx)("span",{children:C?"Scene ".concat(null==(t=f.find(e=>e.id===C))?void 0:t.sceneNumber).concat((null==(r=f.find(e=>e.id===C))?void 0:r.title)?" - ".concat(null==(s=f.find(e=>e.id===C))?void 0:s.title):""):"None - Create manually"}),(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),T&&(0,a.jsxs)("div",{className:"absolute z-50 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),children:[(0,a.jsx)("input",{type:"text",placeholder:"Search scenes...",value:K,onChange:e=>X(e.target.value),onClick:e=>e.stopPropagation(),onFocus:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsxs)("div",{className:"overflow-y-auto max-h-48",children:[(0,a.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),ei("")},onMouseDown:e=>e.stopPropagation(),className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:"None - Create manually"}),N?(0,a.jsxs)("div",{className:"px-4 py-2 text-sm text-text-tertiary flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Loading scenes..."]}):0===f.length?(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No scenes available"}):ec.length>0?ec.map(e=>(0,a.jsxs)("button",{type:"button",onClick:t=>{t.stopPropagation(),ei(e.id)},onMouseDown:e=>e.stopPropagation(),className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:["Scene ",e.sceneNumber," ",e.title?"- ".concat(e.title):""]},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})]})]})]}),C&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Select Shot (Optional)"}),(0,a.jsxs)("button",{type:"button",onClick:()=>{F(!z),U(!1)},className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary text-left flex items-center justify-between",children:[(0,a.jsx)("span",{children:I.shotId?"Shot ".concat(null==(n=D.find(e=>e.id===I.shotId))?void 0:n.shotNumber).concat((null==(l=D.find(e=>e.id===I.shotId))?void 0:l.title)?" - ".concat(null==(d=D.find(e=>e.id===I.shotId))?void 0:d.title):""):"None - Use scene data"}),(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),z&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search shots...",value:J,onChange:e=>Z(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsxs)("div",{className:"overflow-y-auto max-h-48",children:[(0,a.jsx)("button",{type:"button",onClick:()=>ed(""),className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:"None - Use scene data"}),em.length>0?em.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>ed(e.id),className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:["Shot ",e.shotNumber," ",e.title?"- ".concat(e.title):""]},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Description *"}),(0,a.jsx)("input",{type:"text",value:I.description,onChange:e=>L({...I,description:e.target.value}),placeholder:"Event description",className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Scene Number"}),(0,a.jsx)("input",{type:"text",value:I.sceneNumber,onChange:e=>L({...I,sceneNumber:e.target.value}),placeholder:"e.g., 1, 2A, 3B",className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Page Count"}),(0,a.jsx)("input",{type:"text",value:I.pageCount,onChange:e=>L({...I,pageCount:e.target.value}),placeholder:"e.g., 1/8, 3 4/8",className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Duration (minutes)"}),(0,a.jsx)("input",{type:"number",value:I.duration,onChange:e=>L({...I,duration:e.target.value}),placeholder:"e.g., 30",min:"0",className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Location"}),(0,a.jsxs)("select",{value:I.locationId,onChange:e=>(e=>{let t=j.find(t=>t.id===e);L({...I,locationId:e||"",location:t?t.name:I.location})})(e.target.value),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[(0,a.jsx)("option",{value:"",children:"Select location or enter manually"}),j.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ",e.address]},e.id))]})]}),!I.locationId&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Location (Manual Entry)"}),(0,a.jsx)("input",{type:"text",value:I.location,onChange:e=>L({...I,location:e.target.value}),placeholder:"Enter location name",className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Notes"}),(0,a.jsx)("textarea",{value:I.notes,onChange:e=>L({...I,notes:e.target.value}),placeholder:"Additional notes or instructions",rows:3,className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary resize-none"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary border-b border-border-default pb-2",children:"Cast"}),A.size>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:Array.from(A).map(e=>{let t=g.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsxs)("span",{className:"text-sm text-text-primary",children:[t.actorName," as ",t.characterName]}),(0,a.jsx)("button",{type:"button",onClick:()=>ef(e),className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e):null})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{W(!O),H(!1),Q(!1)},className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Cast"]}),O&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search cast...",value:ee,onChange:e=>et(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:eu.length>0?eu.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{ef(e.id),et("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm transition-colors ".concat(A.has(e.id)?"bg-background-tertiary":""),children:[(0,a.jsxs)("div",{className:"font-medium text-text-primary",children:[e.actorName," as ",e.characterName]}),(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:e.castType})]},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary border-b border-border-default pb-2",children:"Crew Required"}),P.size>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:Array.from(P).map(e=>{let t=b.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsxs)("span",{className:"text-sm text-text-primary",children:[t.name," - ",t.role]}),(0,a.jsx)("button",{type:"button",onClick:()=>eN(e),className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e):null})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{H(!V),W(!1),Q(!1)},className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Crew"]}),V&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-96 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search crew or departments...",value:er,onChange:e=>ea(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsxs)("div",{className:"overflow-y-auto max-h-80",children:[Object.entries(eg).map(e=>{let[t,r]=e,s=r.length>0&&r.every(e=>P.has(e.id));if(r.some(e=>P.has(e.id)),!(!er||t.toLowerCase().includes(er.toLowerCase())||r.some(e=>e.name.toLowerCase().includes(er.toLowerCase())||e.role.toLowerCase().includes(er.toLowerCase()))))return null;let n=r.filter(e=>!er||ex.includes(e));return(0,a.jsxs)("div",{className:"border-b border-border-subtle",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{if(s){let e=new Set(P);r.forEach(t=>e.delete(t.id)),q(e)}else{let e=b.filter(e=>e.department===t),r=new Set(P);e.forEach(e=>r.add(e.id)),q(r),H(!1),ea("")}},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm font-semibold transition-colors flex items-center justify-between ".concat(s?"bg-accent-primary/10 text-accent-primary":""),children:[(0,a.jsxs)("span",{className:"capitalize",children:[t.replace(/_/g," ")," (",r.length,")"]}),s&&(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]}),n.length>0&&(0,a.jsx)("div",{className:"pl-4",children:n.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{eN(e.id)},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm transition-colors ".concat(P.has(e.id)?"bg-background-tertiary":""),children:[(0,a.jsx)("div",{className:"font-medium text-text-primary",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:e.role})]},e.id))})]},t)}),0===ex.length&&0===Object.keys(eg).length&&(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary border-b border-border-default pb-2",children:"Equipment Needed"}),B.size>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:Array.from(B).map(e=>{let t=y.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsxs)("span",{className:"text-sm text-text-primary",children:[t.name," ",t.quantity>1&&"(x".concat(t.quantity,")")]}),(0,a.jsx)("button",{type:"button",onClick:()=>ek(e),className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e):null})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{Q(!_),W(!1),H(!1)},className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Equipment"]}),_&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-96 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search equipment, packages, or categories...",value:es,onChange:e=>en(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsxs)("div",{className:"overflow-y-auto max-h-80",children:[eh.length>0&&(0,a.jsxs)("div",{className:"border-b border-border-subtle",children:[(0,a.jsx)("div",{className:"px-4 py-2 text-xs font-semibold text-text-secondary uppercase tracking-wider bg-background-tertiary",children:"Packages"}),eh.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>(e=>{let t=v.find(t=>t.id===e);if(t){let e=new Set(B);t.equipmentIds.forEach(t=>e.add(t)),Y(e),Q(!1),en("")}})(e.id),className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm transition-colors",children:[(0,a.jsx)("div",{className:"font-medium text-text-primary",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:e.description}),(0,a.jsxs)("div",{className:"text-xs text-text-tertiary",children:[e.equipmentIds.length," item",1!==e.equipmentIds.length?"s":""]})]},e.id))]}),Object.entries(ey).map(e=>{let[t,r]=e,s=r.filter(e=>!es||ep.includes(e));if(0===s.length)return null;let n=s.every(e=>B.has(e.id));return s.some(e=>B.has(e.id)),(0,a.jsxs)("div",{className:"border-b border-border-subtle",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{let e=new Set(B);n?s.forEach(t=>e.delete(t.id)):s.forEach(t=>e.add(t.id)),Y(e),en("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm font-semibold transition-colors flex items-center justify-between ".concat(n?"bg-accent-primary/10 text-accent-primary":""),children:[(0,a.jsxs)("span",{className:"capitalize",children:[t.replace(/_/g," ")," (",s.length,")"]}),n&&(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]}),(0,a.jsx)("div",{className:"pl-4",children:s.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{ek(e.id),en("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm transition-colors ".concat(B.has(e.id)?"bg-background-tertiary":""),children:[(0,a.jsxs)("div",{className:"font-medium text-text-primary",children:[e.name," ",e.quantity>1&&"(x".concat(e.quantity,")")]}),e.manufacturer&&e.model&&(0,a.jsxs)("div",{className:"text-xs text-text-tertiary",children:[e.manufacturer," ",e.model]})]},e.id))})]},t)}),0===ep.length&&0===eh.length&&(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary border-b border-border-default pb-2",children:"Storyboard References"}),R.size>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:Array.from(R).map(e=>{let t=w.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsx)("img",{src:t.url,alt:t.name,className:"w-8 h-8 object-cover rounded"}),(0,a.jsx)("span",{className:"text-sm text-text-primary",children:t.name}),(0,a.jsx)("button",{type:"button",onClick:()=>{let t=new Set(R);t.delete(e),E(t)},className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e):null})}),(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:I.shotId?"References from selected shot are automatically included. You can add more below.":"Select a shot to automatically include its storyboard references, or add references manually."}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{G(!$),Q(!1),W(!1),H(!1)},className:"btn-secondary flex items-center gap-2 w-full",disabled:0===w.length,children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Storyboard Reference"]}),$&&w.length>0&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search references...",value:el,onChange:e=>eo(e.target.value),onClick:e=>e.stopPropagation(),onFocus:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:eb.length>0?eb.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{let t=new Set(R);t.has(e.id)?t.delete(e.id):t.add(e.id),E(t),eo("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm transition-colors flex items-center gap-3 ".concat(R.has(e.id)?"bg-background-tertiary":""),children:[(0,a.jsx)("img",{src:e.url,alt:e.name,className:"w-10 h-10 object-cover rounded"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-text-primary",children:e.name}),e.category&&(0,a.jsx)("div",{className:"text-xs text-text-tertiary capitalize",children:e.category})]}),R.has(e.id)&&(0,a.jsx)("svg",{className:"w-4 h-4 text-accent-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]}),0===w.length&&(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:"No reference images available. Add them in the Storyboards tab."})]})]})]})}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 p-6 border-t border-border-default",children:[(0,a.jsx)("button",{type:"button",onClick:x,className:"px-4 py-2 bg-background-tertiary text-text-primary rounded-lg hover:bg-background-secondary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",onClick:ej,className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors font-medium",style:{color:"rgb(var(--colored-button-text))"},children:h?"Update Event":"Create Event"})]})]})}):null}let eL={photoshoot:{scenes:{singular:"Look",plural:"Looks",label:"Looks & Sets"},shots:{singular:"Photo",plural:"Photos",label:"Photos"},cast:{label:"Talent"}},film:{scenes:{singular:"Scene",plural:"Scenes",label:"Scenes & Shots"},shots:{singular:"Shot",plural:"Shots",label:"Shots"},cast:{label:"Cast"}},commercial:{scenes:{singular:"Scene",plural:"Scenes",label:"Scenes & Shots"},shots:{singular:"Shot",plural:"Shots",label:"Shots"},cast:{label:"Cast"}},documentary:{scenes:{singular:"Segment",plural:"Segments",label:"Segments & Shots"},shots:{singular:"Shot",plural:"Shots",label:"Shots"},cast:{label:"Talent"}},episodic:{scenes:{singular:"Scene",plural:"Scenes",label:"Scenes & Shots"},shots:{singular:"Shot",plural:"Shots",label:"Shots"},cast:{label:"Cast"}},music_video:{scenes:{singular:"Scene",plural:"Scenes",label:"Scenes & Shots"},shots:{singular:"Shot",plural:"Shots",label:"Shots"},cast:{label:"Talent"}},corporate:{scenes:{singular:"Segment",plural:"Segments",label:"Segments & Shots"},shots:{singular:"Shot",plural:"Shots",label:"Shots"},cast:{label:"Talent"}}},eA={scenes:{singular:"Scene",plural:"Scenes",label:"Scenes & Shots"},shots:{singular:"Shot",plural:"Shots",label:"Shots"},cast:{label:"Cast"}};function eM(e){return e&&eL[e]||eA}function eP(e){let{projectId:t,isOpen:r,onClose:s}=e,n=o.i.useUtils(),{data:l}=o.i.projects.getById.useQuery({id:t}),{data:d=[]}=o.i.scenes.listByProject.useQuery({projectId:t}),c=eM(null==l?void 0:l.projectType),m=o.i.scenes.syncAllToSchedule.useMutation({onSuccess:e=>{alert(e.message),n.schedule.getSchedule.invalidate({projectId:t}),s()},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),u=o.i.scenes.syncToSchedule.useMutation({onSuccess:e=>{alert(e.message),n.schedule.getSchedule.invalidate({projectId:t})},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),x=o.i.shots.syncToSchedule.useMutation({onSuccess:e=>{alert(e.message),n.schedule.getSchedule.invalidate({projectId:t})},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),[p,h]=(0,i.useState)(""),{data:b=[]}=o.i.scenes.getShotsByScene.useQuery({sceneId:p},{enabled:!!p});if(d.find(e=>e.id===p),!r)return null;let g=d.filter(e=>(e.shootingDayIds||(e.shootingDayId?[e.shootingDayId]:[])).length>0);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-background-secondary border border-border-default rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Sync to Schedule"}),(0,a.jsx)("button",{onClick:s,className:"text-text-secondary hover:text-text-primary transition-colors text-2xl font-bold w-8 h-8 flex items-center justify-center",children:"\xd7"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary mb-3",children:["Sync All ",c.scenes.plural]}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary mb-4",children:["Sync all ",c.scenes.plural.toLowerCase()," with shooting days to the schedule. This will add schedule events for all shots within those ",c.scenes.plural.toLowerCase(),"."]}),(0,a.jsx)("button",{onClick:()=>m.mutate({projectId:t}),disabled:m.isPending||0===g.length,className:"btn-primary w-full",children:m.isPending?"Syncing...":"Sync All ".concat(c.scenes.plural," (").concat(g.length,")")})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary mb-3",children:["Sync Individual ",c.scenes.singular]}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary mb-4",children:["Select a ",c.scenes.singular.toLowerCase()," to sync all its shots to the schedule."]}),(0,a.jsxs)("select",{value:p,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary mb-3",children:[(0,a.jsxs)("option",{value:"",children:["Select a ",c.scenes.singular.toLowerCase(),"..."]}),g.map(e=>(0,a.jsxs)("option",{value:e.id,children:[c.scenes.singular," ",e.sceneNumber," ",e.title?"- ".concat(e.title):""]},e.id))]}),p&&(0,a.jsx)("button",{onClick:()=>u.mutate({sceneId:p}),disabled:u.isPending,className:"btn-primary w-full",children:u.isPending?"Syncing...":"Sync ".concat(c.scenes.singular)})]}),p&&b.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary mb-3",children:["Sync Individual ",c.shots.singular]}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary mb-4",children:["Select a ",c.shots.singular.toLowerCase()," to sync it to the schedule."]}),(0,a.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:b.map(e=>{let t=e.shootingDayIds||[],r=t.length>0;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-background-primary rounded-lg border border-border-default",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-text-primary",children:[c.shots.singular," ",e.shotNumber," ",e.title?"- ".concat(e.title):""]}),r?(0,a.jsxs)("div",{className:"text-xs text-text-tertiary mt-1",children:[t.length," shooting day(s)"]}):(0,a.jsxs)("div",{className:"text-xs text-text-tertiary mt-1",children:["Will inherit from ",c.scenes.singular.toLowerCase()]})]}),(0,a.jsx)("button",{onClick:()=>x.mutate({shotId:e.id}),disabled:x.isPending,className:"btn-secondary text-sm",children:x.isPending?"Syncing...":"Sync"})]},e.id)})})]})]})}),(0,a.jsx)("div",{className:"flex justify-end gap-3 p-6 border-t border-border-default",children:(0,a.jsx)("button",{onClick:s,className:"px-4 py-2 bg-background-tertiary text-text-primary rounded-lg hover:bg-background-secondary transition-colors",children:"Close"})})]})})}function eq(e){var t,r;let s,n,{projectId:l,shootingDayId:d,isOpen:c,onClose:m}=e,{data:u,isLoading:x,error:p}=o.i.schedule.getCallSheet.useQuery({shootingDayId:d,projectId:l},{enabled:c&&!!d}),{data:h}=o.i.projects.getById.useQuery({id:l}),{data:b}=o.i.projectMembers.listByProject.useQuery({projectId:l},{enabled:c}),g=(0,i.useMemo)(()=>(null==u?void 0:u.events)?u.events.reduce((e,t)=>{if(t.pageCount){let r=t.pageCount.match(/(\d+)\s*(\d+)?\/(\d+)/);if(r){let t=parseInt(r[1])||0;return e+(t+(parseInt(r[2])||0)/(parseInt(r[3])||8))}}return e},0):0,[null==u?void 0:u.events]),y=(0,i.useMemo)(()=>{if(!(null==u?void 0:u.events))return"";let e=u.events.find(e=>"break"===e.type&&e.description.toLowerCase().includes("breakfast"));return(null==e?void 0:e.time)||""},[null==u?void 0:u.events]),v=(0,i.useMemo)(()=>{if(!(null==u?void 0:u.events))return"";let e=u.events.find(e=>"break"===e.type&&e.description.toLowerCase().includes("lunch"));return(null==e?void 0:e.time)||""},[null==u?void 0:u.events]),j=(0,i.useMemo)(()=>(null==u?void 0:u.shootingDay.directorCrewId)&&(null==u?void 0:u.crew)?u.crew.find(e=>e.id===u.shootingDay.directorCrewId):null,[null==u?void 0:u.shootingDay.directorCrewId,null==u?void 0:u.crew]),f=(0,i.useMemo)(()=>(null==u?void 0:u.shootingDay.executiveProducerCrewId)&&(null==u?void 0:u.crew)?u.crew.find(e=>e.id===u.shootingDay.executiveProducerCrewId):null,[null==u?void 0:u.shootingDay.executiveProducerCrewId,null==u?void 0:u.crew]),N=(0,i.useMemo)(()=>(null==u?void 0:u.shootingDay.productionCoordinatorCrewId)&&(null==u?void 0:u.crew)?u.crew.find(e=>e.id===u.shootingDay.productionCoordinatorCrewId):null,[null==u?void 0:u.shootingDay.productionCoordinatorCrewId,null==u?void 0:u.crew]);(0,i.useMemo)(()=>(null==u?void 0:u.shootingDay.locationId)&&(null==u?void 0:u.locations)?u.locations.find(e=>e.id===u.shootingDay.locationId):null,[null==u?void 0:u.shootingDay.locationId,null==u?void 0:u.locations]);let k=(0,i.useMemo)(()=>(null==u?void 0:u.shootingDay.basecampLocationId)&&(null==u?void 0:u.locations)?u.locations.find(e=>e.id===u.shootingDay.basecampLocationId):null,[null==u?void 0:u.shootingDay.basecampLocationId,null==u?void 0:u.locations]),w=(0,i.useMemo)(()=>(null==u?void 0:u.shootingDay.crewParkLocationId)&&(null==u?void 0:u.locations)?u.locations.find(e=>e.id===u.shootingDay.crewParkLocationId):null,[null==u?void 0:u.shootingDay.crewParkLocationId,null==u?void 0:u.locations]),C=(0,i.useMemo)(()=>(null==u?void 0:u.shootingDay.techTrucksLocationId)&&(null==u?void 0:u.locations)?u.locations.find(e=>e.id===u.shootingDay.techTrucksLocationId):null,[null==u?void 0:u.shootingDay.techTrucksLocationId,null==u?void 0:u.locations]),S=(0,i.useMemo)(()=>(null==u?void 0:u.shootingDay.bgHoldingLocationId)&&(null==u?void 0:u.locations)?u.locations.find(e=>e.id===u.shootingDay.bgHoldingLocationId):null,[null==u?void 0:u.shootingDay.bgHoldingLocationId,null==u?void 0:u.locations]),D=(0,i.useMemo)(()=>(null==u?void 0:u.shootingDay.bgParkingLocationId)&&(null==u?void 0:u.locations)?u.locations.find(e=>e.id===u.shootingDay.bgParkingLocationId):null,[null==u?void 0:u.shootingDay.bgParkingLocationId,null==u?void 0:u.locations]),I=(0,i.useMemo)(()=>(null==u?void 0:u.cast)?u.cast.map(e=>{let t=u.events.filter(t=>{var r;return null==(r=t.castIds)?void 0:r.includes(e.id)}).filter(e=>e.time).sort((e,t)=>(e.time||"").localeCompare(t.time||""))[0];return{...e,callTime:(null==t?void 0:t.time)||u.shootingDay.callTime}}):[],[null==u?void 0:u.cast,null==u?void 0:u.events,null==u?void 0:u.shootingDay]),L=(0,i.useMemo)(()=>{if(!(null==u?void 0:u.crew))return{};let e={};return u.crew.forEach(t=>{let r=t.department||"other";e[r]||(e[r]=[]);let a=u.events.filter(e=>{var r;return null==(r=e.crewIds)?void 0:r.includes(t.id)}).filter(e=>e.time).sort((e,t)=>(e.time||"").localeCompare(t.time||""))[0];e[r].push({...t,callTime:(null==a?void 0:a.time)||u.shootingDay.callTime})}),e},[null==u?void 0:u.crew,null==u?void 0:u.events,null==u?void 0:u.shootingDay]);if((0,i.useMemo)(()=>(b&&b.forEach(e=>{}),{}),[b]),!c)return null;let A=e=>{if(!e)return"";let[t,r]=e.split(":"),a=parseInt(t);return"".concat(a%12||12,":").concat(r," ").concat(a>=12?"PM":"AM")};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto print:bg-white print:p-0",children:(0,a.jsxs)("div",{className:"bg-white border border-gray-300 rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col my-8 print:max-w-full print:max-h-full print:my-0 print:rounded-none print:border-none print:bg-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-300 bg-gray-50 print:hidden",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"CALL SHEET"}),u&&(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[isNaN((s=(t=u.shootingDay.date)instanceof Date?t:"string"==typeof t?new Date(t):(null==t?void 0:t.toDate)?t.toDate():new Date(t)).getTime())?"Invalid Date":s.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),u.shootingDay.dayNumber&&" • Day ".concat(u.shootingDay.dayNumber)]})]}),(0,a.jsx)("button",{onClick:m,className:"text-gray-600 hover:text-gray-900 transition-colors text-2xl font-bold w-8 h-8 flex items-center justify-center",children:"\xd7"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-8 print:p-6 bg-white",children:x?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):p?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-red-600 mb-2",children:"Error loading call sheet"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:p.message||"Unknown error occurred"})]}):u?(0,a.jsxs)("div",{className:"space-y-6 print:space-y-4",children:[(0,a.jsxs)("div",{className:"text-center mb-6 print:mb-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-black mb-2 print:text-2xl",children:(null==h?void 0:h.title)||"CALL SHEET"}),u.shootingDay.dayNumber&&(0,a.jsxs)("p",{className:"text-lg text-gray-700 print:text-base",children:["Day ",u.shootingDay.dayNumber," of ",u.shootingDay.totalDays||"?"]})]}),(0,a.jsx)("table",{className:"w-full border-collapse border border-black mb-6 print:mb-4",children:(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100 w-1/4",children:"Shoot Date"}),(0,a.jsx)("td",{className:"border border-black p-2",children:isNaN((n=(r=u.shootingDay.date)instanceof Date?r:"string"==typeof r?new Date(r):(null==r?void 0:r.toDate)?r.toDate():new Date(r)).getTime())?"":n.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"})}),(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100 w-1/4",children:"Crew Call"}),(0,a.jsx)("td",{className:"border border-black p-2",children:u.shootingDay.callTime?A(u.shootingDay.callTime):""})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100",children:"Shoot Call"}),(0,a.jsx)("td",{className:"border border-black p-2",children:u.shootingDay.shootCall?A(u.shootingDay.shootCall):u.shootingDay.callTime?A(u.shootingDay.callTime):""}),(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100",children:"Breakfast"}),(0,a.jsx)("td",{className:"border border-black p-2",children:y?A(y):""})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100",children:"Lunch"}),(0,a.jsx)("td",{className:"border border-black p-2",children:v?A(v):""}),(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100",children:"Total Pages"}),(0,a.jsx)("td",{className:"border border-black p-2",children:g.toFixed(1)})]})]})}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-black mb-6 print:mb-4",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"border border-black p-2 text-left font-semibold",children:"Role"}),(0,a.jsx)("th",{className:"border border-black p-2 text-left font-semibold",children:"Name"}),(0,a.jsx)("th",{className:"border border-black p-2 text-left font-semibold",children:"Phone"})]})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-2",children:"Director"}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==j?void 0:j.name)||""}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==j?void 0:j.phone)||""})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-2",children:"Executive Producer"}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==f?void 0:f.name)||""}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==f?void 0:f.phone)||""})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-2",children:"Production Coordinator"}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==N?void 0:N.name)||""}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==N?void 0:N.phone)||""})]})]})]}),(0,a.jsx)("table",{className:"w-full border-collapse border border-black mb-6 print:mb-4",children:(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100 w-1/4",children:"Basecamp"}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==k?void 0:k.name)||""}),(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100 w-1/4",children:"Crew Park"}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==w?void 0:w.name)||""})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100",children:"Tech Trucks"}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==C?void 0:C.name)||""}),(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100",children:"BG Holding"}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==S?void 0:S.name)||""})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100",children:"BG Parking"}),(0,a.jsx)("td",{className:"border border-black p-2",children:(null==D?void 0:D.name)||""}),(0,a.jsx)("td",{className:"border border-black p-2 font-semibold bg-gray-100",children:"Nearest Hospital"}),(0,a.jsx)("td",{className:"border border-black p-2",children:u.shootingDay.nearestHospital||""})]})]})}),u.shootingDay.notes&&(0,a.jsxs)("div",{className:"mb-6 print:mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold uppercase mb-2",children:"Important Notes:"}),(0,a.jsx)("div",{className:"border border-black p-3 bg-gray-50",children:(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:u.shootingDay.notes})})]}),u.events.length>0&&(0,a.jsxs)("div",{className:"mb-6 print:mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold uppercase mb-2",children:"Shooting Schedule"}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-black text-xs",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Sc."}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"IIE"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Setting/Description"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"DIN"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Pages"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"8ths"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Duration"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Cast"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Location"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"DD"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Unit"})]})}),(0,a.jsxs)("tbody",{children:[u.events.map((e,t)=>{let r=u.scenes.find(t=>t.id===e.sceneId);u.shots.find(t=>t.id===e.shotId);let s=u.cast.filter(t=>{var r;return null==(r=e.castIds)?void 0:r.includes(t.id)}),n=e.locationId||(null==r?void 0:r.locationId),l=n?u.locations.find(e=>e.id===n):null,o=e.pageCount||(null==r?void 0:r.pageCount)||"",i=e.description||(null==r?void 0:r.title)||(null==r?void 0:r.description)||"",d=e.duration?"".concat(e.duration):"";return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-1",children:(null==r?void 0:r.sceneNumber)||e.sceneNumber||""}),(0,a.jsx)("td",{className:"border border-black p-1"}),(0,a.jsx)("td",{className:"border border-black p-1",children:i}),(0,a.jsx)("td",{className:"border border-black p-1"}),(0,a.jsx)("td",{className:"border border-black p-1",children:o}),(0,a.jsx)("td",{className:"border border-black p-1",children:(e=>{if(!e)return"";let t=e.match(/(\d+)\s*(\d+)?\/(\d+)/);if(t){let e=parseInt(t[1])||0,r=parseInt(t[2])||0;return(8*e+8*r/(parseInt(t[3])||8)).toFixed(0)}return""})(o)}),(0,a.jsx)("td",{className:"border border-black p-1",children:d}),(0,a.jsx)("td",{className:"border border-black p-1",children:s.map(e=>e.characterName||e.name).filter(Boolean).join(", ")}),(0,a.jsx)("td",{className:"border border-black p-1",children:(null==l?void 0:l.name)||e.location||(null==r?void 0:r.locationName)||""}),(0,a.jsx)("td",{className:"border border-black p-1"}),(0,a.jsx)("td",{className:"border border-black p-1"})]},e.id)}),(0,a.jsx)("tr",{children:(0,a.jsxs)("td",{colSpan:11,className:"border border-black p-1 font-semibold bg-gray-100",children:["End of Day #",u.shootingDay.dayNumber||""]})})]})]})]}),I.length>0&&(0,a.jsxs)("div",{className:"mb-6 print:mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold uppercase mb-2",children:"Cast"}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-black text-xs",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"#"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Character"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Artist"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"SWF"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"PU"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"H/M/W"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Block"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Set Call"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Special Instructions, Misc."})]})}),(0,a.jsx)("tbody",{children:I.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-1",children:t+1}),(0,a.jsx)("td",{className:"border border-black p-1 font-semibold",children:e.characterName||""}),(0,a.jsx)("td",{className:"border border-black p-1",children:e.actorName||e.name||""}),(0,a.jsx)("td",{className:"border border-black p-1"}),(0,a.jsx)("td",{className:"border border-black p-1"}),(0,a.jsx)("td",{className:"border border-black p-1"}),(0,a.jsx)("td",{className:"border border-black p-1"}),(0,a.jsx)("td",{className:"border border-black p-1",children:e.callTime?A(e.callTime):""}),(0,a.jsx)("td",{className:"border border-black p-1",children:e.notes||""})]},e.id))})]})]}),(0,a.jsxs)("div",{className:"mb-6 print:mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold uppercase mb-2",children:"Transport Notes"}),(0,a.jsx)("div",{className:"border border-black p-3 bg-gray-50 min-h-[60px]",children:(0,a.jsx)("p",{className:"text-sm"})})]}),(0,a.jsxs)("div",{className:"mb-6 print:mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold uppercase mb-2",children:"Departmental Notes"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-4",children:Object.entries(L).map(e=>{let[t,r]=e;return(0,a.jsxs)("div",{className:"border border-black p-2",children:[(0,a.jsx)("div",{className:"font-semibold text-xs mb-1 uppercase",children:t.replace(/_/g," ")}),(0,a.jsx)("div",{className:"text-xs space-y-1",children:r.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:e.name}),e.role&&(0,a.jsxs)("span",{className:"text-gray-600",children:[" - ",e.role]}),e.callTime&&e.callTime!==u.shootingDay.callTime&&(0,a.jsxs)("span",{className:"text-gray-600",children:[" (",A(e.callTime),")"]})]},e.id))})]},t)})})]}),Object.keys(L).length>0&&(0,a.jsxs)("div",{className:"mb-6 print:mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold uppercase mb-2",children:"Crew"}),(0,a.jsx)("div",{className:"space-y-4",children:Object.entries(L).map(e=>{let[t,r]=e,s=[...r].sort((e,t)=>e.name.localeCompare(t.name));return(0,a.jsxs)("div",{className:"border border-black",children:[(0,a.jsx)("div",{className:"bg-gray-100 border-b border-black p-2 font-semibold text-sm uppercase",children:t.replace(/_/g," ")}),(0,a.jsxs)("table",{className:"w-full border-collapse text-xs",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Name"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Role"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Call Time"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Phone"})]})}),(0,a.jsx)("tbody",{children:s.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-1",children:e.name}),(0,a.jsx)("td",{className:"border border-black p-1",children:e.role||""}),(0,a.jsx)("td",{className:"border border-black p-1",children:e.callTime?A(e.callTime):""}),(0,a.jsx)("td",{className:"border border-black p-1",children:e.phone||""})]},e.id))})]})]},t)})})]}),(()=>{let e=u.crew.find(e=>{var t;return"1st AD"===e.role||(null==(t=e.role)?void 0:t.includes("1st AD"))}),t=u.crew.find(e=>{var t;return"2nd AD"===e.role||(null==(t=e.role)?void 0:t.includes("2nd AD"))}),r=u.crew.find(e=>{var t;return"Director of Photography"===e.role||"DOP"===e.role||(null==(t=e.role)?void 0:t.includes("Director of Photography"))}),s=u.crew.find(e=>{var t,r;return"Transport Captain"===e.role||"Transportation Coordinator"===e.role||(null==(t=e.role)?void 0:t.includes("Transport Captain"))||(null==(r=e.role)?void 0:r.includes("Transportation Coordinator"))}),n=(e,t)=>e||t?"".concat(e||"").concat(e&&t?"\n":"").concat(t||""):"";return(0,a.jsx)("div",{className:"mt-6 print:mt-4",children:(0,a.jsxs)("table",{className:"w-full border-collapse border border-black text-xs",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Director"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"1st AD"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"DOP"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"2nd AD"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Transport Captain"}),(0,a.jsx)("th",{className:"border border-black p-1 text-left font-semibold",children:"Production Coordinator"})]})}),(0,a.jsx)("tbody",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-black p-1 whitespace-pre-line",children:n(null==j?void 0:j.name,null==j?void 0:j.phone)}),(0,a.jsx)("td",{className:"border border-black p-1 whitespace-pre-line",children:n(null==e?void 0:e.name,null==e?void 0:e.phone)}),(0,a.jsx)("td",{className:"border border-black p-1 whitespace-pre-line",children:n(null==r?void 0:r.name,null==r?void 0:r.phone)}),(0,a.jsx)("td",{className:"border border-black p-1 whitespace-pre-line",children:n(null==t?void 0:t.name,null==t?void 0:t.phone)}),(0,a.jsx)("td",{className:"border border-black p-1 whitespace-pre-line",children:n(null==s?void 0:s.name,null==s?void 0:s.phone)}),(0,a.jsx)("td",{className:"border border-black p-1 whitespace-pre-line",children:n(null==N?void 0:N.name,null==N?void 0:N.phone)})]})})]})})})()]}):u?null:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"Unable to load call sheet data"}),p&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-2",children:p.message})]})}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-300 bg-gray-50 print:hidden",children:[(0,a.jsx)("button",{onClick:m,className:"px-4 py-2 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition-colors",children:"Close"}),(0,a.jsx)("button",{onClick:()=>window.print(),className:"px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors font-medium",style:{color:"rgb(var(--colored-button-text))"},children:"Print"})]})]})})}function eB(e){let{shootingDay:t,projectId:r,isOpen:s,onClose:n,onSave:l}=e,{data:d=[]}=o.i.locations.listByProject.useQuery({projectId:r}),{data:c=[]}=o.i.crew.listByProject.useQuery({projectId:r}),[m,u]=(0,i.useState)({dayNumber:"",totalDays:"",callTime:"",shootCall:"",locationId:"",basecampLocationId:"",crewParkLocationId:"",techTrucksLocationId:"",bgHoldingLocationId:"",bgParkingLocationId:"",nearestHospital:"",directorCrewId:"",executiveProducerCrewId:"",productionCoordinatorCrewId:"",notes:""}),[x,p]=(0,i.useState)(!1),[h,b]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!1),[v,j]=(0,i.useState)(!1),[f,N]=(0,i.useState)(!1),[k,w]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1),[D,I]=(0,i.useState)(!1),[L,A]=(0,i.useState)(!1),[M,P]=(0,i.useState)(""),[q,B]=(0,i.useState)(""),[Y,R]=(0,i.useState)(""),[E,T]=(0,i.useState)(""),[U,z]=(0,i.useState)(""),[F,O]=(0,i.useState)(""),[W,V]=(0,i.useState)(""),[H,_]=(0,i.useState)(""),[Q,$]=(0,i.useState)(""),G=(0,i.useRef)(null);if((0,i.useEffect)(()=>{if(t&&s){var e,r;u({dayNumber:(null==(e=t.dayNumber)?void 0:e.toString())||"",totalDays:(null==(r=t.totalDays)?void 0:r.toString())||"",callTime:t.callTime||"",shootCall:t.shootCall||"",locationId:t.locationId||"",basecampLocationId:t.basecampLocationId||"",crewParkLocationId:t.crewParkLocationId||"",techTrucksLocationId:t.techTrucksLocationId||"",bgHoldingLocationId:t.bgHoldingLocationId||"",bgParkingLocationId:t.bgParkingLocationId||"",nearestHospital:t.nearestHospital||"",directorCrewId:t.directorCrewId||"",executiveProducerCrewId:t.executiveProducerCrewId||"",productionCoordinatorCrewId:t.productionCoordinatorCrewId||"",notes:t.notes||""})}},[t,s]),(0,i.useEffect)(()=>{let e=e=>{G.current&&!G.current.contains(e.target)&&(p(!1),b(!1),y(!1),j(!1),N(!1),w(!1),S(!1),I(!1),A(!1))};if(s)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[s]),!s||!t)return null;let K=d.filter(e=>{var t;return e.name.toLowerCase().includes(M.toLowerCase())||(null==(t=e.address)?void 0:t.toLowerCase().includes(M.toLowerCase()))}),X=d.filter(e=>{var t;return e.name.toLowerCase().includes(q.toLowerCase())||(null==(t=e.address)?void 0:t.toLowerCase().includes(q.toLowerCase()))}),J=d.filter(e=>{var t;return e.name.toLowerCase().includes(Y.toLowerCase())||(null==(t=e.address)?void 0:t.toLowerCase().includes(Y.toLowerCase()))}),Z=d.filter(e=>{var t;return e.name.toLowerCase().includes(E.toLowerCase())||(null==(t=e.address)?void 0:t.toLowerCase().includes(E.toLowerCase()))}),ee=d.filter(e=>{var t;return e.name.toLowerCase().includes(U.toLowerCase())||(null==(t=e.address)?void 0:t.toLowerCase().includes(U.toLowerCase()))}),et=d.filter(e=>{var t;return e.name.toLowerCase().includes(F.toLowerCase())||(null==(t=e.address)?void 0:t.toLowerCase().includes(F.toLowerCase()))}),er=c.filter(e=>{var t;return"Director"===e.role||(null==(t=e.role)?void 0:t.includes("Director"))}).filter(e=>e.name.toLowerCase().includes(W.toLowerCase())),ea=c.filter(e=>{var t;return"Executive Producer"===e.role||(null==(t=e.role)?void 0:t.includes("Executive Producer"))}).filter(e=>e.name.toLowerCase().includes(H.toLowerCase())),es=c.filter(e=>{var t;return"Production Coordinator"===e.role||(null==(t=e.role)?void 0:t.includes("Production Coordinator"))}).filter(e=>e.name.toLowerCase().includes(Q.toLowerCase())),en=e=>{var t;return(null==(t=d.find(t=>t.id===e))?void 0:t.name)||""},el=e=>{var t;return(null==(t=c.find(t=>t.id===e))?void 0:t.name)||""},eo=e=>{e.preventDefault(),l({dayNumber:m.dayNumber?parseInt(m.dayNumber):void 0,totalDays:m.totalDays?parseInt(m.totalDays):void 0,callTime:m.callTime||void 0,shootCall:m.shootCall||void 0,locationId:m.locationId||void 0,basecampLocationId:m.basecampLocationId||void 0,crewParkLocationId:m.crewParkLocationId||void 0,techTrucksLocationId:m.techTrucksLocationId||void 0,bgHoldingLocationId:m.bgHoldingLocationId||void 0,bgParkingLocationId:m.bgParkingLocationId||void 0,nearestHospital:m.nearestHospital||void 0,directorCrewId:m.directorCrewId||void 0,executiveProducerCrewId:m.executiveProducerCrewId||void 0,productionCoordinatorCrewId:m.productionCoordinatorCrewId||void 0,notes:m.notes||void 0}),n()};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:(0,a.jsxs)("div",{ref:G,className:"bg-background-secondary border border-border-default rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col my-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default bg-background-primary",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Edit Shooting Day"}),(0,a.jsx)("button",{onClick:n,className:"text-text-secondary hover:text-text-primary transition-colors text-2xl font-bold w-8 h-8 flex items-center justify-center",children:"\xd7"})]}),(0,a.jsx)("form",{onSubmit:eo,className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Basic Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Day Number"}),(0,a.jsx)("input",{type:"number",value:m.dayNumber,onChange:e=>u({...m,dayNumber:e.target.value}),className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",min:"1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:'Total Days (for "Day X of Y")'}),(0,a.jsx)("input",{type:"number",value:m.totalDays,onChange:e=>u({...m,totalDays:e.target.value}),className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",min:"1"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Call Times"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Crew Call (HH:MM)"}),(0,a.jsx)("input",{type:"time",value:m.callTime,onChange:e=>u({...m,callTime:e.target.value}),className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Shoot Call (HH:MM)"}),(0,a.jsx)("input",{type:"time",value:m.shootCall,onChange:e=>u({...m,shootCall:e.target.value}),className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary"})]})]}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-2",children:'Note: Breakfast and lunch times are pulled from events with type "break"'})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Location Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Primary Location"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:m.locationId?en(m.locationId):"",onFocus:()=>p(!0),onChange:e=>{P(e.target.value),p(!0)},className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Select location"}),x&&(0,a.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-background-primary border border-border-default rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[(0,a.jsx)("input",{type:"text",value:M,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary",placeholder:"Search locations...",autoFocus:!0}),K.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{u({...m,locationId:e.id}),p(!1),P("")},className:"w-full text-left px-3 py-2 hover:bg-background-secondary text-text-primary",children:e.name},e.id)),0===K.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-text-tertiary text-sm",children:"No locations found"})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Basecamp"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:m.basecampLocationId?en(m.basecampLocationId):"",onFocus:()=>b(!0),onChange:e=>{B(e.target.value),b(!0)},className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Select location"}),h&&(0,a.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-background-primary border border-border-default rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[(0,a.jsx)("input",{type:"text",value:q,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary",placeholder:"Search locations...",autoFocus:!0}),X.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{u({...m,basecampLocationId:e.id}),b(!1),B("")},className:"w-full text-left px-3 py-2 hover:bg-background-secondary text-text-primary",children:e.name},e.id)),0===X.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-text-tertiary text-sm",children:"No locations found"})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Crew Park"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:m.crewParkLocationId?en(m.crewParkLocationId):"",onFocus:()=>y(!0),onChange:e=>{R(e.target.value),y(!0)},className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Select location"}),g&&(0,a.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-background-primary border border-border-default rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[(0,a.jsx)("input",{type:"text",value:Y,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary",placeholder:"Search locations...",autoFocus:!0}),J.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{u({...m,crewParkLocationId:e.id}),y(!1),R("")},className:"w-full text-left px-3 py-2 hover:bg-background-secondary text-text-primary",children:e.name},e.id)),0===J.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-text-tertiary text-sm",children:"No locations found"})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Tech Trucks"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:m.techTrucksLocationId?en(m.techTrucksLocationId):"",onFocus:()=>j(!0),onChange:e=>{T(e.target.value),j(!0)},className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Select location"}),v&&(0,a.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-background-primary border border-border-default rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[(0,a.jsx)("input",{type:"text",value:E,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary",placeholder:"Search locations...",autoFocus:!0}),Z.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{u({...m,techTrucksLocationId:e.id}),j(!1),T("")},className:"w-full text-left px-3 py-2 hover:bg-background-secondary text-text-primary",children:e.name},e.id)),0===Z.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-text-tertiary text-sm",children:"No locations found"})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"BG Holding"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:m.bgHoldingLocationId?en(m.bgHoldingLocationId):"",onFocus:()=>N(!0),onChange:e=>{z(e.target.value),N(!0)},className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Select location"}),f&&(0,a.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-background-primary border border-border-default rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[(0,a.jsx)("input",{type:"text",value:U,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary",placeholder:"Search locations...",autoFocus:!0}),ee.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{u({...m,bgHoldingLocationId:e.id}),N(!1),z("")},className:"w-full text-left px-3 py-2 hover:bg-background-secondary text-text-primary",children:e.name},e.id)),0===ee.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-text-tertiary text-sm",children:"No locations found"})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"BG Parking"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:m.bgParkingLocationId?en(m.bgParkingLocationId):"",onFocus:()=>w(!0),onChange:e=>{O(e.target.value),w(!0)},className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Select location"}),k&&(0,a.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-background-primary border border-border-default rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[(0,a.jsx)("input",{type:"text",value:F,onChange:e=>O(e.target.value),className:"w-full px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary",placeholder:"Search locations...",autoFocus:!0}),et.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{u({...m,bgParkingLocationId:e.id}),w(!1),O("")},className:"w-full text-left px-3 py-2 hover:bg-background-secondary text-text-primary",children:e.name},e.id)),0===et.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-text-tertiary text-sm",children:"No locations found"})]})]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Nearest Hospital"}),(0,a.jsx)("input",{type:"text",value:m.nearestHospital,onChange:e=>u({...m,nearestHospital:e.target.value}),className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Nearest hospital name and address"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Key Contacts"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Director"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:m.directorCrewId?el(m.directorCrewId):"",onFocus:()=>S(!0),onChange:e=>{V(e.target.value),S(!0)},className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Select director from crew"}),C&&(0,a.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-background-primary border border-border-default rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[(0,a.jsx)("input",{type:"text",value:W,onChange:e=>V(e.target.value),className:"w-full px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary",placeholder:"Search directors...",autoFocus:!0}),er.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{u({...m,directorCrewId:e.id}),S(!1),V("")},className:"w-full text-left px-3 py-2 hover:bg-background-secondary text-text-primary",children:[e.name," ",e.role&&"- ".concat(e.role)]},e.id)),0===er.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-text-tertiary text-sm",children:"No directors found"})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Executive Producer"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:m.executiveProducerCrewId?el(m.executiveProducerCrewId):"",onFocus:()=>I(!0),onChange:e=>{_(e.target.value),I(!0)},className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Select executive producer from crew"}),D&&(0,a.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-background-primary border border-border-default rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[(0,a.jsx)("input",{type:"text",value:H,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary",placeholder:"Search executive producers...",autoFocus:!0}),ea.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{u({...m,executiveProducerCrewId:e.id}),I(!1),_("")},className:"w-full text-left px-3 py-2 hover:bg-background-secondary text-text-primary",children:[e.name," ",e.role&&"- ".concat(e.role)]},e.id)),0===ea.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-text-tertiary text-sm",children:"No executive producers found"})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Production Coordinator"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:m.productionCoordinatorCrewId?el(m.productionCoordinatorCrewId):"",onFocus:()=>A(!0),onChange:e=>{$(e.target.value),A(!0)},className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary",placeholder:"Select production coordinator from crew"}),L&&(0,a.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-background-primary border border-border-default rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[(0,a.jsx)("input",{type:"text",value:Q,onChange:e=>$(e.target.value),className:"w-full px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary",placeholder:"Search production coordinators...",autoFocus:!0}),es.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{u({...m,productionCoordinatorCrewId:e.id}),A(!1),$("")},className:"w-full text-left px-3 py-2 hover:bg-background-secondary text-text-primary",children:[e.name," ",e.role&&"- ".concat(e.role)]},e.id)),0===es.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-text-tertiary text-sm",children:"No production coordinators found"})]})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Notes"}),(0,a.jsx)("textarea",{value:m.notes,onChange:e=>u({...m,notes:e.target.value}),className:"w-full px-3 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary min-h-[100px]",placeholder:"Important notes for this shooting day..."})]})]})}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 p-6 border-t border-border-default bg-background-primary",children:[(0,a.jsx)("button",{onClick:n,className:"px-4 py-2 bg-background-tertiary text-text-primary rounded-lg hover:bg-background-secondary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:eo,className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors font-medium",style:{color:"rgb(var(--colored-button-text))"},children:"Save Changes"})]})]})})}function eY(e){let{projectId:t}=e,{schedule:r,isLoading:s,error:n,createDay:l,updateDay:o,deleteDay:d,createEvent:c,updateEvent:m,deleteEvent:u}=eD(t),{data:x}=(0,eN.aN)(t),p="owner"===x||"admin"===x,[h,b]=(0,i.useState)(null),[g,y]=(0,i.useState)(new Date),[v,j]=(0,i.useState)(!1),[f,N]=(0,i.useState)(!1),[k,w]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if((null==r?void 0:r.days.length)&&!h){let e=setTimeout(()=>{b(r.days[0].id)},0);return()=>clearTimeout(e)}},[r,h]);let D=async e=>{let a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0);b((await l.mutateAsync({projectId:t,date:a,dayNumber:((null==r?void 0:r.days.length)||0)+1})).id)};if(s)return(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary"})});if(n)return(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"⚠️"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"Error Loading Schedule"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:n.message})]})});let I=null==r?void 0:r.days.find(e=>e.id===h),L=(null==r?void 0:r.events.filter(e=>e.shootingDayId===h))||[],A=e=>{if(!(null==r?void 0:r.days))return null;let t=e.getFullYear(),a=e.getMonth(),s=e.getDate();return r.days.find(e=>{let r=e.date instanceof Date?e.date:new Date(e.date);return r.getFullYear()===t&&r.getMonth()===a&&r.getDate()===s})},M=async e=>{let t=A(e);t?b(t.id):p&&await D(e)},P=e=>{y(t=>{let r=new Date(t);return"prev"===e?r.setMonth(t.getMonth()-1):r.setMonth(t.getMonth()+1),r})},q=(e=>{let t=e.getFullYear(),r=e.getMonth(),a=new Date(t,r,1),s=new Date(t,r+1,0).getDate(),n=a.getDay(),l=[];for(let e=0;e<n;e++)l.push(null);for(let e=1;e<=s;e++)l.push(new Date(t,r,e));return l})(g),B=g.toLocaleDateString(void 0,{month:"long",year:"numeric"}),Y=new Date,R=Y.getFullYear(),E=Y.getMonth(),T=Y.getDate();return(0,a.jsxs)("div",{className:"space-y-6",children:[p&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:()=>N(!0),className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Sync to Schedule"]})}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default p-5 max-w-[103%]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Calendar"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>P("prev"),className:"px-3 py-1 hover:bg-accent-primary/5 transition-colors text-sm",children:"←"}),(0,a.jsx)("span",{className:"text-sm font-medium min-w-[180px] text-center",children:B}),(0,a.jsx)("button",{onClick:()=>P("next"),className:"px-3 py-1 hover:bg-accent-primary/5 transition-colors text-sm",children:"→"}),(0,a.jsx)("button",{onClick:()=>y(new Date),className:"px-2 py-1 text-xs hover:bg-accent-primary/5 transition-colors text-text-secondary",children:"Today"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,a.jsx)("div",{className:"text-center text-xs font-semibold text-text-secondary py-2",children:e},e)),q.map((e,t)=>{if(!e)return(0,a.jsx)("div",{className:"aspect-square"},"empty-".concat(t));let s=A(e),n=e.getFullYear()===R&&e.getMonth()===E&&e.getDate()===T,l=e<Y&&!n,o="".concat(e.getFullYear(),"-").concat(e.getMonth(),"-").concat(e.getDate());return(0,a.jsx)("button",{onClick:()=>M(e),disabled:l&&!s&&!p,className:"\n                  aspect-square text-xs transition-all relative\n                  ".concat(s?"bg-accent-primary/20 text-accent-primary border-2 border-accent-primary font-semibold hover:bg-accent-primary/30":l&&!p?"text-text-tertiary cursor-not-allowed":p&&!l?"hover:bg-accent-primary/5 text-text-secondary hover:text-text-primary border-2 border-dashed border-border-default hover:border-accent-primary":"text-text-secondary border-2 border-transparent","\n                  ").concat(n&&!s?"ring-2 ring-gray-600":"","\n                  ").concat(I&&(null==s?void 0:s.id)===h?"ring-2 ring-accent-primary ring-offset-2 ring-offset-background-secondary":"","\n                "),title:s?"Day ".concat((null==r?void 0:r.days.indexOf(s))+1):p&&!l?"Click to add shooting day":"",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-1",children:[(0,a.jsx)("span",{className:"font-medium",children:e.getDate()}),s?(0,a.jsxs)("span",{className:"text-[8px] mt-0.5 font-semibold",children:["Day ",(null==r?void 0:r.days.indexOf(s))+1]}):p&&!l?(0,a.jsx)("span",{className:"text-[8px] mt-0.5 text-accent-primary font-medium",children:"Add Day"}):null]})},o)})]})]})}),(0,a.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Shooting Days"}),(0,a.jsxs)("div",{className:"flex overflow-x-auto pb-2 gap-2 border-b border-gray-800 scrollbar-thin",children:[null==r?void 0:r.days.map((e,t)=>(0,a.jsxs)("button",{onClick:()=>b(e.id),className:"flex-shrink-0 px-4 py-2 rounded-t-lg font-medium text-sm transition-colors ".concat(h===e.id?"bg-background-primary text-accent-primary border-t border-x border-border-default relative top-[1px]":"text-text-secondary hover:text-text-primary hover:bg-white/5"),children:["Day ",t+1,(0,a.jsx)("span",{className:"ml-2 text-xs opacity-70",children:e.date.toLocaleDateString(void 0,{month:"short",day:"numeric"})})]},e.id)),(null==r?void 0:r.days.length)===0&&(0,a.jsx)("div",{className:"text-sm text-text-secondary py-2 italic",children:"No shooting days scheduled. Click a date on the calendar above to add one."})]})]}),I?(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default min-h-[400px]",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-border-default flex justify-between items-center bg-background-primary",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-bold text-lg",children:["Day ",(null==r?void 0:r.days.indexOf(I))+1," - ",I.date.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})]}),I.notes&&(0,a.jsx)("p",{className:"text-sm text-text-secondary mt-1",children:I.notes})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors font-medium flex items-center gap-2",style:{color:"rgb(var(--colored-button-text))"},children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"View Call Sheet"]}),p&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>S(!0),className:"px-3 py-2 bg-background-tertiary text-text-primary hover:bg-background-secondary rounded-lg text-sm transition-colors",children:"Edit Day"}),(0,a.jsx)("button",{onClick:()=>{confirm("Delete this day and all its events?")&&(d.mutate({id:I.id}),b(null))},className:"px-3 py-2 text-red-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg text-sm transition-colors",children:"Delete Day"})]})]})]}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-text-secondary border-b border-gray-800",children:[(0,a.jsx)("th",{className:"pb-2 font-medium w-20",children:"Time"}),(0,a.jsx)("th",{className:"pb-2 font-medium w-20",children:"Scene"}),(0,a.jsx)("th",{className:"pb-2 font-medium",children:"Description"}),(0,a.jsx)("th",{className:"pb-2 font-medium w-32",children:"Location"}),(0,a.jsx)("th",{className:"pb-2 font-medium w-24 text-center",children:"Pages"}),p&&(0,a.jsx)("th",{className:"pb-2 font-medium w-20 text-right",children:"Actions"})]})}),(0,a.jsxs)("tbody",{className:"divide-y divide-gray-800",children:[L.map(e=>(0,a.jsx)(eR,{event:e,canEdit:p,projectId:t,onUpdate:t=>m.mutate({id:e.id,data:t}),onDelete:()=>u.mutate({id:e.id})},e.id)),p&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"py-3",children:(0,a.jsx)("button",{onClick:()=>j(!0),className:"text-sm text-text-secondary hover:text-accent-primary flex items-center gap-1",children:(0,a.jsx)("span",{children:"+ Add Event"})})})})]})]})})]}):!s&&(null==r?void 0:r.days.length)===0&&(0,a.jsx)("div",{className:"text-center py-12 bg-background-primary border border-border-default",children:(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:"No schedule yet. Click a date on the calendar above to add your first shooting day."})}),I&&(0,a.jsx)(eI,{projectId:t,shootingDayId:I.id,isOpen:v,onClose:()=>j(!1),onCreate:e=>{c.mutate(e,{onSuccess:()=>{j(!1)},onError:e=>{console.error("Error creating event:",e),alert("Failed to create event: ".concat(e.message))}})}}),(0,a.jsx)(eP,{projectId:t,isOpen:f,onClose:()=>N(!1)}),I&&(0,a.jsx)(eq,{projectId:t,shootingDayId:I.id,isOpen:k,onClose:()=>w(!1)}),I&&(0,a.jsx)(eB,{shootingDay:I,projectId:t,isOpen:C,onClose:()=>S(!1),onSave:e=>{o.mutate({id:I.id,data:e},{onSuccess:()=>{S(!1)},onError:e=>{console.error("Error updating shooting day:",e),alert("Failed to update shooting day: ".concat(e.message))}})}})]})}function eR(e){var t,r,s;let{event:n,canEdit:l,onUpdate:d,onDelete:c,projectId:m}=e,[u,x]=(0,i.useState)(!1),{data:p=[]}=o.i.crew.listByProject.useQuery({projectId:m},{enabled:!!(null==(t=n.crewIds)?void 0:t.length)}),{data:h=[]}=o.i.cast.listByProject.useQuery({projectId:m},{enabled:!!(null==(r=n.castIds)?void 0:r.length)}),{data:b=[]}=o.i.equipment.listByProject.useQuery({projectId:m},{enabled:!!(null==(s=n.equipmentIds)?void 0:s.length)}),{data:g=[]}=o.i.locations.listByProject.useQuery({projectId:m},{enabled:!!n.locationId}),y={scene:"",break:"bg-yellow-500/10 text-yellow-500",move:"bg-blue-500/10 text-blue-500",prep:"bg-purple-500/10 text-purple-500",wrap:"bg-red-500/10 text-red-500",other:"bg-gray-500/10 text-gray-500"}[n.type]||"",v=h.filter(e=>{var t;return null==(t=n.castIds)?void 0:t.includes(e.id)}),j=p.filter(e=>{var t;return null==(t=n.crewIds)?void 0:t.includes(e.id)}),f=b.filter(e=>{var t;return null==(t=n.equipmentIds)?void 0:t.includes(e.id)}),N=g.find(e=>e.id===n.locationId);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("tr",{className:"hover:bg-white/5 transition-colors group ".concat(y),children:[(0,a.jsx)("td",{className:"py-3",children:n.time}),(0,a.jsx)("td",{className:"py-3 font-mono",children:n.sceneNumber}),(0,a.jsx)("td",{className:"py-3",children:(0,a.jsxs)("div",{children:["scene"!==n.type&&(0,a.jsxs)("span",{className:"uppercase text-xs font-bold tracking-wider opacity-70 mr-2",children:["[",n.type,"]"]}),(0,a.jsx)("div",{className:"font-medium",children:n.description}),(v.length>0||j.length>0||f.length>0)&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[v.length>0&&(0,a.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded",title:"Cast: ".concat(v.map(e=>e.actorName).join(", ")),children:["\uD83C\uDFAD ",v.length]}),j.length>0&&(0,a.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded",title:"Crew: ".concat(j.map(e=>e.name).join(", ")),children:["\uD83D\uDC65 ",j.length]}),f.length>0&&(0,a.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-purple-500/20 text-purple-400 rounded",title:"Equipment: ".concat(f.map(e=>e.name).join(", ")),children:["\uD83D\uDCE6 ",f.length]})]}),n.notes&&(0,a.jsx)("div",{className:"text-xs text-text-tertiary mt-1 italic",children:n.notes})]})}),(0,a.jsx)("td",{className:"py-3 text-text-secondary",children:N?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:N.name}),(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:N.address})]}):n.location}),(0,a.jsx)("td",{className:"py-3 text-center text-text-secondary",children:n.pageCount}),l&&(0,a.jsxs)("td",{className:"py-3 text-right opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)("button",{onClick:()=>x(!0),className:"text-accent-primary hover:text-accent-hover text-xs mr-2",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>{confirm("Delete?")&&c()},className:"text-red-500 hover:text-red-400 text-xs",children:"Delete"})]})]}),l&&(0,eS.createPortal)((0,a.jsx)(eI,{projectId:m,shootingDayId:n.shootingDayId,isOpen:u,onClose:()=>x(!1),onCreate:e=>{d(e),x(!1)},initialData:{time:n.time,sceneNumber:n.sceneNumber,description:n.description,location:n.location,locationId:n.locationId,pageCount:n.pageCount,type:n.type,duration:n.duration,notes:n.notes,castIds:n.castIds,crewIds:n.crewIds,equipmentIds:n.equipmentIds,storyboardIds:n.storyboardIds}}),document.body)]})}function eE(e){let t=o.i.useUtils(),{data:r,isLoading:a,error:s}=o.i.expenses.listByProject.useQuery({projectId:e}),n=o.i.expenses.create.useMutation({onSuccess:()=>{t.expenses.listByProject.invalidate({projectId:e}),t.budget.getBudget.invalidate({projectId:e})}}),l=o.i.expenses.update.useMutation({onSuccess:()=>{t.expenses.listByProject.invalidate({projectId:e}),t.budget.getBudget.invalidate({projectId:e})}});return{expenses:r||[],isLoading:a,error:s,createExpense:n,updateExpense:l,deleteExpense:o.i.expenses.delete.useMutation({onSuccess:()=>{t.expenses.listByProject.invalidate({projectId:e}),t.budget.getBudget.invalidate({projectId:e})}}),importExpenses:o.i.expenses.import.useMutation({onSuccess:()=>{t.expenses.listByProject.invalidate({projectId:e}),t.budget.getBudget.invalidate({projectId:e})}})}}function eT(e){let{categories:t,items:r,totalBudget:s}=e,n=r.reduce((e,t)=>e+(t.estimatedAmount||0),0),l=r.reduce((e,t)=>e+(t.actualAmount||0),0),o=n-l,i=n>0?o/n*100:0,d=0,c="On Track",m="text-green-500",u="bg-green-500";return s&&s>0?(d=Math.max(n/s*100,l/s*100))>100?(c="Over",m="text-red-500",u="bg-red-500"):d>90?(c="Warning",m="text-yellow-500",u="bg-yellow-500"):(c="On Track",m="text-green-500",u="bg-green-500"):(d=Math.abs(i),i<-10?(c="Over",m="text-red-500",u="bg-red-500"):i<-5?(c="Warning",m="text-yellow-500",u="bg-yellow-500"):(c="On Track",m="text-green-500",u="bg-green-500")),t.reduce((e,t)=>{let a=t.phase||"other";e[a]||(e[a]={estimated:0,actual:0});let s=r.filter(e=>e.categoryId===t.id);return e[a].estimated+=s.reduce((e,t)=>e+(t.estimatedAmount||0),0),e[a].actual+=s.reduce((e,t)=>e+(t.actualAmount||0),0),e},{}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-background-secondary p-6 rounded-lg border border-border-default",children:[(0,a.jsx)("h3",{className:"text-text-secondary text-sm font-medium mb-2",children:"Total Estimated"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:["$",n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"bg-background-secondary p-6 rounded-lg border border-border-default",children:[(0,a.jsx)("h3",{className:"text-text-secondary text-sm font-medium mb-2",children:"Total Actual"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:["$",l.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"bg-background-secondary p-6 rounded-lg border border-border-default",children:[(0,a.jsx)("h3",{className:"text-text-secondary text-sm font-medium mb-2",children:"Variance"}),(0,a.jsxs)("p",{className:"text-2xl font-bold ".concat(o>=0?"text-green-500":"text-red-500"),children:[o>=0?"+":"","$",o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("p",{className:"text-xs mt-1 ".concat(o>=0?"text-green-500":"text-red-500"),children:[i>=0?"+":"",i.toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"bg-background-secondary p-6 rounded-lg border border-border-default",children:[(0,a.jsx)("h3",{className:"text-text-secondary text-sm font-medium mb-2",children:"Budget Health"}),s&&s>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"flex-1 h-2 bg-background-tertiary rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full transition-all ".concat(u),style:{width:"".concat(Math.min(100,d),"%")}})}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(m),children:c})]}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary",children:n>s?(0,a.jsxs)(a.Fragment,{children:["$",(n-s).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," over budget"]}):(0,a.jsxs)(a.Fragment,{children:["$",(s-n).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," remaining"]})}),(0,a.jsxs)("p",{className:"text-xs text-text-tertiary mt-1",children:[d.toFixed(1),"% of $",s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," used"]})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex-1 h-2 bg-background-tertiary rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full transition-all ".concat(u),style:{width:"".concat(Math.min(100,d),"%")}})}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(m),children:c})]})]})]})}let eU=[{value:"all",label:"All Phases"},{value:"pre-production",label:"Pre-Production"},{value:"production",label:"Production"},{value:"post-production",label:"Post-Production"},{value:"wrap",label:"Wrap"},{value:"other",label:"Other"}];function ez(e){let{selectedPhase:t,onPhaseChange:r}=e;return(0,a.jsx)("div",{className:"flex gap-2 mb-4 flex-wrap",children:eU.map(e=>(0,a.jsx)("button",{onClick:()=>r(e.value),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(t===e.value?"bg-accent-primary":"bg-background-secondary text-text-secondary hover:bg-background-tertiary"),style:t===e.value?{color:"rgb(var(--colored-button-text))"}:void 0,children:e.label},e.value))})}function eF(e){let{projectId:t,onClose:r}=e,{templates:s,isLoading:n}=function(){let e=o.i.useUtils(),{data:t,isLoading:r,error:a}=o.i.budgetTemplates.getAll.useQuery();return{templates:t||[],isLoading:r,error:a,createTemplate:o.i.budgetTemplates.create.useMutation({onSuccess:()=>{e.budgetTemplates.getAll.invalidate()}}),applyTemplate:o.i.budgetTemplates.applyTemplate.useMutation({onSuccess:()=>{}})}}(),l=o.i.useUtils(),[d,c]=(0,i.useState)(null),[m,u]=(0,i.useState)("all"),x=o.i.budgetTemplates.applyTemplate.useMutation({onSuccess:()=>{l.budget.getBudget.invalidate({projectId:t}),r()}}),p=async()=>{d&&await x.mutateAsync({projectId:t,templateId:d,includeItems:!0,overwriteExisting:!1,phase:"all"!==m?m:void 0})};return n?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary mx-auto"})})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Apply Budget Template"}),(0,a.jsx)("button",{onClick:r,className:"text-text-secondary hover:text-text-primary",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Select Template"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-2 max-h-64 overflow-y-auto",children:s.map(e=>(0,a.jsxs)("button",{onClick:()=>c(e.id),className:"p-4 text-left rounded-lg border transition-colors ".concat(d===e.id?"border-accent-primary bg-accent-primary/10":"border-border-default hover:bg-background-secondary"),children:[(0,a.jsx)("div",{className:"font-semibold",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-sm text-text-secondary mt-1",children:e.description}),(0,a.jsxs)("div",{className:"text-xs text-text-tertiary mt-1",children:[e.categories.length," categories"]})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Apply to Phase (Optional)"}),(0,a.jsxs)("select",{value:m,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded",children:[(0,a.jsx)("option",{value:"all",children:"All Phases"}),(0,a.jsx)("option",{value:"pre-production",children:"Pre-Production"}),(0,a.jsx)("option",{value:"production",children:"Production"}),(0,a.jsx)("option",{value:"post-production",children:"Post-Production"}),(0,a.jsx)("option",{value:"wrap",children:"Wrap"}),(0,a.jsx)("option",{value:"other",children:"Other"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 bg-background-secondary border border-border-default rounded hover:bg-background-tertiary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:p,disabled:!d||x.isPending,className:"px-4 py-2 bg-accent-primary rounded hover:bg-accent-hover transition-colors font-medium",style:{color:"rgb(var(--colored-button-text))"},children:x.isPending?"Applying...":"Apply Template"})]})]})]})})}var eO=r(3314),eW=r(6847);function eV(e){let{projectId:t,expense:r,budgetItemId:s,onClose:n,onSuccess:l}=e,d=o.i.useUtils(),c=(0,i.useRef)(null),[m,u]=(0,i.useState)(!1),x=o.i.expenses.create.useMutation({onSuccess:()=>{d.expenses.listByProject.invalidate({projectId:t}),d.budget.getBudget.invalidate({projectId:t}),null==l||l(),n()}}),p=o.i.expenses.update.useMutation({onSuccess:()=>{d.expenses.listByProject.invalidate({projectId:t}),d.budget.getBudget.invalidate({projectId:t}),null==l||l(),n()}}),[h,b]=(0,i.useState)({projectId:t,budgetItemId:s,description:(null==r?void 0:r.description)||"",amount:(null==r?void 0:r.amount)||0,category:(null==r?void 0:r.category)||"other",status:(null==r?void 0:r.status)||"pending",transactionDate:(null==r?void 0:r.transactionDate)||new Date,vendor:(null==r?void 0:r.vendor)||"",notes:(null==r?void 0:r.notes)||"",receiptUrl:null==r?void 0:r.receiptUrl,receiptFileName:null==r?void 0:r.receiptFileName}),g=async e=>{if(e){u(!0);try{let r=(0,eO.KR)(eW.IG,"expenses/".concat(t,"/").concat(Date.now(),"_").concat(e.name));await (0,eO.D)(r,e);let a=await (0,eO.qk)(r);b({...h,receiptUrl:a,receiptFileName:e.name})}catch(e){console.error("Error uploading file:",e),alert("Failed to upload receipt")}finally{u(!1)}}},y=async e=>{e.preventDefault(),r?await p.mutateAsync({id:r.id,data:h}):await x.mutateAsync(h)};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:r?"Edit Expense":"Add Expense"}),(0,a.jsx)("button",{onClick:n,className:"text-text-secondary hover:text-text-primary",children:"✕"})]}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description *"}),(0,a.jsx)("input",{type:"text",value:h.description,onChange:e=>b({...h,description:e.target.value}),className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Amount *"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:h.amount,onChange:e=>b({...h,amount:Number(e.target.value)}),className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Category *"}),(0,a.jsxs)("select",{value:h.category,onChange:e=>b({...h,category:e.target.value}),className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0,children:[(0,a.jsx)("option",{value:"labor",children:"Labor"}),(0,a.jsx)("option",{value:"equipment",children:"Equipment"}),(0,a.jsx)("option",{value:"location",children:"Location"}),(0,a.jsx)("option",{value:"transportation",children:"Transportation"}),(0,a.jsx)("option",{value:"catering",children:"Catering"}),(0,a.jsx)("option",{value:"post_production",children:"Post-Production"}),(0,a.jsx)("option",{value:"insurance",children:"Insurance"}),(0,a.jsx)("option",{value:"permits",children:"Permits"}),(0,a.jsx)("option",{value:"other",children:"Other"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Transaction Date *"}),(0,a.jsx)("input",{type:"date",value:h.transactionDate?new Date(h.transactionDate).toISOString().split("T")[0]:"",onChange:e=>b({...h,transactionDate:new Date(e.target.value)}),className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Status"}),(0,a.jsxs)("select",{value:h.status,onChange:e=>b({...h,status:e.target.value}),className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"approved",children:"Approved"}),(0,a.jsx)("option",{value:"paid",children:"Paid"}),(0,a.jsx)("option",{value:"reimbursed",children:"Reimbursed"}),(0,a.jsx)("option",{value:"rejected",children:"Rejected"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Vendor/Payee"}),(0,a.jsx)("input",{type:"text",value:h.vendor,onChange:e=>b({...h,vendor:e.target.value}),className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Receipt"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{ref:c,type:"file",accept:"image/*,.pdf",onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&g(r)},className:"hidden"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=c.current)?void 0:e.click()},disabled:m,className:"px-4 py-2 bg-background-secondary border border-border-default rounded hover:bg-background-tertiary transition-colors",children:m?"Uploading...":"Upload Receipt"}),h.receiptFileName&&(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:h.receiptFileName})]}),h.receiptUrl&&(0,a.jsx)("a",{href:h.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-accent-primary hover:underline mt-1 block",children:"View Receipt"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),(0,a.jsx)("textarea",{value:h.notes,onChange:e=>b({...h,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 bg-background-secondary border border-border-default rounded hover:bg-background-tertiary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:x.isPending||p.isPending||m,className:"px-4 py-2 bg-accent-primary rounded hover:bg-accent-hover transition-colors font-medium",style:{color:"rgb(var(--colored-button-text))"},children:x.isPending||p.isPending?"Saving...":r?"Update":"Create"})]})]})]})})}function eH(e){let{projectId:t,onClose:r}=e,{importExpenses:s}=eE(t),[n,l]=(0,i.useState)(""),[o,d]=(0,i.useState)([]),[c,m]=(0,i.useState)(null),u=e=>{let t=e.trim().split("\n");if(t.length<2)throw Error("CSV must have at least a header row and one data row");let r=t[0].split(",").map(e=>e.trim().toLowerCase());for(let e of["date","description","amount"])if(!r.includes(e))throw Error('CSV must include "'.concat(e,'" column'));let a=[];for(let e=1;e<t.length;e++){let s=t[e].split(",").map(e=>e.trim()),n={};r.forEach((e,t)=>{n[e]=s[t]||""}),n.date&&n.description&&n.amount&&a.push({date:n.date,description:n.description,amount:parseFloat(n.amount)||0,vendor:n.vendor||void 0,category:n.category||void 0,budgetItem:n.budgetitem||n["budget item"]||void 0})}return a},x=async()=>{if(0===o.length)return void m("No expenses to import");try{await s.mutateAsync({projectId:t,expenses:o}),r()}catch(e){m(e.message||"Failed to import expenses")}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Import Expenses"}),(0,a.jsx)("button",{onClick:r,className:"text-text-secondary hover:text-text-primary",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Upload CSV File"}),(0,a.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(!r)return;let a=new FileReader;a.onload=e=>{var t;let r=null==(t=e.target)?void 0:t.result;l(r);try{let e=u(r);d(e),m(null)}catch(e){m(e.message),d([])}},a.readAsText(r)},className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded"}),(0,a.jsx)("p",{className:"text-xs text-text-secondary mt-1",children:"CSV must include: date, description, amount (optional: vendor, category, budgetItem)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Or Paste CSV Data"}),(0,a.jsx)("textarea",{value:n,onChange:e=>l(e.target.value),rows:8,className:"w-full px-3 py-2 bg-background-secondary border border-border-default rounded font-mono text-sm",placeholder:"date,description,amount,vendor,category 2024-01-15,Camera Rental,5000,ABC Rentals,equipment"}),(0,a.jsx)("button",{onClick:()=>{try{let e=u(n);d(e),m(null)}catch(e){m(e.message),d([])}},className:"mt-2 px-4 py-2 bg-background-secondary border border-border-default rounded hover:bg-background-tertiary transition-colors text-sm",children:"Parse CSV"})]}),c&&(0,a.jsx)("div",{className:"bg-red-500/10 border border-red-500/50 rounded p-3 text-sm text-red-400",children:c}),o.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-medium mb-2",children:["Found ",o.length," expenses to import"]}),(0,a.jsxs)("div",{className:"max-h-64 overflow-y-auto border border-border-default rounded",children:[(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-background-secondary",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Date"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Description"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"Amount"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Vendor"})]})}),(0,a.jsx)("tbody",{children:o.slice(0,10).map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-border-default",children:[(0,a.jsx)("td",{className:"px-3 py-2",children:e.date}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.description}),(0,a.jsxs)("td",{className:"px-3 py-2 text-right",children:["$",e.amount.toLocaleString()]}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.vendor||"-"})]},t))})]}),o.length>10&&(0,a.jsxs)("div",{className:"px-3 py-2 text-sm text-text-secondary text-center",children:["... and ",o.length-10," more"]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 bg-background-secondary border border-border-default rounded hover:bg-background-tertiary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:x,disabled:0===o.length||s.isPending,className:"px-4 py-2 bg-accent-primary rounded hover:bg-accent-hover transition-colors font-medium",style:{color:"rgb(var(--colored-button-text))"},children:s.isPending?"Importing...":"Import ".concat(o.length," Expenses")})]})]})]})})}function e_(e){let{projectId:t,budgetItem:r,onClose:s,onLink:n}=e,[l,d]=(0,i.useState)("crew"),[c,m]=(0,i.useState)(""),{data:u=[]}=o.i.crew.listByProject.useQuery({projectId:t}),{data:x=[]}=o.i.equipment.listByProject.useQuery({projectId:t}),{data:p=[]}=o.i.locations.listByProject.useQuery({projectId:t}),{data:h=[]}=o.i.cast.listByProject.useQuery({projectId:t}),b=c?"crew"===l?u.find(e=>e.id===c):"equipment"===l?x.find(e=>e.id===c):"location"===l?p.find(e=>e.id===c):"cast"===l?h.find(e=>e.id===c):null:null;return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:s,children:(0,a.jsxs)("div",{className:"bg-background-secondary rounded-lg border border-border-default p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Link Budget Item"}),(0,a.jsx)("button",{onClick:s,className:"text-text-tertiary hover:text-text-primary",children:"✕"})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("p",{className:"text-sm text-text-secondary mb-2",children:['Link "',r.description,'" to:']})}),(0,a.jsx)("div",{className:"flex gap-2 mb-4 border-b border-border-default",children:["crew","equipment","location","cast"].map(e=>(0,a.jsx)("button",{onClick:()=>{d(e),m("")},className:"px-4 py-2 text-sm font-medium border-b-2 transition-colors ".concat(l===e?"border-accent-primary text-accent-primary":"border-transparent text-text-secondary hover:text-text-primary"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Select ","crew"===l?"Crew Member":"equipment"===l?"Equipment":"location"===l?"Location":"Cast Member"]}),(0,a.jsxs)("select",{value:c,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 bg-background-tertiary border border-border-default rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[(0,a.jsx)("option",{value:"",children:"-- Select --"}),"crew"===l&&u.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ",e.role," (",e.department,")",e.rate&&" - $".concat(e.rate,"/").concat(e.rateType||"day")]},e.id)),"equipment"===l&&x.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.category,")",e.dailyRate&&" - $".concat(e.dailyRate,"/day"),e.weeklyRate&&" - $".concat(e.weeklyRate,"/week")]},e.id)),"location"===l&&p.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ",e.address,e.rentalCost&&" - $".concat(e.rentalCost)]},e.id)),"cast"===l&&h.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.actorName," as ",e.characterName," (",e.castType,")",e.rate&&" - $".concat(e.rate)]},e.id))]})]}),b&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsx)("h3",{className:"font-medium mb-2",children:"Preview:"}),"crew"===l&&(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Name:"})," ",b.name]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Role:"})," ",b.role]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Department:"})," ",b.department]}),b.rate&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Rate:"})," $",b.rate,"/",b.rateType||"day"]})]}),"equipment"===l&&(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Name:"})," ",b.name]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Category:"})," ",b.category]}),b.dailyRate&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Daily Rate:"})," $",b.dailyRate]}),b.weeklyRate&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Weekly Rate:"})," $",b.weeklyRate]})]}),"location"===l&&(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Name:"})," ",b.name]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Address:"})," ",b.address]}),b.rentalCost&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Rental Cost:"})," $",b.rentalCost]})]}),"cast"===l&&(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Actor:"})," ",b.actorName]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Character:"})," ",b.characterName]}),b.rate&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Rate:"})," $",b.rate]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)("button",{onClick:s,className:"px-4 py-2 bg-background-tertiary border border-border-default rounded-lg hover:bg-background-secondary transition-colors text-sm font-medium",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{if(!c)return;let e={};"crew"===l&&(e.linkedCrewMemberId=c),"equipment"===l&&(e.linkedEquipmentId=c),"location"===l&&(e.linkedLocationId=c),"cast"===l&&(e.linkedCastMemberId=c),n(e),s()},disabled:!c,className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"rgb(var(--colored-button-text))"},children:"Link"})]})]})})}function eQ(e){let{projectId:t,onClose:r,onCreateFromCrew:s,onCreateFromEquipment:n,onCreateFromLocations:l,onCreateFromCast:d}=e,[c,m]=(0,i.useState)("crew"),[u,x]=(0,i.useState)(new Set),{data:p=[]}=o.i.crew.listByProject.useQuery({projectId:t}),{data:h=[]}=o.i.equipment.listByProject.useQuery({projectId:t}),{data:b=[]}=o.i.locations.listByProject.useQuery({projectId:t}),{data:g=[]}=o.i.cast.listByProject.useQuery({projectId:t}),y=e=>{let t=new Set(u);t.has(e)?t.delete(e):t.add(e),x(t)};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:r,children:(0,a.jsxs)("div",{className:"bg-background-secondary rounded-lg border border-border-default p-6 max-w-3xl w-full mx-4 max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Create Budget Items From"}),(0,a.jsx)("button",{onClick:r,className:"text-text-tertiary hover:text-text-primary",children:"✕"})]}),(0,a.jsx)("div",{className:"flex gap-2 mb-4 border-b border-border-default",children:["crew","equipment","locations","cast"].map(e=>(0,a.jsx)("button",{onClick:()=>{m(e),x(new Set)},className:"px-4 py-2 text-sm font-medium border-b-2 transition-colors ".concat(c===e?"border-accent-primary text-accent-primary":"border-transparent text-text-secondary hover:text-text-primary"),children:"crew"===e?"Crew":"equipment"===e?"Equipment":"locations"===e?"Locations":"Cast"},e))}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:[u.size," selected"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{"crew"===c?x(new Set(p.map(e=>e.id))):"equipment"===c?x(new Set(h.map(e=>e.id))):"locations"===c?x(new Set(b.map(e=>e.id))):x(new Set(g.map(e=>e.id)))},className:"px-3 py-1 text-xs bg-background-tertiary border border-border-default rounded hover:bg-background-secondary transition-colors",children:"Select All"}),(0,a.jsx)("button",{onClick:()=>{x(new Set)},className:"px-3 py-1 text-xs bg-background-tertiary border border-border-default rounded hover:bg-background-secondary transition-colors",children:"Clear"})]})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-4 max-h-96 overflow-y-auto",children:["crew"===c&&p.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 bg-background-tertiary rounded-lg border border-border-default hover:bg-background-secondary cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:u.has(e.id),onChange:()=>y(e.id),className:"w-4 h-4"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:[e.role," • ",e.department,e.rate&&" • $".concat(e.rate,"/").concat(e.rateType||"day")]})]})]},e.id)),"equipment"===c&&h.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 bg-background-tertiary rounded-lg border border-border-default hover:bg-background-secondary cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:u.has(e.id),onChange:()=>y(e.id),className:"w-4 h-4"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:[e.category,e.dailyRate&&" • $".concat(e.dailyRate,"/day"),e.weeklyRate&&" • $".concat(e.weeklyRate,"/week")]})]})]},e.id)),"locations"===c&&b.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 bg-background-tertiary rounded-lg border border-border-default hover:bg-background-secondary cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:u.has(e.id),onChange:()=>y(e.id),className:"w-4 h-4"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:[e.address,e.rentalCost&&" • $".concat(e.rentalCost)]})]})]},e.id)),"cast"===c&&g.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 bg-background-tertiary rounded-lg border border-border-default hover:bg-background-secondary cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:u.has(e.id),onChange:()=>y(e.id),className:"w-4 h-4"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.actorName}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:["as ",e.characterName," • ",e.castType,e.rate&&" • $".concat(e.rate)]})]})]},e.id))]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 bg-background-tertiary border border-border-default rounded-lg hover:bg-background-secondary transition-colors text-sm font-medium",children:"Cancel"}),(0,a.jsxs)("button",{onClick:()=>{if(0===u.size)return;let e=Array.from(u);"crew"===c?s(e):"equipment"===c?n(e):"locations"===c?l(e):d(e)},disabled:0===u.size,className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"rgb(var(--colored-button-text))"},children:["Create Budget Items (",u.size,")"]})]})]})})}function e$(e){let{projectId:t}=e,{budget:r,isLoading:s,error:n,createCategory:l,updateCategory:d,deleteCategory:c,createItem:m,updateItem:u,deleteItem:x}=function(e){let t=o.i.useUtils(),{data:r,isLoading:a,error:s}=o.i.budget.getBudget.useQuery({projectId:e}),n=o.i.budget.createCategory.useMutation({onSuccess:()=>{t.budget.getBudget.invalidate({projectId:e})}}),l=o.i.budget.updateCategory.useMutation({onSuccess:()=>{t.budget.getBudget.invalidate({projectId:e})}}),i=o.i.budget.deleteCategory.useMutation({onSuccess:()=>{t.budget.getBudget.invalidate({projectId:e})}}),d=o.i.budget.createItem.useMutation({onSuccess:()=>{t.budget.getBudget.invalidate({projectId:e})}});return{budget:r,isLoading:a,error:s,createCategory:n,updateCategory:l,deleteCategory:i,createItem:d,updateItem:o.i.budget.updateItem.useMutation({onSuccess:()=>{t.budget.getBudget.invalidate({projectId:e})}}),deleteItem:o.i.budget.deleteItem.useMutation({onSuccess:()=>{t.budget.getBudget.invalidate({projectId:e})}})}}(t),{expenses:p}=eE(t),{data:h}=(0,eN.aN)(t),{data:b}=o.i.projects.getById.useQuery({id:t}),g="owner"===h||"admin"===h,[y,v]=(0,i.useState)("all"),[j,f]=(0,i.useState)(!1),[N,k]=(0,i.useState)(!1),[w,C]=(0,i.useState)(!1),[S,D]=(0,i.useState)(),[I,L]=(0,i.useState)(null),[A,M]=(0,i.useState)(""),[P,q]=(0,i.useState)(!1),[B,Y]=(0,i.useState)(new Set),[R,E]=(0,i.useState)(!1),[T,U]=(0,i.useState)(null),[z,F]=(0,i.useState)(!1),O=o.i.useUtils(),W=o.i.budget.createFromCrew.useMutation({onSuccess:()=>{O.budget.getBudget.invalidate({projectId:t}),F(!1)}}),V=o.i.budget.createFromEquipment.useMutation({onSuccess:()=>{O.budget.getBudget.invalidate({projectId:t}),F(!1)}}),H=o.i.budget.createFromLocations.useMutation({onSuccess:()=>{O.budget.getBudget.invalidate({projectId:t}),F(!1)}}),_=o.i.budget.createFromCast.useMutation({onSuccess:()=>{O.budget.getBudget.invalidate({projectId:t}),F(!1)}}),Q=(null==r?void 0:r.categories.filter(e=>"all"===y||!e.phase||e.phase===y))||[],$=(null==r?void 0:r.items.filter(e=>{let t=r.categories.find(t=>t.id===e.categoryId);return"all"===y||!(null==t?void 0:t.phase)||t.phase===y}))||[],G=async e=>{e.preventDefault(),A.trim()&&(await l.mutateAsync({projectId:t,name:A,phase:"all"!==y?y:void 0}),M(""),q(!1))};return s?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary"})}):n?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"⚠️"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"Error Loading Budget"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:n.message})]})}):r?(0,a.jsxs)("div",{className:"space-y-6 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Budget"}),g&&(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)("button",{onClick:()=>F(!0),className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-sm font-medium",children:"\uD83D\uDD17 Create from Crew/Equipment/Locations"}),(0,a.jsx)("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-sm font-medium",children:"\uD83D\uDCCB Apply Template"}),(0,a.jsx)("button",{onClick:()=>C(!0),className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-sm font-medium",children:"\uD83D\uDCE5 Import Expenses"}),(0,a.jsx)("button",{onClick:()=>{D(void 0),k(!0)},className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors text-sm font-medium",style:{color:"rgb(var(--colored-button-text))"},children:"+ Add Expense"})]})]}),(0,a.jsx)(eT,{categories:Q,items:$,totalBudget:null==b?void 0:b.budget}),(0,a.jsx)(ez,{selectedPhase:y,onPhaseChange:v}),g&&B.size>0&&(0,a.jsxs)("div",{className:"bg-background-tertiary border border-border-default rounded-lg p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm font-medium",children:[B.size," item",1!==B.size?"s":""," selected"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{confirm("Delete ".concat(B.size," selected item(s)?"))&&(B.forEach(e=>x.mutate({id:e})),Y(new Set))},className:"px-4 py-2 bg-red-500/20 text-red-500 border border-red-500/30 rounded-lg hover:bg-red-500/30 transition-colors text-sm font-medium",children:"Delete Selected"}),(0,a.jsx)("button",{onClick:()=>Y(new Set),className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-sm font-medium",children:"Clear Selection"})]})]}),(0,a.jsxs)("div",{className:"bg-background-secondary rounded-lg border border-border-default overflow-hidden",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-background-tertiary border-b border-border-default",children:(0,a.jsxs)("tr",{children:[g&&(0,a.jsx)("th",{className:"px-4 py-3 w-12",children:(0,a.jsx)("input",{type:"checkbox",checked:B.size===$.length&&$.length>0,onChange:e=>{e.target.checked?Y(new Set($.map(e=>e.id))):Y(new Set)},className:"w-4 h-4 cursor-pointer"})}),(0,a.jsx)("th",{className:"px-4 py-3 text-left font-semibold w-1/3",children:"Category / Item"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Estimated"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Actual"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Variance"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center font-semibold",children:"Status"}),g&&(0,a.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Actions"})]})}),(0,a.jsxs)("tbody",{className:"divide-y divide-border-default",children:[Q.map(e=>{let r=$.filter(t=>t.categoryId===e.id),s=r.reduce((e,t)=>e+(t.estimatedAmount||0),0),n=r.reduce((e,t)=>e+(t.actualAmount||0),0),l=s-n;return(0,a.jsxs)(i.Fragment,{children:[(0,a.jsxs)("tr",{className:"bg-background-tertiary/50 hover:bg-background-tertiary transition-colors",children:[g&&(0,a.jsx)("td",{className:"px-4 py-3"}),(0,a.jsx)("td",{className:"px-4 py-3 font-semibold",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:e.name}),e.department&&(0,a.jsx)("span",{className:"text-xs text-text-tertiary px-2 py-0.5 bg-background-secondary rounded",children:e.department})]})}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right font-semibold",children:["$",s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right font-semibold",children:["$",n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right font-semibold ".concat(l>=0?"text-green-500":"text-red-500"),children:[l>=0?"+":"","$",l.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsx)("td",{className:"px-4 py-3"}),g&&(0,a.jsx)("td",{className:"px-4 py-3 text-right",children:(0,a.jsx)("button",{onClick:()=>{confirm("Delete this category and all its items?")&&c.mutate({id:e.id})},className:"text-red-500 hover:text-red-400 text-xs",children:"Delete"})})]}),r.map(t=>{t.estimatedAmount,t.actualAmount;let r=p.filter(e=>e.budgetItemId===t.id);return r.reduce((e,t)=>e+t.amount,0),(0,a.jsx)(eG,{item:t,category:e,canEdit:g,expensesCount:r.length,isSelected:B.has(t.id),onSelect:e=>{let r=new Set(B);e?r.add(t.id):r.delete(t.id),Y(r)},onUpdate:e=>u.mutate({id:t.id,data:e}),onDelete:()=>x.mutate({id:t.id}),onAddExpense:()=>{D(t.id),k(!0)},onLink:()=>{U(t),E(!0)},isEditing:I===t.id,onEdit:()=>L(t.id),onCancelEdit:()=>L(null)},t.id)}),g&&(0,a.jsx)(eK,{projectId:t,categoryId:e.id,onCreate:e=>{m.mutate(e)}})]},e.id)}),g&&!P&&0===Q.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:g?7:6,className:"px-4 py-8 text-center text-text-secondary",children:(0,a.jsx)("button",{onClick:()=>q(!0),className:"text-accent-primary hover:underline",children:"+ Create your first category"})})})]})]})}),P&&(0,a.jsx)("div",{className:"p-4 bg-background-tertiary border-t border-border-default",children:(0,a.jsxs)("form",{onSubmit:G,className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:A,onChange:e=>M(e.target.value),placeholder:"Category Name (e.g. Camera Dept)",className:"flex-1 px-4 py-2 bg-background-secondary border border-border-default rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-primary",autoFocus:!0}),(0,a.jsx)("button",{type:"submit",disabled:l.isPending,className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors text-sm font-medium",style:{color:"rgb(var(--colored-button-text))"},children:"Add"}),(0,a.jsx)("button",{type:"button",onClick:()=>{q(!1),M("")},className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-sm font-medium",children:"Cancel"})]})})]}),z&&(0,a.jsx)(eQ,{projectId:t,onClose:()=>F(!1),onCreateFromCrew:e=>W.mutate({projectId:t,crewMemberIds:e}),onCreateFromEquipment:e=>V.mutate({projectId:t,equipmentIds:e}),onCreateFromLocations:e=>H.mutate({projectId:t,locationIds:e}),onCreateFromCast:e=>_.mutate({projectId:t,castMemberIds:e})}),j&&(0,a.jsx)(eF,{projectId:t,onClose:()=>f(!1)}),N&&(0,a.jsx)(eV,{projectId:t,budgetItemId:S,onClose:()=>{k(!1),D(void 0)}}),w&&(0,a.jsx)(eH,{projectId:t,onClose:()=>C(!1)}),R&&T&&(0,a.jsx)(e_,{projectId:t,budgetItem:T,onClose:()=>{E(!1),U(null)},onLink:e=>{u.mutate({id:T.id,data:e}),E(!1),U(null)}})]}):(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCB0"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"No Budget Found"})]})})}function eG(e){let{item:t,category:r,canEdit:s,expensesCount:n,isSelected:l,onSelect:o,onUpdate:d,onDelete:c,onAddExpense:m,onLink:u,isEditing:x,onEdit:p,onCancelEdit:h}=e,[b,g]=(0,i.useState)({description:t.description,estimatedAmount:t.estimatedAmount||0,actualAmount:t.actualAmount||0,status:t.status,unit:t.unit||"",quantity:t.quantity||1,unitRate:t.unitRate||0}),y=b.unitRate>0&&b.quantity>0?b.unitRate*b.quantity:b.estimatedAmount,v=(t.estimatedAmount||0)-(t.actualAmount||0);if(x)return(0,a.jsxs)("tr",{className:"bg-background-tertiary/30",children:[s&&(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("input",{type:"checkbox",checked:l,onChange:e=>o(e.target.checked),className:"w-4 h-4 cursor-pointer"})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("input",{type:"text",value:b.description,onChange:e=>g({...b,description:e.target.value}),className:"w-full px-2 py-1 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary"})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-1 p-1 bg-background-tertiary rounded-lg w-fit",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{b.unitRate>0&&g({...b,unitRate:0,estimatedAmount:y})},className:"px-3 py-1 rounded text-xs font-medium transition-colors ".concat(0===b.unitRate?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:0===b.unitRate?{color:"rgb(var(--colored-button-text))"}:void 0,children:"Fixed Amount"}),(0,a.jsx)("button",{type:"button",onClick:()=>{0===b.unitRate&&g({...b,unitRate:b.estimatedAmount/b.quantity||0})},className:"px-3 py-1 rounded text-xs font-medium transition-colors ".concat(b.unitRate>0?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:b.unitRate>0?{color:"rgb(var(--colored-button-text))"}:void 0,children:"Rate \xd7 Quantity"})]}),b.unitRate>0?(0,a.jsxs)("div",{className:"space-y-2 bg-background-tertiary/50 p-3 rounded-lg border border-border-default",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-text-tertiary mb-1 block",children:"Unit"}),(0,a.jsx)("input",{type:"text",value:b.unit,onChange:e=>g({...b,unit:e.target.value}),placeholder:"e.g., days, weeks",className:"w-full px-2 py-1.5 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-text-tertiary mb-1 block",children:"Rate per Unit"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-tertiary text-sm",children:"$"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:b.unitRate,onChange:e=>{let t=Number(e.target.value);g({...b,unitRate:t,estimatedAmount:t*b.quantity})},placeholder:"0.00",className:"w-full pl-6 pr-2 py-1.5 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-sm text-right"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-text-tertiary mb-1 block",children:"Quantity"}),(0,a.jsx)("select",{value:b.quantity,onChange:e=>{let t=Number(e.target.value);g({...b,quantity:t,estimatedAmount:b.unitRate*t})},className:"w-full px-2 py-1.5 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-sm",children:Array.from({length:100},(e,t)=>t+1).map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]}),(0,a.jsx)("div",{className:"pt-2 border-t border-border-default",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-text-tertiary",children:"Total:"}),(0,a.jsxs)("span",{className:"font-semibold text-text-primary",children:["$",y.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-text-tertiary mb-1 block",children:"Amount"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-tertiary text-sm",children:"$"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:b.estimatedAmount,onChange:e=>g({...b,estimatedAmount:Number(e.target.value)}),placeholder:"0.00",className:"w-full pl-6 pr-2 py-1.5 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-sm text-right"})]})]})]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-right",children:(0,a.jsx)("input",{type:"number",step:"0.01",value:b.actualAmount,onChange:e=>g({...b,actualAmount:Number(e.target.value)}),className:"w-32 px-2 py-1 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-right"})}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right text-text-secondary",children:[v>=0?"+":"","$",v.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsxs)("select",{value:b.status,onChange:e=>g({...b,status:e.target.value}),className:"px-2 py-1 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-xs",children:[(0,a.jsx)("option",{value:"estimated",children:"Estimated"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"approved",children:"Approved"}),(0,a.jsx)("option",{value:"paid",children:"Paid"}),(0,a.jsx)("option",{value:"rejected",children:"Rejected"})]})}),s&&(0,a.jsxs)("td",{className:"px-4 py-3 text-right space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{d({...b,estimatedAmount:y}),h()},className:"text-green-500 hover:text-green-400 text-xs",children:"Save"}),(0,a.jsx)("button",{onClick:h,className:"text-text-secondary hover:text-text-primary text-xs",children:"Cancel"})]})]});let j=t.unitRate&&t.quantity?t.unitRate*t.quantity:t.estimatedAmount||0;return(0,a.jsxs)("tr",{className:"hover:bg-background-tertiary/30 transition-colors group ".concat(l?"bg-accent-primary/10":""),children:[s&&(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("input",{type:"checkbox",checked:l,onChange:e=>o(e.target.checked),className:"w-4 h-4 cursor-pointer"})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)("span",{className:"text-text-secondary",children:"└─"}),(0,a.jsx)("span",{children:t.description}),t.unitRate&&t.quantity&&(0,a.jsxs)("span",{className:"text-xs text-text-tertiary",children:["($",t.unitRate.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," \xd7 ",t.quantity," ",t.unit||"units",")"]}),t.linkedCrewMemberId&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded",title:"Linked to crew member",children:"\uD83D\uDC64 Crew"}),t.linkedEquipmentId&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 bg-purple-500/20 text-purple-400 rounded",title:"Linked to equipment",children:"\uD83D\uDCE6 Equipment"}),t.linkedLocationId&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 bg-green-500/20 text-green-400 rounded",title:"Linked to location",children:"\uD83D\uDCCD Location"}),t.linkedCastMemberId&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded",title:"Linked to cast member",children:"\uD83C\uDFAD Cast"}),n>0&&(0,a.jsxs)("button",{onClick:m,className:"text-xs text-accent-primary hover:underline",title:"".concat(n," expense(s)"),children:["\uD83D\uDCB0 ",n]})]})}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right text-text-secondary",children:["$",j.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right text-text-secondary",children:["$",(t.actualAmount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right ".concat(v>=0?"text-green-500":"text-red-500"),children:[v>=0?"+":"","$",v.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium ".concat({estimated:"bg-gray-500",pending:"bg-yellow-500",paid:"bg-green-500",approved:"bg-blue-500",rejected:"bg-red-500"}[t.status]),children:t.status})}),s&&(0,a.jsx)("td",{className:"px-4 py-3 text-right opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)("button",{onClick:u,className:"text-accent-primary hover:text-accent-hover text-xs",title:"Link to crew/equipment/location/cast",children:"\uD83D\uDD17"}),(0,a.jsx)("button",{onClick:m,className:"text-accent-primary hover:text-accent-hover text-xs",title:"Add expense",children:"\uD83D\uDCB0"}),(0,a.jsx)("button",{onClick:p,className:"text-accent-primary hover:text-accent-hover text-xs",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>{confirm("Delete this item?")&&c()},className:"text-red-500 hover:text-red-400 text-xs",children:"Delete"})]})})]})}function eK(e){let{projectId:t,categoryId:r,onCreate:s}=e,[n,l]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1),[c,m]=(0,i.useState)({description:"",estimatedAmount:0,actualAmount:0,status:"estimated",unit:"",quantity:1,unitRate:0});if(!n)return(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-4 py-3 text-center",children:(0,a.jsxs)("button",{onClick:()=>l(!0),className:"px-6 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors text-sm font-semibold flex items-center gap-2 mx-auto",style:{color:"rgb(var(--colored-button-text))"},children:[(0,a.jsx)("span",{children:"+"}),(0,a.jsx)("span",{children:"Add Item"})]})})});let u=o&&c.unitRate>0&&c.quantity>0?c.unitRate*c.quantity:c.estimatedAmount;return(0,a.jsxs)("tr",{className:"bg-background-tertiary/30",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("input",{type:"text",value:c.description,onChange:e=>m({...c,description:e.target.value}),placeholder:"Description",className:"w-full px-2 py-1 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",autoFocus:!0})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-1 p-1 bg-background-tertiary rounded-lg w-fit",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{o&&(d(!1),m({...c,estimatedAmount:u}))},className:"px-3 py-1 rounded text-xs font-medium transition-colors ".concat(o?"text-text-secondary hover:text-text-primary":"bg-accent-primary"),style:o?void 0:{color:"rgb(var(--colored-button-text))"},children:"Fixed Amount"}),(0,a.jsx)("button",{type:"button",onClick:()=>{!o&&(d(!0),c.estimatedAmount>0&&m({...c,unitRate:c.estimatedAmount/c.quantity}))},className:"px-3 py-1 rounded text-xs font-medium transition-colors ".concat(o?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:o?{color:"rgb(var(--colored-button-text))"}:void 0,children:"Rate \xd7 Quantity"})]}),o?(0,a.jsxs)("div",{className:"space-y-2 bg-background-tertiary/50 p-3 rounded-lg border border-border-default",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-text-tertiary mb-1 block",children:"Unit"}),(0,a.jsx)("input",{type:"text",value:c.unit,onChange:e=>m({...c,unit:e.target.value}),placeholder:"e.g., days, weeks",className:"w-full px-2 py-1.5 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-text-tertiary mb-1 block",children:"Rate per Unit"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-tertiary text-sm",children:"$"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:c.unitRate,onChange:e=>{let t=Number(e.target.value);m({...c,unitRate:t,estimatedAmount:t*c.quantity})},placeholder:"0.00",className:"w-full pl-6 pr-2 py-1.5 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-sm text-right"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-text-tertiary mb-1 block",children:"Quantity"}),(0,a.jsx)("select",{value:c.quantity,onChange:e=>{let t=Number(e.target.value);m({...c,quantity:t,estimatedAmount:c.unitRate*t})},className:"w-full px-2 py-1.5 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-sm",children:Array.from({length:100},(e,t)=>t+1).map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]}),(0,a.jsx)("div",{className:"pt-2 border-t border-border-default",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-text-tertiary",children:"Total:"}),(0,a.jsxs)("span",{className:"font-semibold text-text-primary",children:["$",u.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-text-tertiary mb-1 block",children:"Amount"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-tertiary text-sm",children:"$"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:c.estimatedAmount,onChange:e=>m({...c,estimatedAmount:Number(e.target.value)}),placeholder:"0.00",className:"w-full pl-6 pr-2 py-1.5 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-sm text-right"})]})]})]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-right",children:(0,a.jsx)("input",{type:"number",step:"0.01",value:c.actualAmount,onChange:e=>m({...c,actualAmount:Number(e.target.value)}),className:"w-32 px-2 py-1 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-right"})}),(0,a.jsx)("td",{className:"px-4 py-3"}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsxs)("select",{value:c.status,onChange:e=>m({...c,status:e.target.value}),className:"px-2 py-1 bg-background-secondary border border-border-default rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-xs",children:[(0,a.jsx)("option",{value:"estimated",children:"Estimated"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"approved",children:"Approved"}),(0,a.jsx)("option",{value:"paid",children:"Paid"}),(0,a.jsx)("option",{value:"rejected",children:"Rejected"})]})}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{c.description&&(s({projectId:t,categoryId:r,...c,estimatedAmount:u,unit:o?c.unit:void 0,quantity:o?c.quantity:void 0,unitRate:o?c.unitRate:void 0}),m({description:"",estimatedAmount:0,actualAmount:0,status:"estimated",unit:"",quantity:1,unitRate:0}),d(!1),l(!1))},className:"text-green-500 hover:text-green-400 text-xs",children:"Add"}),(0,a.jsx)("button",{onClick:()=>l(!1),className:"text-text-secondary hover:text-text-primary text-xs",children:"Cancel"})]})]})}function eX(e){let{projectId:t,userRole:r,initialTab:s}=e,n="dept_head"===r,l="crew"===r,d="owner"===r||"admin"===r,[c,m]=(0,i.useState)((()=>{if(s)return s;{let e=sessionStorage.getItem("adminTab_".concat(t));if(e&&["team","deptHeads","roleRequests","settings"].includes(e))return sessionStorage.removeItem("adminTab_".concat(t)),e}return n||l?"roleRequests":"team"})());o.i.useUtils();let{data:u}=o.i.projects.getById.useQuery({id:t}),{data:x=[]}=o.i.projectMembers.listByProject.useQuery({projectId:t}),{data:p=[]}=o.i.departmentHeads.listByProject.useQuery({projectId:t}),{data:h=[]}=o.i.crew.listByProject.useQuery({projectId:t}),{data:b=[]}=o.i.roleRequests.listByProject.useQuery({projectId:t}),{data:g}=o.i.roleRequests.getPendingCount.useQuery({projectId:t}),y=Array.from(new Set(h.map(e=>e.department))).sort(),v=x.filter(e=>"active"===e.status);return(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary mb-2",children:n?"Department Management":"Admin Panel"}),(0,a.jsx)("p",{className:"text-text-secondary",children:n?"Review and approve role requests for your department(s)":"Manage team members, department heads, and project settings"})]}),(0,a.jsxs)("div",{className:"flex gap-2 mb-8 border-b border-[rgb(var(--border-default))]",children:[d&&(0,a.jsx)("button",{onClick:()=>m("team"),className:"px-6 py-3 font-medium transition-all border-b-2 ".concat("team"===c?"border-[rgb(var(--accent-primary))] text-[rgb(var(--accent-primary))]":"border-transparent text-text-secondary hover:text-text-primary"),children:"Team Management"}),d&&(0,a.jsx)("button",{onClick:()=>m("deptHeads"),className:"px-6 py-3 font-medium transition-all border-b-2 ".concat("deptHeads"===c?"border-[rgb(var(--accent-primary))] text-[rgb(var(--accent-primary))]":"border-transparent text-text-secondary hover:text-text-primary"),children:"Department Heads"}),(0,a.jsxs)("button",{onClick:()=>m("roleRequests"),className:"px-6 py-3 font-medium transition-all border-b-2 relative ".concat("roleRequests"===c?"border-[rgb(var(--accent-primary))] text-[rgb(var(--accent-primary))]":"border-transparent text-text-secondary hover:text-text-primary"),children:["Role Requests",g&&g.count>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 px-2 py-0.5 rounded-full bg-yellow-500/20 text-yellow-400 text-xs font-bold",children:g.count})]}),d&&(0,a.jsx)("button",{onClick:()=>m("settings"),className:"px-6 py-3 font-medium transition-all border-b-2 ".concat("settings"===c?"border-[rgb(var(--accent-primary))] text-[rgb(var(--accent-primary))]":"border-transparent text-text-secondary hover:text-text-primary"),children:"Project Settings"})]}),(0,a.jsxs)("div",{children:["team"===c&&(0,a.jsx)(eJ,{members:x,crewMembers:h,projectId:t}),"deptHeads"===c&&(0,a.jsx)(eZ,{projectId:t,departments:y,departmentHeads:p,activeMembers:v}),"roleRequests"===c&&(0,a.jsx)(e2,{projectId:t,roleRequests:b,userRole:r,departmentHeads:p}),"settings"===c&&(0,a.jsx)(e0,{project:u,projectId:t})]})]})}function eJ(e){let{members:t,crewMembers:r,projectId:s}=e,n=e=>{switch(e){case"owner":return"Owner";case"admin":return"Admin";case"dept_head":return"Department Head";case"crew":return"Crew Member";default:return e.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())}},[l,d]=(0,i.useState)(!1),[c,m]=(0,i.useState)(""),[u,x]=(0,i.useState)("crew"),p=o.i.useUtils(),h=o.i.projectMembers.addMember.useMutation({onSuccess:()=>{p.projectMembers.listByProject.invalidate({projectId:s}),d(!1),m(""),x("crew"),alert("Invitation sent successfully!")},onError:e=>{console.error("Invite error:",e),alert("Failed to invite member: ".concat(e.message))}}),b=o.i.projectMembers.updateRole.useMutation({onSuccess:()=>{p.projectMembers.listByProject.invalidate({projectId:s})},onError:e=>{console.error("Update role error:",e),alert("Failed to update role: ".concat(e.message))}}),g=o.i.projectMembers.removeMember.useMutation({onSuccess:()=>{p.projectMembers.listByProject.invalidate({projectId:s})}}),y=o.i.crew.backfillCrewCards.useMutation({onSuccess:e=>{p.crew.listByProject.invalidate({projectId:s});let t=[];e.created>0&&t.push("Created ".concat(e.created," new crew card").concat(1!==e.created?"s":"")),e.linked>0&&t.push("Linked ".concat(e.linked," existing crew card").concat(1!==e.linked?"s":""," to users")),e.skipped>0&&t.push("".concat(e.skipped," member").concat(1!==e.skipped?"s":""," already had crew cards")),alert(t.length>0?t.join(", "):"No changes needed")}}),v=o.i.projectMembers.inviteFromCrewCards.useMutation({onSuccess:e=>{p.projectMembers.listByProject.invalidate({projectId:s}),p.crew.listByProject.invalidate({projectId:s}),alert("Sent ".concat(e.invited," invitation").concat(1!==e.invited?"s":"").concat(e.skipped>0?", ".concat(e.skipped," skipped"):""))},onError:e=>{console.error("Invite from crew cards error:",e),alert("Failed to send invitations: ".concat(e.message))}}),j=o.i.projectMembers.activateMember.useMutation({onSuccess:()=>{p.projectMembers.listByProject.invalidate({projectId:s}),p.crew.listByProject.invalidate({projectId:s})}}),f=o.i.projectMembers.activateAllPending.useMutation({onSuccess:e=>{p.projectMembers.listByProject.invalidate({projectId:s}),p.crew.listByProject.invalidate({projectId:s}),alert("Activated ".concat(e.activated," member(s)").concat(e.skipped>0?". ".concat(e.skipped," skipped."):""))},onError:e=>{alert("Failed to activate members: ".concat(e.message))}}),N=o.i.projectMembers.migrateLegacyRoles.useMutation({onSuccess:e=>{p.projectMembers.listByProject.invalidate({projectId:s}),alert("Migrated ".concat(e.migratedCount," users from old role system to new system"))}});return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary",children:"Team Members"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>{confirm("Migrate users with old roles (editor/viewer) to the new role system?")&&N.mutate({projectId:s})},disabled:N.isPending,className:"px-4 py-2 bg-purple-500/20 text-purple-400 rounded-lg hover:bg-purple-500/30 transition-colors disabled:opacity-50",children:N.isPending?"Migrating...":"⚡ Migrate Roles"}),(0,a.jsx)("button",{onClick:()=>{confirm("Create crew cards for all team members who don't have one yet?")&&y.mutate({projectId:s})},disabled:y.isPending,className:"px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors disabled:opacity-50",children:y.isPending?"Creating...":"\uD83D\uDD04 Sync Crew Cards"}),(0,a.jsx)("button",{onClick:()=>d(!l),className:"px-4 py-2 bg-[rgb(var(--accent-primary))] rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors",style:{color:"rgb(var(--colored-button-text))"},children:l?"✕ Cancel":"+ Invite Member"})]})]}),l&&(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Invite Team Member"}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!c)return void alert("Please enter an email address");h.mutate({projectId:s,userEmail:c,role:u})},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email Address *"}),(0,a.jsx)("input",{type:"email",value:c,onChange:e=>m(e.target.value),placeholder:"teammate@example.com",className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Project Role *"}),(0,a.jsxs)("select",{value:u,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[(0,a.jsx)("option",{value:"crew",children:"Crew Member"}),(0,a.jsx)("option",{value:"dept_head",children:"Department Head"}),(0,a.jsx)("option",{value:"admin",children:"Admin"})]}),(0,a.jsxs)("p",{className:"text-xs text-text-tertiary mt-1",children:[(0,a.jsx)("strong",{children:"Crew Member:"})," Can view and create/update their own crew, cast, equipment, and location entries. ",(0,a.jsx)("strong",{children:"Department Head:"})," Can manage their assigned departments and all items within those departments. ",(0,a.jsx)("strong",{children:"Admin:"})," Can manage the entire project including team members and settings."]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{d(!1),m(""),x("crew")},className:"px-4 py-2 bg-background-tertiary text-text-primary rounded-lg hover:bg-background-secondary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:h.isPending,className:"px-4 py-2 bg-[rgb(var(--accent-primary))] rounded-lg hover:bg-[rgb(var(--accent-hover))] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"rgb(var(--colored-button-text))"},children:h.isPending?"Sending...":"Send Invitation"})]})]})]}),(()=>{let e=t.filter(e=>"pending"===e.status);return e.length>0?(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:[e.length," pending invitation",1!==e.length?"s":""]}),(0,a.jsx)("button",{onClick:()=>{confirm("Activate all ".concat(e.length," pending invitation").concat(1!==e.length?"s":"","? This will link their existing crew cards or create new ones if needed."))&&f.mutate({projectId:s})},disabled:f.isPending,className:"px-4 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:f.isPending?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-400"}),"Activating..."]}):(0,a.jsxs)(a.Fragment,{children:["✓ Activate All (",e.length,")"]})})]}):null})(),(0,a.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("div",{className:"text-lg font-medium text-text-primary",children:e.userName}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((e=>{switch(e){case"owner":return"bg-purple-500/20 text-purple-400";case"admin":return"bg-blue-500/20 text-blue-400";case"dept_head":return"bg-green-500/20 text-green-400";case"crew":return"bg-cyan-500/20 text-cyan-400";default:return"bg-gray-500/20 text-gray-400"}})(e.role)),children:n(e.role)}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((e=>{switch(e){case"active":return"bg-green-500/20 text-green-400";case"pending":return"bg-yellow-500/20 text-yellow-400";case"declined":return"bg-red-500/20 text-red-400";default:return"bg-gray-500/20 text-gray-400"}})(e.status)),children:e.status})]}),(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:e.userEmail})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["pending"===e.status&&(0,a.jsx)("button",{onClick:()=>{confirm("Manually activate ".concat(e.userName,"? This will link their existing crew card or create one if needed."))&&j.mutate({memberId:e.id,projectId:s})},className:"px-3 py-1 bg-green-500/20 text-green-400 rounded hover:bg-green-500/30 transition-colors text-sm",children:"Activate"}),"owner"!==e.role&&"active"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("select",{value:e.role,onChange:t=>{let r=t.target.value;confirm("Change ".concat(e.userName,"'s role to ").concat(n(r),"?"))&&b.mutate({id:e.id,role:r})},className:"px-3 py-1 bg-background-tertiary border border-border-default rounded text-sm text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[(0,a.jsx)("option",{value:"crew",children:"Crew Member"}),(0,a.jsx)("option",{value:"dept_head",children:"Department Head"}),(0,a.jsx)("option",{value:"admin",children:"Admin"})]}),(0,a.jsx)("button",{onClick:()=>{confirm("Remove ".concat(e.userName," from the project?"))&&g.mutate({id:e.id})},className:"px-3 py-1 bg-red-500/20 text-red-400 rounded hover:bg-red-500/30 transition-colors text-sm",children:"Remove"})]}),"owner"===e.role&&(0,a.jsx)("span",{className:"text-xs text-text-tertiary",children:"Project Owner"})]})]},e.id))}),0===t.length&&(0,a.jsx)("div",{className:"text-center py-12 text-text-secondary",children:"No team members yet"}),(()=>{let e=new Set(t.map(e=>{var t;return null==(t=e.userEmail)?void 0:t.toLowerCase()}).filter(Boolean)),n=r.filter(t=>!t.userId&&t.email&&t.email.trim()&&!e.has(t.email.toLowerCase()));return 0===n.length?null:(0,a.jsxs)("div",{className:"mt-8 pt-8 border-t border-[rgb(var(--border-default))]",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"Invite Crew Members as Team Members"}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary",children:[n.length," crew member",1!==n.length?"s":""," without team accounts"]})]}),(0,a.jsx)("button",{onClick:()=>{confirm("Send invitations to all ".concat(n.length," crew members?"))&&v.mutate({projectId:s})},disabled:v.isPending,className:"px-4 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors disabled:opacity-50 text-sm font-medium",children:v.isPending?"Sending...":"\uD83D\uDCE7 Invite All (".concat(n.length,")")})]}),(0,a.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:n.map(e=>(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-text-primary",children:e.name}),(0,a.jsxs)("span",{className:"px-2 py-0.5 rounded text-xs font-medium bg-cyan-500/20 text-cyan-400",children:[e.department," • ",e.role]})]}),(0,a.jsx)("div",{className:"text-xs text-text-secondary",children:e.email})]}),(0,a.jsx)("button",{onClick:()=>{confirm("Send invitation to ".concat(e.name," (").concat(e.email,")?"))&&v.mutate({projectId:s,crewMemberIds:[e.id]})},disabled:v.isPending,className:"px-3 py-1 bg-green-500/20 text-green-400 rounded hover:bg-green-500/30 transition-colors disabled:opacity-50 text-xs font-medium",children:"Invite"})]},e.id))})]})})()]})}function eZ(e){let{projectId:t,departments:r,departmentHeads:s,activeMembers:n}=e,l=o.i.useUtils(),i=o.i.departmentHeads.assign.useMutation({onSuccess:()=>{l.departmentHeads.listByProject.invalidate({projectId:t}),l.projectMembers.listByProject.invalidate({projectId:t})}}),d=o.i.departmentHeads.remove.useMutation({onSuccess:()=>{console.log("Department head removed successfully, refreshing data..."),l.departmentHeads.listByProject.invalidate({projectId:t}),l.projectMembers.listByProject.invalidate({projectId:t})},onError:e=>{console.error("Remove department head error:",e),alert("Failed to remove department head: ".concat(e.message))}}),c=e=>s.filter(t=>t.department===e);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Department Heads"}),(0,a.jsx)("p",{className:"text-text-secondary text-sm",children:"Assign department heads who can manage their departments and approve role requests"})]}),r.map(e=>{let r=c(e),s=(e=>{let t=c(e);return n.filter(e=>!t.some(t=>t.userId===e.userId))})(e);return(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4 capitalize",children:e.replace("_"," ")}),r.length>0&&(0,a.jsxs)("div",{className:"mb-4 space-y-2",children:[(0,a.jsx)("div",{className:"text-sm text-text-tertiary mb-2",children:"Current Heads:"}),r.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between bg-[rgb(var(--background-tertiary))] rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC64"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-text-primary",children:e.userName}),(0,a.jsxs)("div",{className:"text-xs text-text-tertiary",children:["Assigned ",new Date(e.assignedAt).toLocaleDateString()]})]})]}),(0,a.jsx)("button",{onClick:()=>{confirm("Remove ".concat(e.userName," as department head?"))&&d.mutate({id:e.id})},disabled:d.isPending,className:"px-3 py-1 bg-red-500/20 text-red-400 rounded hover:bg-red-500/30 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:d.isPending?"Removing...":"Remove"})]},e.id))]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-text-secondary mb-2",children:"Assign New Head:"}),(0,a.jsxs)("select",{onChange:r=>{if(r.target.value){let a=n.find(e=>e.userId===r.target.value);a&&(i.mutate({projectId:t,department:e,userId:a.userId,userName:a.userName}),r.target.value="")}},className:"w-full bg-[rgb(var(--background-tertiary))] border border-[rgb(var(--border-default))] rounded-lg px-4 py-2 text-text-primary",children:[(0,a.jsx)("option",{value:"",children:"Select team member..."}),s.map(e=>(0,a.jsxs)("option",{value:e.userId,children:[e.userName," (",e.userEmail,")"]},e.id))]}),0===s.length&&(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-2",children:"All team members are already assigned as heads of this department"})]})]},e)}),0===r.length&&(0,a.jsx)("div",{className:"text-center py-12 text-text-secondary",children:"No departments found. Add crew members to create departments."})]})}function e0(e){var t,s;let{project:n,projectId:l}=e,[d,c]=(0,i.useState)(!1),[m,u]=(0,i.useState)(!1),[x,p]=(0,i.useState)(null),[h,b]=(0,i.useState)((null==n?void 0:n.coverImageUrl)||null),g=o.i.useUtils(),y=o.i.projects.update.useMutation({onSuccess:()=>{g.projects.getById.invalidate({id:l}),c(!1),p(null)}}),[v,j]=(0,i.useState)({title:(null==n?void 0:n.title)||"",client:(null==n?void 0:n.client)||"",description:(null==n?void 0:n.description)||"",startDate:(null==n?void 0:n.startDate)?new Date(n.startDate).toISOString().split("T")[0]:"",endDate:(null==n?void 0:n.endDate)?new Date(n.endDate).toISOString().split("T")[0]:"",status:(null==n?void 0:n.status)||"planning",budget:(null==n||null==(t=n.budget)?void 0:t.toString())||"",coverImageUrl:(null==n?void 0:n.coverImageUrl)||""});(0,i.useEffect)(()=>{if(n){var e;j({title:n.title||"",client:n.client||"",description:n.description||"",startDate:n.startDate?new Date(n.startDate).toISOString().split("T")[0]:"",endDate:n.endDate?new Date(n.endDate).toISOString().split("T")[0]:"",status:n.status||"planning",budget:(null==(e=n.budget)?void 0:e.toString())||"",coverImageUrl:n.coverImageUrl||""}),b(n.coverImageUrl||null)}},[n]);let f=async e=>{e.preventDefault();try{let e=v.coverImageUrl,t=null==n?void 0:n.coverImageUrl;if(x){u(!0);let{uploadImage:a,generateUniqueFilename:s,deleteImage:n,isBlobUrl:o}=await Promise.resolve().then(r.bind(r,7767)),i=s(x.name),d="projects/".concat(l,"/").concat(i);e=await a(x,d),u(!1),t&&!o(t)&&await n(t)}await y.mutateAsync({id:l,data:{title:v.title,client:v.client,description:v.description||void 0,startDate:new Date(v.startDate),endDate:new Date(v.endDate),status:v.status,budget:v.budget?parseFloat(v.budget):void 0,coverImageUrl:e||void 0}})}catch(e){console.error("Error updating project:",e),alert("Failed to update project. Please try again."),u(!1)}};return d?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Edit Project"}),(0,a.jsx)("p",{className:"text-text-secondary text-sm",children:"Update project details and preferences"})]}),(0,a.jsxs)("form",{onSubmit:f,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Project Information"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Cover Image"}),(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[h&&(0,a.jsx)("img",{src:h,alt:"Cover preview",className:"w-48 h-32 object-cover rounded-lg border border-border-default"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(r){p(r);let e=new FileReader;e.onloadend=()=>{b(e.result)},e.readAsDataURL(r)}},className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary"}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:"Upload a cover image for your project (recommended: 1920x1080px)"}),h&&(0,a.jsx)("button",{type:"button",onClick:()=>{b(null),p(null),j({...v,coverImageUrl:""})},className:"mt-2 text-sm text-red-500 hover:text-red-400",children:"Remove Image"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Project Name *"}),(0,a.jsx)("input",{type:"text",value:v.title,onChange:e=>j({...v,title:e.target.value}),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Client *"}),(0,a.jsx)("input",{type:"text",value:v.client,onChange:e=>j({...v,client:e.target.value}),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:v.description,onChange:e=>j({...v,description:e.target.value}),rows:4,className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary resize-none",placeholder:"Project description..."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Start Date *"}),(0,a.jsx)("input",{type:"date",value:v.startDate,onChange:e=>j({...v,startDate:e.target.value}),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"End Date *"}),(0,a.jsx)("input",{type:"date",value:v.endDate,onChange:e=>j({...v,endDate:e.target.value}),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Status *"}),(0,a.jsxs)("select",{value:v.status,onChange:e=>j({...v,status:e.target.value}),className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",required:!0,children:[(0,a.jsx)("option",{value:"planning",children:"Planning"}),(0,a.jsx)("option",{value:"pre-production",children:"Pre-Production"}),(0,a.jsx)("option",{value:"production",children:"Production"}),(0,a.jsx)("option",{value:"post-production",children:"Post-Production"}),(0,a.jsx)("option",{value:"completed",children:"Completed"}),(0,a.jsx)("option",{value:"archived",children:"Archived"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Budget"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",value:v.budget,onChange:e=>j({...v,budget:e.target.value}),placeholder:"0.00",className:"w-full px-4 py-2 bg-background-primary border border-border-default rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary"})]})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{if(c(!1),p(null),n){var e;j({title:n.title||"",client:n.client||"",description:n.description||"",startDate:n.startDate?new Date(n.startDate).toISOString().split("T")[0]:"",endDate:n.endDate?new Date(n.endDate).toISOString().split("T")[0]:"",status:n.status||"planning",budget:(null==(e=n.budget)?void 0:e.toString())||"",coverImageUrl:n.coverImageUrl||""}),b(n.coverImageUrl||null)}},className:"px-4 py-2 bg-background-tertiary text-text-primary rounded-lg hover:bg-background-secondary transition-colors",disabled:m||y.isPending,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"rgb(var(--colored-button-text))"},disabled:m||y.isPending,children:m?"Uploading...":y.isPending?"Saving...":"Save Changes"})]})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Project Settings"}),(0,a.jsx)("p",{className:"text-text-secondary text-sm",children:"Configure project details and preferences"})]}),(0,a.jsx)("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors font-medium",style:{color:"rgb(var(--colored-button-text))"},children:"Edit Project"})]}),(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Project Information"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(null==n?void 0:n.coverImageUrl)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-text-secondary mb-2",children:"Cover Image"}),(0,a.jsx)("img",{src:n.coverImageUrl,alt:"Project cover",className:"w-full max-w-md h-48 object-cover rounded-lg border border-border-default"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-text-secondary mb-2",children:"Project Name"}),(0,a.jsx)("div",{className:"text-lg text-text-primary",children:null==n?void 0:n.title})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-text-secondary mb-2",children:"Client"}),(0,a.jsx)("div",{className:"text-lg text-text-primary",children:null==n?void 0:n.client})]}),(null==n?void 0:n.description)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-text-secondary mb-2",children:"Description"}),(0,a.jsx)("div",{className:"text-text-primary",children:n.description})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-text-secondary mb-2",children:"Start Date"}),(0,a.jsx)("div",{className:"text-text-primary",children:(null==n?void 0:n.startDate)?new Date(n.startDate).toLocaleDateString():"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-text-secondary mb-2",children:"End Date"}),(0,a.jsx)("div",{className:"text-text-primary",children:(null==n?void 0:n.endDate)?new Date(n.endDate).toLocaleDateString():"N/A"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-text-secondary mb-2",children:"Status"}),(0,a.jsx)("div",{className:"text-lg text-text-primary capitalize",children:null==n||null==(s=n.status)?void 0:s.replace("-"," ")})]}),(null==n?void 0:n.budget)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-text-secondary mb-2",children:"Budget"}),(0,a.jsxs)("div",{className:"text-lg text-text-primary",children:["$",n.budget.toLocaleString()]})]})]})]}),(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-red-500/50 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-red-400 mb-2",children:"Danger Zone"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-4",children:"Irreversible actions that affect the entire project"}),(0,a.jsx)("button",{className:"px-4 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors",children:"Delete Project"})]})]})}function e2(e){let{projectId:t,roleRequests:r,userRole:s,departmentHeads:n}=e,{firebaseUser:l,user:i}=(0,p.A)(),d=o.i.useUtils(),c=o.i.roleRequests.review.useMutation({onSuccess:()=>{d.roleRequests.listByProject.invalidate({projectId:t}),d.roleRequests.getPendingCount.invalidate({projectId:t}),d.crew.listByProject.invalidate({projectId:t})}}),m=e=>{switch(e){case"pending":return"bg-yellow-500/20 text-yellow-400";case"approved":return"bg-green-500/20 text-green-400";case"denied":return"bg-red-500/20 text-red-400";default:return"bg-gray-500/20 text-gray-400"}},u=r;if("dept_head"===s&&(null==l?void 0:l.uid)){let e=n.filter(e=>e.userId===l.uid).map(e=>e.department);u=r.filter(t=>e.includes(t.requestedDepartment))}let x=u.filter(e=>"pending"===e.status),h=u.filter(e=>"pending"!==e.status);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Role Requests"}),(0,a.jsx)("p",{className:"text-text-secondary text-sm",children:"Review and approve role change requests from crew members"})]}),x.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:["⏳ Pending Requests (",x.length,")"]}),(0,a.jsx)("div",{className:"space-y-3",children:x.map(e=>(0,a.jsxs)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-6",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("span",{className:"text-lg font-semibold text-text-primary",children:e.requesterName}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(m(e.status)),children:e.status})]}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:["Requested ",new Date(e.createdAt).toLocaleString()]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-text-tertiary mb-1",children:"Current Role"}),(0,a.jsxs)("div",{className:"text-sm text-text-primary",children:[(0,a.jsx)("span",{className:"font-medium",children:e.currentRole})," ","in"," ",(0,a.jsx)("span",{className:"font-medium capitalize",children:e.currentDepartment.replace("_"," ")})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-text-tertiary mb-1",children:"Requested Role"}),(0,a.jsxs)("div",{className:"text-sm text-accent-primary",children:[(0,a.jsx)("span",{className:"font-medium",children:e.requestedRole})," ","in"," ",(0,a.jsx)("span",{className:"font-medium capitalize",children:e.requestedDepartment.replace("_"," ")})]})]})]}),e.reason&&(0,a.jsxs)("div",{className:"mb-4 p-3 rounded bg-[rgb(var(--background-tertiary))]",children:[(0,a.jsx)("div",{className:"text-xs text-text-tertiary mb-1",children:"Reason"}),(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:e.reason})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>{let t=prompt("Add a note (optional):");c.mutate({requestId:e.id,action:"approve",reviewNote:t||void 0})},disabled:c.isPending,className:"flex-1 px-4 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors font-medium",children:"✓ Approve"}),(0,a.jsx)("button",{onClick:()=>{let t=prompt("Reason for denial (optional):");c.mutate({requestId:e.id,action:"deny",reviewNote:t||void 0})},disabled:c.isPending,className:"flex-1 px-4 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors font-medium",children:"✗ Deny"})]})]},e.id))})]}),0===x.length&&(0,a.jsx)("div",{className:"text-center py-12 text-text-secondary",children:"No pending role requests"}),h.length>0&&(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:["\uD83D\uDCCB Recent Reviews (",h.length,")"]}),(0,a.jsx)("div",{className:"space-y-3",children:h.map(e=>(0,a.jsx)("div",{className:"bg-[rgb(var(--background-secondary))] border border-[rgb(var(--border-default))] rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,a.jsx)("span",{className:"font-medium text-text-primary",children:e.requesterName}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(m(e.status)),children:e.status})]}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:[e.currentRole," → ",e.requestedRole,e.reviewerName&&" • Reviewed by ".concat(e.reviewerName)]}),e.reviewNote&&(0,a.jsxs)("div",{className:"text-xs text-text-tertiary mt-1 italic",children:["Note: ",e.reviewNote]})]}),(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:e.reviewedAt&&new Date(e.reviewedAt).toLocaleDateString()})]})},e.id))})]})]})}function e1(e){let{projectId:t}=e,{schedule:r,isLoading:s}=eD(t),{data:n}=o.i.projects.getById.useQuery({id:t}),[l,d]=(0,i.useState)(null),[c,m]=(0,i.useState)(!1);return s?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary"})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary mb-2",children:"Call Sheets"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"View and manage call sheets for all shooting days"})]}),(null==r?void 0:r.days.length)===0?(0,a.jsxs)("div",{className:"text-center py-12 bg-background-primary border border-border-default rounded-lg",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"No Shooting Days Scheduled"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:"Create shooting days in the Schedule tab to generate call sheets."})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:null==r?void 0:r.days.map((e,t)=>{let s=r.events.filter(t=>t.shootingDayId===e.id),n=new Set(s.map(e=>e.sceneId).filter(Boolean)).size;return(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6 hover:border-accent-primary transition-colors cursor-pointer",onClick:()=>{d(e.id),m(!0)},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-semibold text-accent-primary uppercase tracking-wider mb-1",children:["Day ",t+1]}),(0,a.jsx)("h3",{className:"text-xl font-bold text-text-primary mb-1",children:e.date.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),e.callTime&&(0,a.jsxs)("p",{className:"text-sm text-text-secondary",children:["Call Time: ",e.callTime]})]}),(0,a.jsx)("svg",{className:"w-6 h-6 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm text-text-secondary",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsxs)("span",{children:[s.length," event",1!==s.length?"s":""]})]}),n>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,a.jsxs)("span",{children:[n," scene",1!==n?"s":""]})]}),e.location&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,a.jsx)("span",{className:"truncate",children:e.location})]})]}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-border-default",children:(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),d(e.id),m(!0)},className:"w-full px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-hover transition-colors font-medium",style:{color:"rgb(var(--colored-button-text))"},children:"View Call Sheet"})})]},e.id)})}),l&&(0,a.jsx)(eq,{projectId:t,shootingDayId:l,isOpen:c,onClose:()=>{m(!1),d(null)}})]})}function e4(e){let{projectId:t,onClose:r}=e,{data:s=[],isLoading:n}=o.i.locationTemplates.getAll.useQuery(),l=o.i.useUtils(),[d,c]=(0,i.useState)(null),[m,u]=(0,i.useState)(!0),[x,p]=(0,i.useState)(!1),h=o.i.locationTemplates.applyTemplate.useMutation({onSuccess:e=>{l.locations.listByProject.invalidate({projectId:t}),alert("Template applied successfully! Created ".concat(e.locationsCreated," locations.").concat(e.locationsSkipped>0?" Skipped ".concat(e.locationsSkipped," existing locations."):"")),r()},onError:e=>{alert("Failed to apply template: ".concat(e.message))}}),b=async()=>{d&&await h.mutateAsync({projectId:t,templateId:d,skipExisting:m,overwriteExisting:x})},g=s.find(e=>e.id===d);return n?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary mx-auto"})})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Apply Location Template"}),(0,a.jsx)("button",{onClick:r,className:"text-text-secondary hover:text-text-primary transition-colors",children:"✕"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:s.map(e=>(0,a.jsxs)("div",{onClick:()=>c(e.id),className:"p-4 border rounded-lg cursor-pointer transition-all ".concat(d===e.id?"border-accent-primary bg-accent-primary/10":"border-border-default hover:border-accent-primary/50"),children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-text-tertiary",children:[(0,a.jsx)("span",{className:"px-2 py-1 bg-background-secondary rounded",children:e.type}),(0,a.jsxs)("span",{children:[e.locations.length," locations"]})]})]},e.id))}),g&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary mb-3",children:"Template Preview"}),(0,a.jsx)("div",{className:"bg-background-secondary border border-border-default rounded-lg p-4 max-h-64 overflow-y-auto",children:(0,a.jsx)("div",{className:"space-y-2",children:g.locations.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-background-primary rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-text-primary",children:e.name}),(0,a.jsxs)("span",{className:"text-sm text-text-secondary ml-2 capitalize",children:["(",e.type,")"]}),e.quantity>1&&(0,a.jsxs)("span",{className:"text-text-tertiary ml-1",children:["(\xd7",e.quantity,")"]})]}),e.required&&(0,a.jsx)("span",{className:"text-accent-primary text-xs",children:"Required"})]},t))})})]}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"skipExisting",checked:m,onChange:e=>{u(e.target.checked),e.target.checked&&p(!1)},className:"w-4 h-4"}),(0,a.jsx)("label",{htmlFor:"skipExisting",className:"text-sm text-text-primary",children:"Skip existing locations (don't create duplicates)"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"overwriteExisting",checked:x,onChange:e=>{p(e.target.checked),e.target.checked&&u(!1)},className:"w-4 h-4"}),(0,a.jsx)("label",{htmlFor:"overwriteExisting",className:"text-sm text-text-primary",children:"Overwrite existing locations (update existing locations)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 border border-border-default rounded-lg hover:bg-background-secondary transition-colors text-text-primary",children:"Cancel"}),(0,a.jsx)("button",{onClick:b,disabled:!d||h.isPending,className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"rgb(var(--colored-button-text))"},children:h.isPending?"Applying...":"Apply Template"})]})]})})}let e3=[{value:"interior",label:"Interior"},{value:"exterior",label:"Exterior"},{value:"studio",label:"Studio"},{value:"outdoor",label:"Outdoor"},{value:"indoor",label:"Indoor"},{value:"other",label:"Other"}],e5=[{value:"scouted",label:"Scouted",color:"bg-blue-500/20 text-blue-400"},{value:"confirmed",label:"Confirmed",color:"bg-green-500/20 text-green-400"},{value:"pending",label:"Pending",color:"bg-yellow-500/20 text-yellow-400"},{value:"rejected",label:"Rejected",color:"bg-red-500/20 text-red-400"},{value:"backup",label:"Backup",color:"bg-gray-500/20 text-gray-400"}];function e6(e){let{projectId:t}=e,{firebaseUser:r}=(0,p.A)(),{data:s}=(0,eN.aN)(t),n="owner"===s||"admin"===s||"dept_head"===s||"crew"===s,l=o.i.useUtils(),{data:d=[],isLoading:c,error:m,refetch:u}=o.i.locations.listByProject.useQuery({projectId:t}),x=o.i.budget.createFromLocations.useMutation({onSuccess:()=>{l.budget.getBudget.invalidate({projectId:t}),alert("Budget items created successfully!")}}),[b,g]=(0,i.useState)(!1),[y,v]=(0,i.useState)(null),[j,f]=(0,i.useState)(null),[N,k]=(0,i.useState)(null),[w,C]=(0,i.useState)(!1),[S,D]=(0,i.useState)(null),[I,L]=(0,i.useState)("list"),[A,M]=(0,i.useState)("grid"),[P,q]=(0,i.useState)(new Set),[B,Y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if("map"===I&&d.length>0&&!S){let e=setTimeout(()=>{D(d[0])},0);return()=>clearTimeout(e)}},[I,d,S]);let[R,E]=(0,i.useState)({name:"",address:"",city:"",state:"",zipCode:"",country:"",latitude:"",longitude:"",type:"interior",status:"scouted",contactName:"",contactPhone:"",contactEmail:"",notes:"",photoUrl:"",parkingInfo:"",accessInfo:"",restrictions:"",permitRequired:!1,permitInfo:"",rentalCost:""}),T=o.i.locations.create.useMutation({onSuccess:()=>{l.locations.listByProject.invalidate({projectId:t}),W(),g(!1)}}),U=o.i.locations.update.useMutation({onSuccess:()=>{l.locations.listByProject.invalidate({projectId:t}),W(),v(null)}}),z=o.i.locations.delete.useMutation({onSuccess:()=>{l.locations.listByProject.invalidate({projectId:t})}}),F=o.i.locations.delete.useMutation({onSuccess:()=>{l.locations.listByProject.invalidate({projectId:t}),q(new Set)}}),O=e=>{let t=new Set(P);t.has(e)?t.delete(e):t.add(e),q(t)},W=()=>{E({name:"",address:"",city:"",state:"",zipCode:"",country:"",latitude:"",longitude:"",type:"interior",status:"scouted",contactName:"",contactPhone:"",contactEmail:"",notes:"",photoUrl:"",parkingInfo:"",accessInfo:"",restrictions:"",permitRequired:!1,permitInfo:"",rentalCost:""}),f(null),k(null)},V=e=>{var t,r,a;v(e),E({name:e.name,address:e.address,city:e.city||"",state:e.state||"",zipCode:e.zipCode||"",country:e.country||"",latitude:(null==(t=e.latitude)?void 0:t.toString())||"",longitude:(null==(r=e.longitude)?void 0:r.toString())||"",type:e.type,status:e.status,contactName:e.contactName||"",contactPhone:e.contactPhone||"",contactEmail:e.contactEmail||"",notes:e.notes||"",photoUrl:e.photoUrl||"",parkingInfo:e.parkingInfo||"",accessInfo:e.accessInfo||"",restrictions:e.restrictions||"",permitRequired:e.permitRequired||!1,permitInfo:e.permitInfo||"",rentalCost:(null==(a=e.rentalCost)?void 0:a.toString())||""}),f(e.photoUrl||null),k(null),g(!0)},H=async e=>{if(!e.type.startsWith("image/"))return void alert("Please upload an image file");let t=URL.createObjectURL(e);f(t),k(e),E({...R,photoUrl:t})},_=async e=>{if(e.preventDefault(),!r||!r.uid)return void alert("Please wait for authentication to complete");let a=R.photoUrl;if(j&&(0,h.isBlobUrl)(j)&&N){C(!0);try{let e=(0,h.generateUniqueFilename)(N.name),r="locations/".concat(t,"/").concat(e);a=await (0,h.uploadImage)(N,r)}catch(e){console.error("Error uploading image:",e),alert("Failed to upload image"),C(!1);return}C(!1)}let s={projectId:t,name:R.name,address:R.address,city:R.city||void 0,state:R.state||void 0,zipCode:R.zipCode||void 0,country:R.country||void 0,latitude:R.latitude?parseFloat(R.latitude):void 0,longitude:R.longitude?parseFloat(R.longitude):void 0,type:R.type,status:R.status,contactName:R.contactName||void 0,contactPhone:R.contactPhone||void 0,contactEmail:R.contactEmail||void 0,notes:R.notes||void 0,photoUrl:a||void 0,parkingInfo:R.parkingInfo||void 0,accessInfo:R.accessInfo||void 0,restrictions:R.restrictions||void 0,permitRequired:R.permitRequired,permitInfo:R.permitInfo||void 0,rentalCost:R.rentalCost?parseFloat(R.rentalCost):void 0,createdBy:r.uid};if(y){if(y.photoUrl&&(0,h.G)(y.photoUrl)&&a!==y.photoUrl)try{await (0,h.deleteImage)(y.photoUrl)}catch(e){console.error("Error deleting old image:",e)}await U.mutateAsync({id:y.id,...s})}else await T.mutateAsync(s)},Q=async()=>{if(!R.address)return void alert("Please enter an address first");let e=[R.address,R.city,R.state,R.zipCode,R.country].filter(Boolean).join(", ");try{let t=await fetch("/api/geocode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:e})}),r=await t.json();if(r.error)return void alert(r.error);r.latitude&&r.longitude?E({...R,latitude:parseFloat(r.latitude).toFixed(6),longitude:parseFloat(r.longitude).toFixed(6)}):alert("Could not find coordinates for this address")}catch(e){console.error("Geocoding error:",e),alert("Failed to geocode address. Please check your Google Maps API key configuration.")}},$=e=>{if(e.latitude&&e.longitude)return"https://www.google.com/maps?q=".concat(e.latitude,",").concat(e.longitude);let t=[e.address,e.city,e.state,e.zipCode,e.country].filter(Boolean).join(", ");return"https://www.google.com/maps/search/?api=1&query=".concat(encodeURIComponent(t))};return c?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary"})}):m?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"⚠️"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2 text-text-primary",children:"Error Loading Locations"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:m.message}),(0,a.jsx)("button",{onClick:()=>u(),className:"btn-primary",children:"Try Again"})]})}):(0,a.jsxs)("div",{className:"p-8 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Locations"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"Manage filming locations for your project"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex bg-background-secondary border border-border-default",children:[(0,a.jsx)("button",{onClick:()=>L("list"),className:"px-4 py-2 text-sm font-medium transition-colors ".concat("list"===I?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"list"===I?{color:"rgb(var(--colored-button-text))"}:void 0,children:"List"}),(0,a.jsx)("button",{onClick:()=>L("map"),className:"px-4 py-2 text-sm font-medium transition-colors ".concat("map"===I?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"map"===I?{color:"rgb(var(--colored-button-text))"}:void 0,children:"Map"})]}),"list"===I&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 border border-border-default rounded-lg p-1 bg-background-secondary",children:[(0,a.jsx)("button",{onClick:()=>M("grid"),className:"px-3 py-1 rounded transition-colors ".concat("grid"===A?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"grid"===A?{color:"rgb(var(--colored-button-text))"}:void 0,title:"Grid View",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),(0,a.jsx)("button",{onClick:()=>M("list"),className:"px-3 py-1 rounded transition-colors ".concat("list"===A?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"list"===A?{color:"rgb(var(--colored-button-text))"}:void 0,title:"List View",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]}),n&&(0,a.jsx)("button",{className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-text-primary font-medium",onClick:()=>Y(!0),children:"\uD83D\uDCCB Apply Template"})]}),n&&(0,a.jsx)("button",{onClick:()=>{W(),g(!0)},className:"btn-primary",children:"+ Add Location"})]})]}),"list"===I&&P.size>0&&(0,a.jsxs)("div",{className:"bg-accent-primary/10 border border-accent-primary/30 rounded-lg p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"font-semibold text-text-primary",children:[P.size," location",1!==P.size?"s":""," selected"]}),(0,a.jsx)("button",{onClick:()=>{P.size===d.length?q(new Set):q(new Set(d.map(e=>e.id)))},className:"text-sm text-accent-primary hover:underline",children:P.size===d.length?"Deselect All":"Select All"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{if(0===P.size)return;let e=Array.from(P);x.mutate({projectId:t,locationIds:e}),q(new Set)},className:"px-4 py-2 bg-accent-primary rounded-lg hover:bg-accent-primary/90 transition-colors text-sm font-medium",style:{color:"rgb(var(--colored-button-text))"},disabled:x.isPending,children:x.isPending?"Creating...":"\uD83D\uDCB0 Create Budget Items"}),(0,a.jsx)("button",{onClick:()=>{0!==P.size&&confirm("Are you sure you want to delete ".concat(P.size," location(s)?"))&&Promise.all(Array.from(P).map(e=>F.mutateAsync({id:e}))).then(()=>{q(new Set)})},className:"px-4 py-2 bg-error text-white rounded-lg hover:bg-error/90 transition-colors text-sm font-medium",disabled:F.isPending,children:F.isPending?"Deleting...":"\uD83D\uDDD1️ Delete Selected"})]}),(0,a.jsx)("button",{onClick:()=>q(new Set),className:"px-4 py-2 bg-background-secondary border border-border-default rounded-lg hover:bg-background-tertiary transition-colors text-text-primary text-sm font-medium",children:"Cancel"})]})]}),"map"===I&&(0,a.jsx)("div",{className:"bg-background-primary border border-border-default",style:{height:"600px"},children:0===d.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDDFA️"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"No locations to display on map"})]})}):(0,a.jsxs)("div",{className:"grid grid-cols-2 h-full",children:[(0,a.jsx)("div",{className:"border-r border-border-default overflow-y-auto",children:d.map(e=>{var t,r;return(0,a.jsx)("div",{onClick:()=>D(e),className:"p-4 border-b border-border-default cursor-pointer hover:bg-accent-primary/5 transition-colors ".concat((null==S?void 0:S.id)===e.id?"bg-accent-primary/10":""),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mt-1",children:e.address}),e.city&&(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:[e.city,e.state,e.zipCode].filter(Boolean).join(", ")})]}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat((null==(t=e5.find(t=>t.value===e.status))?void 0:t.color)||""),children:null==(r=e5.find(t=>t.value===e.status))?void 0:r.label})]})},e.id)})}),(0,a.jsx)("div",{className:"relative bg-background-secondary",children:S?(0,a.jsx)("iframe",{width:"100%",height:"100%",style:{border:0},src:(e=>{let t=[e.address,e.city,e.state,e.zipCode,e.country].filter(Boolean).join(", "),r=new URLSearchParams;return e.latitude&&e.longitude&&(r.set("lat",e.latitude.toString()),r.set("lng",e.longitude.toString())),t&&r.set("address",t),e.name&&r.set("name",e.name),"/api/maps/dark?".concat(r.toString())})(S),allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox",title:"Map view for ".concat(S.name)},S.id):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("p",{className:"text-text-secondary",children:"Select a location to view on map"})})})]})}),"list"===I&&(0,a.jsx)(a.Fragment,{children:"grid"===A?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[d.map(e=>{let r=e5.find(t=>t.value===e.status);return(0,a.jsxs)("div",{id:"element-".concat(e.id),className:"bg-background-primary border border-border-default hover:border-accent-primary transition-colors relative ".concat(P.has(e.id)?"ring-2 ring-accent-primary border-accent-primary":""),children:[n&&(0,a.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,a.jsx)("input",{type:"checkbox",checked:P.has(e.id),onChange:()=>O(e.id),className:"w-5 h-5 rounded border-2 border-accent-primary text-accent-primary focus:ring-2 focus:ring-accent-primary cursor-pointer bg-transparent checked:bg-accent-primary",style:{accentColor:"rgb(var(--accent-primary))"}})}),e.photoUrl&&(0,a.jsx)("div",{className:"aspect-video bg-background-secondary overflow-hidden",children:(0,a.jsx)("img",{src:e.photoUrl,alt:e.name,className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary",children:e.name}),r&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat(r.color),children:r.label})]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-2",children:e.address}),e.city&&(0,a.jsx)("p",{className:"text-xs text-text-tertiary mb-3",children:[e.city,e.state,e.zipCode].filter(Boolean).join(", ")}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-text-secondary mb-3",children:[(0,a.jsx)("span",{className:"capitalize",children:e.type}),e.rentalCost&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:["$",e.rentalCost,"/day"]})]})]}),(0,a.jsx)(e8,{projectId:t,locationId:e.id,canEdit:n,onCreateBudgetItem:()=>{x.mutate({projectId:t,locationIds:[e.id]})},onViewBudget:()=>{window.location.href="/projects/".concat(t,"#budget")}}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.latitude&&e.longitude&&(0,a.jsx)("a",{href:$(e),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-accent-primary hover:underline",children:"View Map"}),n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-text-tertiary",children:"•"}),(0,a.jsx)("button",{onClick:()=>V(e),className:"text-xs text-accent-primary hover:underline",children:"Edit"}),(0,a.jsx)("span",{className:"text-text-tertiary",children:"•"}),(0,a.jsx)("button",{onClick:()=>{confirm("Delete this location?")&&z.mutate({id:e.id})},className:"text-xs text-red-500 hover:underline",children:"Delete"})]})]})]})]},e.id)}),0===d.length&&(0,a.jsxs)("div",{className:"col-span-full text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCCD"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:"No locations added yet"}),n&&(0,a.jsx)("button",{onClick:()=>{W(),g(!0)},className:"btn-primary",children:"Add Your First Location"})]})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[d.map(e=>{let t=e5.find(t=>t.value===e.status);return(0,a.jsxs)("div",{id:"element-".concat(e.id),className:"bg-background-primary border border-border-default rounded-lg p-4 hover:border-accent-primary transition-all flex items-center gap-4 ".concat(P.has(e.id)?"ring-2 ring-accent-primary border-accent-primary bg-accent-primary/5":""),children:[n&&(0,a.jsx)("input",{type:"checkbox",checked:P.has(e.id),onChange:()=>O(e.id),className:"w-5 h-5 rounded border-2 border-accent-primary text-accent-primary focus:ring-2 focus:ring-accent-primary flex-shrink-0 cursor-pointer bg-transparent checked:bg-accent-primary",style:{accentColor:"rgb(var(--accent-primary))"}}),(0,a.jsx)("div",{className:"flex-shrink-0",children:e.photoUrl?(0,a.jsx)("img",{src:e.photoUrl,alt:e.name,className:"w-16 h-16 object-cover rounded-lg"}):(0,a.jsx)("div",{className:"w-16 h-16 bg-background-secondary rounded-lg flex items-center justify-center text-2xl",children:"\uD83D\uDCCD"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary truncate",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-text-secondary truncate",children:e.address}),e.city&&(0,a.jsx)("p",{className:"text-xs text-text-tertiary",children:[e.city,e.state,e.zipCode].filter(Boolean).join(", ")})]}),t&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded ml-2 ".concat(t.color),children:t.label})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[(0,a.jsx)("span",{className:"capitalize",children:e.type}),e.rentalCost&&(0,a.jsxs)("span",{children:["$",e.rentalCost,"/day"]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-shrink-0",children:[e.latitude&&e.longitude&&(0,a.jsx)("a",{href:$(e),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-accent-primary hover:underline",children:"View Map"}),n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>V(e),className:"text-xs text-accent-primary hover:underline",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>{confirm("Delete this location?")&&z.mutate({id:e.id})},className:"text-xs text-red-500 hover:underline",children:"Delete"})]})]})]},e.id)}),0===d.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCCD"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:"No locations added yet"}),n&&(0,a.jsx)("button",{onClick:()=>{W(),g(!0)},className:"btn-primary",children:"Add Your First Location"})]})]})}),b&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-background-primary border border-border-default max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-border-default flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:y?"Edit Location":"Add Location"}),(0,a.jsx)("button",{onClick:()=>{g(!1),W(),v(null)},className:"text-text-secondary hover:text-text-primary",children:"✕"})]}),(0,a.jsxs)("form",{onSubmit:_,className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Name *"}),(0,a.jsx)("input",{type:"text",value:R.name,onChange:e=>E({...R,name:e.target.value}),className:"input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Type *"}),(0,a.jsx)("select",{value:R.type,onChange:e=>E({...R,type:e.target.value}),className:"input-field",required:!0,children:e3.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Status *"}),(0,a.jsx)("select",{value:R.status,onChange:e=>E({...R,status:e.target.value}),className:"input-field",required:!0,children:e5.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Rental Cost (per day)"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:R.rentalCost,onChange:e=>E({...R,rentalCost:e.target.value}),className:"input-field",placeholder:"0.00"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Address *"}),(0,a.jsx)("input",{type:"text",value:R.address,onChange:e=>E({...R,address:e.target.value}),className:"input-field",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"City"}),(0,a.jsx)("input",{type:"text",value:R.city,onChange:e=>E({...R,city:e.target.value}),className:"input-field"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"State"}),(0,a.jsx)("input",{type:"text",value:R.state,onChange:e=>E({...R,state:e.target.value}),className:"input-field"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"ZIP Code"}),(0,a.jsx)("input",{type:"text",value:R.zipCode,onChange:e=>E({...R,zipCode:e.target.value}),className:"input-field"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Country"}),(0,a.jsx)("input",{type:"text",value:R.country,onChange:e=>E({...R,country:e.target.value}),className:"input-field"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Latitude"}),(0,a.jsx)("input",{type:"number",step:"any",value:R.latitude,onChange:e=>E({...R,latitude:e.target.value}),className:"input-field",placeholder:"e.g., 40.7128"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Longitude"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"number",step:"any",value:R.longitude,onChange:e=>E({...R,longitude:e.target.value}),className:"input-field",placeholder:"e.g., -74.0060"}),(0,a.jsx)("button",{type:"button",onClick:Q,className:"px-4 py-2 bg-background-tertiary text-text-primary hover:bg-accent-primary/5 border border-border-default text-sm",title:"Get coordinates from address",children:"\uD83D\uDCCD"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Contact Name"}),(0,a.jsx)("input",{type:"text",value:R.contactName,onChange:e=>E({...R,contactName:e.target.value}),className:"input-field"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Contact Phone"}),(0,a.jsx)("input",{type:"tel",value:R.contactPhone,onChange:e=>E({...R,contactPhone:e.target.value}),className:"input-field"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Contact Email"}),(0,a.jsx)("input",{type:"email",value:R.contactEmail,onChange:e=>E({...R,contactEmail:e.target.value}),className:"input-field"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Photo"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[j&&(0,a.jsxs)("div",{className:"relative w-32 h-32 bg-background-secondary",children:[(0,a.jsx)("img",{src:j,alt:"Preview",className:"w-full h-full object-cover"}),(0,a.jsx)("button",{type:"button",onClick:()=>{f(null),k(null),E({...R,photoUrl:""})},className:"absolute top-1 right-1 bg-red-500 rounded-full w-6 h-6 flex items-center justify-center text-xs",style:{color:"rgb(var(--colored-button-text))"},children:"✕"})]}),(0,a.jsxs)("label",{className:"cursor-pointer",children:[(0,a.jsx)("div",{className:"px-4 py-2 bg-background-tertiary border border-border-default hover:bg-accent-primary/5 text-sm",children:j?"Change Photo":"Upload Photo"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return(null==(t=e.target.files)?void 0:t[0])&&H(e.target.files[0])},className:"hidden"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Parking Info"}),(0,a.jsx)("textarea",{value:R.parkingInfo,onChange:e=>E({...R,parkingInfo:e.target.value}),className:"input-field",rows:2})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Access Info"}),(0,a.jsx)("textarea",{value:R.accessInfo,onChange:e=>E({...R,accessInfo:e.target.value}),className:"input-field",rows:2})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Restrictions"}),(0,a.jsx)("textarea",{value:R.restrictions,onChange:e=>E({...R,restrictions:e.target.value}),className:"input-field",rows:2})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"permitRequired",checked:R.permitRequired,onChange:e=>E({...R,permitRequired:e.target.checked}),className:"w-4 h-4"}),(0,a.jsx)("label",{htmlFor:"permitRequired",className:"text-sm",children:"Permit Required"})]}),R.permitRequired&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Permit Info"}),(0,a.jsx)("textarea",{value:R.permitInfo,onChange:e=>E({...R,permitInfo:e.target.value}),className:"input-field",rows:2})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,a.jsx)("textarea",{value:R.notes,onChange:e=>E({...R,notes:e.target.value}),className:"input-field",rows:4})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-border-default",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{g(!1),W(),v(null)},className:"px-4 py-2 bg-background-tertiary text-text-primary hover:bg-accent-primary/5",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:T.isPending||U.isPending||w,className:"btn-primary",children:w?"Uploading...":y?"Update Location":"Create Location"})]})]})]})}),B&&(0,a.jsx)(e4,{projectId:t,onClose:()=>Y(!1)})]})}function e8(e){let{projectId:t,locationId:r,canEdit:s,onCreateBudgetItem:n,onViewBudget:l}=e,{data:i=[],isLoading:d}=o.i.budget.getItemsByLocation.useQuery({projectId:t,locationId:r});if(d)return(0,a.jsx)("div",{className:"text-xs text-text-tertiary mb-2",children:"Loading budget..."});if(0===i.length)return(0,a.jsx)("div",{className:"pt-2 pb-2 border-t border-border-default mb-2",children:s&&(0,a.jsx)("button",{onClick:n,className:"w-full text-xs px-2 py-1 bg-background-tertiary hover:bg-accent-primary/10 text-accent-primary rounded border border-border-default transition-colors",children:"\uD83D\uDCB0 Create Budget Item"})});let c=i.reduce((e,t)=>e+(t.estimatedAmount||0),0);return(0,a.jsxs)("div",{className:"pt-2 pb-2 border-t border-border-default mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("span",{className:"text-xs font-medium text-text-primary",children:["\uD83D\uDCB0 ",i.length," Budget Item",1!==i.length?"s":""]}),(0,a.jsx)("button",{onClick:l,className:"text-xs text-accent-primary hover:text-accent-hover",children:"View →"})]}),(0,a.jsxs)("div",{className:"text-xs text-text-secondary",children:["Total: $",c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),s&&(0,a.jsx)("button",{onClick:n,className:"mt-1 w-full text-xs px-2 py-1 bg-background-tertiary hover:bg-accent-primary/10 text-accent-primary rounded border border-border-default transition-colors",children:"+ Add Another"})]})}function e7(e){let t=o.i.useUtils(),{data:r=[],isLoading:a,error:s,refetch:n}=o.i.scenes.listByProject.useQuery({projectId:e}),l=(0,i.useMemo)(()=>r.map(e=>({...e,scheduledDate:e.scheduledDate instanceof Date?e.scheduledDate:e.scheduledDate?new Date(e.scheduledDate):void 0,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)})).sort((e,t)=>e.sceneNumber.localeCompare(t.sceneNumber,void 0,{numeric:!0})),[r]),d=o.i.scenes.create.useMutation({onSuccess:()=>{t.scenes.listByProject.invalidate({projectId:e})}}),c=o.i.scenes.update.useMutation({onSuccess:()=>{t.scenes.listByProject.invalidate({projectId:e}),t.scenes.getById.invalidate({id:e})}}),m=o.i.scenes.delete.useMutation({onSuccess:()=>{t.scenes.listByProject.invalidate({projectId:e})}}),u=o.i.scenes.linkToSchedule.useMutation({onSuccess:()=>{t.scenes.listByProject.invalidate({projectId:e}),t.schedule.getSchedule.invalidate({projectId:e})}});return{scenes:l,isLoading:a,error:s,refetch:n,createScene:d,updateScene:c,deleteScene:m,linkToSchedule:u,getScheduleConflicts:o.i.scenes.getScheduleConflicts.useQuery,bulkCreate:o.i.scenes.bulkCreate.useMutation({onSuccess:()=>{t.scenes.listByProject.invalidate({projectId:e})}})}}function e9(e){let t=o.i.useUtils(),{data:r=[],isLoading:a,error:s,refetch:n}=o.i.shots.listByScene.useQuery({sceneId:e}),l=(0,i.useMemo)(()=>r.map(e=>({...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)})),[r]),d=o.i.shots.create.useMutation({onSuccess:()=>{t.shots.listByScene.invalidate({sceneId:e})}}),c=o.i.shots.update.useMutation({onSuccess:()=>{t.shots.listByScene.invalidate({sceneId:e}),t.shots.getById.invalidate({id:e})}}),m=o.i.shots.delete.useMutation({onSuccess:()=>{t.shots.listByScene.invalidate({sceneId:e})}});return{shots:l,isLoading:a,error:s,refetch:n,createShot:d,updateShot:c,deleteShot:m,bulkCreate:o.i.shots.bulkCreate.useMutation({onSuccess:()=>{t.shots.listByScene.invalidate({sceneId:e})}}),markBestTake:o.i.shots.markBestTake.useMutation({onSuccess:()=>{t.shots.listByScene.invalidate({sceneId:e})}})}}function te(e){var t,r;let{scene:s,projectId:n,castMembers:l,crewMembers:d,equipment:c,locations:u,schedule:x,onClose:p,onSave:b}=e,g=o.i.useUtils(),y=o.i.scenes.syncToSchedule.useMutation({onSuccess:e=>{alert(e.message),g.schedule.getSchedule.invalidate({projectId:n})},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),[v,j]=(0,i.useState)({sceneNumber:"",title:"",description:"",pageCount:"",locationIds:[],locationNames:[],imageUrl:"",scriptText:"",scriptPageStart:"",scriptPageEnd:"",status:"not-shot",shootingDayIds:[],scheduledDates:[],estimatedDuration:"",timeOfDay:"",weather:"",mood:"",visualNotes:"",castIds:[],crewIds:[],equipmentIds:[],continuityNotes:"",specialRequirements:"",vfxNotes:"",stuntsRequired:!1}),[f,N]=(0,i.useState)(!1),[k,w]=(0,i.useState)(!1),[C,S]=(0,i.useState)(null),[D,I]=(0,i.useState)(null),[L,A]=(0,i.useState)(!1),M=(0,i.useRef)(null),[P,q]=(0,i.useState)(!1),[B,Y]=(0,i.useState)(!1),[R,E]=(0,i.useState)(!1),[T,U]=(0,i.useState)(!1),[z,F]=(0,i.useState)(!1),[O,W]=(0,i.useState)(""),[V,H]=(0,i.useState)(""),[_,Q]=(0,i.useState)(""),[$,G]=(0,i.useState)(""),[K,X]=(0,i.useState)(""),{data:J}=o.i.scenes.getScheduleConflicts.useQuery({sceneId:(null==s?void 0:s.id)||"new",shootingDayId:v.shootingDayIds[0]||void 0,scheduledDate:v.scheduledDates[0]?new Date(v.scheduledDates[0]):void 0},{enabled:v.shootingDayIds.length>0||v.scheduledDates.length>0});(0,i.useEffect)(()=>{if(s){var e,t,r,a;j({sceneNumber:s.sceneNumber||"",title:s.title||"",description:s.description||"",pageCount:s.pageCount||"",locationIds:s.locationIds||(s.locationId?[s.locationId]:[]),locationNames:s.locationNames||(s.locationName?[s.locationName]:[]),imageUrl:s.imageUrl||"",scriptText:s.scriptText||"",scriptPageStart:(null==(e=s.scriptPageStart)?void 0:e.toString())||"",scriptPageEnd:(null==(t=s.scriptPageEnd)?void 0:t.toString())||"",status:s.status||"not-shot",shootingDayIds:s.shootingDayIds||(s.shootingDayId?[s.shootingDayId]:[]),scheduledDates:(null==(r=s.scheduledDates)?void 0:r.map(e=>{try{let t=e instanceof Date?e:(null==e?void 0:e.toDate)?e.toDate():new Date(e);if(isNaN(t.getTime()))return null;return t.toISOString().split("T")[0]}catch(e){return null}}).filter(e=>null!==e))||[],estimatedDuration:(null==(a=s.estimatedDuration)?void 0:a.toString())||"",timeOfDay:s.timeOfDay||"",weather:s.weather||"",mood:s.mood||"",visualNotes:s.visualNotes||"",castIds:s.castIds||[],crewIds:s.crewIds||[],equipmentIds:s.equipmentIds||[],continuityNotes:s.continuityNotes||"",specialRequirements:s.specialRequirements||"",vfxNotes:s.vfxNotes||"",stuntsRequired:s.stuntsRequired||!1}),I(s.imageUrl||null)}},[s]);let Z=e=>{if(e&&e.type.startsWith("image/")){S(e);let t=URL.createObjectURL(e);I(t),j({...v,imageUrl:t})}},ee=async e=>{e.preventDefault(),N(!0);try{let e=v.imageUrl,t=null==s?void 0:s.imageUrl;if(C){w(!0);let r=(0,h.generateUniqueFilename)(C.name),a="scenes/".concat(n,"/").concat(r);e=await (0,h.uploadImage)(C,a),w(!1),t&&!(0,h.isBlobUrl)(t)&&await (0,h.deleteImage)(t)}let r=v.locationIds.map(e=>{let t=u.find(t=>t.id===e);return(null==t?void 0:t.name)||""}).filter(Boolean),a=v.shootingDayIds.map(e=>{var t;let r=null==x||null==(t=x.days)?void 0:t.find(t=>t.id===e);return r?new Date(r.date):null}).filter(Boolean),l={...v,imageUrl:e||void 0,locationNames:r,scheduledDates:a.length>0?a:void 0,scriptPageStart:v.scriptPageStart?parseInt(v.scriptPageStart):void 0,scriptPageEnd:v.scriptPageEnd?parseInt(v.scriptPageEnd):void 0,estimatedDuration:v.estimatedDuration?parseInt(v.estimatedDuration):void 0};Object.keys(l).forEach(e=>{(""===l[e]||Array.isArray(l[e])&&0===l[e].length)&&delete l[e]}),await b(l)}catch(e){console.error("Error saving scene:",e),alert("Failed to save scene. Please try again.")}finally{N(!1)}},et=l.filter(e=>v.castIds.includes(e.id)),er=d.filter(e=>v.crewIds.includes(e.id)),ea=c.filter(e=>v.equipmentIds.includes(e.id)),es=u.filter(e=>v.locationIds.includes(e.id)),en=(null==x||null==(t=x.days)?void 0:t.filter(e=>v.shootingDayIds.includes(e.id)))||[],el=l.filter(e=>!v.castIds.includes(e.id)),eo=d.filter(e=>!v.crewIds.includes(e.id)),ei=c.filter(e=>!v.equipmentIds.includes(e.id)),ed=u.filter(e=>!v.locationIds.includes(e.id)),ec=el.filter(e=>{var t,r;return(null==(t=e.characterName)?void 0:t.toLowerCase().includes(O.toLowerCase()))||(null==(r=e.actorName)?void 0:r.toLowerCase().includes(O.toLowerCase()))}),em=eo.filter(e=>{var t,r;return(null==(t=e.name)?void 0:t.toLowerCase().includes(V.toLowerCase()))||(null==(r=e.role)?void 0:r.toLowerCase().includes(V.toLowerCase()))}),eu=ei.filter(e=>{var t;return null==(t=e.name)?void 0:t.toLowerCase().includes(_.toLowerCase())}),ex=ed.filter(e=>{var t;return null==(t=e.name)?void 0:t.toLowerCase().includes($.toLowerCase())}),ep=(null==x||null==(r=x.days)?void 0:r.filter(e=>!v.shootingDayIds.includes(e.id)))||[];return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,a.jsxs)("div",{className:"bg-background-primary rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"p-6 border-b border-border-default",children:(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:s?"Edit Scene":"Create Scene"})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)("form",{onSubmit:ee,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Scene Image"}),(0,a.jsxs)("div",{onDragOver:e=>{e.preventDefault(),A(!0)},onDragLeave:e=>{e.preventDefault(),A(!1)},onDrop:e=>{e.preventDefault(),A(!1);let t=e.dataTransfer.files[0];t&&Z(t)},className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors ".concat(L?"border-accent-primary bg-accent-primary/10":"border-border-default hover:border-accent-primary/50"),children:[D?(0,a.jsxs)("div",{className:"relative w-full h-48 mb-4",children:[(0,a.jsx)(m.default,{src:D,alt:"Scene preview",fill:!0,className:"object-cover rounded-lg",sizes:"(max-width: 768px) 100vw, 50vw"}),(0,a.jsx)("button",{type:"button",onClick:()=>{I(null),S(null),j({...v,imageUrl:""}),M.current&&(M.current.value="")},className:"absolute top-2 right-2 p-2 bg-error text-white rounded-full hover:bg-error/80 transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,a.jsxs)("div",{className:"py-8",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-2",children:"Drag and drop an image here, or click to browse"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=M.current)?void 0:e.click()},className:"text-sm text-accent-primary hover:text-accent-hover font-medium",children:"Choose File"})]}),(0,a.jsx)("input",{ref:M,type:"file",accept:"image/*",onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&Z(r)},className:"hidden"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Basic Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Scene Number *"}),(0,a.jsx)("input",{type:"text",required:!0,value:v.sceneNumber,onChange:e=>j({...v,sceneNumber:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Status"}),(0,a.jsxs)("select",{value:v.status,onChange:e=>j({...v,status:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary",children:[(0,a.jsx)("option",{value:"not-shot",children:"Not Shot"}),(0,a.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,a.jsx)("option",{value:"completed",children:"Completed"}),(0,a.jsx)("option",{value:"omitted",children:"Omitted"})]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Title"}),(0,a.jsx)("input",{type:"text",value:v.title,onChange:e=>j({...v,title:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:v.description,onChange:e=>j({...v,description:e.target.value}),rows:3,className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Page Count"}),(0,a.jsx)("input",{type:"text",value:v.pageCount,onChange:e=>j({...v,pageCount:e.target.value}),placeholder:"e.g., 1/8",className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Locations"}),(0,a.jsxs)("div",{className:"space-y-3",children:[es.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:es.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsx)("span",{className:"text-sm text-text-primary",children:e.name}),(0,a.jsx)("button",{type:"button",onClick:()=>(e=>{let t=u.find(t=>t.id===e);j({...v,locationIds:v.locationIds.filter(t=>t!==e),locationNames:v.locationNames.filter(e=>e!==((null==t?void 0:t.name)||""))})})(e.id),className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>U(!T),className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Location"]}),T&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-64 bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search locations...",value:$,onChange:e=>G(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:ex.length>0?ex.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{var t=e.id;if(!v.locationIds.includes(t)){let e=u.find(e=>e.id===t);j({...v,locationIds:[...v.locationIds,t],locationNames:[...v.locationNames,(null==e?void 0:e.name)||""]})}U(!1),G("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:e.name},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Production Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Shooting Days"}),(0,a.jsxs)("div",{className:"space-y-2",children:[en.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:en.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsxs)("span",{className:"text-sm text-text-primary",children:[new Date(e.date).toLocaleDateString()," - Day ",e.dayNumber||""]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void j({...v,shootingDayIds:v.shootingDayIds.filter(e=>e!==t)})},className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>F(!z),className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Shooting Day"]}),z&&ep.length>0&&(0,a.jsx)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-y-auto",children:ep.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{var t;return t=e.id,void(!v.shootingDayIds.includes(t)&&j({...v,shootingDayIds:[...v.shootingDayIds,t]}),F(!1))},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:[new Date(e.date).toLocaleDateString()," - Day ",e.dayNumber||""]},e.id))})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Estimated Duration (minutes)"}),(0,a.jsx)("input",{type:"number",value:v.estimatedDuration,onChange:e=>j({...v,estimatedDuration:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]})]}),J&&(J.crew.length>0||J.cast.length>0||J.equipment.length>0||J.location)&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-error/10 border border-error/30 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-error mb-2",children:"Scheduling Conflicts Detected:"}),(0,a.jsxs)("ul",{className:"text-sm text-text-secondary space-y-1",children:[J.crew.length>0&&(0,a.jsxs)("li",{children:["Crew conflicts: ",J.crew.length," member(s)"]}),J.cast.length>0&&(0,a.jsxs)("li",{children:["Cast conflicts: ",J.cast.length," member(s)"]}),J.equipment.length>0&&(0,a.jsxs)("li",{children:["Equipment conflicts: ",J.equipment.length," item(s)"]}),J.location&&(0,a.jsx)("li",{children:"Location conflict: Already scheduled"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Creative Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Time of Day"}),(0,a.jsxs)("select",{value:v.timeOfDay,onChange:e=>j({...v,timeOfDay:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary",children:[(0,a.jsx)("option",{value:"",children:"Select..."}),(0,a.jsx)("option",{value:"DAY",children:"Day"}),(0,a.jsx)("option",{value:"NIGHT",children:"Night"}),(0,a.jsx)("option",{value:"DAWN",children:"Dawn"}),(0,a.jsx)("option",{value:"DUSK",children:"Dusk"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Weather"}),(0,a.jsx)("input",{type:"text",value:v.weather,onChange:e=>j({...v,weather:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Mood"}),(0,a.jsx)("input",{type:"text",value:v.mood,onChange:e=>j({...v,mood:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Visual Notes"}),(0,a.jsx)("textarea",{value:v.visualNotes,onChange:e=>j({...v,visualNotes:e.target.value}),rows:3,className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Assignments"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Cast"}),(0,a.jsxs)("div",{className:"space-y-2",children:[et.length>0&&(0,a.jsx)("div",{className:"space-y-1",children:et.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsx)("span",{className:"text-sm text-text-primary",children:e.characterName}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void j({...v,castIds:v.castIds.filter(e=>e!==t)})},className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>q(!P),className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Cast"]}),P&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search cast...",value:O,onChange:e=>W(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:ec.length>0?ec.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{var t;t=e.id,v.castIds.includes(t)||j({...v,castIds:[...v.castIds,t]}),q(!1),W("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:[e.characterName," ",e.actorName&&"(".concat(e.actorName,")")]},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Crew"}),(0,a.jsxs)("div",{className:"space-y-2",children:[er.length>0&&(0,a.jsx)("div",{className:"space-y-1",children:er.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsxs)("span",{className:"text-sm text-text-primary",children:[e.name," - ",e.role]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void j({...v,crewIds:v.crewIds.filter(e=>e!==t)})},className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>Y(!B),className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Crew"]}),B&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search crew...",value:V,onChange:e=>H(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:em.length>0?em.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{var t;t=e.id,v.crewIds.includes(t)||j({...v,crewIds:[...v.crewIds,t]}),Y(!1),H("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:[e.name," - ",e.role]},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Equipment"}),(0,a.jsxs)("div",{className:"space-y-2",children:[ea.length>0&&(0,a.jsx)("div",{className:"space-y-1",children:ea.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsx)("span",{className:"text-sm text-text-primary",children:e.name}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void j({...v,equipmentIds:v.equipmentIds.filter(e=>e!==t)})},className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>E(!R),className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Equipment"]}),R&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search equipment...",value:_,onChange:e=>Q(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:eu.length>0?eu.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{var t;t=e.id,v.equipmentIds.includes(t)||j({...v,equipmentIds:[...v.equipmentIds,t]}),E(!1),Q("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:e.name},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Production Details"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:v.stuntsRequired,onChange:e=>j({...v,stuntsRequired:e.target.checked}),className:"rounded"}),(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Stunts Required"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Continuity Notes"}),(0,a.jsx)("textarea",{value:v.continuityNotes,onChange:e=>j({...v,continuityNotes:e.target.value}),rows:3,className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Special Requirements"}),(0,a.jsx)("textarea",{value:v.specialRequirements,onChange:e=>j({...v,specialRequirements:e.target.value}),rows:3,className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"VFX Notes"}),(0,a.jsx)("textarea",{value:v.vfxNotes,onChange:e=>j({...v,vfxNotes:e.target.value}),rows:3,className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]})]})]})]})}),(0,a.jsxs)("div",{className:"p-6 border-t border-border-default flex justify-between items-center",children:[(0,a.jsx)("div",{children:s&&(v.shootingDayIds.length>0||s.shootingDayIds&&s.shootingDayIds.length>0)&&(0,a.jsxs)("button",{type:"button",onClick:()=>{let e=s.id;y.mutate({sceneId:e})},disabled:y.isPending,className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),y.isPending?"Syncing...":"Sync to Schedule"]})}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:p,className:"btn-secondary",disabled:f||k,children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:ee,className:"btn-primary",disabled:f||k,children:f||k?"Saving...":"Save Scene"})]})]})]})})}function tt(e){var t,r;let{scene:s,projectId:n,castMembers:l,crewMembers:i,equipment:d,locations:c,schedule:u,onClose:x,onEdit:p,onNavigate:b,onViewShot:g}=e,y=o.i.useUtils(),{data:v}=o.i.projects.getById.useQuery({id:n}),{shots:j}=e9(s.id),f=eM(null==v?void 0:v.projectType),N=o.i.scenes.syncToSchedule.useMutation({onSuccess:e=>{alert(e.message),y.schedule.getSchedule.invalidate({projectId:n})},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),k=o.i.shots.syncToSchedule.useMutation({onSuccess:e=>{alert(e.message),y.schedule.getSchedule.invalidate({projectId:n})},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),w=(e,t)=>{let r=t?"".concat(e,"?id=").concat(t):e;b?b(r):(window.location.hash=r,setTimeout(()=>{x()},100))},C=s.locationIds||(s.locationId?[s.locationId]:[]),S=c.filter(e=>C.includes(e.id)),D=l.filter(e=>{var t;return null==(t=s.castIds)?void 0:t.includes(e.id)}),I=i.filter(e=>{var t;return null==(t=s.crewIds)?void 0:t.includes(e.id)}),L=d.filter(e=>{var t;return null==(t=s.equipmentIds)?void 0:t.includes(e.id)}),A=s.shootingDayIds||(s.shootingDayId?[s.shootingDayId]:[]),M=(null==u||null==(t=u.days)?void 0:t.filter(e=>A.includes(e.id)))||[],P={"not-shot":"bg-gray-500/10 text-gray-400 border-gray-500/30","in-progress":"bg-blue-500/10 text-blue-400 border-blue-500/30",completed:"bg-green-500/10 text-green-400 border-green-500/30",omitted:"bg-red-500/10 text-red-400 border-red-500/30"};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,a.jsxs)("div",{className:"bg-background-primary rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-border-default flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-text-primary",children:[f.scenes.singular," ",s.sceneNumber]}),(0,a.jsx)("span",{className:"px-3 py-1 text-sm font-semibold rounded capitalize border ".concat(P[s.status]||P["not-shot"]),children:s.status.replace("-"," ")})]}),s.title&&(0,a.jsx)("p",{className:"text-lg text-text-secondary",children:s.title})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[p&&(0,a.jsxs)("button",{onClick:p,className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Edit"]}),(0,a.jsx)("button",{onClick:x,className:"p-2 text-text-secondary hover:text-text-primary hover:bg-background-tertiary rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[s.imageUrl&&(0,a.jsx)("div",{className:"relative w-full h-64 md:h-96 overflow-hidden bg-background-secondary rounded-lg",children:(0,a.jsx)(m.default,{src:s.imageUrl,alt:s.title||"".concat(f.scenes.singular," ").concat(s.sceneNumber),fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 80vw",unoptimized:s.imageUrl.startsWith("blob:")||s.imageUrl.startsWith("data:")||(0,h.G)(s.imageUrl)})}),s.description&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-2",children:"Description"}),(0,a.jsx)("p",{className:"text-text-secondary whitespace-pre-wrap",children:s.description})]}),(s.scriptText||s.pageCount||s.scriptPageStart||s.scriptPageEnd)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:"Script Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.pageCount&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Pages"}),(0,a.jsx)("p",{className:"text-text-primary font-medium mt-1",children:s.pageCount})]}),s.scriptPageStart&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Page Start"}),(0,a.jsx)("p",{className:"text-text-primary font-medium mt-1",children:s.scriptPageStart})]}),s.scriptPageEnd&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Page End"}),(0,a.jsx)("p",{className:"text-text-primary font-medium mt-1",children:s.scriptPageEnd})]})]}),s.scriptText&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Script Text"}),(0,a.jsx)("div",{className:"mt-2 p-4 bg-background-secondary rounded-lg",children:(0,a.jsx)("p",{className:"text-text-secondary whitespace-pre-wrap",children:s.scriptText})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:"Production Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[S.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Locations"}),(0,a.jsx)("div",{className:"mt-1 flex flex-wrap gap-1",children:S.map(e=>(0,a.jsx)("button",{onClick:()=>w("locations",e.id),className:"px-2 py-1 bg-background-tertiary rounded text-sm text-text-primary hover:bg-background-elevated transition-colors cursor-pointer border border-accent-primary/30 hover:border-accent-primary ring-1 ring-transparent hover:ring-accent-primary/20",children:e.name},e.id))})]}),M.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Shooting Days"}),(0,a.jsx)("div",{className:"mt-1 flex flex-wrap gap-1",children:M.map(e=>(0,a.jsxs)("span",{className:"px-2 py-1 bg-background-tertiary rounded text-sm text-text-primary",children:[new Date(e.date).toLocaleDateString()," - Day ",e.dayNumber||""]},e.id))})]}),s.scheduledDate&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Scheduled Date"}),(0,a.jsx)("p",{className:"text-text-primary font-medium mt-1",children:new Date(s.scheduledDate).toLocaleDateString()})]}),s.estimatedDuration&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Estimated Duration"}),(0,a.jsxs)("p",{className:"text-text-primary font-medium mt-1",children:[s.estimatedDuration," min"]})]})]})]}),(s.timeOfDay||s.weather||s.mood||s.visualNotes)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:"Creative Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.timeOfDay&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Time of Day"}),(0,a.jsx)("p",{className:"text-text-primary font-medium mt-1",children:s.timeOfDay})]}),s.weather&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Weather"}),(0,a.jsx)("p",{className:"text-text-primary font-medium mt-1",children:s.weather})]}),s.mood&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Mood"}),(0,a.jsx)("p",{className:"text-text-primary font-medium mt-1",children:s.mood})]})]}),s.visualNotes&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Visual Notes"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2 whitespace-pre-wrap",children:s.visualNotes})]})]}),(D.length>0||I.length>0||L.length>0)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:"Assignments"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[D.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium mb-2 block",children:"Cast"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:D.map(e=>(0,a.jsxs)("button",{onClick:()=>w("cast",e.id),className:"px-3 py-1.5 bg-background-tertiary rounded-lg border-2 border-accent-primary/30 hover:border-accent-primary transition-colors cursor-pointer text-left ring-1 ring-transparent hover:ring-accent-primary/20",children:[(0,a.jsx)("span",{className:"text-sm text-text-primary",children:e.characterName}),e.actorName&&(0,a.jsxs)("span",{className:"text-xs text-text-tertiary ml-2",children:["(",e.actorName,")"]})]},e.id))})]}),I.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium mb-2 block",children:"Crew"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:I.map(e=>(0,a.jsxs)("button",{onClick:()=>w("crew",e.id),className:"px-3 py-1.5 bg-background-tertiary rounded-lg border-2 border-accent-primary/30 hover:border-accent-primary transition-colors cursor-pointer text-left ring-1 ring-transparent hover:ring-accent-primary/20",children:[(0,a.jsx)("span",{className:"text-sm text-text-primary",children:e.name}),e.role&&(0,a.jsxs)("span",{className:"text-xs text-text-tertiary ml-2",children:["- ",e.role]})]},e.id))})]}),L.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium mb-2 block",children:"Equipment"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:L.map(e=>(0,a.jsx)("button",{onClick:()=>w("equipment",e.id),className:"px-3 py-1.5 bg-background-tertiary rounded-lg border-2 border-accent-primary/30 hover:border-accent-primary transition-colors cursor-pointer text-left ring-1 ring-transparent hover:ring-accent-primary/20",children:(0,a.jsx)("span",{className:"text-sm text-text-primary",children:e.name})},e.id))})]})]})]}),(s.continuityNotes||s.specialRequirements||s.vfxNotes||s.stuntsRequired)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:"Production Details"}),(0,a.jsxs)("div",{className:"space-y-3",children:[s.stuntsRequired&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-error",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,a.jsx)("span",{className:"text-sm font-semibold text-error",children:"Stunts Required"})]}),s.continuityNotes&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Continuity Notes"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1 whitespace-pre-wrap",children:s.continuityNotes})]}),s.specialRequirements&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"Special Requirements"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1 whitespace-pre-wrap",children:s.specialRequirements})]}),s.vfxNotes&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-accent-secondary font-medium",children:"VFX Notes"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1 whitespace-pre-wrap",children:s.vfxNotes})]})]})]}),j&&j.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:f.shots.plural}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:j.map(e=>{var t,r;let n={"not-shot":"bg-gray-500/10 text-gray-400","in-progress":"bg-blue-500/10 text-blue-400",completed:"bg-green-500/10 text-green-400",omitted:"bg-red-500/10 text-red-400"};return(0,a.jsxs)("div",{className:"p-4 bg-background-secondary rounded-lg border border-border-default hover:bg-background-tertiary hover:border-accent-primary/50 transition-all",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("button",{onClick:()=>null==g?void 0:g(e),className:"text-left flex-1",children:[(0,a.jsxs)("h4",{className:"text-base font-semibold text-text-primary",children:[f.shots.singular," ",e.shotNumber,e.title&&(0,a.jsxs)("span",{className:"text-text-secondary ml-2",children:["- ",e.title]})]}),e.shotType&&(0,a.jsx)("span",{className:"text-xs text-text-tertiary capitalize mt-1 inline-block",children:e.shotType.replace("-"," ")}),e.description&&(0,a.jsx)("p",{className:"text-sm text-text-secondary line-clamp-2 mt-2",children:e.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-2",children:[((null==(t=e.shootingDayIds)?void 0:t.length)>0||e.shootingDayId||(null==(r=s.shootingDayIds)?void 0:r.length)>0||s.shootingDayId)&&(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),k.mutate({shotId:e.id})},className:"p-1.5 text-text-secondary hover:text-accent-primary hover:bg-accent-primary/10 rounded transition-colors",title:"Sync to Schedule",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded capitalize ".concat(n[e.status]||n["not-shot"]),children:e.status.replace("-"," ")})]})]}),e.imageUrl&&(0,a.jsx)("div",{className:"relative w-full h-32 mt-3 overflow-hidden bg-background-tertiary rounded",children:(0,a.jsx)(m.default,{src:e.imageUrl,alt:e.title||"".concat(f.shots.singular," ").concat(e.shotNumber),fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 50vw",unoptimized:e.imageUrl.startsWith("blob:")||e.imageUrl.startsWith("data:")||(0,h.G)(e.imageUrl)})})]},e.id)})})]})]})}),(0,a.jsxs)("div",{className:"p-6 border-t border-border-default flex justify-between items-center",children:[((null==(r=s.shootingDayIds)?void 0:r.length)>0||s.shootingDayId)&&(0,a.jsxs)("button",{onClick:()=>N.mutate({sceneId:s.id}),className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Sync to Schedule"]}),(0,a.jsxs)("div",{className:"flex gap-2 ml-auto",children:[p&&(0,a.jsx)("button",{onClick:p,className:"btn-secondary",children:"Edit"}),(0,a.jsx)("button",{onClick:x,className:"btn-primary",children:"Close"})]})]})]})})}function tr(e){let{isOpen:t,onClose:r,onSelectCategory:s,imageUrl:n}=e;return t?(0,a.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 p-4 animate-in fade-in duration-200",children:(0,a.jsxs)("div",{className:"bg-background-primary rounded-xl shadow-xl max-w-md w-full overflow-hidden scale-100 animate-in zoom-in-95 duration-200",children:[(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-text-primary mb-2",children:"Add Reference Image"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-6",children:"Select a category for this reference image."}),(0,a.jsx)("div",{className:"mb-6 rounded-lg overflow-hidden border border-border-default aspect-video relative",children:(0,a.jsx)("img",{src:n,alt:"Reference Preview",className:"object-cover w-full h-full"})}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[{id:"wardrobe",label:"Wardrobe",icon:"\uD83D\uDC55"},{id:"camera",label:"Camera",icon:"\uD83C\uDFA5"},{id:"location",label:"Location",icon:"\uD83D\uDCCD"},{id:"character",label:"Character",icon:"\uD83D\uDC64"},{id:"other",label:"Other",icon:"\uD83D\uDD16"}].map(e=>(0,a.jsxs)("button",{onClick:()=>s(e.id),className:"flex items-center gap-3 p-3 rounded-lg border border-border-default hover:border-accent-primary hover:bg-accent-primary/5 transition-all text-left",children:[(0,a.jsx)("span",{className:"text-2xl",children:e.icon}),(0,a.jsx)("span",{className:"font-medium text-text-primary",children:e.label})]},e.id))})]}),(0,a.jsx)("div",{className:"p-4 bg-background-secondary border-t border-border-default flex justify-end",children:(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-text-secondary hover:text-text-primary transition-colors",children:"Cancel"})})]})}):null}function ta(e){let t=o.i.useUtils(),{data:r=[],isLoading:a,error:s}=o.i.referenceImages.list.useQuery({projectId:e}),n=o.i.referenceImages.create.useMutation({onSuccess:()=>{t.referenceImages.list.invalidate({projectId:e})}});return{images:r,isLoading:a,error:s,createReferenceImage:n,deleteReferenceImage:o.i.referenceImages.delete.useMutation({onSuccess:()=>{t.referenceImages.list.invalidate({projectId:e})}}),migrateShotReferences:o.i.referenceImages.migrateShotReferences.useMutation({onSuccess:()=>{t.referenceImages.list.invalidate({projectId:e}),t.shots.listByProject.invalidate({projectId:e}),t.shots.listByScene.invalidate()}})}}function ts(e){var t,r;let{sceneId:s,projectId:n,castMembers:l,crewMembers:d,equipment:c,locations:u,schedule:x,onClose:p,onViewShot:b,initialShotId:g}=e,y=o.i.useUtils(),v=o.i.shots.syncToSchedule.useMutation({onSuccess:e=>{alert(e.message),y.schedule.getSchedule.invalidate({projectId:n})},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),{shots:j,isLoading:f,createShot:N,updateShot:k,deleteShot:w,markBestTake:C}=e9(s),{data:S}=o.i.scenes.getById.useQuery({id:s}),{createReferenceImage:D}=ta(n),[I,L]=(0,i.useState)(!1),[A,M]=(0,i.useState)(null),[P,q]=(0,i.useState)(!1),[B,Y]=(0,i.useState)(null),[R,E]=(0,i.useState)(null),[T,U]=(0,i.useState)({shotNumber:"",title:"",description:"",shotType:"master",cameraAngle:"",cameraMovement:"",lens:"",focalLength:"",frameRate:"",resolution:"",cameraId:"",lensId:"",equipmentIds:[],lightingSetup:"",status:"not-shot",duration:"",slateInfo:"",composition:"",blocking:"",actionDescription:"",castIds:[],crewIds:[],locationIds:[],locationNames:[],shootingDayIds:[],imageUrl:"",storyboardId:"",shotReferences:[]}),[z,F]=(0,i.useState)(!1),[O,W]=(0,i.useState)(null),[V,H]=(0,i.useState)(null),[_,Q]=(0,i.useState)(!1),$=(0,i.useRef)(null),G=(0,i.useRef)(null),[K,X]=(0,i.useState)(!1),[J,Z]=(0,i.useState)(!1),[ee,et]=(0,i.useState)(!1),[er,ea]=(0,i.useState)(!1),[es,en]=(0,i.useState)(!1),[el,eo]=(0,i.useState)(""),[ei,ed]=(0,i.useState)(""),[ec,em]=(0,i.useState)(""),[eu,ex]=(0,i.useState)(""),[ep,eh]=(0,i.useState)("");(0,i.useEffect)(()=>{!A&&S&&I&&(U({shotNumber:"",title:"",description:"",shotType:"master",cameraAngle:"",cameraMovement:"",lens:"",focalLength:"",frameRate:"",resolution:"",cameraId:"",lensId:"",equipmentIds:[],lightingSetup:"",status:"not-shot",duration:"",slateInfo:"",composition:"",blocking:"",actionDescription:"",castIds:S.castIds||[],crewIds:S.crewIds||[],locationIds:S.locationIds||(S.locationId?[S.locationId]:[]),locationNames:S.locationNames||(S.locationName?[S.locationName]:[]),shootingDayIds:S.shootingDayIds||(S.shootingDayId?[S.shootingDayId]:[]),imageUrl:S.imageUrl||"",storyboardId:"",shotReferences:[]}),H(S.imageUrl||null))},[S,I,A]),(0,i.useEffect)(()=>{if(A){var e,t,r;U({shotNumber:A.shotNumber||"",title:A.title||"",description:A.description||"",shotType:A.shotType||"master",cameraAngle:A.cameraAngle||"",cameraMovement:A.cameraMovement||"",lens:A.lens||"",focalLength:(null==(e=A.focalLength)?void 0:e.toString())||"",frameRate:(null==(t=A.frameRate)?void 0:t.toString())||"",resolution:A.resolution||"",cameraId:A.cameraId||"",lensId:A.lensId||"",equipmentIds:A.equipmentIds||[],lightingSetup:A.lightingSetup||"",status:A.status||"not-shot",duration:(null==(r=A.duration)?void 0:r.toString())||"",slateInfo:A.slateInfo||"",composition:A.composition||"",blocking:A.blocking||"",actionDescription:A.actionDescription||"",castIds:A.castIds||[],crewIds:A.crewIds||[],locationIds:A.locationIds||[],locationNames:A.locationNames||[],shootingDayIds:A.shootingDayIds||[],imageUrl:A.imageUrl||"",storyboardId:A.storyboardId||"",shotReferences:A.shotReferences||[]}),H(A.imageUrl||null)}},[A]),(0,i.useEffect)(()=>{if(g&&j.length>0&&!A){let e=j.find(e=>e.id===g);e&&(M(e),L(!0))}},[g,j,A]);let eb=e=>{if(!e.type.startsWith("image/"))return void alert("Please select an image file");W(e);let t=new FileReader;t.onloadend=()=>{H(t.result)},t.readAsDataURL(e)},eg=async e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(r)try{F(!0);let e="projects/".concat(n,"/references/").concat(Date.now(),"-").concat(r.name),t=await (0,h.uploadImage)(r,e);Y(t),E(r.name),q(!0)}catch(e){console.error("Error uploading reference:",e),alert("Failed to upload reference image")}finally{F(!1),G.current&&(G.current.value="")}},ey=async e=>{if(B&&R)try{let t={id:(await D.mutateAsync({projectId:n,url:B,name:R,category:e,tags:[]})).id,url:B,category:e};U(e=>({...e,shotReferences:[...e.shotReferences,t]})),q(!1),Y(null),E(null)}catch(e){console.error("Error creating reference image:",e),alert("Failed to create reference image")}},ev=async e=>{e.preventDefault();try{F(!0);let e=T.imageUrl;if(O){let t=(0,h.generateUniqueFilename)(O.name),r="shots/".concat(n,"/").concat(t);e=await (0,h.uploadImage)(O,r)}if((null==A?void 0:A.imageUrl)&&e!==A.imageUrl&&!(0,h.isBlobUrl)(A.imageUrl))try{await (0,h.deleteImage)(A.imageUrl)}catch(e){console.error("Error deleting old image:",e)}let t={...T,imageUrl:e,focalLength:T.focalLength?parseFloat(T.focalLength):void 0,frameRate:T.frameRate?parseFloat(T.frameRate):void 0,duration:T.duration?parseFloat(T.duration):void 0};Object.keys(t).forEach(e=>{(""===t[e]||Array.isArray(t[e])&&0===t[e].length)&&delete t[e]}),A?await k.mutateAsync({id:A.id,data:t}):await N.mutateAsync({...t,sceneId:s,projectId:n,createdBy:""}),L(!1),M(null),W(null),H(null),U({shotNumber:"",title:"",description:"",shotType:"master",cameraAngle:"",cameraMovement:"",lens:"",focalLength:"",frameRate:"",resolution:"",cameraId:"",lensId:"",equipmentIds:[],lightingSetup:"",status:"not-shot",duration:"",slateInfo:"",composition:"",blocking:"",actionDescription:"",castIds:[],crewIds:[],locationIds:[],locationNames:[],shootingDayIds:[],imageUrl:"",storyboardId:"",shotReferences:[]})}catch(e){console.error("Error saving shot:",e),alert("Failed to save shot. Please try again.")}finally{F(!1)}},ej=async(e,t)=>{let r=j.find(t=>t.id===e);if(!r)return;let a=r.takeNumbers||[];a.includes(t)||await k.mutateAsync({id:e,data:{takeNumbers:[...a,t]}})},ef=l.filter(e=>T.castIds.includes(e.id)),eN=d.filter(e=>T.crewIds.includes(e.id)),ek=c.filter(e=>T.equipmentIds.includes(e.id)),ew=u.filter(e=>T.locationIds.includes(e.id)),eC=(null==x||null==(t=x.days)?void 0:t.filter(e=>T.shootingDayIds.includes(e.id)))||[],eS=l.filter(e=>!T.castIds.includes(e.id)),eD=d.filter(e=>!T.crewIds.includes(e.id)),eI=c.filter(e=>!T.equipmentIds.includes(e.id)),eL=u.filter(e=>!T.locationIds.includes(e.id)),eA=(null==x||null==(r=x.days)?void 0:r.filter(e=>!T.shootingDayIds.includes(e.id)))||[],eM=eS.filter(e=>{var t;return null==(t=e.characterName)?void 0:t.toLowerCase().includes(el.toLowerCase())}),eP=eD.filter(e=>{var t,r;return(null==(t=e.name)?void 0:t.toLowerCase().includes(ei.toLowerCase()))||(null==(r=e.role)?void 0:r.toLowerCase().includes(ei.toLowerCase()))}),eq=eI.filter(e=>{var t;return null==(t=e.name)?void 0:t.toLowerCase().includes(ec.toLowerCase())}),eB=eL.filter(e=>{var t;return null==(t=e.name)?void 0:t.toLowerCase().includes(eu.toLowerCase())}),eY=eA.filter(e=>{var t;if(!ep)return!0;let r=new Date(e.date).toLocaleDateString().toLowerCase(),a=(null==(t=e.dayNumber)?void 0:t.toString())||"";return r.includes(ep.toLowerCase())||a.includes(ep.toLowerCase())});return f?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsx)("div",{className:"bg-background-primary rounded-lg p-6",children:(0,a.jsxs)("div",{className:"relative w-16 h-16",children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-accent-primary/20"}),(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-accent-primary animate-spin"})]})})}):(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:[(0,a.jsxs)("div",{className:"bg-background-primary rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-border-default flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary",children:"Shots"}),(0,a.jsxs)("button",{onClick:()=>{L(!0),M(null),W(null),H(null)},className:"btn-primary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Shot"]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[I||A?(0,a.jsxs)("form",{onSubmit:ev,className:"space-y-6 mb-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Main Storyboard Image"}),(0,a.jsxs)("div",{onDragOver:e=>{e.preventDefault(),Q(!0)},onDragLeave:e=>{e.preventDefault(),Q(!1)},onDrop:e=>{e.preventDefault(),Q(!1);let t=e.dataTransfer.files[0];t&&eb(t)},className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors ".concat(_?"border-accent-primary bg-accent-primary/10":"border-border-default hover:border-accent-primary/50"),children:[V?(0,a.jsxs)("div",{className:"relative w-full h-48 mb-4",children:[(0,a.jsx)(m.default,{src:V,alt:"Shot preview",fill:!0,className:"object-cover rounded-lg",sizes:"(max-width: 768px) 100vw, 50vw"}),(0,a.jsx)("button",{type:"button",onClick:()=>{H(null),W(null),U({...T,imageUrl:""}),$.current&&($.current.value="")},className:"absolute top-2 right-2 p-2 bg-error text-white rounded-full hover:bg-error/80 transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,a.jsxs)("div",{className:"py-8",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-2",children:"Drag and drop an image here"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=$.current)?void 0:e.click()},className:"text-sm text-accent-primary hover:text-accent-hover font-medium",children:"Choose File"})]}),(0,a.jsx)("input",{ref:$,type:"file",accept:"image/*",onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&eb(r)},className:"hidden"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary",children:"Reference Images"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=G.current)?void 0:e.click()},className:"text-xs bg-background-tertiary px-2 py-1 rounded hover:bg-background-elevated transition-colors",children:"+ Add Reference"}),(0,a.jsx)("input",{ref:G,type:"file",accept:"image/*",onChange:eg,className:"hidden"})]}),(0,a.jsx)("div",{className:"border border-border-default rounded-lg p-3 min-h-[200px] max-h-[300px] overflow-y-auto",children:0===T.shotReferences.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-text-tertiary text-sm italic",children:"No references added"}):(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:T.shotReferences.map(e=>(0,a.jsxs)("div",{className:"relative aspect-square rounded overflow-hidden group",children:[(0,a.jsx)(m.default,{src:e.url,alt:e.category,fill:!0,className:"object-cover",unoptimized:(0,h.G)(e.url)}),(0,a.jsxs)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[(0,a.jsx)("span",{className:"text-white text-xs capitalize font-medium",children:e.category}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void U(e=>({...e,shotReferences:e.shotReferences.filter(e=>e.id!==t)}))},className:"p-1 bg-error text-white rounded-full",children:(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]},e.id))})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Basic Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Shot Number *"}),(0,a.jsx)("input",{type:"text",required:!0,value:T.shotNumber,onChange:e=>U({...T,shotNumber:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Shot Type"}),(0,a.jsxs)("select",{value:T.shotType,onChange:e=>U({...T,shotType:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary",children:[(0,a.jsx)("option",{value:"master",children:"Master"}),(0,a.jsx)("option",{value:"medium",children:"Medium"}),(0,a.jsx)("option",{value:"close",children:"Close"}),(0,a.jsx)("option",{value:"extreme-close",children:"Extreme Close"}),(0,a.jsx)("option",{value:"wide",children:"Wide"}),(0,a.jsx)("option",{value:"insert",children:"Insert"}),(0,a.jsx)("option",{value:"pov",children:"POV"}),(0,a.jsx)("option",{value:"over-shoulder",children:"Over Shoulder"}),(0,a.jsx)("option",{value:"two-shot",children:"Two Shot"}),(0,a.jsx)("option",{value:"establishing",children:"Establishing"}),(0,a.jsx)("option",{value:"cutaway",children:"Cutaway"}),(0,a.jsx)("option",{value:"other",children:"Other"})]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Title"}),(0,a.jsx)("input",{type:"text",value:T.title,onChange:e=>U({...T,title:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:T.description,onChange:e=>U({...T,description:e.target.value}),rows:3,className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Camera Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Camera Angle"}),(0,a.jsx)("input",{type:"text",value:T.cameraAngle,onChange:e=>U({...T,cameraAngle:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Camera Movement"}),(0,a.jsx)("input",{type:"text",value:T.cameraMovement,onChange:e=>U({...T,cameraMovement:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Lens"}),(0,a.jsx)("input",{type:"text",value:T.lens,onChange:e=>U({...T,lens:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Focal Length"}),(0,a.jsx)("input",{type:"number",value:T.focalLength,onChange:e=>U({...T,focalLength:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Frame Rate"}),(0,a.jsx)("input",{type:"number",value:T.frameRate,onChange:e=>U({...T,frameRate:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Resolution"}),(0,a.jsx)("input",{type:"text",value:T.resolution,onChange:e=>U({...T,resolution:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Location & Scheduling"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Locations"}),(0,a.jsxs)("div",{className:"space-y-2",children:[ew.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:ew.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsx)("span",{className:"text-sm text-text-primary",children:e.name}),(0,a.jsx)("button",{type:"button",onClick:()=>(e=>{let t=u.find(t=>t.id===e);U({...T,locationIds:T.locationIds.filter(t=>t!==e),locationNames:T.locationNames.filter(e=>e!==((null==t?void 0:t.name)||""))})})(e.id),className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>ea(!er),className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Location"]}),er&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search locations...",value:eu,onChange:e=>ex(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:eB.length>0?eB.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{var t=e.id;if(!T.locationIds.includes(t)){let e=u.find(e=>e.id===t);U({...T,locationIds:[...T.locationIds,t],locationNames:[...T.locationNames,(null==e?void 0:e.name)||""]})}ea(!1),ex("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:e.name},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Shooting Days"}),(0,a.jsxs)("div",{className:"space-y-2",children:[eC.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:eC.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsxs)("span",{className:"text-sm text-text-primary",children:[new Date(e.date).toLocaleDateString()," - Day ",e.dayNumber||""]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void U({...T,shootingDayIds:T.shootingDayIds.filter(e=>e!==t)})},className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>en(!es),className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Shooting Day"]}),es&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search shooting days...",value:ep,onChange:e=>eh(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:eY.length>0?eY.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{var t;t=e.id,T.shootingDayIds.includes(t)||U({...T,shootingDayIds:[...T.shootingDayIds,t]}),en(!1),eh("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:[new Date(e.date).toLocaleDateString()," - Day ",e.dayNumber||""]},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Assignments"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Cast"}),(0,a.jsxs)("div",{className:"space-y-2",children:[ef.length>0&&(0,a.jsx)("div",{className:"space-y-1",children:ef.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsx)("span",{className:"text-sm text-text-primary",children:e.characterName}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void U({...T,castIds:T.castIds.filter(e=>e!==t)})},className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>X(!K),className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Cast"]}),K&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search cast...",value:el,onChange:e=>eo(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:eM.length>0?eM.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{var t;t=e.id,T.castIds.includes(t)||U({...T,castIds:[...T.castIds,t]}),X(!1),eo("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:e.characterName},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Crew"}),(0,a.jsxs)("div",{className:"space-y-2",children:[eN.length>0&&(0,a.jsx)("div",{className:"space-y-1",children:eN.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsxs)("span",{className:"text-sm text-text-primary",children:[e.name," - ",e.role]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void U({...T,crewIds:T.crewIds.filter(e=>e!==t)})},className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>Z(!J),className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Crew"]}),J&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search crew...",value:ei,onChange:e=>ed(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:eP.length>0?eP.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{var t;t=e.id,T.crewIds.includes(t)||U({...T,crewIds:[...T.crewIds,t]}),Z(!1),ed("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:[e.name," - ",e.role]},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Equipment"}),(0,a.jsxs)("div",{className:"space-y-2",children:[ek.length>0&&(0,a.jsx)("div",{className:"space-y-1",children:ek.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-1.5 bg-background-tertiary rounded-lg border border-border-default",children:[(0,a.jsx)("span",{className:"text-sm text-text-primary",children:e.name}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void U({...T,equipmentIds:T.equipmentIds.filter(e=>e!==t)})},className:"text-text-tertiary hover:text-error transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>et(!ee),className:"btn-secondary flex items-center gap-2 w-full",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Equipment"]}),ee&&(0,a.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-background-primary border border-border-default rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search equipment...",value:ec,onChange:e=>em(e.target.value),onClick:e=>e.stopPropagation(),className:"px-3 py-2 border-b border-border-default bg-background-secondary text-text-primary text-sm focus:outline-none focus:border-accent-primary"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-48",children:eq.length>0?eq.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{var t;t=e.id,T.equipmentIds.includes(t)||U({...T,equipmentIds:[...T.equipmentIds,t]}),et(!1),em("")},className:"w-full text-left px-4 py-2 hover:bg-background-tertiary text-sm text-text-primary transition-colors",children:e.name},e.id)):(0,a.jsx)("div",{className:"px-4 py-2 text-sm text-text-tertiary",children:"No results found"})})]})]})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Production Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Status"}),(0,a.jsxs)("select",{value:T.status,onChange:e=>U({...T,status:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary",children:[(0,a.jsx)("option",{value:"not-shot",children:"Not Shot"}),(0,a.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,a.jsx)("option",{value:"completed",children:"Completed"}),(0,a.jsx)("option",{value:"omitted",children:"Omitted"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Duration (seconds)"}),(0,a.jsx)("input",{type:"number",value:T.duration,onChange:e=>U({...T,duration:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Lighting Setup"}),(0,a.jsx)("input",{type:"text",value:T.lightingSetup,onChange:e=>U({...T,lightingSetup:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Slate Info"}),(0,a.jsx)("input",{type:"text",value:T.slateInfo,onChange:e=>U({...T,slateInfo:e.target.value}),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Creative Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Composition"}),(0,a.jsx)("textarea",{value:T.composition,onChange:e=>U({...T,composition:e.target.value}),rows:2,className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Blocking"}),(0,a.jsx)("textarea",{value:T.blocking,onChange:e=>U({...T,blocking:e.target.value}),rows:2,className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Action Description"}),(0,a.jsx)("textarea",{value:T.actionDescription,onChange:e=>U({...T,actionDescription:e.target.value}),rows:3,className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{L(!1),M(null),W(null),H(null)},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:z,children:z?"Uploading...":A?"Update Shot":"Create Shot"})]})]}):null,0===j.length?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-text-secondary",children:"No shots yet. Add your first shot above."})}):(0,a.jsx)("div",{className:"space-y-4",children:j.map(e=>{var t,r;let s=e.locationIds||[],n=u.filter(e=>s.includes(e.id)),o=l.filter(t=>{var r;return null==(r=e.castIds)?void 0:r.includes(t.id)}),i=d.filter(t=>{var r;return null==(r=e.crewIds)?void 0:r.includes(t.id)}),c=e.shootingDayIds||[],p=(null==x||null==(t=x.days)?void 0:t.filter(e=>c.includes(e.id)))||[];return(0,a.jsxs)("div",{className:"card-elevated p-4",children:[e.imageUrl&&(0,a.jsx)("div",{className:"relative w-full h-48 mb-4 overflow-hidden bg-background-secondary rounded-lg",children:(0,a.jsx)(m.default,{src:e.imageUrl,alt:e.title||"Shot ".concat(e.shotNumber),fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 50vw",unoptimized:e.imageUrl.startsWith("blob:")||e.imageUrl.startsWith("data:")||(0,h.G)(e.imageUrl)})}),(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex-1 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>null==b?void 0:b(e),children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary",children:["Shot ",e.shotNumber,e.title&&(0,a.jsxs)("span",{className:"text-text-secondary ml-2",children:["- ",e.title]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm text-text-tertiary",children:[(0,a.jsx)("span",{className:"capitalize",children:e.shotType.replace("-"," ")}),e.lens&&(0,a.jsxs)("span",{children:["Lens: ",e.lens]}),e.frameRate&&(0,a.jsxs)("span",{children:[e.frameRate," fps"]}),e.resolution&&(0,a.jsx)("span",{children:e.resolution})]}),n.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-sm text-text-tertiary",children:[(0,a.jsxs)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,a.jsx)("span",{children:n.map(e=>e.name).join(", ")})]}),p.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-sm text-text-tertiary",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("span",{children:p.map(e=>new Date(e.date).toLocaleDateString()).join(", ")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(c.length>0||(null==S||null==(r=S.shootingDayIds)?void 0:r.length)>0||(null==S?void 0:S.shootingDayId))&&(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),v.mutate({shotId:e.id})},className:"p-1.5 text-text-secondary hover:text-accent-primary hover:bg-accent-primary/10 rounded transition-colors",title:"Sync to Schedule",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded capitalize ".concat("completed"===e.status?"bg-green-500/10 text-green-400":"in-progress"===e.status?"bg-blue-500/10 text-blue-400":"bg-gray-500/10 text-gray-400"),children:e.status.replace("-"," ")}),(0,a.jsx)("button",{onClick:()=>{M(e),L(!0)},className:"p-1.5 text-text-secondary hover:text-text-primary hover:bg-background-elevated rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:()=>{confirm("Are you sure you want to delete this shot?")&&w.mutate({id:e.id})},className:"p-1.5 text-error hover:bg-error/10 rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(0,a.jsxs)("div",{className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>null==b?void 0:b(e),children:[e.description&&(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-3",children:e.description}),(o.length>0||i.length>0)&&(0,a.jsxs)("div",{className:"mb-3",children:[o.length>0&&(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold text-text-tertiary",children:"Cast: "}),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:o.map(e=>e.characterName).join(", ")})]}),i.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs font-semibold text-text-tertiary",children:"Crew: "}),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:i.map(e=>"".concat(e.name," (").concat(e.role,")")).join(", ")})]})]})]}),e.takeNumbers&&e.takeNumbers.length>0&&(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-text-primary mb-2",children:"Takes"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.takeNumbers.map(t=>(0,a.jsxs)("button",{onClick:r=>{r.stopPropagation(),C.mutate({id:e.id,takeNumber:t})},className:"px-3 py-1 text-sm rounded transition-colors ".concat(e.bestTake===t?"bg-accent-primary font-semibold":"bg-background-tertiary text-text-secondary hover:bg-background-elevated"),style:e.bestTake===t?{color:"rgb(var(--colored-button-text))"}:void 0,children:["Take ",t,e.bestTake===t&&" ✓"]},t))})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation();let r=prompt("Enter take number:");r&&ej(e.id,parseInt(r))},className:"text-sm text-accent-primary hover:text-accent-hover font-medium",children:"+ Add Take"}),b&&(0,a.jsxs)("button",{onClick:t=>{t.stopPropagation(),b(e)},className:"text-sm text-accent-primary hover:text-accent-hover font-medium flex items-center gap-1",children:["View Details",(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]},e.id)})})]}),(0,a.jsxs)("div",{className:"p-6 border-t border-border-default flex justify-between items-center",children:[(0,a.jsx)("div",{children:A&&(()=>{let e=A.shootingDayIds||[],t=(null==S?void 0:S.shootingDayIds)||((null==S?void 0:S.shootingDayId)?[S.shootingDayId]:[]);return e.length>0||t.length>0?(0,a.jsxs)("button",{onClick:()=>v.mutate({shotId:A.id}),disabled:v.isPending,className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),v.isPending?"Syncing...":"Sync to Schedule"]}):null})()}),(0,a.jsx)("button",{onClick:p,className:"btn-primary",children:"Close"})]})]}),(0,a.jsx)(tr,{isOpen:P,onClose:()=>{q(!1),Y(null),E(null)},onSelectCategory:ey,imageUrl:B||""})]})}function tn(e){var t,r;let{shot:s,projectId:n,castMembers:l,crewMembers:i,equipment:d,locations:c,schedule:u,onClose:x,onEdit:p,onNavigate:b}=e;o.i.useUtils();let{data:g}=o.i.projects.getById.useQuery({id:n}),y=eM(null==g?void 0:g.projectType),v=s.locationIds||[],j=c.filter(e=>v.includes(e.id));l.filter(e=>{var t;return null==(t=s.castIds)?void 0:t.includes(e.id)}),i.filter(e=>{var t;return null==(t=s.crewIds)?void 0:t.includes(e.id)}),d.filter(e=>{var t;return null==(t=s.equipmentIds)?void 0:t.includes(e.id)});let f=s.shootingDayIds||[],N=(null==u||null==(t=u.days)?void 0:t.filter(e=>f.includes(e.id)))||[],k={"not-shot":"bg-gray-500/10 text-gray-400 border-gray-500/30","in-progress":"bg-blue-500/10 text-blue-400 border-blue-500/30",completed:"bg-green-500/10 text-green-400 border-green-500/30",omitted:"bg-red-500/10 text-red-400 border-red-500/30"},w=(s.shotReferences||[]).reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{}),C={wardrobe:"Wardrobe",camera:"Camera",location:"Location",character:"Character",other:"Other"};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,a.jsxs)("div",{className:"bg-background-primary rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-border-default flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-text-primary",children:[y.shots.singular," ",s.shotNumber]}),(0,a.jsx)("span",{className:"px-3 py-1 text-sm font-semibold rounded capitalize border ".concat(k[s.status]||k["not-shot"]),children:s.status.replace("-"," ")}),s.shotType&&(0,a.jsx)("span",{className:"px-3 py-1 text-sm bg-background-tertiary rounded capitalize text-text-secondary",children:s.shotType.replace("-"," ")})]}),s.title&&(0,a.jsx)("p",{className:"text-lg text-text-secondary",children:s.title})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[p&&(0,a.jsxs)("button",{onClick:p,className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Edit"]}),(0,a.jsx)("button",{onClick:x,className:"p-2 text-text-secondary hover:text-text-primary hover:bg-background-tertiary rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:s.imageUrl?(0,a.jsx)("div",{className:"relative w-full aspect-video overflow-hidden bg-background-secondary rounded-lg border border-border-default",children:(0,a.jsx)(m.default,{src:s.imageUrl,alt:s.title||"".concat(y.shots.singular," ").concat(s.shotNumber),fill:!0,className:"object-contain",unoptimized:s.imageUrl.startsWith("blob:")||s.imageUrl.startsWith("data:")||(0,h.G)(s.imageUrl)})}):(0,a.jsx)("div",{className:"aspect-video bg-background-secondary rounded-lg border border-border-default flex items-center justify-center text-text-tertiary",children:"No storyboard image"})}),(0,a.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary border-b border-border-default pb-2",children:"Reference Images"}),0===Object.keys(w).length?(0,a.jsx)("p",{className:"text-sm text-text-tertiary italic",children:"No reference images attached."}):Object.entries(w).map(e=>{let[t,r]=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider mb-2",children:C[t]||t}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:null==r?void 0:r.map(e=>(0,a.jsx)("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-border-subtle group cursor-pointer hover:border-accent-primary transition-colors",children:(0,a.jsx)(m.default,{src:e.url,alt:t,fill:!0,className:"object-cover",unoptimized:(0,h.G)(e.url)})},e.id))})]},t)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[s.description&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-2",children:"Description"}),(0,a.jsx)("p",{className:"text-text-secondary whitespace-pre-wrap",children:s.description})]}),(s.duration||s.lightingSetup||s.slateInfo||(null==(r=s.takeNumbers)?void 0:r.length)>0)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:"Production Info"}),(0,a.jsxs)("div",{className:"space-y-3",children:[s.duration&&(0,a.jsxs)("div",{className:"flex justify-between border-b border-border-subtle pb-1",children:[(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Duration"}),(0,a.jsxs)("span",{className:"text-sm text-text-primary font-medium",children:[s.duration,"s"]})]}),s.lightingSetup&&(0,a.jsxs)("div",{className:"flex justify-between border-b border-border-subtle pb-1",children:[(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Lighting"}),(0,a.jsx)("span",{className:"text-sm text-text-primary font-medium",children:s.lightingSetup})]}),s.slateInfo&&(0,a.jsxs)("div",{className:"flex justify-between border-b border-border-subtle pb-1",children:[(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Slate"}),(0,a.jsx)("span",{className:"text-sm text-text-primary font-medium",children:s.slateInfo})]})]}),s.takeNumbers&&s.takeNumbers.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("span",{className:"text-sm text-text-secondary mb-2 block",children:"Takes"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:s.takeNumbers.map(e=>(0,a.jsxs)("span",{className:"px-2 py-1 rounded text-xs font-medium border ".concat(s.bestTake===e?"bg-accent-primary border-accent-primary":"bg-background-tertiary border-border-default"),style:s.bestTake===e?{color:"rgb(var(--colored-button-text))"}:void 0,children:["Take ",e," ",s.bestTake===e&&"✓"]},e))})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(s.cameraAngle||s.cameraMovement||s.lens||s.focalLength||s.frameRate||s.resolution)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:"Camera"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[s.cameraAngle&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-text-tertiary block",children:"Angle"}),(0,a.jsx)("span",{className:"text-sm text-text-primary",children:s.cameraAngle})]}),s.cameraMovement&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-text-tertiary block",children:"Movement"}),(0,a.jsx)("span",{className:"text-sm text-text-primary",children:s.cameraMovement})]}),s.lens&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-text-tertiary block",children:"Lens"}),(0,a.jsx)("span",{className:"text-sm text-text-primary",children:s.lens})]}),s.focalLength&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-text-tertiary block",children:"Focal Length"}),(0,a.jsxs)("span",{className:"text-sm text-text-primary",children:[s.focalLength,"mm"]})]}),s.frameRate&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-text-tertiary block",children:"FPS"}),(0,a.jsx)("span",{className:"text-sm text-text-primary",children:s.frameRate})]}),s.resolution&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-text-tertiary block",children:"Res"}),(0,a.jsx)("span",{className:"text-sm text-text-primary",children:s.resolution})]})]})]}),(j.length>0||N.length>0)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:"Logistics"}),(0,a.jsxs)("div",{className:"space-y-3",children:[j.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-text-tertiary block mb-1",children:"Locations"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:j.map(e=>(0,a.jsx)("span",{className:"px-2 py-1 bg-background-tertiary rounded text-xs border border-border-default",children:e.name},e.id))})]}),N.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-text-tertiary block mb-1",children:"Schedule"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:N.map(e=>(0,a.jsx)("span",{className:"px-2 py-1 bg-background-tertiary rounded text-xs border border-border-default",children:new Date(e.date).toLocaleDateString()},e.id))})]})]})]})]})]}),(s.composition||s.blocking||s.actionDescription)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-accent-primary mb-3",children:"Creative Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.composition&&(0,a.jsxs)("div",{className:"bg-background-secondary p-3 rounded border border-border-subtle",children:[(0,a.jsx)("span",{className:"text-xs text-accent-secondary font-bold uppercase tracking-wider mb-1 block",children:"Composition"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary whitespace-pre-wrap",children:s.composition})]}),s.blocking&&(0,a.jsxs)("div",{className:"bg-background-secondary p-3 rounded border border-border-subtle",children:[(0,a.jsx)("span",{className:"text-xs text-accent-secondary font-bold uppercase tracking-wider mb-1 block",children:"Blocking"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary whitespace-pre-wrap",children:s.blocking})]}),s.actionDescription&&(0,a.jsxs)("div",{className:"bg-background-secondary p-3 rounded border border-border-subtle",children:[(0,a.jsx)("span",{className:"text-xs text-accent-secondary font-bold uppercase tracking-wider mb-1 block",children:"Action"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary whitespace-pre-wrap",children:s.actionDescription})]})]})]})]})}),(0,a.jsx)("div",{className:"p-6 border-t border-border-default flex justify-end",children:(0,a.jsx)("button",{onClick:x,className:"btn-primary",children:"Close"})})]})})}function tl(e){let{projectId:t}=e,{user:r}=(0,p.A)(),s=o.i.useUtils(),[n,l]=(0,i.useState)("creative"),[d,c]=(0,i.useState)(!1),[m,u]=(0,i.useState)(!1),[x,h]=(0,i.useState)(!1),[b,g]=(0,i.useState)(!1),[y,v]=(0,i.useState)(null),[j,f]=(0,i.useState)(null),[N,k]=(0,i.useState)(null),[w,C]=(0,i.useState)(""),[S,D]=(0,i.useState)(new Set(["not-shot","in-progress","completed","omitted"])),[I,L]=(0,i.useState)(new Set),{scenes:A,isLoading:M,error:P,createScene:q,updateScene:B,deleteScene:Y}=e7(t),{data:R}=o.i.projects.getById.useQuery({id:t}),{data:E=[]}=o.i.cast.listByProject.useQuery({projectId:t}),{data:T=[]}=o.i.crew.listByProject.useQuery({projectId:t}),{data:U=[]}=o.i.equipment.listByProject.useQuery({projectId:t}),{data:z=[]}=o.i.locations.listByProject.useQuery({projectId:t}),{data:F}=o.i.schedule.getSchedule.useQuery({projectId:t}),{data:O}=o.i.projectMembers.getMyRole.useQuery({projectId:t}),W=o.i.scenes.syncAllToSchedule.useMutation({onSuccess:e=>{alert(e.message),s.schedule.getSchedule.invalidate({projectId:t})},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),V=o.i.scenes.syncToSchedule.useMutation({onSuccess:e=>{alert(e.message),s.schedule.getSchedule.invalidate({projectId:t})},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),H=o.i.shots.syncToSchedule.useMutation({onSuccess:e=>{alert(e.message),s.schedule.getSchedule.invalidate({projectId:t})},onError:e=>{alert("Failed to sync: ".concat(e.message))}}),_=eM(null==R?void 0:R.projectType),Q="owner"===O||"admin"===O,$=A.filter(e=>{var t,r;let a=!w||e.sceneNumber.toLowerCase().includes(w.toLowerCase())||(null==(t=e.title)?void 0:t.toLowerCase().includes(w.toLowerCase()))||(null==(r=e.description)?void 0:r.toLowerCase().includes(w.toLowerCase())),s=S.has(e.status);return a&&s}),G=()=>{v(null),c(!0)},K=e=>{v(e),c(!0)},X=async e=>{confirm("Are you sure you want to delete this ".concat(_.scenes.singular.toLowerCase(),"? All ").concat(_.shots.plural.toLowerCase()," will also be deleted."))&&await Y.mutateAsync({id:e})},J=e=>{v(e),u(!0)},Z=e=>{f(e),h(!0)},ee=e=>{k(e),g(!0)};return M?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"relative w-16 h-16",children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-accent-primary/20"}),(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-accent-primary animate-spin"})]})}):P?(0,a.jsx)("div",{className:"p-8",children:(0,a.jsx)("div",{className:"bg-error/10 border border-error/30 rounded-xl p-6",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("svg",{className:"w-6 h-6 text-error flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-error mb-1",children:["Error Loading ",_.scenes.plural]}),(0,a.jsx)("p",{className:"text-text-secondary text-sm",children:P.message})]})]})})}):(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-1 text-text-primary",children:_.scenes.label}),(0,a.jsxs)("p",{className:"text-text-secondary",children:["Manage your production ",_.scenes.plural.toLowerCase()," and ",_.shots.plural.toLowerCase()]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-background-secondary border border-border-default rounded-lg p-1",children:[(0,a.jsx)("button",{onClick:()=>l("creative"),className:"px-4 py-2 text-sm font-medium transition-all rounded ".concat("creative"===n?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"creative"===n?{color:"rgb(var(--colored-button-text))"}:void 0,children:"Creative"}),(0,a.jsx)("button",{onClick:()=>l("production"),className:"px-4 py-2 text-sm font-medium transition-all rounded ".concat("production"===n?"bg-accent-primary":"text-text-secondary hover:text-text-primary"),style:"production"===n?{color:"rgb(var(--colored-button-text))"}:void 0,children:"Production"})]}),Q&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>W.mutate({projectId:t}),disabled:W.isPending,className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),W.isPending?"Syncing...":"Sync All to Schedule"]}),(0,a.jsxs)("button",{onClick:G,className:"btn-primary flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add ",_.scenes.singular]})]})]})]}),(0,a.jsx)("div",{className:"card-elevated p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,a.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,a.jsx)("input",{type:"text",placeholder:"Search ".concat(_.scenes.plural.toLowerCase(),"..."),value:w,onChange:e=>C(e.target.value),className:"w-full px-4 py-2 bg-background-secondary border border-border-default rounded-lg text-text-primary placeholder-text-tertiary focus:outline-none focus:border-accent-primary"})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Status:"}),["not-shot","in-progress","completed","omitted"].map(e=>(0,a.jsx)("button",{onClick:()=>{let t=new Set(S);t.has(e)?t.delete(e):t.add(e),D(t)},className:"px-3 py-1 text-xs font-medium rounded transition-colors ".concat(S.has(e)?"bg-accent-primary":"bg-background-tertiary text-text-secondary hover:bg-background-elevated"),style:S.has(e)?{color:"rgb(var(--colored-button-text))"}:void 0,children:e.replace("-"," ")},e))]})]})}),0===$.length?(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-12 h-12 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(0,a.jsxs)("h3",{className:"text-xl font-semibold mb-2",children:["No ",_.scenes.plural.toLowerCase()," found"]}),(0,a.jsx)("p",{className:"text-text-secondary mb-6 max-w-md mx-auto",children:w||S.size<4?"Try adjusting your filters":"Get started by creating your first ".concat(_.scenes.singular.toLowerCase())}),Q&&!w&&4===S.size&&(0,a.jsxs)("button",{onClick:G,className:"btn-primary inline-flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create Your First ",_.scenes.singular]})]}):"creative"===n?(0,a.jsx)(to,{scenes:$,onViewScene:J,onEditScene:K,onDeleteScene:X,onViewShots:Z,onSyncScene:e=>V.mutate({sceneId:e}),canEdit:Q,castMembers:E,crewMembers:T,locations:z,terminology:_}):(0,a.jsx)(ti,{scenes:$,onViewScene:J,onEditScene:K,onDeleteScene:X,onViewShots:Z,onViewShot:ee,onSyncScene:e=>V.mutate({sceneId:e}),onSyncShot:e=>H.mutate({shotId:e}),canEdit:Q,castMembers:E,crewMembers:T,equipment:U,locations:z,schedule:F,projectId:t,terminology:_}),d&&(0,a.jsx)(te,{scene:y,projectId:t,castMembers:E,crewMembers:T,equipment:U,locations:z,schedule:F,onClose:()=>{c(!1),v(null)},onSave:async e=>{y?await B.mutateAsync({id:y.id,data:e}):await q.mutateAsync({...e,projectId:t,createdBy:(null==r?void 0:r.id)||""}),c(!1),v(null)}}),m&&y&&(0,a.jsx)(tt,{scene:y,projectId:t,castMembers:E,crewMembers:T,equipment:U,locations:z,schedule:F,onClose:()=>{u(!1),v(null)},onEdit:Q?()=>{u(!1),K(y)}:void 0,onNavigate:e=>{window.location.hash=e,u(!1),v(null)},onViewShot:ee}),x&&j&&(0,a.jsx)(ts,{sceneId:j,projectId:t,castMembers:E,crewMembers:T,equipment:U,locations:z,schedule:F,initialShotId:null==N?void 0:N.id,onClose:()=>{h(!1),f(null),k(null)},onViewShot:ee}),b&&N&&(0,a.jsx)(tn,{shot:N,projectId:t,castMembers:E,crewMembers:T,equipment:U,locations:z,schedule:F,onClose:()=>{g(!1),k(null)},onEdit:Q?()=>{g(!1),f(N.sceneId),h(!0)}:void 0,onNavigate:e=>{window.location.hash=e,g(!1),k(null)}})]})}function to(e){let{scenes:t,onViewScene:r,onEditScene:s,onDeleteScene:n,onViewShots:l,onSyncScene:o,canEdit:i,castMembers:d,crewMembers:c,locations:u,terminology:x}=e,p={"not-shot":"bg-gray-500/10 border-gray-500/30","in-progress":"bg-blue-500/10 border-blue-500/30",completed:"bg-green-500/10 border-green-500/30",omitted:"bg-red-500/10 border-red-500/30"};return(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>{var t;let b=e.locationIds||(e.locationId?[e.locationId]:[]),g=u.filter(e=>b.includes(e.id)),y=d.filter(t=>{var r;return null==(r=e.castIds)?void 0:r.includes(t.id)}),v=c.filter(t=>{var r;return null==(r=e.crewIds)?void 0:r.includes(t.id)});return(0,a.jsxs)("div",{className:"card-elevated overflow-hidden hover:scale-105 transition-transform cursor-pointer border-2 ".concat(p[e.status]||p["not-shot"]),onClick:()=>r(e),children:[e.imageUrl&&(0,a.jsx)("div",{className:"relative w-full h-48 overflow-hidden bg-background-secondary",children:(0,a.jsx)(m.default,{src:e.imageUrl,alt:e.title||"Scene ".concat(e.sceneNumber),fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",unoptimized:e.imageUrl.startsWith("blob:")||e.imageUrl.startsWith("data:")||(0,h.G)(e.imageUrl)})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-xl font-bold text-text-primary mb-1",children:[x.scenes.singular," ",e.sceneNumber]}),e.title&&(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:e.title})]}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded capitalize ".concat(p[e.status]||p["not-shot"]),children:e.status.replace("-"," ")})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-4 line-clamp-2",children:e.description}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[g.length>0&&(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[g.slice(0,3).map(e=>(0,a.jsxs)("button",{onClick:t=>{t.stopPropagation();let r="locations?id=".concat(e.id);window.location.hash=r},className:"flex items-center gap-1.5 px-2 py-1 bg-background-tertiary rounded text-sm text-text-secondary hover:bg-background-elevated transition-colors cursor-pointer border border-accent-primary/30 hover:border-accent-primary ring-1 ring-transparent hover:ring-accent-primary/20",children:[(0,a.jsxs)("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,a.jsx)("span",{children:e.name})]},e.id)),g.length>3&&(0,a.jsxs)("span",{className:"text-xs text-text-tertiary",children:["+",g.length-3," more"]})]}),e.pageCount&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-text-tertiary",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsxs)("span",{children:[e.pageCount," pages"]})]})]}),(y.length>0||v.length>0)&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[y.slice(0,3).map(e=>(0,a.jsx)("button",{onClick:t=>{t.stopPropagation();let r="cast?id=".concat(e.id);window.location.hash=r},className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xs font-semibold border-2 border-accent-primary/50 hover:border-accent-primary transition-colors cursor-pointer ring-2 ring-transparent hover:ring-accent-primary/30",title:e.characterName,children:e.characterName.charAt(0)},e.id)),y.length>3&&(0,a.jsxs)("span",{className:"text-xs text-text-tertiary",children:["+",y.length-3]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-border-default",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("button",{onClick:t=>{t.stopPropagation(),l(e.id)},className:"text-sm text-accent-primary hover:text-accent-hover font-medium",children:["View ",x.shots.plural]}),i&&o&&((null==(t=e.shootingDayIds)?void 0:t.length)>0||e.shootingDayId)&&(0,a.jsxs)("button",{onClick:t=>{t.stopPropagation(),o(e.id)},className:"text-sm text-text-secondary hover:text-accent-primary font-medium flex items-center gap-1",title:"Sync to Schedule",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Sync"]})]}),i&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"p-2 text-text-secondary hover:text-text-primary hover:bg-background-tertiary rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),confirm("Are you sure you want to delete this ".concat(x.scenes.singular.toLowerCase(),"?"))&&n(e.id)},className:"p-2 text-error hover:bg-error/10 rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})]},e.id)})})}function ti(e){let{scenes:t,onViewScene:r,onEditScene:s,onDeleteScene:n,onViewShots:l,onViewShot:o,onSyncScene:d,onSyncShot:c,canEdit:m,castMembers:u,crewMembers:x,equipment:p,locations:h,schedule:b,projectId:g,terminology:y}=e,[v,j]=(0,i.useState)(new Set);return(0,a.jsx)("div",{className:"card-elevated overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-background-secondary border-b border-border-default",children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-text-tertiary uppercase tracking-wider",children:[y.scenes.singular," #"]}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-text-tertiary uppercase tracking-wider",children:"Title"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-text-tertiary uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-text-tertiary uppercase tracking-wider",children:"Location"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-text-tertiary uppercase tracking-wider",children:"Scheduled"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-text-tertiary uppercase tracking-wider",children:"Duration"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-text-tertiary uppercase tracking-wider",children:"Cast"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-text-tertiary uppercase tracking-wider",children:"Crew"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-text-tertiary uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-border-default",children:t.map(e=>{var t,f;let N=e.locationIds||(e.locationId?[e.locationId]:[]),k=h.filter(e=>N.includes(e.id)),w=u.filter(t=>{var r;return null==(r=e.castIds)?void 0:r.includes(t.id)}),C=x.filter(t=>{var r;return null==(r=e.crewIds)?void 0:r.includes(t.id)}),S=v.has(e.id),D=e.shootingDayIds||(e.shootingDayId?[e.shootingDayId]:[]),I=(null==b||null==(t=b.days)?void 0:t.filter(e=>D.includes(e.id)))||[];return(0,a.jsxs)(i.Fragment,{children:[(0,a.jsxs)("tr",{className:"hover:bg-background-tertiary",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm font-semibold text-text-primary",children:e.sceneNumber}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-text-primary",children:e.title||"-"}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded capitalize ".concat("completed"===e.status?"bg-green-500/10 text-green-400":"in-progress"===e.status?"bg-blue-500/10 text-blue-400":"omitted"===e.status?"bg-red-500/10 text-red-400":"bg-gray-500/10 text-gray-400"),children:e.status.replace("-"," ")})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-text-secondary",children:k.length>0?1===k.length?k[0].name:"".concat(k.length," locations"):"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-text-secondary",children:I.length>0?1===I.length?new Date(I[0].date).toLocaleDateString():"".concat(I.length," days"):e.scheduledDate?new Date(e.scheduledDate).toLocaleDateString():"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-text-secondary",children:e.estimatedDuration?"".concat(e.estimatedDuration," min"):"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-text-secondary",children:w.length>0?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[w.slice(0,2).map(e=>(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xs",title:e.characterName,children:e.characterName.charAt(0)},e.id)),w.length>2&&(0,a.jsxs)("span",{className:"text-xs",children:["+",w.length-2]})]}):"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-text-secondary",children:C.length>0?"".concat(C.length," crew"):"-"}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>r(e),className:"p-1.5 text-text-secondary hover:text-accent-primary hover:bg-accent-primary/10 rounded transition-colors",title:"View ".concat(y.scenes.singular," Details"),children:(0,a.jsxs)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),(0,a.jsx)("button",{onClick:()=>(e=>{let t=new Set(v);t.has(e)?t.delete(e):t.add(e),j(t)})(e.id),className:"p-1.5 text-text-secondary hover:text-text-primary hover:bg-background-elevated rounded transition-colors ".concat(S?"bg-background-elevated":""),title:S?"Collapse":"Expand",children:(0,a.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(S?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),m&&(0,a.jsxs)(a.Fragment,{children:[d&&((null==(f=e.shootingDayIds)?void 0:f.length)>0||e.shootingDayId)&&(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),d(e.id)},className:"p-1.5 text-text-secondary hover:text-accent-primary hover:bg-accent-primary/10 rounded transition-colors",title:"Sync to Schedule",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),l(e.id)},className:"p-1.5 text-text-secondary hover:text-accent-primary hover:bg-accent-primary/10 rounded transition-colors",title:"View ".concat(y.shots.plural),children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"p-1.5 text-text-secondary hover:text-text-primary hover:bg-background-elevated rounded transition-colors",title:"Edit ".concat(y.scenes.singular),children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),confirm("Are you sure you want to delete this ".concat(y.scenes.singular.toLowerCase(),"?"))&&n(e.id)},className:"p-1.5 text-error hover:bg-error/10 rounded transition-colors",title:"Delete ".concat(y.scenes.singular),children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})})]}),S&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:9,className:"px-4 py-4 bg-background-secondary",children:(0,a.jsx)(td,{scene:e,castMembers:w,crewMembers:C,equipment:p.filter(t=>{var r;return null==(r=e.equipmentIds)?void 0:r.includes(t.id)}),locations:k,onViewShots:()=>l(e.id),onSyncShot:c,projectId:g,terminology:y,onNavigate:e=>{window.location.href="/projects/".concat(g,"#").concat(e)},onViewShot:o})})})]},e.id)})})]})})})}function td(e){let{scene:t,castMembers:r,crewMembers:s,equipment:n,locations:l,onViewShots:o,onSyncShot:i,projectId:d,terminology:c,onNavigate:m,onViewShot:u}=e,{shots:x}=e9(t.id),p=(e,t)=>{let r=t?"".concat(e,"?id=").concat(t):e;m?m(r):window.location.href="/projects/".concat(d,"#").concat(r)};return(0,a.jsxs)("div",{className:"space-y-4",children:[t.description&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-accent-primary mb-2",children:"Description"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:t.description})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.pageCount&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-semibold text-accent-secondary mb-1",children:"Pages"}),(0,a.jsx)("p",{className:"text-sm text-text-primary",children:t.pageCount})]}),t.timeOfDay&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-semibold text-accent-secondary mb-1",children:"Time of Day"}),(0,a.jsx)("p",{className:"text-sm text-text-primary",children:t.timeOfDay})]}),t.weather&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-semibold text-accent-secondary mb-1",children:"Weather"}),(0,a.jsx)("p",{className:"text-sm text-text-primary",children:t.weather})]}),t.mood&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-semibold text-accent-secondary mb-1",children:"Mood"}),(0,a.jsx)("p",{className:"text-sm text-text-primary",children:t.mood})]})]}),r.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-accent-primary mb-2",children:"Cast"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(e=>(0,a.jsx)("button",{onClick:()=>p("cast",e.id),className:"px-3 py-1 bg-background-tertiary rounded text-sm text-text-secondary hover:bg-background-elevated transition-colors cursor-pointer border border-accent-primary/30 hover:border-accent-primary ring-1 ring-transparent hover:ring-accent-primary/20",children:e.characterName},e.id))})]}),s.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-accent-primary mb-2",children:"Crew"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map(e=>(0,a.jsxs)("button",{onClick:()=>p("crew",e.id),className:"px-3 py-1 bg-background-tertiary rounded text-sm text-text-secondary hover:bg-background-elevated transition-colors cursor-pointer border border-accent-primary/30 hover:border-accent-primary ring-1 ring-transparent hover:ring-accent-primary/20",children:[e.name," - ",e.role]},e.id))})]}),n.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-accent-primary mb-2",children:"Equipment"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(e=>(0,a.jsx)("button",{onClick:()=>p("equipment",e.id),className:"px-3 py-1 bg-background-tertiary rounded text-sm text-text-secondary hover:bg-background-elevated transition-colors cursor-pointer border border-accent-primary/30 hover:border-accent-primary ring-1 ring-transparent hover:ring-accent-primary/20",children:e.name},e.id))})]}),l.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-accent-primary mb-2",children:"Locations"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(e=>(0,a.jsx)("button",{onClick:()=>p("locations",e.id),className:"px-3 py-1 bg-background-tertiary rounded text-sm text-text-secondary hover:bg-background-elevated transition-colors cursor-pointer border border-accent-primary/30 hover:border-accent-primary ring-1 ring-transparent hover:ring-accent-primary/20",children:e.name},e.id))})]}),x&&x.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-accent-primary mb-2",children:c.shots.plural}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:x.map(e=>{var r,s;let n={"not-shot":"bg-gray-500/10 text-gray-400","in-progress":"bg-blue-500/10 text-blue-400",completed:"bg-green-500/10 text-green-400",omitted:"bg-red-500/10 text-red-400"};return(0,a.jsx)("div",{className:"p-2 bg-background-tertiary rounded border border-border-default hover:bg-background-elevated hover:border-accent-primary/50 transition-all",children:(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("button",{onClick:()=>null==u?void 0:u(e),className:"text-left flex-1",children:[(0,a.jsxs)("span",{className:"text-xs font-semibold text-text-primary",children:[c.shots.singular," ",e.shotNumber]}),e.title&&(0,a.jsx)("p",{className:"text-xs text-text-secondary truncate",children:e.title})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[i&&((null==(r=e.shootingDayIds)?void 0:r.length)>0||e.shootingDayId||(null==(s=t.shootingDayIds)?void 0:s.length)>0||t.shootingDayId)&&(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),i(e.id)},className:"p-1 text-text-secondary hover:text-accent-primary hover:bg-accent-primary/10 rounded transition-colors",title:"Sync to Schedule",children:(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,a.jsx)("span",{className:"px-1.5 py-0.5 text-xs font-semibold rounded capitalize ".concat(n[e.status]||n["not-shot"]),children:e.status.replace("-"," ")})]})]})},e.id)})})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("button",{onClick:o,className:"btn-secondary text-sm",children:["View ",c.shots.plural]})})]})}function tc(e){var t,r,s,n;let{integration:l,projectId:d,onClose:c}=e,[m,u]=(0,i.useState)((null==(t=l.config)?void 0:t.slackChannelId)||""),[x,p]=(0,i.useState)((null==(r=l.config)?void 0:r.slackChannelName)||""),h=o.i.useUtils(),b=o.i.integrations.update.useMutation({onSuccess:()=>{h.integrations.listByProject.invalidate({projectId:d}),c()}}),{data:g,isLoading:y}=o.i.integrations.getSlackChannels.useQuery({integrationId:l.id},{enabled:"slack"===l.type&&"connected"===l.status}),v=async()=>{let e=null==g?void 0:g.channels.find(e=>e.id===m);await b.mutateAsync({id:l.id,config:{...l.config,slackChannelId:m||void 0,slackChannelName:(null==e?void 0:e.name)||x||void 0}})},j=(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-background-secondary border border-border-default rounded-lg w-full max-w-md overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary",children:"Configure Slack"}),(0,a.jsx)("button",{onClick:c,className:"p-2 text-text-secondary hover:text-text-primary hover:bg-background-tertiary rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(null==(s=l.config)?void 0:s.slackTeamName)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-text-secondary mb-2 block",children:"Workspace"}),(0,a.jsx)("p",{className:"text-text-primary",children:l.config.slackTeamName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-text-secondary mb-2 block",children:"Channel"}),y?(0,a.jsx)("div",{className:"text-text-tertiary text-sm",children:"Loading channels..."}):(null==g?void 0:g.channels)&&g.channels.length>0?(0,a.jsxs)("select",{value:m,onChange:e=>{let t=g.channels.find(t=>t.id===e.target.value);u(e.target.value),p((null==t?void 0:t.name)||"")},className:"w-full px-3 py-2 bg-background-tertiary border border-border-default rounded-lg text-text-primary focus:outline-none focus:border-accent-primary",children:[(0,a.jsx)("option",{value:"",children:"Select a channel..."}),g.channels.map(e=>(0,a.jsxs)("option",{value:e.id,children:["#",e.name," ",e.isPrivate?"(Private)":"",e.isMember?"":" (Not a member - invite bot first)"]},e.id))]}):(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"bg-background-tertiary p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-2",children:"No channels found. To use Slack notifications:"}),(0,a.jsxs)("ol",{className:"text-sm text-text-secondary list-decimal list-inside space-y-1",children:[(0,a.jsx)("li",{children:"Go to your Slack workspace"}),(0,a.jsxs)("li",{children:["Invite the ",(0,a.jsx)("strong",{children:"@doublecheck"})," bot to a channel (type ",(0,a.jsx)("code",{className:"bg-background-secondary px-1 rounded",children:"/invite @doublecheck"})," in the channel)"]}),(0,a.jsx)("li",{children:"Or create a new channel and add the bot"}),(0,a.jsx)("li",{children:"Refresh this page to see available channels"})]})]}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"btn-secondary text-sm w-full",children:"Refresh Channels"})]})]}),m&&(0,a.jsxs)("div",{className:"bg-background-tertiary p-3 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-xs text-text-secondary",children:["Messages will be sent to #",x||"selected channel"," when you sync."]}),(null==g||null==(n=g.channels.find(e=>e.id===m))?void 0:n.isMember)===!1&&(0,a.jsx)("p",{className:"text-xs text-error mt-2",children:"⚠️ The bot is not a member of this channel. Invite @doublecheck to the channel in Slack first."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-4",children:[(0,a.jsx)("button",{onClick:c,className:"btn-secondary flex-1",children:"Cancel"}),(0,a.jsx)("button",{onClick:v,disabled:b.isPending,className:"btn-primary flex-1",children:b.isPending?"Saving...":"Save"})]})]})]})});return(0,eS.createPortal)(j,document.body)}function tm(e){var t,r,s;let{integration:n,projectId:l}=e,[d,c]=(0,i.useState)(!1),[m,u]=(0,i.useState)(!1),x=o.i.useUtils(),p=ev[n.type],h=o.i.integrations.delete.useMutation({onSuccess:()=>{x.integrations.listByProject.invalidate({projectId:l})}}),b=o.i.integrations.sync.useMutation({onSuccess:e=>{x.integrations.listByProject.invalidate({projectId:l}),c(!1),e.message&&alert(e.message)},onError:e=>{c(!1),alert("Sync failed: ".concat(e.message))}}),g=async()=>{c(!0),await b.mutateAsync({integrationId:n.id})},y=async()=>{confirm("Are you sure you want to disconnect this integration?")&&await h.mutateAsync({id:n.id})};return(0,a.jsxs)("div",{className:"card-elevated p-6",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"text-3xl",children:p.icon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:n.name}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat({disconnected:"bg-gray-500/10 text-gray-400",connecting:"bg-blue-500/10 text-blue-400",connected:"bg-green-500/10 text-green-400",error:"bg-red-500/10 text-red-400"}[n.status]),children:n.status.replace("_"," ")})]})]})}),n.description&&(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-4",children:n.description}),"slack"===n.type&&"connected"===n.status&&(0,a.jsxs)("div",{className:"bg-background-tertiary p-3 rounded-lg mb-4 space-y-1",children:[(null==(t=n.config)?void 0:t.slackTeamName)&&(0,a.jsxs)("div",{className:"text-xs text-text-secondary",children:[(0,a.jsx)("span",{className:"font-medium",children:"Workspace:"})," ",n.config.slackTeamName]}),(null==(r=n.config)?void 0:r.slackChannelName)&&(0,a.jsxs)("div",{className:"text-xs text-text-secondary",children:[(0,a.jsx)("span",{className:"font-medium",children:"Channel:"})," #",n.config.slackChannelName]}),!(null==(s=n.config)?void 0:s.slackChannelName)&&(0,a.jsx)("div",{className:"text-xs text-text-tertiary italic",children:"No channel configured - messages will go to #general"})]}),n.lastSyncAt&&(0,a.jsxs)("div",{className:"text-xs text-text-tertiary mb-4",children:["Last synced: ",new Date(n.lastSyncAt).toLocaleString()]}),n.lastSyncError&&(0,a.jsxs)("div",{className:"text-xs text-error mb-4 bg-error/10 p-2 rounded",children:["Last error: ",n.lastSyncError]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-4 border-t border-border-default",children:["connected"===n.status&&(0,a.jsxs)(a.Fragment,{children:["slack"===n.type&&(0,a.jsx)("button",{onClick:()=>u(!0),className:"btn-secondary text-sm",title:"Configure channel",children:"Settings"}),(0,a.jsx)("button",{onClick:g,disabled:d,className:"btn-secondary text-sm flex-1",children:d?"Syncing...":"Sync Now"})]}),(0,a.jsx)("button",{onClick:y,className:"btn-secondary text-sm text-error hover:bg-error/10",children:"Disconnect"})]}),m&&(0,a.jsx)(tc,{integration:n,projectId:l,onClose:()=>u(!1)})]})}function tu(e){let{projectId:t,integrationType:r,onClose:s}=e,[n,l]=(0,i.useState)(!1),d=o.i.useUtils(),c=ev[r],m=o.i.integrations.create.useMutation({onSuccess:async e=>{if(d.integrations.listByProject.invalidate({projectId:t}),c.requiresOAuth){let t=window.location.origin,a="".concat(t,"/api/integrations/oauth/").concat(r,"?integrationId=").concat(e.id);window.location.href=a}else s()}}),u=async()=>{l(!0);try{await m.mutateAsync({projectId:t,type:r,name:c.name,description:c.description})}catch(e){console.error("Error creating integration:",e),l(!1)}},x=(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-background-secondary border border-border-default rounded-lg w-full max-w-md overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"text-4xl",children:c.icon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary",children:c.name}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:c.category})]})]}),(0,a.jsx)("button",{onClick:s,className:"p-2 text-text-secondary hover:text-text-primary hover:bg-background-tertiary rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsx)("p",{className:"text-text-secondary",children:c.description}),c.requiresOAuth?(0,a.jsx)("div",{className:"bg-background-tertiary p-4 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-text-secondary",children:["You'll be redirected to authenticate with ",c.name,". After authorization, you'll be brought back to complete the connection."]})}):(0,a.jsx)("div",{className:"bg-background-tertiary p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"This integration supports file import. You'll be able to upload files after connecting."})}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-4",children:[(0,a.jsx)("button",{onClick:s,className:"btn-secondary flex-1",children:"Cancel"}),(0,a.jsx)("button",{onClick:u,disabled:n,className:"btn-primary flex-1",children:n?"Connecting...":"Connect"})]})]})]})});return(0,eS.createPortal)(x,document.body)}function tx(e){let{projectId:t}=e,[r,s]=(0,i.useState)(null),[n,l]=(0,i.useState)(!1),{data:d=[],isLoading:c}=o.i.integrations.listByProject.useQuery({projectId:t}),{data:m=[]}=o.i.integrations.getAvailableTypes.useQuery(),u=m.reduce((e,t)=>{let r=t.category;return e[r]||(e[r]=[]),e[r].push(t),e},{});return c?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-text-secondary",children:"Loading integrations..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-1 text-text-primary",children:"Integrations"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Connect your favorite tools to streamline your production workflow"})]})}),d.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-4",children:"Connected"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(e=>(0,a.jsx)(tm,{integration:e,projectId:t},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-4",children:"Available Integrations"}),Object.entries(u).map(e=>{let[t,r]=e;return(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-text-secondary mb-3 capitalize",children:t}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(e=>{let t=d.some(t=>t.type===e.type);return(0,a.jsx)("div",{className:"card-elevated p-6 cursor-pointer hover:scale-105 transition-transform ".concat(t?"opacity-60":""),onClick:()=>!t&&void(s(e.type),l(!0)),children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"text-4xl",children:e.icon}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold text-text-primary mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-4",children:e.description}),t?(0,a.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-500/10 text-green-400",children:"Connected"}):(0,a.jsx)("button",{className:"btn-primary text-sm",children:"Connect"})]})]})},e.type)})})]},t)})]}),n&&r&&(0,a.jsx)(tu,{projectId:t,integrationType:r,onClose:()=>{l(!1),s(null)}})]})}function tp(e){let{reference:t,projectId:r,onClose:s,onViewShot:n}=e,{data:l}=o.i.projects.getById.useQuery({id:r}),{data:i=[],isLoading:d}=o.i.referenceImages.getShotsByReference.useQuery({referenceId:t.id,projectId:r}),c=eM(null==l?void 0:l.projectType);return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,a.jsxs)("div",{className:"bg-background-primary rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-border-default flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:t.name}),t.category&&(0,a.jsx)("span",{className:"inline-block px-3 py-1 text-sm font-semibold rounded capitalize bg-background-tertiary text-text-secondary",children:{wardrobe:"Wardrobe",camera:"Camera",location:"Location",character:"Character",other:"Other"}[t.category]||t.category})]}),(0,a.jsx)("button",{onClick:s,className:"p-2 text-text-secondary hover:text-text-primary hover:bg-background-tertiary rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{className:"relative w-full aspect-square bg-background-secondary rounded-lg border border-border-default overflow-hidden",children:(0,a.jsx)(m.default,{src:t.url,alt:t.name,fill:!0,className:"object-contain",unoptimized:(0,h.G)(t.url)})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-accent-primary mb-4",children:["Used in ",c.shots.plural," (",i.length,")"]}),d?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsxs)("div",{className:"relative w-8 h-8",children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-accent-primary/20"}),(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-accent-primary animate-spin"})]})}):0===i.length?(0,a.jsxs)("div",{className:"text-center py-8 text-sm text-text-tertiary",children:["This reference is not currently used in any ",c.shots.plural.toLowerCase(),"."]}):(0,a.jsx)("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:i.map(e=>(0,a.jsx)("button",{onClick:()=>{var t,r;return t=e.id,r=e.sceneId,void(n&&n(t,r),s())},className:"w-full text-left p-3 bg-background-secondary hover:bg-background-tertiary rounded-lg border border-border-default hover:border-accent-primary/50 transition-all group",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("span",{className:"font-semibold text-text-primary",children:[c.shots.singular," ",e.shotNumber]}),e.title&&(0,a.jsxs)("span",{className:"text-sm text-text-secondary",children:["- ",e.title]})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-text-tertiary line-clamp-2 mt-1",children:e.description}),e.shotType&&(0,a.jsx)("span",{className:"inline-block mt-2 text-xs px-2 py-0.5 bg-background-tertiary rounded capitalize text-text-secondary",children:e.shotType.replace("-"," ")})]}),(0,a.jsx)("svg",{className:"w-5 h-5 text-text-tertiary group-hover:text-accent-primary transition-colors flex-shrink-0 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},e.id))})]})]}),t.tags&&t.tags.length>0&&(0,a.jsxs)("div",{className:"mt-6 pt-6 border-t border-border-default",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-text-secondary mb-2",children:"Tags"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:t.tags.map(e=>(0,a.jsx)("span",{className:"px-2 py-1 text-xs bg-background-tertiary rounded text-text-secondary",children:e},e))})]})]}),(0,a.jsx)("div",{className:"p-6 border-t border-border-default flex justify-end",children:(0,a.jsx)("button",{onClick:s,className:"btn-primary",children:"Close"})})]})})}function th(e){let{img:t,onDragStart:r,onView:s,onDelete:n}=e,l=(0,i.useRef)({wasDragged:!1});return(0,a.jsxs)("div",{className:"relative group rounded overflow-hidden border border-border-subtle aspect-square",children:[(0,a.jsx)("div",{className:"w-full h-full cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:e=>{l.current.wasDragged=!0,r(e,t.url)},onMouseDown:()=>{l.current.wasDragged=!1},onMouseUp:e=>{l.current.wasDragged||(e.stopPropagation(),s(t)),setTimeout(()=>{l.current.wasDragged=!1},100)},children:(0,a.jsx)(m.default,{src:t.url,alt:t.name,fill:!0,className:"object-cover pointer-events-none",unoptimized:(0,h.G)(t.url)})}),(0,a.jsxs)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-1 pointer-events-none",children:[(0,a.jsx)("div",{className:"p-1.5 bg-white/10 rounded text-white",children:(0,a.jsxs)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),n(t.id)},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:"p-1.5 bg-white/10 hover:bg-error rounded text-white transition-colors pointer-events-auto",title:"Delete",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}function tb(e){let{projectId:t,onDragStart:r,onViewShot:s}=e,{images:n,isLoading:l,createReferenceImage:o,deleteReferenceImage:d,migrateShotReferences:c}=ta(t),[m,u]=(0,i.useState)(!1),[x,p]=(0,i.useState)(!1),[b,g]=(0,i.useState)([]),[y,v]=(0,i.useState)({}),[j,f]=(0,i.useState)(!1),[N,k]=(0,i.useState)(null),w=(0,i.useRef)(null),C=async e=>{p(!1),u(!0);try{for(let r=0;r<b.length;r++){let a=b[r],s="projects/".concat(t,"/references/").concat(Date.now(),"-").concat(a.name),n=await (0,h.uploadImage)(a,s);await o.mutateAsync({projectId:t,url:n,name:a.name,category:e,tags:[]})}}catch(e){console.error("Error uploading reference:",e),alert("Failed to upload reference image")}finally{u(!1),g([]),w.current&&(w.current.value="")}},S=async e=>{confirm("Are you sure you want to delete this reference image?")&&await d.mutateAsync({id:e,projectId:t})},D=async()=>{if(confirm("This will migrate any references that were uploaded directly to shots into the reference gallery. Continue?"))try{f(!0);let e=await c.mutateAsync({projectId:t});alert(e.message||"Migration complete! Created ".concat(e.referencesCreated," reference(s)."))}catch(e){console.error("Migration error:",e),alert("Migration failed: ".concat(e.message||"Unknown error"))}finally{f(!1)}},I={wardrobe:"Wardrobe",camera:"Camera",location:"Location",character:"Character",other:"Other",uncategorized:"Uncategorized"},L=n.reduce((e,t)=>{let r=t.category||"uncategorized";return e[r]||(e[r]=[]),e[r].push(t),e},{});return(0,a.jsxs)("div",{className:"w-64 bg-background-secondary border-l border-border-subtle flex flex-col h-full flex-shrink-0",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-border-subtle",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary",children:"References"}),(0,a.jsx)("button",{onClick:()=>{var e;return null==(e=w.current)?void 0:e.click()},className:"p-1.5 text-accent-primary hover:bg-accent-primary/10 rounded transition-colors",disabled:m,title:"Upload References",children:m?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),(0,a.jsx)("button",{onClick:D,disabled:j||c.isPending,className:"w-full text-xs text-text-secondary hover:text-text-primary px-2 py-1.5 bg-background-tertiary hover:bg-background-elevated rounded transition-colors flex items-center justify-center gap-1",title:"Migrate references from shots to gallery",children:j||c.isPending?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Migrating..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,a.jsx)("span",{children:"Migrate Shot References"})]})}),(0,a.jsx)("input",{ref:w,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>{let t=e.target.files;t&&0!==t.length&&(g(Array.from(t)),p(!0))}})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[0===n.length&&!l&&(0,a.jsx)("div",{className:"text-center py-8 text-sm text-text-tertiary",children:"No reference images. Upload some to use them in your storyboard."}),["wardrobe","camera","location","character","other","uncategorized"].map(e=>{let t=L[e];if(!(null==t?void 0:t.length))return null;let s=y[e];return(0,a.jsxs)("div",{className:"border border-border-default rounded-lg overflow-hidden bg-background-primary",children:[(0,a.jsxs)("button",{onClick:()=>{v(t=>({...t,[e]:!t[e]}))},className:"w-full flex items-center justify-between p-2 bg-background-tertiary hover:bg-background-elevated transition-colors text-left",children:[(0,a.jsxs)("span",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider",children:[I[e]||e," (",t.length,")"]}),(0,a.jsx)("svg",{className:"w-3 h-3 text-text-tertiary transition-transform ".concat(s?"-rotate-90":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),!s&&(0,a.jsx)("div",{className:"p-2 grid grid-cols-2 gap-2",children:t.map(e=>(0,a.jsx)(th,{img:e,onDragStart:r,onView:k,onDelete:S},e.id))})]},e)})]}),(0,a.jsx)(tr,{isOpen:x,onClose:()=>{p(!1),g([]),w.current&&(w.current.value="")},onSelectCategory:C,imageUrl:b.length>0?URL.createObjectURL(b[0]):""}),N&&(0,a.jsx)(tp,{reference:N,projectId:t,onClose:()=>k(null),onViewShot:s})]})}function tg(e){var t,r,s,n,l,d,c,u,x,b,g,y,v,j,f;let{projectId:N}=e,{user:k}=(0,p.A)(),{scenes:w,isLoading:C}=e7(N),{shots:S,isLoading:D,updateShot:I,createShot:L,updateShotOrder:A}=function(e){let t=o.i.useUtils(),{data:r=[],isLoading:a,error:s,refetch:n}=o.i.shots.listByProject.useQuery({projectId:e}),l=(0,i.useMemo)(()=>r.map(e=>({...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)})),[r]),d=o.i.shots.create.useMutation({onSuccess:()=>{t.shots.listByProject.invalidate({projectId:e})}}),c=o.i.shots.update.useMutation({onSuccess:()=>{t.shots.listByProject.invalidate({projectId:e})}});return{shots:l,isLoading:a,error:s,refetch:n,createShot:d,updateShot:c,deleteShot:o.i.shots.delete.useMutation({onSuccess:()=>{t.shots.listByProject.invalidate({projectId:e})}}),updateShotOrder:o.i.shots.updateOrder.useMutation({onSuccess:()=>{t.shots.listByProject.invalidate({projectId:e})}})}}(N),{data:M=[]}=o.i.cast.listByProject.useQuery({projectId:N}),{data:P=[]}=o.i.crew.listByProject.useQuery({projectId:N}),{data:q=[]}=o.i.equipment.listByProject.useQuery({projectId:N}),{data:B=[]}=o.i.locations.listByProject.useQuery({projectId:N}),{data:Y}=o.i.schedule.getSchedule.useQuery({projectId:N}),[R,E]=(0,i.useState)(null),[T,U]=(0,i.useState)(!1),[z,F]=(0,i.useState)(!1),[O,W]=(0,i.useState)(null),[V,H]=(0,i.useState)(!1),[_,Q]=(0,i.useState)(0),[$,G]=(0,i.useState)(null),[K,X]=(0,i.useState)(!0),[J,Z]=(0,i.useState)(!1),[ee,et]=(0,i.useState)(null),[er,ea]=(0,i.useState)(null),[es,en]=(0,i.useState)(null),[el,eo]=(0,i.useState)(null),[ei,ed]=(0,i.useState)(null),ec=(0,i.useMemo)(()=>{let e={};return w.forEach(t=>{e[t.id]=[]}),S.forEach(t=>{e[t.sceneId]&&e[t.sceneId].push(t)}),Object.keys(e).forEach(t=>{e[t].sort((e,t)=>void 0!==e.sortOrder&&void 0!==t.sortOrder?e.sortOrder-t.sortOrder:e.shotNumber.localeCompare(t.shotNumber,void 0,{numeric:!0}))}),e},[w,S]),em=async(e,t)=>{if(e)try{en(t);let r="projects/".concat(N,"/shots/").concat(t,"/").concat(Date.now(),"-").concat(e.name),a=await (0,h.uploadImage)(e,r);await I.mutateAsync({id:t,data:{imageUrl:a}})}catch(e){console.error("Failed to upload image:",e),alert("Failed to upload image")}finally{en(null)}},eu=async(e,t)=>{let r=ec[e]||[],a="1";if(t){let e=t.shotNumber.replace(/[a-zA-Z]+$/,""),s=r.filter(t=>t.shotNumber.startsWith(e)),n=s[s.length-1].shotNumber.match(/(\d+)([a-zA-Z]*)$/);if(n){let t=n[2];if(t){let r=String.fromCharCode(t.slice(-1).charCodeAt(0)+1);a="".concat(e).concat(t.slice(0,-1)).concat(r)}else a="".concat(e,"A")}else a="".concat(e,"A")}else{let e=(r.length>0?r[r.length-1].shotNumber:"0").match(/(\d+)([a-zA-Z]*)$/);if(e){let t=parseInt(e[1]);a="".concat(t+1)}else r.length>0&&(a="".concat(r.length+1))}let s=r.reduce((e,t)=>Math.max(e,t.sortOrder||0),0);await L.mutateAsync({projectId:N,sceneId:e,shotNumber:a,shotType:t?t.shotType:"master",status:"not-shot",createdBy:(null==k?void 0:k.id)||"",sortOrder:s+1e3,...t?{description:t.description,actionDescription:t.actionDescription,locationIds:t.locationIds,castIds:t.castIds,crewIds:t.crewIds,equipmentIds:t.equipmentIds}:{}})},ex=e=>{e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.getData("type")||(ei?"reference":el?"shot":"");e.dataTransfer.dropEffect="reference"===t?"copy":"move"},ep=async(e,t,r)=>{if(e.preventDefault(),e.stopPropagation(),"reference"===e.dataTransfer.getData("type")||ei){let r=e.dataTransfer.getData("imageUrl")||ei;r&&t&&(et(r),ea(t.id),Z(!0)),ed(null);return}if(el&&el.id!==t.id){if(el.sceneId===r){let e=[...ec[r]||[]],a=e.findIndex(e=>e.id===el.id),s=e.findIndex(e=>e.id===t.id);if(-1===a||-1===s)return;let[n]=e.splice(a,1);e.splice(s,0,n);let l=e.map((e,t)=>({id:e.id,sortOrder:(t+1)*1e3}));try{await A.mutateAsync({updates:l})}catch(e){console.error("Failed to update order:",e)}}else{let e=[...ec[r]||[]],a=e.findIndex(e=>e.id===t.id);e.splice(a,0,el),await I.mutateAsync({id:el.id,data:{sceneId:r}});let s=e.map((e,t)=>({id:e.id,sortOrder:(t+1)*1e3}));try{await A.mutateAsync({updates:s})}catch(e){console.error("Failed to update order in new scene:",e)}}eo(null)}},eh=async e=>{if(!ee||!er)return;let t=S.find(e=>e.id===er);if(!t)return;let r={id:crypto.randomUUID(),url:ee,category:e},a=[...t.shotReferences||[],r];try{await I.mutateAsync({id:t.id,data:{shotReferences:a}})}catch(e){console.error("Failed to add reference:",e),alert("Failed to add reference image")}Z(!1),et(null),ea(null)},eb=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;G(e),Q(t),H(!0)};return C||D?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"relative w-16 h-16",children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-accent-primary/20"}),(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-accent-primary animate-spin"})]})}):(0,a.jsxs)("div",{className:"flex h-full overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-8 relative",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-1 text-text-primary",children:"Storyboards"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Visual planning and shot lists"})]}),(0,a.jsxs)("button",{onClick:()=>X(!K),className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ".concat(K?"bg-accent-primary":"bg-background-secondary text-text-secondary hover:bg-background-tertiary"),style:K?{color:"rgb(var(--colored-button-text))"}:void 0,children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),K?"Hide References":"Show References"]})]}),(0,a.jsxs)("div",{className:"space-y-12 pb-20",children:[w.map(e=>{var t;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 border-b border-border-subtle pb-2 sticky top-0 bg-background-primary z-10 pt-2",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-text-primary",children:["Scene ",e.sceneNumber]}),(0,a.jsx)("span",{className:"text-text-secondary text-sm truncate max-w-md",children:e.title}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>eb(e.id),className:"text-xs bg-background-tertiary text-text-secondary hover:text-text-primary px-2 py-1 rounded hover:bg-background-elevated transition-colors flex items-center gap-1",disabled:!(null==(t=ec[e.id])?void 0:t.length),children:[(0,a.jsxs)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Play"]}),(0,a.jsx)("button",{onClick:()=>eu(e.id),className:"text-xs bg-accent-primary/10 text-accent-primary px-2 py-1 rounded hover:bg-accent-primary/20 transition-colors font-medium",children:"+ Add Shot"}),(0,a.jsx)("button",{onClick:()=>{W(e.id),F(!0)},className:"text-xs text-text-secondary hover:text-text-primary px-2 py-1 rounded hover:bg-background-tertiary transition-colors",children:"Manage List"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 min-h-[100px]",onDragOver:e=>{e.preventDefault();let t=e.dataTransfer.getData("type")||(ei?"reference":el?"shot":"");e.dataTransfer.dropEffect="reference"===t?"copy":"move"},onDrop:async t=>{if(t.preventDefault(),"reference"!==t.dataTransfer.getData("type")&&el&&el.sceneId!==e.id&&(t.target===t.currentTarget||t.target.closest(".grid")===t.currentTarget)){await I.mutateAsync({id:el.id,data:{sceneId:e.id}});let t=(ec[e.id]||[]).reduce((e,t)=>Math.max(e,t.sortOrder||0),0);await A.mutateAsync({updates:[{id:el.id,sortOrder:t+1e3}]}),eo(null)}},children:[(ec[e.id]||[]).map((t,r)=>(0,a.jsxs)("div",{draggable:!0,onDragStart:e=>{eo(t),ed(null),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("type","shot"),e.dataTransfer.setData("shotId",t.id)},onDragOver:ex,onDrop:r=>ep(r,t,e.id),className:"group relative bg-background-secondary border border-border-default rounded-lg overflow-hidden hover:border-accent-primary/50 transition-all flex flex-col ".concat((null==el?void 0:el.id)===t.id?"opacity-50 border-dashed border-accent-primary":""," ").concat(ei?"border-dashed border-accent-secondary":""),children:[(0,a.jsxs)("div",{className:"relative aspect-video bg-black/20 group-hover:bg-black/30 transition-colors cursor-move",children:[t.imageUrl?(0,a.jsx)(m.default,{src:t.imageUrl,alt:"Shot ".concat(t.shotNumber),fill:!0,className:"object-cover",unoptimized:t.imageUrl.startsWith("blob:")||t.imageUrl.startsWith("data:")||(0,h.G)(t.imageUrl)}):(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-text-tertiary",children:(0,a.jsx)("svg",{className:"w-8 h-8 opacity-20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,a.jsxs)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[(0,a.jsxs)("label",{className:"cursor-pointer p-2 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors",title:"Upload Storyboard Image",children:[(0,a.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:e=>{var r;(null==(r=e.target.files)?void 0:r[0])&&em(e.target.files[0],t.id)},disabled:es===t.id}),es===t.id?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})]}),(0,a.jsx)("button",{onClick:()=>eb(e.id,r),className:"p-2 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors",title:"View Fullscreen",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),(0,a.jsx)("button",{onClick:()=>{E(t),U(!0)},className:"p-2 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors",title:"View Details",children:(0,a.jsxs)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),(0,a.jsx)("div",{className:"absolute top-2 left-2 bg-background-primary/90 text-text-primary px-2 py-0.5 text-xs font-bold rounded shadow-sm border border-border-subtle",children:t.shotNumber}),t.shotReferences&&t.shotReferences.length>0&&(0,a.jsxs)("div",{className:"absolute bottom-2 right-2 flex gap-1",children:[t.shotReferences.some(e=>"wardrobe"===e.category)&&(0,a.jsx)("span",{className:"bg-black/50 p-1 rounded text-xs",title:"Wardrobe",children:"\uD83D\uDC55"}),t.shotReferences.some(e=>"camera"===e.category)&&(0,a.jsx)("span",{className:"bg-black/50 p-1 rounded text-xs",title:"Camera",children:"\uD83C\uDFA5"}),t.shotReferences.some(e=>"location"===e.category)&&(0,a.jsx)("span",{className:"bg-black/50 p-1 rounded text-xs",title:"Location",children:"\uD83D\uDCCD"}),t.shotReferences.some(e=>"character"===e.category)&&(0,a.jsx)("span",{className:"bg-black/50 p-1 rounded text-xs",title:"Character",children:"\uD83D\uDC64"}),t.shotReferences.some(e=>"other"===e.category)&&(0,a.jsx)("span",{className:"bg-black/50 p-1 rounded text-xs",title:"Other",children:"\uD83D\uDD16"})]})]}),(0,a.jsxs)("div",{className:"p-3 flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-accent-primary uppercase tracking-wider",children:t.shotType}),(0,a.jsx)("button",{onClick:()=>eu(e.id,t),className:"text-[10px] text-text-tertiary hover:text-accent-primary transition-colors",title:"Create Variant",children:"+ Variant"})]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary line-clamp-2 flex-1",children:t.description||t.actionDescription||(0,a.jsx)("span",{className:"text-text-tertiary italic",children:"No description"})})]})]},t.id)),(!ec[e.id]||0===ec[e.id].length)&&(0,a.jsxs)("div",{onDragOver:e=>{e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.getData("type")||(el?"shot":"");e.dataTransfer.dropEffect="shot"===t?"move":"none"},onDrop:async t=>{t.preventDefault(),t.stopPropagation(),"shot"===t.dataTransfer.getData("type")&&el&&el.sceneId!==e.id&&(await I.mutateAsync({id:el.id,data:{sceneId:e.id}}),await A.mutateAsync({updates:[{id:el.id,sortOrder:1e3}]}),eo(null))},className:"aspect-video border-2 border-dashed border-border-default rounded-lg flex flex-col items-center justify-center text-text-tertiary hover:border-accent-primary hover:text-accent-primary transition-colors h-full min-h-[150px] col-span-full",children:[(0,a.jsx)("svg",{className:"w-8 h-8 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Add First Shot"}),el&&el.sceneId!==e.id&&(0,a.jsx)("span",{className:"text-xs mt-1 text-accent-primary",children:"Drop shot here"})]})]})]},e.id)}),0===w.length&&(0,a.jsx)("div",{className:"text-center py-12 text-text-secondary",children:"No scenes found. Create scenes in the Scenes tab to start storyboarding."})]})]}),K&&(0,a.jsx)(tb,{projectId:N,onDragStart:(e,t)=>{ed(t),eo(null),e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("type","reference"),e.dataTransfer.setData("imageUrl",t)},onViewShot:(e,t)=>{let r=S.find(t=>t.id===e);r&&(E(r),U(!0))}}),(0,a.jsx)(tr,{isOpen:J,onClose:()=>{Z(!1),et(null),ea(null)},onSelectCategory:eh,imageUrl:ee||""}),T&&R&&(0,a.jsx)(tn,{shot:R,projectId:N,castMembers:M,crewMembers:P,equipment:q,locations:B,schedule:Y,onClose:()=>{U(!1),E(null)},onEdit:()=>{U(!1),W(R.sceneId),E(R),F(!0)}}),z&&O&&(0,a.jsx)(ts,{sceneId:O,projectId:N,castMembers:M,crewMembers:P,equipment:q,locations:B,schedule:Y,initialShotId:null==R?void 0:R.id,onClose:()=>{F(!1),W(null),E(null)}}),V&&$&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 bg-gradient-to-b from-black/50 to-transparent absolute top-0 left-0 right-0 z-10",children:[(0,a.jsxs)("div",{className:"text-white",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg",children:["Scene ",null==(t=w.find(e=>e.id===$))?void 0:t.sceneNumber]}),(0,a.jsxs)("p",{className:"text-sm opacity-80",children:["Shot ",null==(s=ec[$])||null==(r=s[_])?void 0:r.shotNumber,"(",_+1," / ",null==(n=ec[$])?void 0:n.length,")"]})]}),(0,a.jsx)("button",{onClick:()=>H(!1),className:"p-2 text-white hover:text-gray-300 rounded-full bg-white/10 hover:bg-white/20",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"flex-1 flex items-center justify-center relative",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),Q(e=>Math.max(0,e-1))},disabled:0===_,className:"absolute left-4 p-4 text-white hover:bg-white/10 rounded-full disabled:opacity-30 disabled:cursor-not-allowed z-10 transition-colors",children:(0,a.jsx)("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("div",{className:"relative w-full h-full max-w-6xl max-h-[85vh] p-4",children:(null==(d=ec[$])||null==(l=d[_])?void 0:l.imageUrl)?(0,a.jsx)(m.default,{src:ec[$][_].imageUrl,alt:"Shot",fill:!0,className:"object-contain",unoptimized:!0}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("svg",{className:"w-24 h-24 mx-auto mb-4 opacity-20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{children:"No image uploaded for this shot"})]})})}),(0,a.jsx)("button",{onClick:e=>{var t;e.stopPropagation();let r=((null==(t=ec[$])?void 0:t.length)||0)-1;Q(e=>Math.min(r,e+1))},disabled:_>=((null==(c=ec[$])?void 0:c.length)||0)-1,className:"absolute right-4 p-4 text-white hover:bg-white/10 rounded-full disabled:opacity-30 disabled:cursor-not-allowed z-10 transition-colors",children:(0,a.jsx)("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),(0,a.jsx)("div",{className:"p-6 bg-gradient-to-t from-black/80 to-transparent text-white",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("h4",{className:"font-bold mb-2",children:["Shot ",null==(x=ec[$])||null==(u=x[_])?void 0:u.shotNumber," - ",null==(g=ec[$])||null==(b=g[_])?void 0:b.shotType]}),(0,a.jsx)("p",{className:"opacity-80",children:(null==(v=ec[$])||null==(y=v[_])?void 0:y.description)||(null==(f=ec[$])||null==(j=f[_])?void 0:j.actionDescription)||"No description provided."})]})})]})]})}let ty={overview:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),scenes:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),storyboards:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),schedule:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),cast:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),crew:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),equipment:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),locations:(0,a.jsxs)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),documents:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),budget:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),callsheets:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),analytics:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),settings:(0,a.jsxs)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),admin:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),integrations:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})},tv=[{title:"PLANNING",items:[{id:"overview",name:"Overview",icon:ty.overview},{id:"scenes",name:"Scenes & Shots",icon:ty.scenes},{id:"storyboards",name:"Storyboards",icon:ty.storyboards}]},{title:"PRODUCTION",items:[{id:"schedule",name:"Schedule",icon:ty.schedule},{id:"cast",name:"Cast",icon:ty.cast},{id:"crew",name:"Crew",icon:ty.crew},{id:"equipment",name:"Equipment",icon:ty.equipment},{id:"locations",name:"Locations",icon:ty.locations}]},{title:"POST-PRODUCTION",items:[{id:"documents",name:"Documents",icon:ty.documents},{id:"budget",name:"Budget",icon:ty.budget}]},{title:"REPORTS",items:[{id:"callsheets",name:"Call Sheets",icon:ty.callsheets},{id:"analytics",name:"Analytics",icon:ty.analytics}]},{title:"INTEGRATIONS",items:[{id:"integrations",name:"Integrations",icon:ty.integrations}]}];function tj(){let e=(0,l.useParams)(),t=(0,l.useRouter)(),r=e.projectId,[d,m]=(0,i.useState)("overview");(0,i.useEffect)(()=>{let e=()=>{{let e=window.location.hash.slice(1);if(e){let[t,r]=e.split("?"),a=new URLSearchParams(r||"").get("id");t&&tv.some(e=>e.items.some(e=>e.id===t))&&(m(t),a&&setTimeout(()=>{let e=document.getElementById("element-".concat(a));e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("ring-2","ring-accent-primary","bg-accent-primary/10"),setTimeout(()=>{e.classList.remove("ring-2","ring-accent-primary","bg-accent-primary/10")},2e3))},500))}}};return e(),window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[]);let{data:u,isLoading:p}=o.i.projects.getById.useQuery({id:r}),{data:h,isLoading:b}=o.i.projectMembers.getMyRole.useQuery({projectId:r});return((0,i.useEffect)(()=>{p||b||u||t.push("/dashboard"),p||b||!u||null!==h||t.push("/dashboard")},[u,h,p,b,t]),p||b)?(0,a.jsx)(s.O,{children:(0,a.jsx)(n.N,{children:(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"relative w-16 h-16",children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-accent-primary/20"}),(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-accent-primary animate-spin"})]})})})}):u?(0,a.jsx)(s.O,{children:(0,a.jsx)(n.N,{fullWidth:!0,children:(0,a.jsxs)("div",{className:"flex h-[calc(100vh-4rem)]",children:[(0,a.jsx)("aside",{className:"w-56 bg-background-secondary border-r border-border-subtle overflow-y-auto flex-shrink-0",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"mb-6 pb-4 border-b border-border-subtle",children:[(0,a.jsxs)(c(),{href:"/dashboard",className:"text-xs text-text-tertiary hover:text-accent-primary transition-colors flex items-center gap-1 mb-3",children:[(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Dashboard"]}),(0,a.jsx)("div",{className:"text-xs font-semibold text-text-tertiary mb-1 uppercase tracking-wider",children:"Project"}),(0,a.jsx)("div",{className:"text-sm font-bold text-text-primary truncate",title:u.title,children:u.title}),(0,a.jsx)("div",{className:"text-xs text-text-tertiary mt-1",children:u.client})]}),(0,a.jsx)("nav",{className:"space-y-6",children:tv.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-text-tertiary mb-2 uppercase tracking-wider",children:e.title}),(0,a.jsx)("div",{className:"space-y-1",children:e.items.map(e=>{let t="cast"===e.id?eM(null==u?void 0:u.projectType).cast.label:"scenes"===e.id?eM(null==u?void 0:u.projectType).scenes.label:e.name;return(0,a.jsxs)("button",{onClick:()=>m(e.id),className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all ".concat(d===e.id?"bg-accent-primary/10 text-accent-primary":"text-text-secondary hover:text-text-primary hover:bg-background-tertiary"),children:[e.icon,(0,a.jsx)("span",{children:t})]},e.id)})})]},e.title))}),(0,a.jsxs)("div",{className:"mt-6 pt-6 border-t border-border-subtle",children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-text-tertiary mb-2 uppercase tracking-wider",children:"SETTINGS"}),(0,a.jsx)("div",{className:"space-y-1",children:("owner"===h||"admin"===h||"dept_head"===h)&&(0,a.jsxs)("button",{onClick:()=>m("admin"),className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all ".concat("admin"===d?"bg-accent-primary/10 text-accent-primary":"text-text-secondary hover:text-text-primary hover:bg-background-tertiary"),children:[ty.admin,(0,a.jsx)("span",{children:"Admin"})]})})]})]})}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto bg-background-primary",children:(()=>{switch(d){case"overview":return(0,a.jsx)(x,{project:u,projectId:r,onNavigate:m});case"scenes":return(0,a.jsx)(tl,{projectId:r});case"storyboards":return(0,a.jsx)(tg,{projectId:r});case"cast":return(0,a.jsx)(y,{projectId:r});case"crew":return(0,a.jsx)(k,{projectId:r});case"equipment":return(0,a.jsx)(ew,{projectId:r});case"schedule":return(0,a.jsx)(eY,{projectId:r});case"budget":return(0,a.jsx)(e$,{projectId:r});case"locations":return(0,a.jsx)(e6,{projectId:r});case"integrations":return(0,a.jsx)(tx,{projectId:r});case"admin":return(0,a.jsx)(eX,{projectId:r,userRole:h});case"callsheets":return(0,a.jsx)(e1,{projectId:r});default:return(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Coming Soon"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"This module is under development"})]})})}})()})]})})}):(0,a.jsx)(s.O,{children:(0,a.jsx)(n.N,{children:(0,a.jsx)("div",{className:"text-center py-16",children:(0,a.jsx)("p",{className:"text-text-secondary",children:"Project not found"})})})})}},7767:(e,t,r)=>{"use strict";r.d(t,{G:()=>i,deleteImage:()=>l,generateUniqueFilename:()=>o,isBlobUrl:()=>d,uploadImage:()=>n});var a=r(3314),s=r(6847);let n=async(e,t)=>{try{let r=(0,a.KR)(s.IG,t),n=await (0,a.D)(r,e);return await (0,a.qk)(n.ref)}catch(e){throw console.error("Error uploading image:",e),Error("Failed to upload image")}},l=async e=>{try{let t=new URL(e).pathname.match(/\/o\/(.+)/);if(!t)throw Error("Invalid storage URL");let r=t[1],n=decodeURIComponent(r),l=(0,a.KR)(s.IG,n);await (0,a.XR)(l)}catch(e){console.error("Error deleting image:",e)}},o=e=>{let t=Date.now(),r=Math.random().toString(36).substring(2,8),a=e.split(".").pop()||"jpg";return"".concat(t,"-").concat(r,".").concat(a)},i=e=>e.includes("firebasestorage.googleapis.com"),d=e=>e.startsWith("blob:")},8175:(e,t,r)=>{"use strict";r.d(t,{Lq:()=>o,Mw:()=>l,Nf:()=>i,aN:()=>n,eO:()=>s});var a=r(7127);function s(e){return a.i.projectMembers.listByProject.useQuery({projectId:e})}function n(e){return a.i.projectMembers.getMyRole.useQuery({projectId:e})}function l(){let e=a.i.useUtils();return a.i.projectMembers.addMember.useMutation({onSuccess:t=>{e.projectMembers.listByProject.invalidate({projectId:t.projectId})}})}function o(){let e=a.i.useUtils();return a.i.projectMembers.updateRole.useMutation({onSuccess:t=>{e.projectMembers.listByProject.invalidate({projectId:t.projectId})}})}function i(){let e=a.i.useUtils();return a.i.projectMembers.removeMember.useMutation({onSuccess:()=>{e.projectMembers.listByProject.invalidate()}})}}},e=>{e.O(0,[680,661,201,637,223,956,674,718,795,358],()=>e(e.s=5401)),_N_E=e.O()}]);